import{r as L,j as w,R as qu,M as Zu,a as ds,b as Ue,c as U,H as $u,d as Ku,e as Ur,f as Qu,I as gs,F as ps,g as Ju,h as th,C as eh,i as rr,k as hc,o as nh,S as ih,L as sr,l as rh,u as sh,T as oh,m as ah,n as ch,p as lh,q as uh,s as hh,t as fh,v as or,w as dh,x as gh,y as ho,z as fo,A as ph,B as mh,D as _h,E as fc,G as dc,J as bh,K as yh,N as Eh,O as vh,Q as Th,P as wh,U as Ah,V as Sh,W as xh}from"./vendor.2182c948.js";function Ph(n,t){for(var e=0;e<t.length;e++){const i=t[e];if(typeof i!="string"&&!Array.isArray(i)){for(const r in i)if(r!=="default"&&!(r in n)){const s=Object.getOwnPropertyDescriptor(i,r);s&&Object.defineProperty(n,r,s.get?s:{enumerable:!0,get:()=>i[r]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerpolicy&&(s.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?s.credentials="include":r.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=e(r);fetch(r.href,s)}})();var gt;(function(n){n.MOBILE="MOBILE",n.DESKTOP="DESKTOP"})(gt||(gt={}));const gc="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,pc=L.exports.createContext({size:gt.DESKTOP,isTouchDevice:gc}),Mh=n=>{const[t,e]=L.exports.useState({size:window.innerWidth>n.breakPoint?gt.DESKTOP:gt.MOBILE,isTouchDevice:gc});return L.exports.useLayoutEffect(()=>{const i=r=>{const s=window.innerWidth;s>n.breakPoint&&t.size===gt.MOBILE?e({...t,size:gt.DESKTOP}):s<n.breakPoint&&t.size===gt.DESKTOP&&e({...t,size:gt.MOBILE})};return window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)},[n.breakPoint,t]),w(pc.Provider,{value:t,children:n.children})},ce=()=>L.exports.useContext(pc),Lh=n=>w(qu,{children:w(Mh,{breakPoint:n.breakPoint||540,children:w(Zu,{children:n.children})})});const mc=L.exports.createContext({}),Oi=()=>L.exports.useContext(mc);var se;(function(n){n.PENDING="PENDING",n.OK="OK",n.FAILED="FAILED"})(se||(se={}));const Rh=ds({key:"search",default:{args:{},status:se.OK}}),Sn=()=>{const[n,t]=Ue(Rh),e=(c={})=>t({args:c,status:se.PENDING,result:n.result});return{changeSearchQuery:c=>e({...n.args,query:c}),clearSearchQuery:()=>e({...n.args,query:void 0}),refreshSearch:()=>e({...n.args}),search:n,setActiveAggregation:c=>t({args:{...n.args,activeAggregation:c},status:n.status,result:n.result}),setFilter:c=>{const l=[...(n.args.filters||[]).filter(u=>u.name!==c.name),c];e({...n.args,filters:l})},setSearchState:t}},Ih=n=>{const t=n.activeAggregation||n.aggregations[0]||"",e=i=>()=>{const{length:r}=n.aggregations,o=(n.aggregations.indexOf(t)+i+r)%r;n.onChangeAggregation(n.aggregations[o])};return U("div",{className:"p6o-aggs-carousel",children:[w("button",{tabIndex:4,"aria-label":"Previous filter category",onClick:e(-1),children:w($u,{})}),w("h3",{"aria-live":"polite","aria-atomic":!0,children:t}),w("button",{tabIndex:5,"aria-label":"Next filter category",onClick:e(1),children:w(Ku,{})})]})},Ch=n=>n>1e3?(n/1e3).toFixed(1)+"k":n>1e6?(n/1e6).toFixed(1)+"M":n,Oh=n=>w("div",{className:"p6o-aggs-values",children:w("ul",{children:n.buckets.map(({label:t,count:e})=>w("li",{className:n.filterValues.length>0&&!n.filterValues.includes(t)?"p6o-value-unselected":"",onClick:n.onToggleFilterValue(t),children:U("div",{className:"p6o-agg-value-wrapper",children:[w("span",{className:"p6o-agg-value-count",style:{backgroundColor:n.colors&&n.colors[t],borderColor:n.colors&&n.colors[t]&&Ur(n.colors[t]).alpha(.8).hex()},children:Ch(e)}),w("span",{className:"p6o-agg-value-label",children:t})]})},t))})});const go=n=>{var l,u,h,g;const{search:t,setFilter:e,setActiveAggregation:i}=Sn(),r=(l=t.result)!=null&&l.aggregations?Object.keys(t.result.aggregations):[],s=n.displayFacets||r,o=t.args.activeAggregation||s[0]||"",a=((h=(u=t.args.filters)==null?void 0:u.find(m=>m.name===o))==null?void 0:h.values)||[],c=m=>()=>{const b=a.includes(m)?{name:o,values:a.filter(y=>y!==m)}:{name:o,values:[...a,m]};e(b)};return U("div",{className:n.fullscreen?"p6o-aggs p6o-aggs-overlay fullscreen":"p6o-aggs p6o-aggs-overlay",children:[w(Ih,{aggregations:s,activeAggregation:o,onChangeAggregation:i}),((g=t.result)==null?void 0:g.aggregations)&&w(Oh,{buckets:t.result.aggregations[o].buckets,colors:n.colors,filterValues:a,onToggleFilterValue:c})]})},po=n=>ce().size===gt.DESKTOP?n.children:null,_c=n=>{const t=L.exports.useRef(null);L.exports.useEffect(()=>{const i=r=>{r.key==="Escape"&&n.onClose(null)};return document.addEventListener("keydown",i),()=>document.removeEventListener("keydown",i)},[]);const e=i=>{i.target===t.current&&n.onClose(i)};return Qu.createPortal(U("div",{ref:t,className:n.className?`p6o-info-modal-bg ${n.className}`:"p6o-info-modal-bg",onClick:e,children:[w("button",{className:"p6o-info-modal-close",onClick:n.onClose,children:w(gs,{})}),w("main",{className:"p6o-info-modal-main",children:n.children})]}),document.body)};const kh=n=>{const[t,e]=L.exports.useState(!1);return U(ps,{children:[w("button",{className:"p6o-controls-btn p6o-info",tabIndex:41,"aria-label":"Information",onClick:()=>e(!0),children:w(Ju,{})}),t&&w(_c,{className:n.className,onClose:()=>e(!1),children:n.children})]})},mo=n=>ce().size===gt.MOBILE?n.children:null;const Nh=n=>{const[t,e]=L.exports.useState(!1);return U(ps,{children:[w("button",{className:"p6o-controls-btn p6o-mobile-menu-btn",tabIndex:42,"aria-label":"Open menu",onClick:()=>e(!0),children:w(th,{})}),w(eh,{in:t,className:"p6o-mobile-menu",classNames:"p6o-mobile-menu",timeout:200,unmountOnExit:!0,children:U("div",{className:"p6o-mobile-menu",children:[w("button",{className:"p6o-mobile-menu-close",onClick:()=>e(!1),children:w(gs,{})}),w("main",{children:n.items.length===1?n.items[0]:null})]})})]})},ki=ds({key:"mapView",default:{}}),gi=n=>{const{longitude:t,latitude:e,zoom:i}=n,r=s=>s!==void 0;return r(t)&&r(e)&&r(i)},Dh=ds({key:"selected",default:null});function pi(n,t){if(!n)throw new Error(t||"loader assertion failed.")}const ms=Boolean(typeof process!="object"||String(process)!=="[object process]"||process.browser),_o=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);_o&&parseFloat(_o[1]);const Fh="3.2.11";function Yt(n,t){if(!n)throw new Error(t||"loaders.gl assertion failed.")}const si=typeof process!="object"||String(process)!=="[object process]"||process.browser,Uh=typeof window<"u"&&typeof window.orientation<"u",bo=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);bo&&parseFloat(bo[1]);function f(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}class Bh{constructor(t,e){f(this,"name",void 0),f(this,"workerThread",void 0),f(this,"isRunning",!0),f(this,"result",void 0),f(this,"_resolve",()=>{}),f(this,"_reject",()=>{}),this.name=t,this.workerThread=e,this.result=new Promise((i,r)=>{this._resolve=i,this._reject=r})}postMessage(t,e){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:e})}done(t){Yt(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){Yt(this.isRunning),this.isRunning=!1,this._reject(t)}}class ar{}const cr=new Map;function Vh(n){Yt(n.source&&!n.url||!n.source&&n.url);let t=cr.get(n.source||n.url);return t||(n.url&&(t=jh(n.url),cr.set(n.url,t)),n.source&&(t=bc(n.source),cr.set(n.source,t))),Yt(t),t}function jh(n){if(!n.startsWith("http"))return n;const t=zh(n);return bc(t)}function bc(n){const t=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(t)}function zh(n){return`try {
  importScripts('`.concat(n,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function yc(n,t=!0,e){const i=e||new Set;if(n){if(yo(n))i.add(n);else if(yo(n.buffer))i.add(n.buffer);else if(!ArrayBuffer.isView(n)){if(t&&typeof n=="object")for(const r in n)yc(n[r],t,i)}}return e===void 0?Array.from(i):[]}function yo(n){return n?n instanceof ArrayBuffer||typeof MessagePort<"u"&&n instanceof MessagePort||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas:!1}const lr=()=>{};class Br{static isSupported(){return typeof Worker<"u"&&si||typeof ar<"u"&&!si}constructor(t){f(this,"name",void 0),f(this,"source",void 0),f(this,"url",void 0),f(this,"terminated",!1),f(this,"worker",void 0),f(this,"onMessage",void 0),f(this,"onError",void 0),f(this,"_loadableURL","");const{name:e,source:i,url:r}=t;Yt(i||r),this.name=e,this.source=i,this.url=r,this.onMessage=lr,this.onError=s=>console.log(s),this.worker=si?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=lr,this.onError=lr,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(t,e){e=e||yc(t),this.worker.postMessage(t,e)}_getErrorFromErrorEvent(t){let e="Failed to load ";return e+="worker ".concat(this.name," from ").concat(this.url,". "),t.message&&(e+="".concat(t.message," in ")),t.lineno&&(e+=":".concat(t.lineno,":").concat(t.colno)),new Error(e)}_createBrowserWorker(){this._loadableURL=Vh({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},t.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},t.onmessageerror=e=>console.error(e),t}_createNodeWorker(){let t;if(this.url){const i=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);t=new ar(i,{eval:!1})}else if(this.source)t=new ar(this.source,{eval:!0});else throw new Error("no worker");return t.on("message",e=>{this.onMessage(e)}),t.on("error",e=>{this.onError(e)}),t.on("exit",e=>{}),t}}class Gh{static isSupported(){return Br.isSupported()}constructor(t){f(this,"name","unnamed"),f(this,"source",void 0),f(this,"url",void 0),f(this,"maxConcurrency",1),f(this,"maxMobileConcurrency",1),f(this,"onDebug",()=>{}),f(this,"reuseWorkers",!0),f(this,"props",{}),f(this,"jobQueue",[]),f(this,"idleQueue",[]),f(this,"count",0),f(this,"isDestroyed",!1),this.source=t.source,this.url=t.url,this.setProps(t)}destroy(){this.idleQueue.forEach(t=>t.destroy()),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},t.name!==void 0&&(this.name=t.name),t.maxConcurrency!==void 0&&(this.maxConcurrency=t.maxConcurrency),t.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=t.maxMobileConcurrency),t.reuseWorkers!==void 0&&(this.reuseWorkers=t.reuseWorkers),t.onDebug!==void 0&&(this.onDebug=t.onDebug)}async startJob(t,e=(r,s,o)=>r.done(o),i=(r,s)=>r.error(s)){const r=new Promise(s=>(this.jobQueue.push({name:t,onMessage:e,onError:i,onStart:s}),this));return this._startQueuedJob(),await r}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const e=this.jobQueue.shift();if(e){this.onDebug({message:"Starting job",name:e.name,workerThread:t,backlog:this.jobQueue.length});const i=new Bh(e.name,t);t.onMessage=r=>e.onMessage(i,r.type,r.payload),t.onError=r=>e.onError(i,r),e.onStart(i);try{await i.result}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const t="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new Br({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return Uh?this.maxMobileConcurrency:this.maxConcurrency}}const Hh={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class Wt{static isSupported(){return Br.isSupported()}static getWorkerFarm(t={}){return Wt._workerFarm=Wt._workerFarm||new Wt({}),Wt._workerFarm.setProps(t),Wt._workerFarm}constructor(t){f(this,"props",void 0),f(this,"workerPools",new Map),this.props={...Hh},this.setProps(t),this.workerPools=new Map}destroy(){for(const t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(const e of this.workerPools.values())e.setProps(this._getWorkerPoolProps())}getWorkerPool(t){const{name:e,source:i,url:r}=t;let s=this.workerPools.get(e);return s||(s=new Gh({name:e,source:i,url:r}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(e,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}f(Wt,"_workerFarm",void 0);const Wh="latest";function Xh(n,t={}){const e=t[n.id]||{},i="".concat(n.id,"-worker.js");let r=e.workerUrl;if(!r&&n.id==="compression"&&(r=t.workerUrl),t._workerType==="test"&&(r="modules/".concat(n.module,"/dist/").concat(i)),!r){let s=n.version;s==="latest"&&(s=Wh);const o=s?"@".concat(s):"";r="https://unpkg.com/@loaders.gl/".concat(n.module).concat(o,"/dist/").concat(i)}return Yt(r),r}function Yh(n,t=Fh){Yt(n,"no worker provided");const e=n.version;return!(!t||!e)}function qh(n,t){return!Wt.isSupported()||!si&&!(t!=null&&t._nodeWorkers)?!1:n.worker&&(t==null?void 0:t.worker)}async function Zh(n,t,e,i,r){const s=n.id,o=Xh(n,e),c=Wt.getWorkerFarm(e).getWorkerPool({name:s,url:o});e=JSON.parse(JSON.stringify(e)),i=JSON.parse(JSON.stringify(i||{}));const l=await c.startJob("process-on-worker",$h.bind(null,r));return l.postMessage("process",{input:t,options:e,context:i}),await(await l.result).result}async function $h(n,t,e,i){switch(e){case"done":t.done(i);break;case"error":t.error(new Error(i.error));break;case"process":const{id:r,input:s,options:o}=i;try{const a=await n(s,o);t.postMessage("done",{id:r,result:a})}catch(a){const c=a instanceof Error?a.message:"unknown error";t.postMessage("error",{id:r,error:c})}break;default:console.warn("parse-with-worker unknown message ".concat(e))}}function Ec(n){return n&&typeof n=="object"&&n.isBuffer}function Kh(n){return Ec(n)?new Uint8Array(n.buffer,n.byteOffset,n.length).slice().buffer:n}function vc(n){if(Ec(n))return Kh(n);if(n instanceof ArrayBuffer)return n;if(ArrayBuffer.isView(n))return n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength);if(typeof n=="string"){const t=n;return new TextEncoder().encode(t).buffer}if(n&&typeof n=="object"&&n._toArrayBuffer)return n._toArrayBuffer();throw new Error("toArrayBuffer")}function Qh(n,t,e){if(e=e||n.byteLength,n.byteLength<e||t.byteLength<e)return!1;const i=new Uint8Array(n),r=new Uint8Array(t);for(let s=0;s<i.length;++s)if(i[s]!==r[s])return!1;return!0}function Jh(...n){const t=n.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),e=t.reduce((s,o)=>s+o.byteLength,0),i=new Uint8Array(e);let r=0;for(const s of t)i.set(s,r),r+=s.byteLength;return i.buffer}async function tf(n){const t=[];for await(const e of n)t.push(e);return Jh(...t)}function Eo(){let n;if(typeof window<"u"&&window.performance)n=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();n=t[0]*1e3+t[1]/1e6}else n=Date.now();return n}class vo{constructor(t,e){f(this,"name",void 0),f(this,"type",void 0),f(this,"sampleSize",1),f(this,"time",void 0),f(this,"count",void 0),f(this,"samples",void 0),f(this,"lastTiming",void 0),f(this,"lastSampleTime",void 0),f(this,"lastSampleCount",void 0),f(this,"_count",0),f(this,"_time",0),f(this,"_samples",0),f(this,"_startTime",0),f(this,"_timerPending",!1),this.name=t,this.type=e,this.reset()}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Eo(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Eo()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class _s{constructor(t){f(this,"id",void 0),f(this,"stats",{}),this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:t,type:e})}get size(){return Object.keys(this.stats).length}reset(){for(const t in this.stats)this.stats[t].reset();return this}forEach(t){for(const e in this.stats)t(this.stats[e])}getTable(){const t={};return this.forEach(e=>{t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}}),t}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(e=>this._getOrCreate(e))}_getOrCreate(t){if(!t||!t.name)return null;const{name:e,type:i}=t;return this.stats[e]||(t instanceof vo?this.stats[e]=t:this.stats[e]=new vo(e,i)),this.stats[e]}}let ef="";const To={};function nf(n){for(const t in To)if(n.startsWith(t)){const e=To[t];n=n.replace(t,e)}return!n.startsWith("http://")&&!n.startsWith("https://")&&(n="".concat(ef).concat(n)),n}function rf(n){const t=n&&n.lastIndexOf("/");return t>=0?n.substr(t+1):""}const sf=n=>typeof n=="boolean",pn=n=>typeof n=="function",xn=n=>n!==null&&typeof n=="object",wo=n=>xn(n)&&n.constructor==={}.constructor,of=n=>n&&typeof n[Symbol.iterator]=="function",af=n=>n&&typeof n[Symbol.asyncIterator]=="function",Xe=n=>typeof Response<"u"&&n instanceof Response||n&&n.arrayBuffer&&n.text&&n.json,Ye=n=>typeof Blob<"u"&&n instanceof Blob,cf=n=>n&&typeof n=="object"&&n.isBuffer,lf=n=>typeof ReadableStream<"u"&&n instanceof ReadableStream||xn(n)&&pn(n.tee)&&pn(n.cancel)&&pn(n.getReader),uf=n=>xn(n)&&pn(n.read)&&pn(n.pipe)&&sf(n.readable),Tc=n=>lf(n)||uf(n),hf=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,ff=/^([-\w.]+\/[-\w.+]+)/;function df(n){const t=ff.exec(n);return t?t[1]:n}function Ao(n){const t=hf.exec(n);return t?t[1]:""}const gf=/\?.*/;function Ni(n){if(Xe(n)){const t=ur(n.url||""),e=n.headers.get("content-type")||"";return{url:t,type:df(e)||Ao(t)}}return Ye(n)?{url:ur(n.name||""),type:n.type||""}:typeof n=="string"?{url:ur(n),type:Ao(n)}:{url:"",type:""}}function pf(n){return Xe(n)?n.headers["content-length"]||-1:Ye(n)?n.size:typeof n=="string"?n.length:n instanceof ArrayBuffer||ArrayBuffer.isView(n)?n.byteLength:-1}function ur(n){return n.replace(gf,"")}async function wc(n){if(Xe(n))return n;const t={},e=pf(n);e>=0&&(t["content-length"]=String(e));const{url:i,type:r}=Ni(n);r&&(t["content-type"]=r);const s=await bf(n);s&&(t["x-first-bytes"]=s),typeof n=="string"&&(n=new TextEncoder().encode(n));const o=new Response(n,{headers:t});return Object.defineProperty(o,"url",{value:i}),o}async function mf(n){if(!n.ok){const t=await _f(n);throw new Error(t)}}async function _f(n){let t="Failed to fetch resource ".concat(n.url," (").concat(n.status,"): ");try{const e=n.headers.get("Content-Type");let i=n.statusText;e.includes("application/json")&&(i+=" ".concat(await n.text())),t+=i,t=t.length>60?"".concat(t.slice(0,60),"..."):t}catch{}return t}async function bf(n){if(typeof n=="string")return"data:,".concat(n.slice(0,5));if(n instanceof Blob){const e=n.slice(0,5);return await new Promise(i=>{const r=new FileReader;r.onload=s=>{var o;return i(s==null||(o=s.target)===null||o===void 0?void 0:o.result)},r.readAsDataURL(e)})}if(n instanceof ArrayBuffer){const e=n.slice(0,5),i=yf(e);return"data:base64,".concat(i)}return null}function yf(n){let t="";const e=new Uint8Array(n);for(let i=0;i<e.byteLength;i++)t+=String.fromCharCode(e[i]);return btoa(t)}async function So(n,t){if(typeof n=="string"){n=nf(n);let e=t;return t!=null&&t.fetch&&typeof(t==null?void 0:t.fetch)!="function"&&(e=t.fetch),await fetch(n,e)}return await wc(n)}function Ac(n){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&Boolean(process.versions.electron))return!0;const t=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,e=n||t;return!!(e&&e.indexOf("Electron")>=0)}function Kt(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||Ac()}const oi={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},Xn=oi.window||oi.self||oi.global,on=oi.process||{},Sc=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";Kt();const hr=globalThis;function xc(n){if(!n&&!Kt())return"Node";if(Ac(n))return"Electron";const e=n||(typeof navigator<"u"?navigator:{}).userAgent||"";if(e.indexOf("Edge")>-1)return"Edge";const i=e.indexOf("MSIE ")!==-1,r=e.indexOf("Trident/")!==-1;return i||r?"IE":hr.chrome?"Chrome":hr.safari?"Safari":hr.mozInnerScreenX?"Firefox":"Unknown"}function Ef(n){try{const t=window[n],e="__storage_test__";return t.setItem(e,e),t.removeItem(e),t}catch{return null}}class vf{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";f(this,"storage",void 0),f(this,"id",void 0),f(this,"config",{}),this.storage=Ef(i),this.id=t,this.config={},Object.assign(this.config,e),this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){return this.config={},this.updateConfiguration(t)}updateConfiguration(t){if(Object.assign(this.config,t),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}return this}_loadConfiguration(){let t={};if(this.storage){const e=this.storage.getItem(this.id);t=e?JSON.parse(e):{}}return Object.assign(this.config,t),this}}function Tf(n){let t;return n<10?t="".concat(n.toFixed(2),"ms"):n<100?t="".concat(n.toFixed(1),"ms"):n<1e3?t="".concat(n.toFixed(0),"ms"):t="".concat((n/1e3).toFixed(2),"s"),t}function wf(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const e=Math.max(t-n.length,0);return"".concat(" ".repeat(e)).concat(n)}function fr(n,t,e){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const r=n.src.replace(/\(/g,"%28").replace(/\)/g,"%29");n.width>i&&(e=Math.min(e,i/n.width));const s=n.width*e,o=n.height*e,a=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(s/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(r,");"),"background-size:".concat(s,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(t," %c+"),a]}let mi;(function(n){n[n.BLACK=30]="BLACK",n[n.RED=31]="RED",n[n.GREEN=32]="GREEN",n[n.YELLOW=33]="YELLOW",n[n.BLUE=34]="BLUE",n[n.MAGENTA=35]="MAGENTA",n[n.CYAN=36]="CYAN",n[n.WHITE=37]="WHITE",n[n.BRIGHT_BLACK=90]="BRIGHT_BLACK",n[n.BRIGHT_RED=91]="BRIGHT_RED",n[n.BRIGHT_GREEN=92]="BRIGHT_GREEN",n[n.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",n[n.BRIGHT_BLUE=94]="BRIGHT_BLUE",n[n.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",n[n.BRIGHT_CYAN=96]="BRIGHT_CYAN",n[n.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(mi||(mi={}));function xo(n){return typeof n=="string"?mi[n.toUpperCase()]||mi.WHITE:n}function Af(n,t,e){return!Kt&&typeof n=="string"&&(t&&(t=xo(t),n="\x1B[".concat(t,"m").concat(n,"\x1B[39m")),e&&(t=xo(e),n="\x1B[".concat(e+10,"m").concat(n,"\x1B[49m"))),n}function Sf(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const e=Object.getPrototypeOf(n),i=Object.getOwnPropertyNames(e);for(const r of i)typeof n[r]=="function"&&(t.find(s=>r===s)||(n[r]=n[r].bind(n)))}function _i(n,t){if(!n)throw new Error(t||"Assertion failed")}function Ae(){let n;if(Kt&&"performance"in Xn){var t,e;n=Xn==null||(t=Xn.performance)===null||t===void 0||(e=t.now)===null||e===void 0?void 0:e.call(t)}else if("hrtime"in on){var i;const r=on==null||(i=on.hrtime)===null||i===void 0?void 0:i.call(on);n=r[0]*1e3+r[1]/1e6}else n=Date.now();return n}const Se={debug:Kt&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},xf={enabled:!0,level:0};function St(){}const Po={},Mo={once:!0};class Pn{constructor(){let{id:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};f(this,"id",void 0),f(this,"VERSION",Sc),f(this,"_startTs",Ae()),f(this,"_deltaTs",Ae()),f(this,"_storage",void 0),f(this,"userData",{}),f(this,"LOG_THROTTLE_TIMEOUT",0),this.id=t,this._storage=new vf("__probe-".concat(this.id,"__"),xf),this.userData={},this.timeStamp("".concat(this.id," started")),Sf(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Ae()-this._startTs).toPrecision(10))}getDelta(){return Number((Ae()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.updateConfiguration({enabled:t}),this}setLevel(t){return this._storage.updateConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,e){this._storage.updateConfiguration({[t]:e})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,e){_i(t,e)}warn(t){return this._getLogFunction(0,t,Se.warn,arguments,Mo)}error(t){return this._getLogFunction(0,t,Se.error,arguments)}deprecated(t,e){return this.warn("`".concat(t,"` is deprecated and will be removed in a later version. Use `").concat(e,"` instead"))}removed(t,e){return this.error("`".concat(t,"` has been removed. Use `").concat(e,"` instead"))}probe(t,e){return this._getLogFunction(t,e,Se.log,arguments,{time:!0,once:!0})}log(t,e){return this._getLogFunction(t,e,Se.debug,arguments)}info(t,e){return this._getLogFunction(t,e,console.info,arguments)}once(t,e){for(var i=arguments.length,r=new Array(i>2?i-2:0),s=2;s<i;s++)r[s-2]=arguments[s];return this._getLogFunction(t,e,Se.debug||Se.info,arguments,Mo)}table(t,e,i){return e?this._getLogFunction(t,e,console.table||St,i&&[i],{tag:Rf(e)}):St}image(t){let{logLevel:e,priority:i,image:r,message:s="",scale:o=1}=t;return this._shouldLog(e||i)?Kt?Lf({image:r,message:s,scale:o}):Mf({image:r,message:s,scale:o}):St}time(t,e){return this._getLogFunction(t,e,console.time?console.time:console.info)}timeEnd(t,e){return this._getLogFunction(t,e,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,e){return this._getLogFunction(t,e,console.timeStamp||St)}group(t,e){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const r=Lo({logLevel:t,message:e,opts:i}),{collapsed:s}=i;return r.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(t,e){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(t,e,Object.assign({},i,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||St)}withGroup(t,e,i){this.group(t,e)();try{i()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=Pc(t)}_getLogFunction(t,e,i,r,s){if(this._shouldLog(t)){s=Lo({logLevel:t,message:e,args:r,opts:s}),i=i||s.method,_i(i),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=Ae();const o=s.tag||s.message;if(s.once)if(!Po[o])Po[o]=Ae();else return St;return e=Pf(this.id,s.message,s),i.bind(console,e,...s.args)}return St}}f(Pn,"VERSION",Sc);function Pc(n){if(!n)return 0;let t;switch(typeof n){case"number":t=n;break;case"object":t=n.logLevel||n.priority||0;break;default:return 0}return _i(Number.isFinite(t)&&t>=0),t}function Lo(n){const{logLevel:t,message:e}=n;n.logLevel=Pc(t);const i=n.args?Array.from(n.args):[];for(;i.length&&i.shift()!==e;);switch(typeof t){case"string":case"function":e!==void 0&&i.unshift(e),n.message=t;break;case"object":Object.assign(n,t);break}typeof n.message=="function"&&(n.message=n.message());const r=typeof n.message;return _i(r==="string"||r==="object"),Object.assign(n,{args:i},n.opts)}function Pf(n,t,e){if(typeof t=="string"){const i=e.time?wf(Tf(e.total)):"";t=e.time?"".concat(n,": ").concat(i,"  ").concat(t):"".concat(n,": ").concat(t),t=Af(t,e.color,e.background)}return t}function Mf(n){let{image:t,message:e="",scale:i=1}=n;return(void 0)({image:t,message:e,scale:i}),St}function Lf(n){let{image:t,message:e="",scale:i=1}=n;if(typeof t=="string"){const s=new Image;return s.onload=()=>{const o=fr(s,e,i);console.log(...o)},s.src=t,St}const r=t.nodeName||"";if(r.toLowerCase()==="img")return console.log(...fr(t,e,i)),St;if(r.toLowerCase()==="canvas"){const s=new Image;return s.onload=()=>console.log(...fr(s,e,i)),s.src=t.toDataURL(),St}return St}function Rf(n){for(const t in n)for(const e in n[t])return e||"untitled";return"empty"}const Ro=new Pn({id:"loaders.gl"});class If{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class Cf{constructor(){f(this,"console",void 0),this.console=console}log(...t){return this.console.log.bind(this.console,...t)}info(...t){return this.console.info.bind(this.console,...t)}warn(...t){return this.console.warn.bind(this.console,...t)}error(...t){return this.console.error.bind(this.console,...t)}}const Mc={fetch:null,mimeType:void 0,nothrow:!1,log:new Cf,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:ms,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},Of={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Lc(){globalThis.loaders=globalThis.loaders||{};const{loaders:n}=globalThis;return n._state=n._state||{},n._state}const Rc=()=>{const n=Lc();return n.globalOptions=n.globalOptions||{...Mc},n.globalOptions};function kf(n,t,e,i){return e=e||[],e=Array.isArray(e)?e:[e],Nf(n,e),Ff(t,n,i)}function Ic(n,t){const e=Rc(),i=n||e;return typeof i.fetch=="function"?i.fetch:xn(i.fetch)?r=>So(r,i):t!=null&&t.fetch?t==null?void 0:t.fetch:So}function Nf(n,t){Io(n,null,Mc,Of,t);for(const e of t){const i=n&&n[e.id]||{},r=e.options&&e.options[e.id]||{},s=e.deprecatedOptions&&e.deprecatedOptions[e.id]||{};Io(i,e.id,r,s,t)}}function Io(n,t,e,i,r){const s=t||"Top level",o=t?"".concat(t,"."):"";for(const a in n){const c=!t&&xn(n[a]),l=a==="baseUri"&&!t,u=a==="workerUrl"&&t;if(!(a in e)&&!l&&!u){if(a in i)Ro.warn("".concat(s," loader option '").concat(o).concat(a,"' no longer supported, use '").concat(i[a],"'"))();else if(!c){const h=Df(a,r);Ro.warn("".concat(s," loader option '").concat(o).concat(a,"' not recognized. ").concat(h))()}}}}function Df(n,t){const e=n.toLowerCase();let i="";for(const r of t)for(const s in r.options){if(n===s)return"Did you mean '".concat(r.id,".").concat(s,"'?");const o=s.toLowerCase();(e.startsWith(o)||o.startsWith(e))&&(i=i||"Did you mean '".concat(r.id,".").concat(s,"'?"))}return i}function Ff(n,t,e){const r={...n.options||{}};return Uf(r,e),r.log===null&&(r.log=new If),Co(r,Rc()),Co(r,t),r}function Co(n,t){for(const e in t)if(e in t){const i=t[e];wo(i)&&wo(n[e])?n[e]={...n[e],...t[e]}:n[e]=t[e]}}function Uf(n,t){t&&!("baseUri"in n)&&(n.baseUri=t)}function bs(n){var t;return n?(Array.isArray(n)&&(n=n[0]),Array.isArray((t=n)===null||t===void 0?void 0:t.extensions)):!1}function ys(n){var t,e;pi(n,"null loader"),pi(bs(n),"invalid loader");let i;return Array.isArray(n)&&(i=n[1],n=n[0],n={...n,options:{...n.options,...i}}),((t=n)!==null&&t!==void 0&&t.parseTextSync||(e=n)!==null&&e!==void 0&&e.parseText)&&(n.text=!0),n.text||(n.binary=!0),n}const Cc=()=>{const n=Lc();return n.loaderRegistry=n.loaderRegistry||[],n.loaderRegistry};function Bf(n){const t=Cc();n=Array.isArray(n)?n:[n];for(const e of n){const i=ys(e);t.find(r=>i===r)||t.unshift(i)}}function Vf(){return Cc()}const jf=new Pn({id:"loaders.gl"}),zf=/\.([^.]+)$/;async function Gf(n,t=[],e,i){if(!Oc(n))return null;let r=Oo(n,t,{...e,nothrow:!0},i);if(r)return r;if(Ye(n)&&(n=await n.slice(0,10).arrayBuffer(),r=Oo(n,t,e,i)),!r&&!(e!=null&&e.nothrow))throw new Error(kc(n));return r}function Oo(n,t=[],e,i){if(!Oc(n))return null;if(t&&!Array.isArray(t))return ys(t);let r=[];t&&(r=r.concat(t)),e!=null&&e.ignoreRegisteredLoaders||r.push(...Vf()),Wf(r);const s=Hf(n,r,e,i);if(!s&&!(e!=null&&e.nothrow))throw new Error(kc(n));return s}function Hf(n,t,e,i){const{url:r,type:s}=Ni(n),o=r||(i==null?void 0:i.url);let a=null,c="";if(e!=null&&e.mimeType&&(a=dr(t,e==null?void 0:e.mimeType),c="match forced by supplied MIME type ".concat(e==null?void 0:e.mimeType)),a=a||Xf(t,o),c=c||(a?"matched url ".concat(o):""),a=a||dr(t,s),c=c||(a?"matched MIME type ".concat(s):""),a=a||qf(t,n),c=c||(a?"matched initial data ".concat(Nc(n)):""),a=a||dr(t,e==null?void 0:e.fallbackMimeType),c=c||(a?"matched fallback MIME type ".concat(s):""),c){var l;jf.log(1,"selectLoader selected ".concat((l=a)===null||l===void 0?void 0:l.name,": ").concat(c,"."))}return a}function Oc(n){return!(n instanceof Response&&n.status===204)}function kc(n){const{url:t,type:e}=Ni(n);let i="No valid loader found (";i+=t?"".concat(rf(t),", "):"no url provided, ",i+="MIME type: ".concat(e?'"'.concat(e,'"'):"not provided",", ");const r=n?Nc(n):"";return i+=r?' first bytes: "'.concat(r,'"'):"first bytes: not available",i+=")",i}function Wf(n){for(const t of n)ys(t)}function Xf(n,t){const e=t&&zf.exec(t),i=e&&e[1];return i?Yf(n,i):null}function Yf(n,t){t=t.toLowerCase();for(const e of n)for(const i of e.extensions)if(i.toLowerCase()===t)return e;return null}function dr(n,t){for(const e of n)if(e.mimeTypes&&e.mimeTypes.includes(t)||t==="application/x.".concat(e.id))return e;return null}function qf(n,t){if(!t)return null;for(const e of n)if(typeof t=="string"){if(Zf(t,e))return e}else if(ArrayBuffer.isView(t)){if(ko(t.buffer,t.byteOffset,e))return e}else if(t instanceof ArrayBuffer&&ko(t,0,e))return e;return null}function Zf(n,t){return t.testText?t.testText(n):(Array.isArray(t.tests)?t.tests:[t.tests]).some(i=>n.startsWith(i))}function ko(n,t,e){return(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>$f(n,t,e,r))}function $f(n,t,e,i){if(i instanceof ArrayBuffer)return Qh(i,n,i.byteLength);switch(typeof i){case"function":return i(n,e);case"string":const r=Vr(n,t,i.length);return i===r;default:return!1}}function Nc(n,t=5){return typeof n=="string"?n.slice(0,t):ArrayBuffer.isView(n)?Vr(n.buffer,n.byteOffset,t):n instanceof ArrayBuffer?Vr(n,0,t):""}function Vr(n,t,e){if(n.byteLength<t+e)return"";const i=new DataView(n);let r="";for(let s=0;s<e;s++)r+=String.fromCharCode(i.getUint8(t+s));return r}const Kf=256*1024;function*Qf(n,t){const e=(t==null?void 0:t.chunkSize)||Kf;let i=0;const r=new TextEncoder;for(;i<n.length;){const s=Math.min(n.length-i,e),o=n.slice(i,i+s);i+=s,yield r.encode(o)}}const Jf=256*1024;function*td(n,t={}){const{chunkSize:e=Jf}=t;let i=0;for(;i<n.byteLength;){const r=Math.min(n.byteLength-i,e),s=new ArrayBuffer(r),o=new Uint8Array(n,i,r);new Uint8Array(s).set(o),i+=r,yield s}}const ed=1024*1024;async function*nd(n,t){const e=(t==null?void 0:t.chunkSize)||ed;let i=0;for(;i<n.size;){const r=i+e,s=await n.slice(i,r).arrayBuffer();i=r,yield s}}function No(n,t){return ms?id(n,t):rd(n)}async function*id(n,t){const e=n.getReader();let i;try{for(;;){const r=i||e.read();t!=null&&t._streamReadAhead&&(i=e.read());const{done:s,value:o}=await r;if(s)return;yield vc(o)}}catch{e.releaseLock()}}async function*rd(n,t){for await(const e of n)yield vc(e)}function sd(n,t){if(typeof n=="string")return Qf(n,t);if(n instanceof ArrayBuffer)return td(n,t);if(Ye(n))return nd(n,t);if(Tc(n))return No(n,t);if(Xe(n))return No(n.body,t);throw new Error("makeIterator")}const Dc="Cannot convert supplied data type";function od(n,t,e){if(t.text&&typeof n=="string")return n;if(cf(n)&&(n=n.buffer),n instanceof ArrayBuffer){const i=n;return t.text&&!t.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(n)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(n);let i=n.buffer;const r=n.byteLength||n.length;return(n.byteOffset!==0||r!==i.byteLength)&&(i=i.slice(n.byteOffset,n.byteOffset+r)),i}throw new Error(Dc)}async function ad(n,t,e){const i=n instanceof ArrayBuffer||ArrayBuffer.isView(n);if(typeof n=="string"||i)return od(n,t);if(Ye(n)&&(n=await wc(n)),Xe(n)){const r=n;return await mf(r),t.binary?await r.arrayBuffer():await r.text()}if(Tc(n)&&(n=sd(n,e)),of(n)||af(n))return tf(n);throw new Error(Dc)}function cd(n,t,e=null){if(e)return e;const i={fetch:Ic(t,n),...n};return Array.isArray(i.loaders)||(i.loaders=null),i}function ld(n,t){if(!t&&n&&!Array.isArray(n))return n;let e;if(n&&(e=Array.isArray(n)?n:[n]),t&&t.loaders){const i=Array.isArray(t.loaders)?t.loaders:[t.loaders];e=e?[...e,...i]:i}return e&&e.length?e:null}async function Es(n,t,e,i){Yt(!i||typeof i=="object"),t&&!Array.isArray(t)&&!bs(t)&&(i=void 0,e=t,t=void 0),n=await n,e=e||{};const{url:r}=Ni(n),o=ld(t,i),a=await Gf(n,o,e);return a?(e=kf(e,a,o,r),i=cd({url:r,parse:Es,loaders:o},e,i),await ud(a,n,e,i)):null}async function ud(n,t,e,i){if(Yh(n),Xe(t)){const r=t,{ok:s,redirected:o,status:a,statusText:c,type:l,url:u}=r,h=Object.fromEntries(r.headers.entries());i.response={headers:h,ok:s,redirected:o,status:a,statusText:c,type:l,url:u}}if(t=await ad(t,n,e),n.parseTextSync&&typeof t=="string")return e.dataType="text",n.parseTextSync(t,e,i,n);if(qh(n,e))return await Zh(n,t,e,i,Es);if(n.parseText&&typeof t=="string")return await n.parseText(t,e,i,n);if(n.parse)return await n.parse(t,e,i,n);throw Yt(!n.parseSync),new Error("".concat(n.id," loader - no parser found and worker is disabled"))}async function jr(n,t,e,i){!Array.isArray(t)&&!bs(t)&&(e=t,t=void 0);const r=Ic(e);let s=n;return typeof n=="string"&&(s=await r(n)),Ye(n)&&(s=await r(n)),await Es(s,t,e)}const hd="3.2.11",{_parseImageNode:fd}=globalThis,zr=typeof Image<"u",Gr=typeof ImageBitmap<"u",dd=Boolean(fd),Hr=ms?!0:dd;function gd(n){switch(n){case"auto":return Gr||zr||Hr;case"imagebitmap":return Gr;case"image":return zr;case"data":return Hr;default:throw new Error("@loaders.gl/images: image ".concat(n," not supported in this environment"))}}function pd(){if(Gr)return"imagebitmap";if(zr)return"image";if(Hr)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function md(n){const t=bd(n);if(!t)throw new Error("Not an image");return t}function _d(n){switch(md(n)){case"data":return n;case"image":case"imagebitmap":const t=document.createElement("canvas"),e=t.getContext("2d");if(!e)throw new Error("getImageData");return t.width=n.width,t.height=n.height,e.drawImage(n,0,0),e.getImageData(0,0,n.width,n.height);default:throw new Error("getImageData")}}function bd(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&n instanceof Image?"image":n&&typeof n=="object"&&n.data&&n.width&&n.height?"data":null}const yd=/^data:image\/svg\+xml/,Ed=/\.svg((\?|#).*)?$/;function vs(n){return n&&(yd.test(n)||Ed.test(n))}function vd(n,t){if(vs(t)){let i=new TextDecoder().decode(n);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(s){throw new Error(s.message)}return"data:image/svg+xml;base64,".concat(btoa(i))}return Fc(n,t)}function Fc(n,t){if(vs(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(n)])}async function Uc(n,t,e){const i=vd(n,e),r=self.URL||self.webkitURL,s=typeof i!="string"&&r.createObjectURL(i);try{return await Td(s||i,t)}finally{s&&r.revokeObjectURL(s)}}async function Td(n,t){const e=new Image;return e.src=n,t.image&&t.image.decode&&e.decode?(await e.decode(),e):await new Promise((i,r)=>{try{e.onload=()=>i(e),e.onerror=s=>r(new Error("Could not load image ".concat(n,": ").concat(s)))}catch(s){r(s)}})}const wd={};let Do=!0;async function Ad(n,t,e){let i;vs(e)?i=await Uc(n,t,e):i=Fc(n,e);const r=t&&t.imagebitmap;return await Sd(i,r)}async function Sd(n,t=null){if((xd(t)||!Do)&&(t=null),t)try{return await createImageBitmap(n,t)}catch(e){console.warn(e),Do=!1}return await createImageBitmap(n)}function xd(n){for(const t in n||wd)return!1;return!0}const Ut=!1,mn=!0;function Bc(n){const t=Mn(n);return Pd(t)||Rd(t)||Md(t)||Ld(t)}function Pd(n){const t=Mn(n);return t.byteLength>=24&&t.getUint32(0,Ut)===2303741511?{mimeType:"image/png",width:t.getUint32(16,Ut),height:t.getUint32(20,Ut)}:null}function Md(n){const t=Mn(n);return t.byteLength>=10&&t.getUint32(0,Ut)===1195984440?{mimeType:"image/gif",width:t.getUint16(6,mn),height:t.getUint16(8,mn)}:null}function Ld(n){const t=Mn(n);return t.byteLength>=14&&t.getUint16(0,Ut)===16973&&t.getUint32(2,mn)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,mn),height:t.getUint32(22,mn)}:null}function Rd(n){const t=Mn(n);if(!(t.byteLength>=3&&t.getUint16(0,Ut)===65496&&t.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:r}=Id();let s=2;for(;s+9<t.byteLength;){const o=t.getUint16(s,Ut);if(r.has(o))return{mimeType:"image/jpeg",height:t.getUint16(s+5,Ut),width:t.getUint16(s+7,Ut)};if(!i.has(o))return null;s+=2,s+=t.getUint16(s,Ut)}return null}function Id(){const n=new Set([65499,65476,65484,65501,65534]);for(let e=65504;e<65520;++e)n.add(e);return{tableMarkers:n,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Mn(n){if(n instanceof DataView)return n;if(ArrayBuffer.isView(n))return new DataView(n.buffer);if(n instanceof ArrayBuffer)return new DataView(n);throw new Error("toDataView")}async function Cd(n,t){const{mimeType:e}=Bc(n)||{},i=globalThis._parseImageNode;return pi(i),await i(n,e)}async function Od(n,t,e){t=t||{};const r=(t.image||{}).type||"auto",{url:s}=e||{},o=kd(r);let a;switch(o){case"imagebitmap":a=await Ad(n,t,s);break;case"image":a=await Uc(n,t,s);break;case"data":a=await Cd(n);break;default:pi(!1)}return r==="data"&&(a=_d(a)),a}function kd(n){switch(n){case"auto":case"data":return pd();default:return gd(n),n}}const Nd=["png","jpg","jpeg","gif","webp","bmp","ico","svg"],Dd=["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],Fd={image:{type:"auto",decode:!0}},Ud={id:"image",module:"images",name:"Images",version:hd,mimeTypes:Dd,extensions:Nd,parse:Od,tests:[n=>Boolean(Bc(new DataView(n)))],options:Fd},H=new Pn({id:"deck"});let Wr={};function Bd(n){Wr=n}function at(n,t,e,i){H.level>0&&Wr[n]&&Wr[n].call(null,t,e,i)}function Vd(n){const t=n[0],e=n[n.length-1];return t==="{"&&e==="}"||t==="["&&e==="]"}const jd={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:Vd,parseTextSync:JSON.parse},_n="8.8.16",ai=globalThis.deck&&globalThis.deck.VERSION;if(ai&&ai!==_n)throw new Error("deck.gl - multiple versions detected: ".concat(ai," vs ").concat(_n));ai||(H.log(1,"deck.gl ".concat(_n))(),globalThis.deck={...globalThis.deck,VERSION:_n,version:_n,log:H,_registerLoggers:Bd},Bf([jd,[Ud,{imagebitmap:{premultiplyAlpha:"none"}}]]));const zd=globalThis.deck,O=new Pn({id:"luma.gl"});function ht(n,t){if(!n)throw new Error(t||"luma.gl: assertion failed.")}const Gd="Invalid WebGLRenderingContext",Hd="Requires WebGL2";function Di(n){return typeof WebGLRenderingContext<"u"&&n instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext?!0:Boolean(n&&Number.isFinite(n._version))}function j(n){return typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext?!0:Boolean(n&&n._version===2)}function Wd(n){return j(n)?n:null}function Fi(n){return ht(Di(n),Gd),n}function ft(n){return ht(j(n),Hd),n}const dn={};function Xd(n){globalThis.console&&globalThis.console.error&&globalThis.console.error(n)}function Yd(n){globalThis.console&&globalThis.console.log&&globalThis.console.log(n)}function qd(n,t){dn[n]=!0,t!==void 0&&Xd(t)}function Zd(n){const t=n.getError;n.getError=function(){let i;do i=t.apply(n),i!==0&&(dn[i]=!0);while(i!==0);for(i in dn)if(dn[i])return delete dn[i],parseInt(i,10);return 0}}const Ln=function n(t){const e=t.gl;this.ext=t,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(t.maxVertexAttribs);for(let i=0;i<this.attribs.length;i++){const r=new n.VertexAttrib(e);this.attribs[i]=r}this.maxAttrib=0};Ln.VertexAttrib=function(t){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};Ln.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const ve=function(t){const e=this;this.gl=t,Zd(t);const i=this.original={getParameter:t.getParameter,enableVertexAttribArray:t.enableVertexAttribArray,disableVertexAttribArray:t.disableVertexAttribArray,bindBuffer:t.bindBuffer,getVertexAttrib:t.getVertexAttrib,vertexAttribPointer:t.vertexAttribPointer};t.getParameter=function(s){return s===e.VERTEX_ARRAY_BINDING_OES?e.currentVertexArrayObject===e.defaultVertexArrayObject?null:e.currentVertexArrayObject:i.getParameter.apply(this,arguments)},t.enableVertexAttribArray=function(s){const o=e.currentVertexArrayObject;o.maxAttrib=Math.max(o.maxAttrib,s);const a=o.attribs[s];return a.enabled=!0,i.enableVertexAttribArray.apply(this,arguments)},t.disableVertexAttribArray=function(s){const o=e.currentVertexArrayObject;o.maxAttrib=Math.max(o.maxAttrib,s);const a=o.attribs[s];return a.enabled=!1,i.disableVertexAttribArray.apply(this,arguments)},t.bindBuffer=function(s,o){switch(s){case 34962:e.currentArrayBuffer=o;break;case 34963:e.currentVertexArrayObject.elementArrayBuffer=o;break}return i.bindBuffer.apply(this,arguments)},t.getVertexAttrib=function(s,o){const c=e.currentVertexArrayObject.attribs[s];switch(o){case 34975:return c.buffer;case 34338:return c.enabled;case 34339:return c.size;case 34340:return c.stride;case 34341:return c.type;case 34922:return c.normalized;default:return i.getVertexAttrib.apply(this,arguments)}},t.vertexAttribPointer=function(s,o,a,c,l,u){const h=e.currentVertexArrayObject;h.maxAttrib=Math.max(h.maxAttrib,s);const g=h.attribs[s];return g.buffer=e.currentArrayBuffer,g.size=o,g.type=a,g.normalized=c,g.stride=l,g.offset=u,g.recache(),i.vertexAttribPointer.apply(this,arguments)},t.instrumentExtension&&t.instrumentExtension(this,"OES_vertex_array_object"),t.canvas&&t.canvas.addEventListener("webglcontextrestored",()=>{Yd("OESVertexArrayObject emulation library context restored"),e.reset_()},!0),this.reset_()};ve.prototype.VERTEX_ARRAY_BINDING_OES=34229;ve.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let i=0;i<this.vertexArrayObjects.length;++i)this.vertexArrayObjects.isAlive=!1;const e=this.gl;this.maxVertexAttribs=e.getParameter(34921),this.defaultVertexArrayObject=new Ln(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};ve.prototype.createVertexArrayOES=function(){const t=new Ln(this);return this.vertexArrayObjects.push(t),t};ve.prototype.deleteVertexArrayOES=function(t){t.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(t),1),this.currentVertexArrayObject===t&&this.bindVertexArrayOES(null)};ve.prototype.isVertexArrayOES=function(t){return!!(t&&t instanceof Ln&&t.hasBeenBound&&t.ext===this)};ve.prototype.bindVertexArrayOES=function(t){const e=this.gl;if(t&&!t.isAlive){qd(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const i=this.original,r=this.currentVertexArrayObject;this.currentVertexArrayObject=t||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const s=this.currentVertexArrayObject;if(r===s)return;(!r||s.elementArrayBuffer!==r.elementArrayBuffer)&&i.bindBuffer.call(e,34963,s.elementArrayBuffer);let o=this.currentArrayBuffer;const a=Math.max(r?r.maxAttrib:0,s.maxAttrib);for(let c=0;c<=a;c++){const l=s.attribs[c],u=r?r.attribs[c]:null;if((!r||l.enabled!==u.enabled)&&(l.enabled?i.enableVertexAttribArray.call(e,c):i.disableVertexAttribArray.call(e,c)),l.enabled){let h=!1;(!r||l.buffer!==u.buffer)&&(o!==l.buffer&&(i.bindBuffer.call(e,34962,l.buffer),o=l.buffer),h=!0),(h||l.cached!==u.cached)&&i.vertexAttribPointer.call(e,c,l.size,l.type,l.normalized,l.stride,l.offset)}}this.currentArrayBuffer!==o&&i.bindBuffer.call(e,34962,this.currentArrayBuffer)};function $d(n){if(typeof n.createVertexArray=="function")return;const t=n.getSupportedExtensions;n.getSupportedExtensions=function(){const r=t.call(this)||[];return r.indexOf("OES_vertex_array_object")<0&&r.push("OES_vertex_array_object"),r};const e=n.getExtension;n.getExtension=function(r){const s=e.call(this,r);return s||(r!=="OES_vertex_array_object"?null:(n.__OESVertexArrayObject||(this.__OESVertexArrayObject=new ve(this)),this.__OESVertexArrayObject))}}const Fo="OES_element_index",Uo="WEBGL_draw_buffers",Kd="EXT_disjoint_timer_query",Qd="EXT_disjoint_timer_query_webgl2",Jd="EXT_texture_filter_anisotropic",Bo="WEBGL_debug_renderer_info",tg=35723,eg=4352,ng=36795,ig=34047,rg=37445,sg=37446,X=n=>j(n)?void 0:0,og={[3074]:n=>j(n)?void 0:36064,[tg]:n=>j(n)?void 0:eg,[35977]:X,[32937]:X,[ng]:(n,t)=>{const e=j(n)?n.getExtension(Qd):n.getExtension(Kd);return e&&e.GPU_DISJOINT_EXT?t(e.GPU_DISJOINT_EXT):0},[rg]:(n,t)=>{const e=n.getExtension(Bo);return t(e&&e.UNMASKED_VENDOR_WEBGL||7936)},[sg]:(n,t)=>{const e=n.getExtension(Bo);return t(e&&e.UNMASKED_RENDERER_WEBGL||7937)},[ig]:(n,t)=>{const e=n.luma.extensions[Jd];return e?t(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},[32883]:X,[35071]:X,[37447]:X,[36063]:(n,t)=>{if(!j(n)){const e=n.getExtension(Uo);return e?t(e.MAX_COLOR_ATTACHMENTS_WEBGL):0}},[35379]:X,[35374]:X,[35377]:X,[34852]:n=>{if(!j(n)){const t=n.getExtension(Uo);return t?t.MAX_DRAW_BUFFERS_WEBGL:0}},[36203]:n=>n.getExtension(Fo)?2147483647:65535,[33001]:n=>n.getExtension(Fo)?16777216:65535,[33e3]:n=>16777216,[37157]:X,[35373]:X,[35657]:X,[36183]:X,[37137]:X,[34045]:X,[35978]:X,[35979]:X,[35968]:X,[35376]:X,[35375]:X,[35659]:X,[37154]:X,[35371]:X,[35658]:X,[35076]:X,[35077]:X,[35380]:X};function ag(n,t,e){const i=og[e],r=typeof i=="function"?i(n,t,e):i;return r!==void 0?r:t(e)}const cg="OES_vertex_array_object",Vc="ANGLE_instanced_arrays",lg="WEBGL_draw_buffers",ug="EXT_disjoint_timer_query",hg="EXT_texture_filter_anisotropic",fg="VertexArray requires WebGL2 or OES_vertex_array_object extension";function dg(n,t){return{webgl2:j(n),ext:n.getExtension(t)}}const jc={[cg]:{meta:{suffix:"OES"},createVertexArray:()=>{ht(!1,fg)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[Vc]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(n,t){ht(t===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[lg]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{ht(!1)}},[ug]:{meta:{suffix:"EXT"},createQuery:()=>{ht(!1)},deleteQuery:()=>{ht(!1)},beginQuery:()=>{ht(!1)},endQuery:()=>{},getQuery(n,t){return this.getQueryObject(n,t)},getQueryParameter(n,t){return this.getQueryObject(n,t)},getQueryObject:()=>{}}},gr={readBuffer:(n,t,e)=>{j(n)&&t(e)},getVertexAttrib:(n,t,e,i)=>{const{webgl2:r,ext:s}=dg(n,Vc);let o;switch(i){case 35069:o=r?void 0:!1;break;case 35070:o=!r&&!s?0:void 0;break}return o!==void 0?o:t(e,i)},getProgramParameter:(n,t,e,i)=>{if(!j(n))switch(i){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return t(e,i)},getInternalformatParameter:(n,t,e,i,r)=>{if(!j(n))switch(r){case 32937:return new Int32Array([0])}return n.getInternalformatParameter(e,i,r)},getTexParameter(n,t,e,i){switch(i){case 34046:const{extensions:r}=n.luma,s=r[hg];i=s&&s.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return t(e,i)},getParameter:ag,hint(n,t,e,i){return t(e,i)}};function gg(n){n.luma=n.luma||{};const{luma:t}=n;return t.polyfilled||($d(n),pg(n),_g(n,jc),mg(n,{target:t,target2:n}),t.polyfilled=!0),n}globalThis.polyfillContext=gg;function pg(n){n.luma.extensions={};const t=n.getSupportedExtensions()||[];for(const e of t)n.luma[e]=n.getExtension(e)}function mg(n,t){let{target:e,target2:i}=t;Object.keys(gr).forEach(r=>{if(typeof gr[r]=="function"){const s=n[r]?n[r].bind(n):()=>{},o=gr[r].bind(null,n,s);e[r]=o,i[r]=o}})}function _g(n,t){for(const e of Object.getOwnPropertyNames(t))e!=="overrides"&&bg(n,{extension:e,target:n.luma,target2:n})}function bg(n,t){let{extension:e,target:i,target2:r}=t;const s=jc[e];ht(s);const{meta:o={}}=s,{suffix:a=""}=o,c=n.getExtension(e);for(const l of Object.keys(s)){const u="".concat(l).concat(a);let h=null;l==="meta"||typeof n[l]=="function"||(c&&typeof c[u]=="function"?h=function(){return c[u](...arguments)}:typeof s[l]=="function"&&(h=s[l].bind(i))),h&&(i[l]=h,r[l]=h)}}const Ts={[3042]:!1,[32773]:new Float32Array([0,0,0,0]),[32777]:32774,[34877]:32774,[32969]:1,[32968]:0,[32971]:1,[32970]:0,[3106]:new Float32Array([0,0,0,0]),[3107]:[!0,!0,!0,!0],[2884]:!1,[2885]:1029,[2929]:!1,[2931]:1,[2932]:513,[2928]:new Float32Array([0,1]),[2930]:!0,[3024]:!0,[36006]:null,[2886]:2305,[33170]:4352,[2849]:1,[32823]:!1,[32824]:0,[10752]:0,[32938]:1,[32939]:!1,[3089]:!1,[3088]:new Int32Array([0,0,1024,1024]),[2960]:!1,[2961]:0,[2968]:4294967295,[36005]:4294967295,[2962]:519,[2967]:0,[2963]:4294967295,[34816]:519,[36003]:0,[36004]:4294967295,[2964]:7680,[2965]:7680,[2966]:7680,[34817]:7680,[34818]:7680,[34819]:7680,[2978]:[0,0,1024,1024],[3333]:4,[3317]:4,[37440]:!1,[37441]:!1,[37443]:37444,[35723]:4352,[36010]:null,[35977]:!1,[3330]:0,[3332]:0,[3331]:0,[3314]:0,[32878]:0,[3316]:0,[3315]:0,[32877]:0},te=(n,t,e)=>t?n.enable(e):n.disable(e),Vo=(n,t,e)=>n.hint(e,t),mt=(n,t,e)=>n.pixelStorei(e,t),yg=(n,t)=>{const e=j(n)?36009:36160;return n.bindFramebuffer(e,t)},Eg=(n,t)=>n.bindFramebuffer(36008,t);function an(n){return Array.isArray(n)||ArrayBuffer.isView(n)}const vg={[3042]:te,[32773]:(n,t)=>n.blendColor(...t),[32777]:"blendEquation",[34877]:"blendEquation",[32969]:"blendFunc",[32968]:"blendFunc",[32971]:"blendFunc",[32970]:"blendFunc",[3106]:(n,t)=>n.clearColor(...t),[3107]:(n,t)=>n.colorMask(...t),[2884]:te,[2885]:(n,t)=>n.cullFace(t),[2929]:te,[2931]:(n,t)=>n.clearDepth(t),[2932]:(n,t)=>n.depthFunc(t),[2928]:(n,t)=>n.depthRange(...t),[2930]:(n,t)=>n.depthMask(t),[3024]:te,[35723]:Vo,[36006]:yg,[2886]:(n,t)=>n.frontFace(t),[33170]:Vo,[2849]:(n,t)=>n.lineWidth(t),[32823]:te,[32824]:"polygonOffset",[10752]:"polygonOffset",[35977]:te,[32938]:"sampleCoverage",[32939]:"sampleCoverage",[3089]:te,[3088]:(n,t)=>n.scissor(...t),[2960]:te,[2961]:(n,t)=>n.clearStencil(t),[2968]:(n,t)=>n.stencilMaskSeparate(1028,t),[36005]:(n,t)=>n.stencilMaskSeparate(1029,t),[2962]:"stencilFuncFront",[2967]:"stencilFuncFront",[2963]:"stencilFuncFront",[34816]:"stencilFuncBack",[36003]:"stencilFuncBack",[36004]:"stencilFuncBack",[2964]:"stencilOpFront",[2965]:"stencilOpFront",[2966]:"stencilOpFront",[34817]:"stencilOpBack",[34818]:"stencilOpBack",[34819]:"stencilOpBack",[2978]:(n,t)=>n.viewport(...t),[3333]:mt,[3317]:mt,[37440]:mt,[37441]:mt,[37443]:mt,[3330]:mt,[3332]:mt,[3331]:mt,[36010]:Eg,[3314]:mt,[32878]:mt,[3316]:mt,[3315]:mt,[32877]:mt,framebuffer:(n,t)=>{const e=t&&"handle"in t?t.handle:t;return n.bindFramebuffer(36160,e)},blend:(n,t)=>t?n.enable(3042):n.disable(3042),blendColor:(n,t)=>n.blendColor(...t),blendEquation:(n,t)=>{t=an(t)?t:[t,t],n.blendEquationSeparate(...t)},blendFunc:(n,t)=>{t=an(t)&&t.length===2?[...t,...t]:t,n.blendFuncSeparate(...t)},clearColor:(n,t)=>n.clearColor(...t),clearDepth:(n,t)=>n.clearDepth(t),clearStencil:(n,t)=>n.clearStencil(t),colorMask:(n,t)=>n.colorMask(...t),cull:(n,t)=>t?n.enable(2884):n.disable(2884),cullFace:(n,t)=>n.cullFace(t),depthTest:(n,t)=>t?n.enable(2929):n.disable(2929),depthFunc:(n,t)=>n.depthFunc(t),depthMask:(n,t)=>n.depthMask(t),depthRange:(n,t)=>n.depthRange(...t),dither:(n,t)=>t?n.enable(3024):n.disable(3024),derivativeHint:(n,t)=>{n.hint(35723,t)},frontFace:(n,t)=>n.frontFace(t),mipmapHint:(n,t)=>n.hint(33170,t),lineWidth:(n,t)=>n.lineWidth(t),polygonOffsetFill:(n,t)=>t?n.enable(32823):n.disable(32823),polygonOffset:(n,t)=>n.polygonOffset(...t),sampleCoverage:(n,t)=>n.sampleCoverage(...t),scissorTest:(n,t)=>t?n.enable(3089):n.disable(3089),scissor:(n,t)=>n.scissor(...t),stencilTest:(n,t)=>t?n.enable(2960):n.disable(2960),stencilMask:(n,t)=>{t=an(t)?t:[t,t];const[e,i]=t;n.stencilMaskSeparate(1028,e),n.stencilMaskSeparate(1029,i)},stencilFunc:(n,t)=>{t=an(t)&&t.length===3?[...t,...t]:t;const[e,i,r,s,o,a]=t;n.stencilFuncSeparate(1028,e,i,r),n.stencilFuncSeparate(1029,s,o,a)},stencilOp:(n,t)=>{t=an(t)&&t.length===3?[...t,...t]:t;const[e,i,r,s,o,a]=t;n.stencilOpSeparate(1028,e,i,r),n.stencilOpSeparate(1029,s,o,a)},viewport:(n,t)=>n.viewport(...t)};function Z(n,t,e){return t[n]!==void 0?t[n]:e[n]}const Tg={blendEquation:(n,t,e)=>n.blendEquationSeparate(Z(32777,t,e),Z(34877,t,e)),blendFunc:(n,t,e)=>n.blendFuncSeparate(Z(32969,t,e),Z(32968,t,e),Z(32971,t,e),Z(32970,t,e)),polygonOffset:(n,t,e)=>n.polygonOffset(Z(32824,t,e),Z(10752,t,e)),sampleCoverage:(n,t,e)=>n.sampleCoverage(Z(32938,t,e),Z(32939,t,e)),stencilFuncFront:(n,t,e)=>n.stencilFuncSeparate(1028,Z(2962,t,e),Z(2967,t,e),Z(2963,t,e)),stencilFuncBack:(n,t,e)=>n.stencilFuncSeparate(1029,Z(34816,t,e),Z(36003,t,e),Z(36004,t,e)),stencilOpFront:(n,t,e)=>n.stencilOpSeparate(1028,Z(2964,t,e),Z(2965,t,e),Z(2966,t,e)),stencilOpBack:(n,t,e)=>n.stencilOpSeparate(1029,Z(34817,t,e),Z(34818,t,e),Z(34819,t,e))},jo={enable:(n,t)=>n({[t]:!0}),disable:(n,t)=>n({[t]:!1}),pixelStorei:(n,t,e)=>n({[t]:e}),hint:(n,t,e)=>n({[t]:e}),bindFramebuffer:(n,t,e)=>{switch(t){case 36160:return n({[36006]:e,[36010]:e});case 36009:return n({[36006]:e});case 36008:return n({[36010]:e});default:return null}},blendColor:(n,t,e,i,r)=>n({[32773]:new Float32Array([t,e,i,r])}),blendEquation:(n,t)=>n({[32777]:t,[34877]:t}),blendEquationSeparate:(n,t,e)=>n({[32777]:t,[34877]:e}),blendFunc:(n,t,e)=>n({[32969]:t,[32968]:e,[32971]:t,[32970]:e}),blendFuncSeparate:(n,t,e,i,r)=>n({[32969]:t,[32968]:e,[32971]:i,[32970]:r}),clearColor:(n,t,e,i,r)=>n({[3106]:new Float32Array([t,e,i,r])}),clearDepth:(n,t)=>n({[2931]:t}),clearStencil:(n,t)=>n({[2961]:t}),colorMask:(n,t,e,i,r)=>n({[3107]:[t,e,i,r]}),cullFace:(n,t)=>n({[2885]:t}),depthFunc:(n,t)=>n({[2932]:t}),depthRange:(n,t,e)=>n({[2928]:new Float32Array([t,e])}),depthMask:(n,t)=>n({[2930]:t}),frontFace:(n,t)=>n({[2886]:t}),lineWidth:(n,t)=>n({[2849]:t}),polygonOffset:(n,t,e)=>n({[32824]:t,[10752]:e}),sampleCoverage:(n,t,e)=>n({[32938]:t,[32939]:e}),scissor:(n,t,e,i,r)=>n({[3088]:new Int32Array([t,e,i,r])}),stencilMask:(n,t)=>n({[2968]:t,[36005]:t}),stencilMaskSeparate:(n,t,e)=>n({[t===1028?2968:36005]:e}),stencilFunc:(n,t,e,i)=>n({[2962]:t,[2967]:e,[2963]:i,[34816]:t,[36003]:e,[36004]:i}),stencilFuncSeparate:(n,t,e,i,r)=>n({[t===1028?2962:34816]:e,[t===1028?2967:36003]:i,[t===1028?2963:36004]:r}),stencilOp:(n,t,e,i)=>n({[2964]:t,[2965]:e,[2966]:i,[34817]:t,[34818]:e,[34819]:i}),stencilOpSeparate:(n,t,e,i,r)=>n({[t===1028?2964:34817]:e,[t===1028?2965:34818]:i,[t===1028?2966:34819]:r}),viewport:(n,t,e,i,r)=>n({[2978]:[t,e,i,r]})},Nt=(n,t)=>n.isEnabled(t),zo={[3042]:Nt,[2884]:Nt,[2929]:Nt,[3024]:Nt,[32823]:Nt,[32926]:Nt,[32928]:Nt,[3089]:Nt,[2960]:Nt,[35977]:Nt};function zc(n){for(const t in n)return!1;return!0}function wg(n,t){if(n===t)return!0;const e=Array.isArray(n)||ArrayBuffer.isView(n),i=Array.isArray(t)||ArrayBuffer.isView(t);if(e&&i&&n.length===t.length){for(let r=0;r<n.length;++r)if(n[r]!==t[r])return!1;return!0}return!1}function Go(n,t){const e=n[t].bind(n);n[t]=function(){const r=arguments.length<=0?void 0:arguments[0];return r in n.state.cache?n.state.enable?n.state.cache[r]:e(...arguments):e(...arguments)},Object.defineProperty(n[t],"name",{value:"".concat(t,"-from-cache"),configurable:!1})}function Ag(n,t,e){const i=n[t].bind(n);n[t]=function(){for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];const{valueChanged:c,oldValue:l}=e(n.state._updateCache,...o);return c&&i(...o),l},Object.defineProperty(n[t],"name",{value:"".concat(t,"-to-cache"),configurable:!1})}function Sg(n){const t=n.useProgram.bind(n);n.useProgram=function(i){n.state.program!==i&&(t(i),n.state.program=i)}}class xg{constructor(t){let{copyState:e=!1,log:i=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.program=null,this.stateStack=[],this.enable=!0,this.cache=e?Mg(t):Object.assign({},Ts),this.log=i,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){ht(this.stateStack.length>0);const t=this.stateStack[this.stateStack.length-1];qt(this.gl,t),this.stateStack.pop()}_updateCache(t){let e=!1,i;const r=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const s in t){ht(s!==void 0);const o=t[s],a=this.cache[s];wg(o,a)||(e=!0,i=a,r&&!(s in r)&&(r[s]=a),this.cache[s]=o)}return{valueChanged:e,oldValue:i}}}function Gc(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:e=!0,copyState:i}=t;if(ht(i!==void 0),!n.state){const{polyfillContext:r}=globalThis;r&&r(n),n.state=new xg(n,{copyState:i}),Sg(n);for(const s in jo){const o=jo[s];Ag(n,s,o)}Go(n,"getParameter"),Go(n,"isEnabled")}return n.state.enable=e,n}function Pg(n){n.state||Gc(n,{copyState:!1}),n.state.push()}function Ho(n){ht(n.state),n.state.pop()}function qt(n,t){if(ht(Di(n),"setParameters requires a WebGL context"),zc(t))return;const e={};for(const r in t){const s=Number(r),o=vg[r];o&&(typeof o=="string"?e[o]=!0:o(n,t[r],s))}const i=n.state&&n.state.cache;if(i)for(const r in e){const s=Tg[r];s(n,t,i)}}function Mg(n,t){if(t=t||Ts,typeof t=="number"){const r=t,s=zo[r];return s?s(n,r):n.getParameter(r)}const e=Array.isArray(t)?t:Object.keys(t),i={};for(const r of e){const s=zo[r];i[r]=s?s(n,Number(r)):n.getParameter(Number(r))}return i}function Lg(n){qt(n,Ts)}function xt(n,t,e){if(zc(t))return e(n);const{nocatch:i=!0}=t;Pg(n),qt(n,t);let r;if(i)r=e(n),Ho(n);else try{r=e(n)}finally{Ho(n)}return r}function Be(n){const{luma:t}=n;if(n.canvas&&t){const{clientWidth:e}=t.canvasSizeInfo;return e?n.drawingBufferWidth/e:1}return 1}function pr(n,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const i=Be(n),r=n.drawingBufferWidth,s=n.drawingBufferHeight;return Ig(t,i,r,s,e)}function Rg(n){const t=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(n)?n<=0?1:n:n?t:1}function Ig(n,t,e,i,r){const s=Wo(n[0],t,e);let o=Xo(n[1],t,i,r),a=Wo(n[0]+1,t,e);const c=a===e-1?a:a-1;a=Xo(n[1]+1,t,i,r);let l;return r?(a=a===0?a:a+1,l=o,o=a):l=a===i-1?a:a-1,{x:s,y:o,width:Math.max(c-s+1,1),height:Math.max(l-o+1,1)}}function Wo(n,t,e){return Math.min(Math.round(n*t),e-1)}function Xo(n,t,e,i){return i?Math.max(0,e-1-Math.round(n*t)):Math.min(Math.round(n*t),e-1)}const ws=Kt(),Cg=ws&&typeof document<"u",Hc={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function Wc(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ht(ws,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),n=Object.assign({},Hc,n);const{width:t,height:e}=n;function i(a){if(n.throwOnError)throw new Error(a);return console.error(a),null}n.onError=i;let r;const{canvas:s}=n,o=Dg({canvas:s,width:t,height:e,onError:i});return r=Ng(o,n),r?(r=As(r,n),Fg(r),r):null}function As(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!n||n._instrumented)return n;n._version=n._version||Ug(n),n.luma=n.luma||{},n.luma.canvasSizeInfo=n.luma.canvasSizeInfo||{},t=Object.assign({},Hc,t);const{manageState:e,debug:i}=t;return e&&Gc(n,{copyState:!1,log:function(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return O.log(1,...s)()}}),ws&&i&&(globalThis.makeDebugContext?(n=globalThis.makeDebugContext(n,t),O.level=Math.max(O.level,1)):O.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),n._instrumented=!0,n}function Og(n){const t=n.getParameter(7936),e=n.getParameter(7937),i=n.getExtension("WEBGL_debug_renderer_info"),r=i&&n.getParameter(i.UNMASKED_VENDOR_WEBGL||7936),s=i&&n.getParameter(i.UNMASKED_RENDERER_WEBGL||7937);return{vendor:r||t,renderer:s||e,vendorMasked:t,rendererMasked:e,version:n.getParameter(7938),shadingLanguageVersion:n.getParameter(35724)}}function kg(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(n.canvas){const i=Rg(t.useDevicePixels);Bg(n,i,t);return}const e=n.getExtension("STACKGL_resize_drawingbuffer");e&&"width"in t&&"height"in t&&e.resize(t.width,t.height)}function Ng(n,t){const{onError:e}=t;let i=null;const r=c=>i=c.statusMessage||i;n.addEventListener("webglcontextcreationerror",r,!1);const{webgl1:s=!0,webgl2:o=!0}=t;let a=null;return o&&(a=a||n.getContext("webgl2",t),a=a||n.getContext("experimental-webgl2",t)),s&&(a=a||n.getContext("webgl",t),a=a||n.getContext("experimental-webgl",t)),n.removeEventListener("webglcontextcreationerror",r,!1),a?(t.onContextLost&&n.addEventListener("webglcontextlost",t.onContextLost,!1),t.onContextRestored&&n.addEventListener("webglcontextrestored",t.onContextRestored,!1),a):e("Failed to create ".concat(o&&!s?"WebGL2":"WebGL"," context: ").concat(i||"Unknown error"))}function Dg(n){let{canvas:t,width:e=800,height:i=600,onError:r}=n,s;return typeof t=="string"?(Cg&&document.readyState==="complete"||r("createGLContext called on canvas '".concat(t,"' before page was loaded")),s=document.getElementById(t)):t?s=t:(s=document.createElement("canvas"),s.id="lumagl-canvas",s.style.width=Number.isFinite(e)?"".concat(e,"px"):"100%",s.style.height=Number.isFinite(i)?"".concat(i,"px"):"100%",document.body.insertBefore(s,document.body.firstChild)),s}function Fg(n){const t=j(n)?"WebGL2":"WebGL1",e=Og(n),i=e?"(".concat(e.vendor,",").concat(e.renderer,")"):"",r=n.debug?" debug":"";O.info(1,"".concat(t).concat(r," context ").concat(i))()}function Ug(n){return typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext?2:1}function Bg(n,t,e){let i="width"in e?e.width:n.canvas.clientWidth,r="height"in e?e.height:n.canvas.clientHeight;(!i||!r)&&(O.log(1,"Canvas clientWidth/clientHeight is 0")(),t=1,i=n.canvas.width||1,r=n.canvas.height||1),n.luma=n.luma||{},n.luma.canvasSizeInfo=n.luma.canvasSizeInfo||{};const s=n.luma.canvasSizeInfo;if(s.clientWidth!==i||s.clientHeight!==r||s.devicePixelRatio!==t){let o=t;const a=Math.floor(i*o),c=Math.floor(r*o);n.canvas.width=a,n.canvas.height=c,(n.drawingBufferWidth!==a||n.drawingBufferHeight!==c)&&(O.warn("Device pixel ratio clamped")(),o=Math.min(n.drawingBufferWidth/i,n.drawingBufferHeight/r),n.canvas.width=Math.floor(i*o),n.canvas.height=Math.floor(r*o)),Object.assign(n.luma.canvasSizeInfo,{clientWidth:i,clientHeight:r,devicePixelRatio:t})}}const bn="8.5.17",Vg="set luma.log.level=1 (or higher) to trace rendering";class jg{constructor(){this.stats=new Map}get(t){return this.stats.has(t)||this.stats.set(t,new _s({id:t})),this.stats.get(t)}}const _e=new jg;if(globalThis.luma&&globalThis.luma.VERSION!==bn)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(bn));globalThis.luma||(Kt()&&O.log(1,"luma.gl ".concat(bn," - ").concat(Vg))(),globalThis.luma=globalThis.luma||{VERSION:bn,version:bn,log:O,stats:_e,globals:{modules:{},nodeIO:{}}});function zg(n){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(n):setTimeout(n,1e3/60)}function Gg(n){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(n):clearTimeout(n)}function C(n,t){if(!n)throw new Error(t||"luma.gl: assertion failed.")}function mr(n,t){if(typeof t!="string")return t;const e=Number(t);if(!isNaN(e))return e;t=t.replace(/^.*\./,"");const i=n[t];return C(i!==void 0,"Accessing undefined constant GL.".concat(t)),i}function ae(n,t){t=Number(t);for(const e in n)if(n[e]===t)return"GL.".concat(e);return String(t)}const _r={};function ye(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";_r[n]=_r[n]||1;const t=_r[n]++;return"".concat(n,"-").concat(t)}function Yo(n){return C(typeof n=="number","Input must be a number"),n&&(n&n-1)===0}function Ve(n){let t=!0;for(const e in n){t=!1;break}return t}function Xc(n,t,e,i){const r="See luma.gl ".concat(e," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),s=Object.getPrototypeOf(n);i.forEach(o=>{s.methodName||(s[o]=()=>{throw O.removed("Calling removed method ".concat(t,".").concat(o,": "),r)(),new Error(o)})})}const xe="Resource subclass must define virtual methods";class Qt{get[Symbol.toStringTag](){return"Resource"}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Fi(t);const{id:i,userData:r={}}=e;this.gl=t,this.gl2=t,this.id=i||ye(this[Symbol.toStringTag]),this.userData=r,this._bound=!1,this._handle=e.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:t=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,e&&t&&e.filter(Boolean).forEach(i=>i.delete()),this}bind(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof t!="function")return this._bindHandle(t),this;let e;return this._bound?e=t():(this._bindHandle(this.handle),this._bound=!0,e=t(),this._bound=!1,this._bindHandle(null)),e}unbind(){this.bind(null)}getParameter(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};t=mr(this.gl,t),C(t);const r=(this.constructor.PARAMETERS||{})[t];if(r){const s=j(this.gl);if(!((!("webgl2"in r)||s)&&(!("extension"in r)||this.gl.getExtension(r.extension)))){const a=r.webgl1,c="webgl2"in r?r.webgl2:r.webgl1;return s?c:a}}return this._getParameter(t,e)}getParameters(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:e,keys:i}=t,r=this.constructor.PARAMETERS||{},s=j(this.gl),o={},a=e||Object.keys(r);for(const c of a){const l=r[c];if(l&&(!("webgl2"in l)||s)&&(!("extension"in l)||this.gl.getExtension(l.extension))){const h=i?ae(this.gl,c):c;o[h]=this.getParameter(c,t),i&&l.type==="GLenum"&&(o[h]=ae(this.gl,o[h]))}}return o}setParameter(t,e){t=mr(this.gl,t),C(t);const r=(this.constructor.PARAMETERS||{})[t];if(r){const s=j(this.gl);if(!((!("webgl2"in r)||s)&&(!("extension"in r)||this.gl.getExtension(r.extension))))throw new Error("Parameter not available on this platform");r.type==="GLenum"&&(e=mr(e))}return this._setParameter(t,e),this}setParameters(t){for(const e in t)this.setParameter(e,t[e]);return this}stubRemovedMethods(t,e,i){return Xc(this,t,e,i)}initialize(t){}_createHandle(){throw new Error(xe)}_deleteHandle(){throw new Error(xe)}_bindHandle(t){throw new Error(xe)}_getOptsFromHandle(){throw new Error(xe)}_getParameter(t,e){throw new Error(xe)}_setParameter(t,e){throw new Error(xe)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const t=this[Symbol.toStringTag],e=_e.get("Resource Counts");e.get("Resources Created").incrementCount(),e.get("".concat(t,"s Created")).incrementCount(),e.get("".concat(t,"s Active")).incrementCount()}_removeStats(){const t=this[Symbol.toStringTag];_e.get("Resource Counts").get("".concat(t,"s Active")).decrementCount()}_trackAllocatedMemory(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(t,e),this._trackAllocatedMemoryForContext(t,e,this.gl.canvas&&this.gl.canvas.id)}_trackAllocatedMemoryForContext(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";const r=_e.get("Memory Usage".concat(i));r.get("GPU Memory").addCount(t),r.get("".concat(e," Memory")).addCount(t),this.byteLength=t}_trackDeallocatedMemory(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(t),this._trackDeallocatedMemoryForContext(t,this.gl.canvas&&this.gl.canvas.id)}_trackDeallocatedMemoryForContext(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const i=_e.get("Memory Usage".concat(e));i.get("GPU Memory").subtractCount(this.byteLength),i.get("".concat(t," Memory")).subtractCount(this.byteLength),this.byteLength=0}}const Hg="Failed to deduce GL constant from typed array";function Xr(n){switch(ArrayBuffer.isView(n)?n.constructor:n){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(Hg)}}function yn(n){let{clamped:t=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(n){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return t?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function Wg(n){let{data:t,width:e,height:i,bytesPerPixel:r=4,temp:s}=n;const o=e*r;s=s||new Uint8Array(o);for(let a=0;a<i/2;++a){const c=a*o,l=(i-a-1)*o;s.set(t.subarray(c,c+o)),t.copyWithin(c,l,l+o),t.set(s,l)}}function Xg(n){let{data:t,width:e,height:i}=n;const r=Math.round(e/2),s=Math.round(i/2),o=new Uint8Array(r*s*4);for(let a=0;a<s;a++)for(let c=0;c<r;c++)for(let l=0;l<4;l++)o[(a*r+c)*4+l]=t[(a*2*e+c*2)*4+l];return{data:o,width:r,height:s}}function Yr(n,t,e){const{removedProps:i={},deprecatedProps:r={},replacedProps:s={}}=e;for(const a in i)if(a in t){const l=i[a]?"".concat(n,".").concat(i[a]):"N/A";O.removed("".concat(n,".").concat(a),l)()}for(const a in r)if(a in t){const c=r[a];O.deprecated("".concat(n,".").concat(a),"".concat(n,".").concat(c))()}let o=null;for(const a in s)if(a in t){const c=s[a];O.deprecated("".concat(n,".").concat(a),"".concat(n,".").concat(c))(),o=o||Object.assign({},t),o[c]=t[a],delete o[a]}return o||t}const Yg={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},qg={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class Et{static getBytesPerElement(t){return yn(t.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(t){return C(t.size),yn(t.type||5126).BYTES_PER_ELEMENT*t.size}static resolve(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return new Et(Yg,...e)}constructor(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];e.forEach(r=>this._assign(r)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return Et.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return Et.getBytesPerVertex(this)}_assign(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t=Yr("Accessor",t,qg),t.type!==void 0&&(this.type=t.type,(t.type===5124||t.type===5125)&&(this.integer=!0)),t.size!==void 0&&(this.size=t.size),t.offset!==void 0&&(this.offset=t.offset),t.stride!==void 0&&(this.stride=t.stride),t.normalized!==void 0&&(this.normalized=t.normalized),t.integer!==void 0&&(this.integer=t.integer),t.divisor!==void 0&&(this.divisor=t.divisor),t.buffer!==void 0&&(this.buffer=t.buffer),t.index!==void 0&&(typeof t.index=="boolean"?this.index=t.index?1:0:this.index=t.index),t.instanced!==void 0&&(this.divisor=t.instanced?1:0),t.isInstanced!==void 0&&(this.divisor=t.isInstanced?1:0),this}}const qo=10,Yc={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},Zg={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:Yc},$g={removedProps:Yc};class W extends Qt{get[Symbol.toStringTag](){return"Buffer"}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,e),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=e.target||(this.gl.webgl2?36662:34962),this.initialize(e),Object.seal(this)}getElementCount(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Et.getBytesPerElement(t))}getVertexCount(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Et.getBytesPerVertex(t))}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(t)&&(t={data:t}),Number.isFinite(t)&&(t={byteLength:t}),t=Yr("Buffer",t,Zg),this.usage=t.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},t,t.accessor)),t.data?this._setData(t.data,t.offset,t.byteLength):this._setByteLength(t.byteLength||0),this}setProps(t){return t=Yr("Buffer",t,$g),"accessor"in t&&this.setAccessor(t.accessor),this}setAccessor(t){return t=Object.assign({},t),delete t.buffer,this.accessor=new Et(t),this}reallocate(t){return t>this.byteLength?(this._setByteLength(t),!0):(this.bytesUsed=t,!1)}setData(t){return this.initialize(t)}subData(t){ArrayBuffer.isView(t)&&(t={data:t});const{data:e,offset:i=0,srcOffset:r=0}=t,s=t.byteLength||t.length;C(e);const o=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(o,this.handle),r!==0||s!==void 0?(ft(this.gl),this.gl.bufferSubData(this.target,i,e,r,s)):this.gl.bufferSubData(o,i,e),this.gl.bindBuffer(o,null),this.debugData=null,this._inferType(e),this}copyData(t){let{sourceBuffer:e,readOffset:i=0,writeOffset:r=0,size:s}=t;const{gl:o}=this;return ft(o),o.bindBuffer(36662,e.handle),o.bindBuffer(36663,this.handle),o.copyBufferSubData(36662,36663,i,r,s),o.bindBuffer(36662,null),o.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:t=null,srcByteOffset:e=0,dstOffset:i=0,length:r=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ft(this.gl);const s=yn(this.accessor.type||5126,{clamped:!1}),o=this._getAvailableElementCount(e),a=i;let c,l;t?(l=t.length,c=l-a):(c=Math.min(o,r||o),l=a+c);const u=Math.min(o,c);return r=r||u,C(r<=u),t=t||new s(l),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,t,i,r),this.gl.bindBuffer(36662,null),t}bind(){let{target:t=this.target,index:e=this.accessor&&this.accessor.index,offset:i=0,size:r}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t===35345||t===35982?r!==void 0?this.gl.bindBufferRange(t,e,this.handle,i,r):(C(i===0),this.gl.bindBufferBase(t,e,this.handle)):this.gl.bindBuffer(t,this.handle),this}unbind(){let{target:t=this.target,index:e=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t===35345||t===35982?this.gl.bindBufferBase(t,e,null):this.gl.bindBuffer(t,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(qo,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:t.byteLength+e;C(ArrayBuffer.isView(t)),this._trackDeallocatedMemory();const r=this._getTarget();this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,i,this.usage),this.gl.bufferSubData(r,e,t),this.gl.bindBuffer(r,null),this.debugData=t.slice(0,qo),this.bytesUsed=i,this._trackAllocatedMemory(i);const s=Xr(t);return C(s),this.setAccessor(new Et(this.accessor,{type:s})),this}_setByteLength(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;C(t>=0),this._trackDeallocatedMemory();let i=t;t===0&&(i=new Float32Array(0));const r=this._getTarget();return this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,i,e),this.gl.bindBuffer(r,null),this.usage=e,this.debugData=null,this.bytesUsed=t,this._trackAllocatedMemory(t),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(t){const e=yn(this.accessor.type||5126,{clamped:!1}),i=t/e.BYTES_PER_ELEMENT;return this.getElementCount()-i}_inferType(t){this.accessor.type||this.setAccessor(new Et(this.accessor,{type:Xr(t)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(t){this.gl.bindBuffer(this.target,this.handle);const e=this.gl.getBufferParameter(this.target,t);return this.gl.bindBuffer(this.target,null),e}get type(){return O.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return O.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(t){return O.deprecated("setByteLength","reallocate")(),this.reallocate(t)}updateAccessor(t){return O.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new Et(this.accessor,t),this}}const Ss={[6407]:{dataFormat:6407,types:[5121,33635]},[6408]:{dataFormat:6408,types:[5121,32819,32820]},[6406]:{dataFormat:6406,types:[5121]},[6409]:{dataFormat:6409,types:[5121]},[6410]:{dataFormat:6410,types:[5121]},[33326]:{dataFormat:6403,types:[5126],gl2:!0},[33328]:{dataFormat:33319,types:[5126],gl2:!0},[34837]:{dataFormat:6407,types:[5126],gl2:!0},[34836]:{dataFormat:6408,types:[5126],gl2:!0}},qc={[6403]:1,[36244]:1,[33319]:2,[33320]:2,[6407]:3,[36248]:3,[6408]:4,[36249]:4,[6402]:1,[34041]:1,[6406]:1,[6409]:1,[6410]:2},Zc={[5126]:4,[5125]:4,[5124]:4,[5123]:2,[5122]:2,[5131]:2,[5120]:1,[5121]:1};function Kg(n,t){const e=Ss[t];if(!e)return!1;if(e.gl1===void 0&&e.gl2===void 0)return!0;const i=j(n)&&e.gl2||e.gl1;return typeof i=="string"?n.getExtension(i):i}function Qg(n,t){const e=Ss[t];switch(e&&e.types[0]){case 5126:return n.getExtension("OES_texture_float_linear");case 5131:return n.getExtension("OES_texture_half_float_linear");default:return!0}}const Jg=[9729,9728],Zo=globalThis.WebGLBuffer||function(){};class je extends Qt{get[Symbol.toStringTag](){return"Texture"}static isSupported(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:i,linearFiltering:r}=e;let s=!0;return i&&(s=s&&Kg(t,i),s=s&&(!r||Qg(t,i))),s}constructor(t,e){const{id:i=ye("texture"),handle:r,target:s}=e;super(t,{id:i,handle:r}),this.target=s,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=t.data;if(e instanceof Promise)return e.then(A=>this.initialize(Object.assign({},t,{pixels:A,data:A}))),this;const i=typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement;if(i&&e.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,e.addEventListener("loadeddata",()=>this.initialize(t)),this;const{pixels:r=null,format:s=6408,border:o=0,recreate:a=!1,parameters:c={},pixelStore:l={},textureUnit:u=void 0}=t;e||(e=r);let{width:h,height:g,dataFormat:m,type:b,compressed:y=!1,mipmaps:E=!0}=t;const{depth:T=0}=t;return{width:h,height:g,compressed:y,dataFormat:m,type:b}=this._deduceParameters({format:s,type:b,dataFormat:m,compressed:y,data:e,width:h,height:g}),this.width=h,this.height=g,this.depth=T,this.format=s,this.type=b,this.dataFormat=m,this.border=o,this.textureUnit=u,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),E&&this._isNPOT()&&(O.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),E=!1,this._updateForNPOT(c)),this.mipmaps=E,this.setImageData({data:e,width:h,height:g,depth:T,format:s,type:b,dataFormat:m,border:o,mipmaps:E,parameters:l,compressed:y}),E&&this.generateMipmap(),this.setParameters(c),a&&(this.data=e),i&&(this._video={video:e,parameters:c,lastTime:e.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?e.currentTime:-1}),this}update(){if(this._video){const{video:t,parameters:e,lastTime:i}=this._video;if(i===t.currentTime||t.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:t,parameters:e}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=t.currentTime}}resize(t){let{height:e,width:i,mipmaps:r=!1}=t;return i!==this.width||e!==this.height?this.initialize({width:i,height:e,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:r}):this}generateMipmap(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(O.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),xt(this.gl,t,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(t){this._trackDeallocatedMemory("Texture");const{target:e=this.target,pixels:i=null,level:r=0,format:s=this.format,border:o=this.border,offset:a=0,parameters:c={}}=t;let{data:l=null,type:u=this.type,width:h=this.width,height:g=this.height,dataFormat:m=this.dataFormat,compressed:b=!1}=t;l||(l=i),{type:u,dataFormat:m,compressed:b,width:h,height:g}=this._deduceParameters({format:s,type:u,dataFormat:m,compressed:b,data:l,width:h,height:g});const{gl:y}=this;y.bindTexture(this.target,this.handle);let E=null;({data:l,dataType:E}=this._getDataType({data:l,compressed:b}));let T,A=0;if(xt(this.gl,c,()=>{switch(E){case"null":y.texImage2D(e,r,s,h,g,o,m,u,l);break;case"typed-array":y.texImage2D(e,r,s,h,g,o,m,u,l,a);break;case"buffer":T=ft(y),T.bindBuffer(35052,l.handle||l),T.texImage2D(e,r,s,h,g,o,m,u,a),T.bindBuffer(35052,null);break;case"browser-object":j(y)?y.texImage2D(e,r,s,h,g,o,m,u,l):y.texImage2D(e,r,s,m,u,l);break;case"compressed":for(const[S,x]of l.entries())y.compressedTexImage2D(e,S,x.format,x.width,x.height,o,x.data),A+=x.levelSize;break;default:C(!1,"Unknown image data type")}}),E==="compressed")this._trackAllocatedMemory(A,"Texture");else if(l&&l.byteLength)this._trackAllocatedMemory(l.byteLength,"Texture");else{const S=qc[this.dataFormat]||4,x=Zc[this.type]||1;this._trackAllocatedMemory(this.width*this.height*S*x,"Texture")}return this.loaded=!0,this}setSubImageData(t){let{target:e=this.target,pixels:i=null,data:r=null,x:s=0,y:o=0,width:a=this.width,height:c=this.height,level:l=0,format:u=this.format,type:h=this.type,dataFormat:g=this.dataFormat,compressed:m=!1,offset:b=0,border:y=this.border,parameters:E={}}=t;if({type:h,dataFormat:g,compressed:m,width:a,height:c}=this._deduceParameters({format:u,type:h,dataFormat:g,compressed:m,data:r,width:a,height:c}),C(this.depth===0,"texSubImage not supported for 3D textures"),r||(r=i),r&&r.data){const T=r;r=T.data,a=T.shape[0],c=T.shape[1]}r instanceof W&&(r=r.handle),this.gl.bindTexture(this.target,this.handle),xt(this.gl,E,()=>{if(m)this.gl.compressedTexSubImage2D(e,l,s,o,a,c,u,r);else if(r===null)this.gl.texSubImage2D(e,l,s,o,a,c,g,h,null);else if(ArrayBuffer.isView(r))this.gl.texSubImage2D(e,l,s,o,a,c,g,h,r,b);else if(r instanceof Zo){const T=ft(this.gl);T.bindBuffer(35052,r),T.texSubImage2D(e,l,s,o,a,c,g,h,b),T.bindBuffer(35052,null)}else j(this.gl)?ft(this.gl).texSubImage2D(e,l,s,o,a,c,g,h,r):this.gl.texSubImage2D(e,l,s,o,g,h,r)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return O.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:e}=this;return t!==void 0&&(this.textureUnit=t,e.activeTexture(33984+t)),e.bindTexture(this.target,this.handle),t}unbind(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:e}=this;return t!==void 0&&(this.textureUnit=t,e.activeTexture(33984+t)),e.bindTexture(this.target,null),t}_getDataType(t){let{data:e,compressed:i=!1}=t;return i?{data:e,dataType:"compressed"}:e===null?{data:e,dataType:"null"}:ArrayBuffer.isView(e)?{data:e,dataType:"typed-array"}:e instanceof W?{data:e.handle,dataType:"buffer"}:e instanceof Zo?{data:e,dataType:"buffer"}:{data:e,dataType:"browser-object"}}_deduceParameters(t){const{format:e,data:i}=t;let{width:r,height:s,dataFormat:o,type:a,compressed:c}=t;const l=Ss[e];return o=o||l&&l.dataFormat,a=a||l&&l.types[0],c=c||l&&l.compressed,{width:r,height:s}=this._deduceImageSize(i,r,s),{dataFormat:o,type:a,compressed:c,width:r,height:s,format:e,data:i}}_deduceImageSize(t,e,i){let r;return typeof ImageData<"u"&&t instanceof ImageData?r={width:t.width,height:t.height}:typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement?r={width:t.naturalWidth,height:t.naturalHeight}:typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement?r={width:t.width,height:t.height}:typeof ImageBitmap<"u"&&t instanceof ImageBitmap?r={width:t.width,height:t.height}:typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement?r={width:t.videoWidth,height:t.videoHeight}:t?r={width:e,height:i}:r={width:e>=0?e:1,height:i>=0?i:1},C(r,"Could not deduced texture size"),C(e===void 0||r.width===e,"Deduced texture width does not match supplied width"),C(i===void 0||r.height===i,"Deduced texture height does not match supplied height"),r}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(t){switch(t){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const e=this.gl.getTexParameter(this.target,t);return this.gl.bindTexture(this.target,null),e}}_setParameter(t,e){switch(this.gl.bindTexture(this.target,this.handle),e=this._getNPOTParam(t,e),t){case 33082:case 33083:this.gl.texParameterf(this.handle,t,e);break;case 4096:case 4097:C(!1);break;default:this.gl.texParameteri(this.target,t,e);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return j(this.gl)||!this.width||!this.height?!1:!Yo(this.width)||!Yo(this.height)}_updateForNPOT(t){t[this.gl.TEXTURE_MIN_FILTER]===void 0&&(t[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),t[this.gl.TEXTURE_WRAP_S]===void 0&&(t[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),t[this.gl.TEXTURE_WRAP_T]===void 0&&(t[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(t,e){if(this._isNPOT())switch(t){case 10241:Jg.indexOf(e)===-1&&(e=9729);break;case 10242:case 10243:e!==33071&&(e=33071);break}return e}}let tp="";function ep(n,t){return C(typeof n=="string"),n=tp+n,new Promise((e,i)=>{try{const r=new Image;r.onload=()=>e(r),r.onerror=()=>i(new Error("Could not load image ".concat(n,"."))),r.crossOrigin=t&&t.crossOrigin||"anonymous",r.src=n}catch(r){i(r)}})}class Tt extends je{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(t,e){return je.isSupported(t,e)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Fi(t),(e instanceof Promise||typeof e=="string")&&(e={data:e}),typeof e.data=="string"&&(e=Object.assign({},e,{data:ep(e.data)})),super(t,Object.assign({},e,{target:3553})),this.initialize(e),Object.seal(this)}}const qr=[34069,34070,34071,34072,34073,34074];class $c extends je{get[Symbol.toStringTag](){return"TextureCube"}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Fi(t),super(t,Object.assign({},e,{target:34067})),this.initialize(e),Object.seal(this)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:e=!0,parameters:i={}}=t;return this.opts=t,this.setCubeMapImageData(t).then(()=>{this.loaded=!0,e&&this.generateMipmap(t),this.setParameters(i)}),this}subImage(t){let{face:e,data:i,x:r=0,y:s=0,mipmapLevel:o=0}=t;return this._subImage({target:e,data:i,x:r,y:s,mipmapLevel:o})}async setCubeMapImageData(t){let{width:e,height:i,pixels:r,data:s,border:o=0,format:a=6408,type:c=5121}=t;const{gl:l}=this,u=r||s,h=await Promise.all(qr.map(g=>{const m=u[g];return Promise.all(Array.isArray(m)?m:[m])}));this.bind(),qr.forEach((g,m)=>{h[m].length>1&&this.opts.mipmaps!==!1&&O.warn("".concat(this.id," has mipmap and multiple LODs."))(),h[m].forEach((b,y)=>{e&&i?l.texImage2D(g,y,a,e,i,o,a,c,b):l.texImage2D(g,y,a,a,c,b)})}),this.unbind()}setImageDataForFace(t){const{face:e,width:i,height:r,pixels:s,data:o,border:a=0,format:c=6408,type:l=5121}=t,{gl:u}=this,h=s||o;return this.bind(),h instanceof Promise?h.then(g=>this.setImageDataForFace(Object.assign({},t,{face:e,data:g,pixels:g}))):this.width||this.height?u.texImage2D(e,0,c,i,r,a,c,l,h):u.texImage2D(e,0,c,c,l,h),this}}$c.FACES=qr;class np extends je{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(t){return j(t)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ft(t),e=Object.assign({depth:1},e,{target:32879,unpackFlipY:!1}),super(t,e),this.initialize(e),Object.seal(this)}setImageData(t){let{level:e=0,dataFormat:i=6408,width:r,height:s,depth:o=1,border:a=0,format:c,type:l=5121,offset:u=0,data:h,parameters:g={}}=t;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),xt(this.gl,g,()=>{ArrayBuffer.isView(h)&&this.gl.texImage3D(this.target,e,i,r,s,o,a,c,l,h),h instanceof W&&(this.gl.bindBuffer(35052,h.handle),this.gl.texImage3D(this.target,e,i,r,s,o,a,c,l,u))}),h&&h.byteLength)this._trackAllocatedMemory(h.byteLength,"Texture");else{const m=qc[this.dataFormat]||4,b=Zc[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*m*b,"Texture")}return this.loaded=!0,this}}const de="EXT_color_buffer_float",$o={[33189]:{bpp:2},[33190]:{gl2:!0,bpp:3},[36012]:{gl2:!0,bpp:4},[36168]:{bpp:1},[34041]:{bpp:4},[35056]:{gl2:!0,bpp:4},[36013]:{gl2:!0,bpp:5},[32854]:{bpp:2},[36194]:{bpp:2},[32855]:{bpp:2},[33321]:{gl2:!0,bpp:1},[33330]:{gl2:!0,bpp:1},[33329]:{gl2:!0,bpp:1},[33332]:{gl2:!0,bpp:2},[33331]:{gl2:!0,bpp:2},[33334]:{gl2:!0,bpp:4},[33333]:{gl2:!0,bpp:4},[33323]:{gl2:!0,bpp:2},[33336]:{gl2:!0,bpp:2},[33335]:{gl2:!0,bpp:2},[33338]:{gl2:!0,bpp:4},[33337]:{gl2:!0,bpp:4},[33340]:{gl2:!0,bpp:8},[33339]:{gl2:!0,bpp:8},[32849]:{gl2:!0,bpp:3},[32856]:{gl2:!0,bpp:4},[32857]:{gl2:!0,bpp:4},[36220]:{gl2:!0,bpp:4},[36238]:{gl2:!0,bpp:4},[36975]:{gl2:!0,bpp:4},[36214]:{gl2:!0,bpp:8},[36232]:{gl2:!0,bpp:8},[36226]:{gl2:!0,bpp:16},[36208]:{gl2:!0,bpp:16},[33325]:{gl2:de,bpp:2},[33327]:{gl2:de,bpp:4},[34842]:{gl2:de,bpp:8},[33326]:{gl2:de,bpp:4},[33328]:{gl2:de,bpp:8},[34836]:{gl2:de,bpp:16},[35898]:{gl2:de,bpp:4}};function ip(n,t,e){const i=e[t];if(!i)return!1;const r=j(n)&&i.gl2||i.gl1;return typeof r=="string"?n.getExtension(r):r}class Ce extends Qt{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(t){let{format:e}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!e||ip(t,e,$o)}static getSamplesForFormat(t,e){let{format:i}=e;return t.getInternalformatParameter(36161,i,32937)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,e),this.initialize(e),Object.seal(this)}initialize(t){let{format:e,width:i=1,height:r=1,samples:s=0}=t;return C(e,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),s!==0&&j(this.gl)?this.gl.renderbufferStorageMultisample(36161,s,e,i,r):this.gl.renderbufferStorage(36161,e,i,r),this.format=e,this.width=i,this.height=r,this.samples=s,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*$o[this.format].bpp),this}resize(t){let{width:e,height:i}=t;return e!==this.width||i!==this.height?this.initialize({width:e,height:i,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(t){this.gl.bindRenderbuffer(36161,t)}_syncHandle(t){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(t){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,t)}}const rp=256,sp=1024,op=16384,Ko=6144,Qo=6145,Jo=6146,ta=34041,Kc="clear: bad arguments";function xs(n){let{framebuffer:t=null,color:e=null,depth:i=null,stencil:r=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s={};t&&(s.framebuffer=t);let o=0;e&&(o|=op,e!==!0&&(s.clearColor=e)),i&&(o|=rp,i!==!0&&(s.clearDepth=i)),r&&(o|=sp,i!==!0&&(s.clearStencil=i)),C(o!==0,Kc),xt(n,s,()=>{n.clear(o)})}function ap(n){let{framebuffer:t=null,buffer:e=Ko,drawBuffer:i=0,value:r=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ft(n),xt(n,{framebuffer:t},()=>{switch(e){case Ko:switch(r.constructor){case Int32Array:n.clearBufferiv(e,i,r);break;case Uint32Array:n.clearBufferuiv(e,i,r);break;case Float32Array:default:n.clearBufferfv(e,i,r)}break;case Qo:n.clearBufferfv(Qo,0,[r]);break;case Jo:n.clearBufferiv(Jo,0,[r]);break;case ta:const[s,o]=r;n.clearBufferfi(ta,0,s,o);break;default:C(!1,Kc)}})}function cp(n){switch(n){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return C(!1),0}}function Ui(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:e=0,sourceY:i=0,sourceFormat:r=6408}=t;let{sourceAttachment:s=36064,target:o=null,sourceWidth:a,sourceHeight:c,sourceType:l}=t;const{framebuffer:u,deleteFramebuffer:h}=lp(n);C(u);const{gl:g,handle:m,attachments:b}=u;a=a||u.width,c=c||u.height,s===36064&&m===null&&(s=1028),C(b[s]),l=l||b[s].type,o=up(o,l,r,a,c),l=l||Xr(o);const y=g.bindFramebuffer(36160,m);return g.readPixels(e,i,a,c,r,l,o),g.bindFramebuffer(36160,y||null),h&&u.delete(),o}function ea(n){let{sourceAttachment:t=36064,targetMaxHeight:e=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=Ui(n,{sourceAttachment:t}),{width:r,height:s}=n;for(;s>e;)({data:i,width:r,height:s}=Xg({data:i,width:r,height:s}));Wg({data:i,width:r,height:s});const o=document.createElement("canvas");o.width=r,o.height=s;const a=o.getContext("2d"),c=a.createImageData(r,s);return c.data.set(i),a.putImageData(c,0,0),o.toDataURL()}function lp(n){return n instanceof Q?{framebuffer:n,deleteFramebuffer:!1}:{framebuffer:Ep(n),deleteFramebuffer:!0}}function up(n,t,e,i,r){if(n)return n;t=t||5121;const s=yn(t,{clamped:!1}),o=cp(e);return new s(i*r*o)}const q={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function hp(n){const t=new Tt(n,{format:6408,type:5126,dataFormat:6408}),e=new Q(n,{id:"test-framebuffer",check:!1,attachments:{[36064]:t}}),i=e.getStatus();return t.delete(),e.delete(),i===36053}const Qc={[q.WEBGL2]:[!1,!0],[q.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[q.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[q.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[q.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[q.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[q.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[q.FLOAT_BLEND]:["EXT_float_blend"],[q.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[q.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[q.TEXTURE_FLOAT]:["OES_texture_float",!0],[q.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[q.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[q.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[q.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[q.COLOR_ATTACHMENT_RGBA32F]:[hp,"EXT_color_buffer_float"],[q.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[q.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[q.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[q.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[q.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[q.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},fp=2;function dp(n,t){return Jc(n,t)}function Jc(n,t){return t=Array.isArray(t)?t:[t],t.every(e=>tl(n,e))}function gp(n){n.luma=n.luma||{},n.luma.caps=n.luma.caps||{};for(const t in Qc)n.luma.caps[t]===void 0&&(n.luma.caps[t]=tl(n,t));return n.luma.caps}function tl(n,t){return n.luma=n.luma||{},n.luma.caps=n.luma.caps||{},n.luma.caps[t]===void 0&&(n.luma.caps[t]=pp(n,t)),n.luma.caps[t]||O.log(fp,"Feature: ".concat(t," not supported"))(),n.luma.caps[t]}function pp(n,t){const e=Qc[t];C(e,t);let i;const r=j(n)&&e[1]||e[0];if(typeof r=="function")i=r(n);else if(Array.isArray(r)){i=!0;for(const s of r)i=i&&Boolean(n.getExtension(s))}else typeof r=="string"?i=Boolean(n.getExtension(r)):typeof r=="boolean"?i=r:C(!1);return i}const na="Multiple render targets not supported";class Q extends Qt{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:i,colorBufferHalfFloat:r}=e;let s=!0;return i&&(s=Boolean(t.getExtension("EXT_color_buffer_float")||t.getExtension("WEBGL_color_buffer_float")||t.getExtension("OES_texture_float"))),r&&(s=s&&Boolean(t.getExtension("EXT_color_buffer_float")||t.getExtension("EXT_color_buffer_half_float"))),s}static getDefaultFramebuffer(t){return t.luma=t.luma||{},t.luma.defaultFramebuffer=t.luma.defaultFramebuffer||new Q(t,{id:"default-framebuffer",handle:null,attachments:{}}),t.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const t=ft(this.gl);return t.getParameter(t.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const t=ft(this.gl);return t.getParameter(t.MAX_DRAW_BUFFERS)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,e),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(e),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(t){let{width:e=1,height:i=1,attachments:r=null,color:s=!0,depth:o=!0,stencil:a=!1,check:c=!0,readBuffer:l=void 0,drawBuffers:u=void 0}=t;if(C(e>=0&&i>=0,"Width and height need to be integers"),this.width=e,this.height=i,r)for(const h in r){const g=r[h];(Array.isArray(g)?g[0]:g).resize({width:e,height:i})}else r=this._createDefaultAttachments(s,o,a,e,i);this.update({clearAttachments:!0,attachments:r,readBuffer:l,drawBuffers:u}),r&&c&&this.checkStatus()}delete(){for(const t of this.ownResources)t.delete();return super.delete(),this}update(t){let{attachments:e={},readBuffer:i,drawBuffers:r,clearAttachments:s=!1,resizeAttachments:o=!0}=t;this.attach(e,{clearAttachments:s,resizeAttachments:o});const{gl:a}=this,c=a.bindFramebuffer(36160,this.handle);return i&&this._setReadBuffer(i),r&&this._setDrawBuffers(r),a.bindFramebuffer(36160,c||null),this}resize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:e,height:i}=t;if(this.handle===null)return C(e===void 0&&i===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;e===void 0&&(e=this.gl.drawingBufferWidth),i===void 0&&(i=this.gl.drawingBufferHeight),e!==this.width&&i!==this.height&&O.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(e,"x").concat(i))();for(const r in this.attachments)this.attachments[r].resize({width:e,height:i});return this.width=e,this.height=i,this}attach(t){let{clearAttachments:e=!1,resizeAttachments:i=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r={};e&&Object.keys(this.attachments).forEach(o=>{r[o]=null}),Object.assign(r,t);const s=this.gl.bindFramebuffer(36160,this.handle);for(const o in r){C(o!==void 0,"Misspelled framebuffer binding point?");const a=Number(o),c=r[a];let l=c;if(!l)this._unattach(a);else if(l instanceof Ce)this._attachRenderbuffer({attachment:a,renderbuffer:l});else if(Array.isArray(c)){const[u,h=0,g=0]=c;l=u,this._attachTexture({attachment:a,texture:u,layer:h,level:g})}else this._attachTexture({attachment:a,texture:l,layer:0,level:0});i&&l&&l.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,s||null),Object.assign(this.attachments,t),Object.keys(this.attachments).filter(o=>!this.attachments[o]).forEach(o=>{delete this.attachments[o]})}checkStatus(){const t=this.getStatus();if(t!==36053)throw new Error(_p(t));return this}getStatus(){const{gl:t}=this,e=t.bindFramebuffer(36160,this.handle),i=t.checkFramebufferStatus(36160);return t.bindFramebuffer(36160,e||null),i}clear(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:e,depth:i,stencil:r,drawBuffers:s=[]}=t,o=this.gl.bindFramebuffer(36160,this.handle);return(e||i||r)&&xs(this.gl,{color:e,depth:i,stencil:r}),s.forEach((a,c)=>{ap(this.gl,{drawBuffer:c,value:a})}),this.gl.bindFramebuffer(36160,o||null),this}readPixels(){return O.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return O.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return O.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return O.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return O.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return O.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(t){let{attachments:e=[],x:i=0,y:r=0,width:s,height:o}=t;const a=ft(this.gl),c=a.bindFramebuffer(36008,this.handle);return i===0&&r===0&&s===void 0&&o===void 0?a.invalidateFramebuffer(36008,e):a.invalidateFramebuffer(36008,e,i,r,s,o),a.bindFramebuffer(36008,c),this}getAttachmentParameter(t,e,i){let r=this._getAttachmentParameterFallback(e);return r===null&&(this.gl.bindFramebuffer(36160,this.handle),r=this.gl.getFramebufferAttachmentParameter(36160,t,e),this.gl.bindFramebuffer(36160,null)),i&&r>1e3&&(r=ae(this.gl,r)),r}getAttachmentParameters(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,e=arguments.length>1?arguments[1]:void 0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const r={};for(const s of i){const o=e?ae(this.gl,s):s;r[o]=this.getAttachmentParameter(t,s,e)}return r}getParameters(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const e=Object.keys(this.attachments),i={};for(const r of e){const s=Number(r),o=t?ae(this.gl,s):s;i[o]=this.getAttachmentParameters(s,t)}return i}show(){return typeof window<"u"&&window.open(ea(this),"luma-debug-texture"),this}log(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(t>O.level||typeof window>"u")return this;e=e||"Framebuffer ".concat(this.id);const i=ea(this,{targetMaxHeight:100});return O.image({logLevel:t,message:e,image:i},e)(),this}bind(){let{target:t=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(t,this.handle),this}unbind(){let{target:t=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(t,null),this}_createDefaultAttachments(t,e,i,r,s){let o=null;return t&&(o=o||{},o[36064]=new Tt(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:r,height:s,mipmaps:!1,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.ownResources.push(o[36064])),e&&i?(o=o||{},o[33306]=new Ce(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:r,height:111}),this.ownResources.push(o[33306])):e?(o=o||{},o[36096]=new Ce(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:r,height:s}),this.ownResources.push(o[36096])):i&&C(!1),o}_unattach(t){const e=this.attachments[t];!e||(e instanceof Ce?this.gl.framebufferRenderbuffer(36160,t,36161,null):this.gl.framebufferTexture2D(36160,t,3553,null,0),delete this.attachments[t])}_attachRenderbuffer(t){let{attachment:e=36064,renderbuffer:i}=t;const{gl:r}=this;r.framebufferRenderbuffer(36160,e,36161,i.handle),this.attachments[e]=i}_attachTexture(t){let{attachment:e=36064,texture:i,layer:r,level:s}=t;const{gl:o}=this;switch(o.bindTexture(i.target,i.handle),i.target){case 35866:case 32879:ft(o).framebufferTextureLayer(36160,e,i.target,s,r);break;case 34067:const c=mp(r);o.framebufferTexture2D(36160,e,c,i.handle,s);break;case 3553:o.framebufferTexture2D(36160,e,3553,i.handle,s);break;default:C(!1,"Illegal texture type")}o.bindTexture(i.target,null),this.attachments[e]=i}_setReadBuffer(t){const e=Wd(this.gl);e?e.readBuffer(t):C(t===36064||t===1029,na),this.readBuffer=t}_setDrawBuffers(t){const{gl:e}=this,i=ft(e);if(i)i.drawBuffers(t);else{const r=e.getExtension("WEBGL_draw_buffers");r?r.drawBuffersWEBGL(t):C(t.length===1&&(t[0]===36064||t[0]===1029),na)}this.drawBuffers=t}_getAttachmentParameterFallback(t){const e=gp(this.gl);switch(t){case 36052:return e.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return e.WEBGL2?null:8;case 33297:return e.WEBGL2?null:5125;case 33296:return!e.WEBGL2&&!e.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(t){return this.gl.bindFramebuffer(36160,t)}}function mp(n){return n<34069?n+34069:n}function _p(n){return(Q.STATUS||{})[n]||"Framebuffer error ".concat(n)}const bp=[36049,36048,33296,33298,33299,33300,33301,33302,33303];Q.ATTACHMENT_PARAMETERS=bp;function yp(n,t){C(n instanceof Tt||n instanceof $c||n instanceof np);const e=n.constructor,{gl:i,width:r,height:s,format:o,type:a,dataFormat:c,border:l,mipmaps:u}=n,h=Object.assign({width:r,height:s,format:o,type:a,dataFormat:c,border:l,mipmaps:u},t);return new e(i,h)}function Ep(n,t){const{gl:e,width:i,height:r,id:s}=n;return new Q(e,Object.assign({},t,{id:"framebuffer-for-".concat(s),width:i,height:r,attachments:{[36064]:n}}))}function ci(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const e=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,i=n.match(e);return i?i[1]:t}const vp=35632,Tp=35633;function wp(n){switch(n){case vp:return"fragment";case Tp:return"vertex";default:return"unknown type"}}function Ap(n,t,e,i){const r=n.split(/\r?\n/),s={},o={},a=i||ci(t)||"(unnamed)",c="".concat(wp(e)," shader ").concat(a);for(let u=0;u<r.length;u++){const h=r[u];if(h.length<=1)continue;const g=h.split(":"),m=g[0],b=parseInt(g[2],10);if(isNaN(b))throw new Error("GLSL compilation error in ".concat(c,": ").concat(n));m!=="WARNING"?s[b]=h:o[b]=h}const l=Sp(t);return{shaderName:c,errors:ia(s,l),warnings:ia(o,l)}}function ia(n,t){let e="";for(let i=0;i<t.length;i++){const r=t[i];if(!(!n[i+3]&&!n[i+2]&&!n[i+1])&&(e+="".concat(r,`
`),n[i+1])){const s=n[i+1],o=s.split(":",3),a=o[0],c=parseInt(o[1],10)||0,l=s.substring(o.join(":").length+1).trim();e+=el("^^^ ".concat(a,": ").concat(l,`

`),c)}}return e}function Sp(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const i=n.split(/\r?\n/),r=String(i.length+t-1).length;return i.map((s,o)=>{const a=String(o+t),c=a.length;return el(a,r-c)+e+s})}function el(n,t){let e="";for(let i=0;i<t;++i)e+=" ";return"".concat(e).concat(n)}function nl(n){let t=100;const e=n.match(/[^\s]+/g);if(e.length>=2&&e[0]==="#version"){const i=parseInt(e[1],10);Number.isFinite(i)&&(t=i)}return t}const xp="Shader: GLSL source code must be a JavaScript string";class En extends Qt{get[Symbol.toStringTag](){return"Shader"}static getTypeName(t){switch(t){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return C(!1),"unknown"}}constructor(t,e){Fi(t),C(typeof e.source=="string",xp);const i=ci(e.source,null)||e.id||ye("unnamed ".concat(En.getTypeName(e.shaderType)));super(t,{id:i}),this.shaderType=e.shaderType,this.source=e.source,this.initialize(e)}initialize(t){let{source:e}=t;const i=ci(e,null);i&&(this.id=ye(i)),this._compile(e)}getParameter(t){return this.gl.getShaderParameter(this.handle,t)}toString(){return"".concat(En.getTypeName(this.shaderType),":").concat(this.id)}getName(){return ci(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const t=this.gl.getExtension("WEBGL_debug_shaders");return t?t.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(t.startsWith("#version ")||(t=`#version 100
`.concat(t)),this.source=t,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const i=this.gl.getShaderInfoLog(this.handle),{shaderName:r,errors:s,warnings:o}=Ap(i,this.source,this.shaderType,this.id);throw O.error("GLSL compilation errors in ".concat(r,`
`).concat(s))(),O.warn("GLSL compilation warnings in ".concat(r,`
`).concat(o))(),new Error("GLSL compilation errors in ".concat(r))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class br extends En{get[Symbol.toStringTag](){return"VertexShader"}constructor(t,e){typeof e=="string"&&(e={source:e}),super(t,Object.assign({},e,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class yr extends En{get[Symbol.toStringTag](){return"FragmentShader"}constructor(t,e){typeof e=="string"&&(e={source:e}),super(t,Object.assign({},e,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const Pp={[5126]:Y.bind(null,"uniform1fv",_t,1,ot),[35664]:Y.bind(null,"uniform2fv",_t,2,ot),[35665]:Y.bind(null,"uniform3fv",_t,3,ot),[35666]:Y.bind(null,"uniform4fv",_t,4,ot),[5124]:Y.bind(null,"uniform1iv",ee,1,ot),[35667]:Y.bind(null,"uniform2iv",ee,2,ot),[35668]:Y.bind(null,"uniform3iv",ee,3,ot),[35669]:Y.bind(null,"uniform4iv",ee,4,ot),[35670]:Y.bind(null,"uniform1iv",ee,1,ot),[35671]:Y.bind(null,"uniform2iv",ee,2,ot),[35672]:Y.bind(null,"uniform3iv",ee,3,ot),[35673]:Y.bind(null,"uniform4iv",ee,4,ot),[35674]:Y.bind(null,"uniformMatrix2fv",_t,4,Ht),[35675]:Y.bind(null,"uniformMatrix3fv",_t,9,Ht),[35676]:Y.bind(null,"uniformMatrix4fv",_t,16,Ht),[35678]:rt,[35680]:rt,[5125]:Y.bind(null,"uniform1uiv",Yn,1,ot),[36294]:Y.bind(null,"uniform2uiv",Yn,2,ot),[36295]:Y.bind(null,"uniform3uiv",Yn,3,ot),[36296]:Y.bind(null,"uniform4uiv",Yn,4,ot),[35685]:Y.bind(null,"uniformMatrix2x3fv",_t,6,Ht),[35686]:Y.bind(null,"uniformMatrix2x4fv",_t,8,Ht),[35687]:Y.bind(null,"uniformMatrix3x2fv",_t,6,Ht),[35688]:Y.bind(null,"uniformMatrix3x4fv",_t,12,Ht),[35689]:Y.bind(null,"uniformMatrix4x2fv",_t,8,Ht),[35690]:Y.bind(null,"uniformMatrix4x3fv",_t,12,Ht),[35678]:rt,[35680]:rt,[35679]:rt,[35682]:rt,[36289]:rt,[36292]:rt,[36293]:rt,[36298]:rt,[36299]:rt,[36300]:rt,[36303]:rt,[36306]:rt,[36307]:rt,[36308]:rt,[36311]:rt},Mp={},Lp={},Rp={},ra=[0];function Ps(n,t,e,i){t===1&&typeof n=="boolean"&&(n=n?1:0),Number.isFinite(n)&&(ra[0]=n,n=ra);const r=n.length;if(r%t&&O.warn("Uniform size should be multiples of ".concat(t),n)(),n instanceof e)return n;let s=i[r];s||(s=new e(r),i[r]=s);for(let o=0;o<r;o++)s[o]=n[o];return s}function _t(n,t){return Ps(n,t,Float32Array,Mp)}function ee(n,t){return Ps(n,t,Int32Array,Lp)}function Yn(n,t){return Ps(n,t,Uint32Array,Rp)}function sa(n,t,e){const i=Pp[e.type];if(!i)throw new Error("Unknown GLSL uniform type ".concat(e.type));return i().bind(null,n,t)}function Ip(n){if(n[n.length-1]!=="]")return{name:n,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/,e=n.match(t);if(!e||e.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(n));return{name:e[1],length:e[2]||1,isArray:Boolean(e[2])}}function Cp(n,t,e){for(const i in n){const r=n[i];if((!e||Boolean(e[i]))&&!Op(r))throw t=t?"".concat(t," "):"",console.error("".concat(t," Bad uniform ").concat(i),r),new Error("".concat(t," Bad uniform ").concat(i))}return!0}function Op(n){return Array.isArray(n)||ArrayBuffer.isView(n)?Np(n):isFinite(n)||n===!0||n===!1||n instanceof je||n instanceof Ce?!0:n instanceof Q?Boolean(n.texture):!1}function kp(n,t,e){if(Array.isArray(e)||ArrayBuffer.isView(e))if(n[t]){const i=n[t];for(let r=0,s=e.length;r<s;++r)i[r]=e[r]}else n[t]=e.slice();else n[t]=e}function Np(n){if(n.length===0)return!1;const t=Math.min(n.length,16);for(let e=0;e<t;++e)if(!Number.isFinite(n[e]))return!1;return!0}function rt(){let n=null;return(t,e,i)=>{const r=n!==i;return r&&(t.uniform1i(e,i),n=i),r}}function Y(n,t,e,i){let r=null,s=null;return(o,a,c)=>{const l=t(c,e),u=l.length;let h=!1;if(r===null)r=new Float32Array(u),s=u,h=!0;else{C(s===u,"Uniform length cannot change.");for(let g=0;g<u;++g)if(l[g]!==r[g]){h=!0;break}}return h&&(i(o,n,a,l),r.set(l)),h}}function ot(n,t,e,i){n[t](e,i)}function Ht(n,t,e,i){n[t](e,!1,i)}const Dp=5120,Fp=5121,Up=5122,Bp=5123,oa=0,qn=1,Vp=2,jp=3,Zn=4,zp=5,Gp=6,tt=5126,Hp=35664,Wp=35665,Xp=35666,cn=5124,Yp=35667,qp=35668,Zp=35669,ln=5125,$p=36294,Kp=36295,Qp=36296,Jp=35670,tm=35671,em=35672,nm=35673,im=35674,rm=35675,sm=35676,om=35685,am=35686,cm=35687,lm=35688,um=35689,hm=35690,Zr={[tt]:[tt,1,"float"],[Hp]:[tt,2,"vec2"],[Wp]:[tt,3,"vec3"],[Xp]:[tt,4,"vec4"],[cn]:[cn,1,"int"],[Yp]:[cn,2,"ivec2"],[qp]:[cn,3,"ivec3"],[Zp]:[cn,4,"ivec4"],[ln]:[ln,1,"uint"],[$p]:[ln,2,"uvec2"],[Kp]:[ln,3,"uvec3"],[Qp]:[ln,4,"uvec4"],[Jp]:[tt,1,"bool"],[tm]:[tt,2,"bvec2"],[em]:[tt,3,"bvec3"],[nm]:[tt,4,"bvec4"],[im]:[tt,8,"mat2"],[om]:[tt,8,"mat2x3"],[am]:[tt,8,"mat2x4"],[rm]:[tt,12,"mat3"],[cm]:[tt,12,"mat3x2"],[lm]:[tt,12,"mat3x4"],[sm]:[tt,16,"mat4"],[um]:[tt,16,"mat4x2"],[hm]:[tt,16,"mat4x3"]};function fm(n){switch(n){case oa:return oa;case qn:return qn;case jp:return qn;case Vp:return qn;case Zn:return Zn;case zp:return Zn;case Gp:return Zn;default:return C(!1),0}}function aa(n){const t=Zr[n];if(!t)return null;const[e,i]=t;return{type:e,components:i}}function il(n,t){switch(n){case Dp:case Fp:case Up:case Bp:n=tt;break}for(const e in Zr){const[i,r,s]=Zr[e];if(i===n&&r===t)return{glType:e,name:s}}return null}class dm{constructor(t){this.id=t.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(t),this._readVaryingsFromProgram(t)}getAttributeInfo(t){const e=Number(t);return Number.isFinite(e)?this.attributeInfosByLocation[e]:this.attributeInfosByName[t]||null}getAttributeLocation(t){const e=this.getAttributeInfo(t);return e?e.location:-1}getAttributeAccessor(t){const e=this.getAttributeInfo(t);return e?e.accessor:null}getVaryingInfo(t){const e=Number(t);return Number.isFinite(e)?this.varyingInfos[e]:this.varyingInfosByName[t]||null}getVaryingIndex(t){const e=this.getVaryingInfo();return e?e.location:-1}getVaryingAccessor(t){const e=this.getVaryingInfo();return e?e.accessor:null}_readAttributesFromProgram(t){const{gl:e}=t,i=e.getProgramParameter(t.handle,35721);for(let r=0;r<i;r++){const{name:s,type:o,size:a}=e.getActiveAttrib(t.handle,r),c=e.getAttribLocation(t.handle,s);c>=0&&this._addAttribute(c,s,o,a)}this.attributeInfos.sort((r,s)=>r.location-s.location)}_readVaryingsFromProgram(t){const{gl:e}=t;if(!j(e))return;const i=e.getProgramParameter(t.handle,35971);for(let r=0;r<i;r++){const{name:s,type:o,size:a}=e.getTransformFeedbackVarying(t.handle,r);this._addVarying(r,s,o,a)}this.varyingInfos.sort((r,s)=>r.location-s.location)}_addAttribute(t,e,i,r){const{type:s,components:o}=aa(i),a={type:s,size:r*o};this._inferProperties(t,e,a);const c={location:t,name:e,accessor:new Et(a)};this.attributeInfos.push(c),this.attributeInfosByLocation[t]=c,this.attributeInfosByName[c.name]=c}_inferProperties(t,e,i){/instance/i.test(e)&&(i.divisor=1)}_addVarying(t,e,i,r){const{type:s,components:o}=aa(i),a=new Et({type:s,size:r*o}),c={location:t,name:e,accessor:a};this.varyingInfos.push(c),this.varyingInfosByName[c.name]=c}}const ca=4,gm=35981,pm=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class rl extends Qt{get[Symbol.toStringTag](){return"Program"}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,e),this.stubRemovedMethods("Program","v6.0",pm),this._isCached=!1,this.initialize(e),Object.seal(this),this._setId(e.id)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:e,vs:i,fs:r,varyings:s,bufferMode:o=gm}=t;return this.hash=e||"",this.vs=typeof i=="string"?new br(this.gl,{id:"".concat(t.id,"-vs"),source:i}):i,this.fs=typeof r=="string"?new yr(this.gl,{id:"".concat(t.id,"-fs"),source:r}):r,C(this.vs instanceof br),C(this.fs instanceof yr),this.uniforms={},this._textureUniforms={},s&&s.length>0&&(ft(this.gl),this.varyings=s,this.gl2.transformFeedbackVaryings(this.handle,s,o)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new dm(this),this.setProps(t)}delete(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(t)}setProps(t){return"uniforms"in t&&this.setUniforms(t.uniforms),this}draw(t){let{logPriority:e,drawMode:i=4,vertexCount:r,offset:s=0,start:o,end:a,isIndexed:c=!1,indexType:l=5123,instanceCount:u=0,isInstanced:h=u>0,vertexArray:g=null,transformFeedback:m,framebuffer:b,parameters:y={},uniforms:E,samplers:T}=t;if((E||T)&&(O.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(E||{})),O.priority>=e){const A=b?b.id:"default",S="mode=".concat(ae(this.gl,i)," verts=").concat(r," ")+"instances=".concat(u," indexType=").concat(ae(this.gl,l)," ")+"isInstanced=".concat(h," isIndexed=").concat(c," ")+"Framebuffer=".concat(A);O.log(e,S)()}return C(g),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||r===0||h&&u===0?!1:(g.bindForDraw(r,u,()=>{if(b!==void 0&&(y=Object.assign({},y,{framebuffer:b})),m){const A=fm(i);m.begin(A)}this._bindTextures(),xt(this.gl,y,()=>{c&&h?this.gl2.drawElementsInstanced(i,r,l,s,u):c&&j(this.gl)&&!isNaN(o)&&!isNaN(a)?this.gl2.drawRangeElements(i,o,a,r,l,s):c?this.gl.drawElements(i,r,l,s):h?this.gl2.drawArraysInstanced(i,s,r,u):this.gl.drawArrays(i,s,r)}),m&&m.end()}),!0)}setUniforms(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};O.priority>=2&&Cp(t,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const e in t){const i=t[e],r=this._uniformSetters[e];if(r){let s=i,o=!1;if(s instanceof Q&&(s=s.texture),s instanceof je)if(o=this.uniforms[e]!==i,o){r.textureIndex===void 0&&(r.textureIndex=this._textureIndexCounter++);const a=s,{textureIndex:c}=r;a.bind(c),s=c,this._textureUniforms[e]=a}else s=r.textureIndex;else this._textureUniforms[e]&&delete this._textureUniforms[e];(r(s)||o)&&kp(this.uniforms,e,i)}}return this}_areTexturesRenderable(){let t=!0;for(const e in this._textureUniforms){const i=this._textureUniforms[e];i.update(),t=t&&i.loaded}return t}_bindTextures(){for(const t in this._textureUniforms){const e=this._uniformSetters[t].textureIndex;this._textureUniforms[t].bind(e)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(t){const e=this.gl.getAttachedShaders(t),i={};for(const r of e)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:i.vs=new br({handle:r});break;case 35632:i.fs=new yr({handle:r});break}return i}_getParameter(t){return this.gl.getProgramParameter(this.handle,t)}_setId(t){if(!t){const e=this._getName();this.id=ye(e)}}_getName(){let t=this.vs.getName()||this.fs.getName();return t=t.replace(/shader/i,""),t=t?"".concat(t,"-program"):"program",t}_compileAndLink(){const{gl:t}=this;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),O.time(ca,"linkProgram for ".concat(this._getName()))(),t.linkProgram(this.handle),O.timeEnd(ca,"linkProgram for ".concat(this._getName()))(),t.debug||O.level>0){if(!t.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(t.getProgramInfoLog(this.handle)));if(t.validateProgram(this.handle),!t.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(t.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:t}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let e=0;e<this._uniformCount;e++){const i=this.gl.getActiveUniform(this.handle,e),{name:r}=Ip(i.name);let s=t.getUniformLocation(this.handle,r);if(this._uniformSetters[r]=sa(t,s,i),i.size>1)for(let o=0;o<i.size;o++)s=t.getUniformLocation(this.handle,"".concat(r,"[").concat(o,"]")),this._uniformSetters["".concat(r,"[").concat(o,"]")]=sa(t,s,i)}this._textureIndexCounter=0}getActiveUniforms(t,e){return this.gl2.getActiveUniforms(this.handle,t,e)}getUniformBlockIndex(t){return this.gl2.getUniformBlockIndex(this.handle,t)}getActiveUniformBlockParameter(t,e){return this.gl2.getActiveUniformBlockParameter(this.handle,t,e)}uniformBlockBinding(t,e){this.gl2.uniformBlockBinding(this.handle,t,e)}}const mm=34918,_m=34919,bm=35007,ym=36795,Em=35976,vm=35887,Tm=36202;class bi extends Qt{get[Symbol.toStringTag](){return"Query"}static isSupported(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const i=j(t),r=Jc(t,q.TIMER_QUERY);let s=i||r;for(const o of e)switch(o){case"queries":s=s&&i;break;case"timers":s=s&&r;break;default:C(!1)}return s}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,e),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(bm)}beginOcclusionQuery(){let{conservative:t=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(t?Tm:vm)}beginTransformFeedbackQuery(){return this.begin(Em)}begin(t){return this._queryPending?this:(this.target=t,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const t=this.gl2.getQueryParameter(this.handle,_m);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.gl2.getParameter(ym)}getResult(){return this.gl2.getQueryParameter(this.handle,mm)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let e=0;return this._pollingPromise=new Promise((i,r)=>{const s=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):e++>t?(r("Timed out"),this._pollingPromise=null):requestAnimationFrame(s)};requestAnimationFrame(s)}),this._pollingPromise}_createHandle(){return bi.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class sl extends Qt{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(t){return j(t)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ft(t),super(t,e),this.initialize(e),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,Ve(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(t),this}setProps(t){"program"in t&&(this.configuration=t.program&&t.program.configuration),"configuration"in t&&(this.configuration=t.configuration),"bindOnUse"in t&&(t=t.bindOnUse),"buffers"in t&&this.setBuffers(t.buffers)}setBuffers(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const e in t)this.setBuffer(e,t[e])}),this}setBuffer(t,e){const i=this._getVaryingIndex(t),{buffer:r,byteSize:s,byteOffset:o}=this._getBufferParams(e);return i<0?(this.unused[t]=r,O.warn("".concat(this.id," unused varying buffer ").concat(t))(),this):(this.buffers[i]=e,this.bindOnUse||this._bindBuffer(i,r,o,s),this)}begin(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(t),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(t){let e,i,r;return t instanceof W?r=t:(r=t.buffer,i=t.byteSize,e=t.byteOffset),(e!==void 0||i!==void 0)&&(e=e||0,i=i||r.byteLength-e),{buffer:r,byteOffset:e,byteSize:i}}_getVaryingInfo(t){return this.configuration&&this.configuration.getVaryingInfo(t)}_getVaryingIndex(t){if(this.configuration)return this.configuration.getVaryingInfo(t).location;const e=Number(t);return Number.isFinite(e)?e:-1}_bindBuffers(){if(this.bindOnUse)for(const t in this.buffers){const{buffer:e,byteSize:i,byteOffset:r}=this._getBufferParams(this.buffers[t]);this._bindBuffer(t,e,r,i)}}_unbindBuffers(){if(this.bindOnUse)for(const t in this.buffers)this._bindBuffer(t,null)}_bindBuffer(t,e){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0;const s=e&&e.handle;return!s||r===void 0?this.gl.bindBufferBase(35982,t,s):this.gl.bindBufferRange(35982,t,s,i,r),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(t){this.gl.bindTransformFeedback(36386,this.handle)}}let $n=null;function wm(n){return(!$n||$n.byteLength<n)&&($n=new ArrayBuffer(n)),$n}function Am(n,t){const e=wm(n.BYTES_PER_ELEMENT*t);return new n(e,0,t)}function Sm(n){let{target:t,source:e,start:i=0,count:r=1}=n;const s=e.length,o=r*s;let a=0;for(let c=i;a<s;a++)t[c++]=e[a];for(;a<o;)a<o-a?(t.copyWithin(i+a,i,i+a),a*=2):(t.copyWithin(i+a,i,i+o-a),a=o);return t}const xm="elements must be GL.ELEMENT_ARRAY_BUFFER";class bt extends Qt{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(t){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?j(t)||xc()==="Chrome":!0}static getDefaultArray(t){return t.luma=t.luma||{},t.luma.defaultVertexArray||(t.luma.defaultVertexArray=new bt(t,{handle:null,isDefaultArray:!0})),t.luma.defaultVertexArray}static getMaxAttributes(t){return bt.MAX_ATTRIBUTES=bt.MAX_ATTRIBUTES||t.getParameter(34921),bt.MAX_ATTRIBUTES}static setConstant(t,e,i){switch(i.constructor){case Float32Array:bt._setConstantFloatArray(t,e,i);break;case Int32Array:bt._setConstantIntArray(t,e,i);break;case Uint32Array:bt._setConstantUintArray(t,e,i);break;default:C(!1)}}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=e.id||e.program&&e.program.id;super(t,Object.assign({},e,{id:i})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=e.isDefaultArray||!1,this.gl2=t,this.initialize(e),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return bt.getMaxAttributes(this.gl)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(t)}setProps(t){return this}setElementBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return C(!t||t.target===34963,xm),this.bind(()=>{this.gl.bindBuffer(34963,t?t.handle:null)}),this}setBuffer(t,e,i){if(e.target===34963)return this.setElementBuffer(e,i);const{size:r,type:s,stride:o,offset:a,normalized:c,integer:l,divisor:u}=i,{gl:h,gl2:g}=this;return t=Number(t),this.bind(()=>{h.bindBuffer(34962,e.handle),l?(C(j(h)),g.vertexAttribIPointer(t,r,s,o,a)):h.vertexAttribPointer(t,r,s,c,o,a),h.enableVertexAttribArray(t),g.vertexAttribDivisor(t,u||0)}),this}enable(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!e&&t===0&&!bt.isSupported(this.gl,{constantAttributeZero:!0})||(t=Number(t),this.bind(()=>e?this.gl.enableVertexAttribArray(t):this.gl.disableVertexAttribArray(t))),this}getConstantBuffer(t,e){const i=this._normalizeConstantArrayValue(e),r=i.byteLength*t,s=i.length*t;let o=!this.buffer;if(this.buffer=this.buffer||new W(this.gl,r),o=o||this.buffer.reallocate(r),o=o||!this._compareConstantArrayValues(i,this.bufferValue),o){const a=Am(e.constructor,s);Sm({target:a,source:i,start:0,count:s}),this.buffer.subData(a),this.bufferValue=e}return this.buffer}_normalizeConstantArrayValue(t){return Array.isArray(t)?new Float32Array(t):t}_compareConstantArrayValues(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}static _setConstantFloatArray(t,e,i){switch(i.length){case 1:t.vertexAttrib1fv(e,i);break;case 2:t.vertexAttrib2fv(e,i);break;case 3:t.vertexAttrib3fv(e,i);break;case 4:t.vertexAttrib4fv(e,i);break;default:C(!1)}}static _setConstantIntArray(t,e,i){switch(C(j(t)),i.length){case 1:t.vertexAttribI1iv(e,i);break;case 2:t.vertexAttribI2iv(e,i);break;case 3:t.vertexAttribI3iv(e,i);break;case 4:t.vertexAttribI4iv(e,i);break;default:C(!1)}}static _setConstantUintArray(t,e,i){switch(C(j(t)),i.length){case 1:t.vertexAttribI1uiv(e,i);break;case 2:t.vertexAttribI2uiv(e,i);break;case 3:t.vertexAttribI3uiv(e,i);break;case 4:t.vertexAttribI4uiv(e,i);break;default:C(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(t){return this.gl2.deleteVertexArray(t),[this.elements]}_bindHandle(t){this.gl2.bindVertexArray(t)}_getParameter(t,e){let{location:i}=e;return C(Number.isFinite(i)),this.bind(()=>{switch(t){case 34373:return this.gl.getVertexAttribOffset(i,t);default:return this.gl.getVertexAttrib(i,t)}})}}const Pm="VertexArray: attributes must be Buffers or constants (i.e. typed array)",Mm=/^(.+)__LOCATION_([0-9]+)$/,Lm=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class Rm{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=e.id||e.program&&e.program.id;this.id=i,this.gl=t,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new bt(t),Xc(this,"VertexArray","v6.0",Lm),this.initialize(e),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(t)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:t}=this.vertexArrayObject;return this.values=new Array(t).fill(null),this.accessors=new Array(t).fill(null),this.unused={},this.drawParams=null,this}setProps(t){return"program"in t&&(this.configuration=t.program&&t.program.configuration),"configuration"in t&&(this.configuration=t.configuration),"attributes"in t&&this.setAttributes(t.attributes),"elements"in t&&this.setElementBuffer(t.elements),"bindOnUse"in t&&(t=t.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(t){return Object.assign(this.attributes,t),this.vertexArrayObject.bind(()=>{for(const e in t){const i=t[e];this._setAttribute(e,i)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=t,this.elementsAccessor=e,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(t,e),this}setBuffer(t,e){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e.target===34963)return this.setElementBuffer(e,i);const{location:r,accessor:s}=this._resolveLocationAndAccessor(t,e,e.accessor,i);return r>=0&&(this.values[r]=e,this.accessors[r]=s,this.clearDrawParams(),this.vertexArrayObject.setBuffer(r,e,s)),this}setConstant(t,e){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:r,accessor:s}=this._resolveLocationAndAccessor(t,e,Object.assign({size:e.length},i));return r>=0&&(e=this.vertexArrayObject._normalizeConstantArrayValue(e),this.values[r]=e,this.accessors[r]=s,this.clearDrawParams(),this.vertexArrayObject.enable(r,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new W(this.gl,{accessor:{size:4}});for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++)this.values[t]instanceof W&&(this.gl.disableVertexAttribArray(t),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(t,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++){const e=this.values[t];e instanceof W&&this.setBuffer(t,e)}}),this}bindForDraw(t,e,i){let r;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(t,e),r=i()}),r}_resolveLocationAndAccessor(t,e,i,r){const s={location:-1,accessor:null},{location:o,name:a}=this._getAttributeIndex(t);if(!Number.isFinite(o)||o<0)return this.unused[t]=e,O.once(3,()=>"unused value ".concat(t," in ").concat(this.id))(),s;const c=this._getAttributeInfo(a||o);if(!c)return s;const l=this.accessors[o]||{},u=Et.resolve(c.accessor,l,i,r),{size:h,type:g}=u;return C(Number.isFinite(h)&&Number.isFinite(g)),{location:o,accessor:u}}_getAttributeInfo(t){return this.configuration&&this.configuration.getAttributeInfo(t)}_getAttributeIndex(t){const e=Number(t);if(Number.isFinite(e))return{location:e};const i=Mm.exec(t),r=i?i[1]:t,s=i?Number(i[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(r)+s,name:r}:{location:-1}}_setAttribute(t,e){if(e instanceof W)this.setBuffer(t,e);else if(Array.isArray(e)&&e.length&&e[0]instanceof W){const i=e[0],r=e[1];this.setBuffer(t,i,r)}else if(ArrayBuffer.isView(e)||Array.isArray(e)){const i=e;this.setConstant(t,i)}else if(e.buffer instanceof W){const i=e;this.setBuffer(t,i.buffer,i)}else throw new Error(Pm)}_setConstantAttributes(t,e){const i=Math.max(t|0,e|0);let r=this.values[0];ArrayBuffer.isView(r)&&this._setConstantAttributeZero(r,i);for(let s=1;s<this.vertexArrayObject.MAX_ATTRIBUTES;s++)r=this.values[s],ArrayBuffer.isView(r)&&this._setConstantAttribute(s,r)}_setConstantAttributeZero(t,e){if(bt.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,t);return}const i=this.vertexArrayObject.getConstantBuffer(e,t);this.vertexArrayObject.setBuffer(0,i,this.accessors[0])}_setConstantAttribute(t,e){bt.setConstant(this.gl,t,e)}_updateDrawParams(){const t={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this._updateDrawParamsForLocation(t,e);return this.elements&&(t.elementCount=this.elements.getElementCount(this.elements.accessor),t.isIndexed=!0,t.indexType=this.elementsAccessor.type||this.elements.accessor.type,t.indexOffset=this.elementsAccessor.offset||0),t.indexCount===1/0&&(t.indexCount=0),t.vertexCount===1/0&&(t.vertexCount=0),t.instanceCount===1/0&&(t.instanceCount=0),t}_updateDrawParamsForLocation(t,e){const i=this.values[e],r=this.accessors[e];if(!i)return;const{divisor:s}=r,o=s>0;if(t.isInstanced=t.isInstanced||o,i instanceof W){const a=i;if(o){const c=a.getVertexCount(r);t.instanceCount=Math.min(t.instanceCount,c)}else{const c=a.getVertexCount(r);t.vertexCount=Math.min(t.vertexCount,c)}}}setElements(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return O.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(t,e)}}function Im(n,t){const{maxElts:e=16,size:i=1}=t;let r="[";for(let o=0;o<n.length&&o<e;++o)o>0&&(r+=",".concat(o%i===0?" ":"")),r+=vn(n[o],t);const s=n.length>e?"...":"]";return"".concat(r).concat(s)}function vn(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e=1e-16,{isInteger:i=!1}=t;if(Array.isArray(n)||ArrayBuffer.isView(n))return Im(n,t);if(!Number.isFinite(n))return String(n);if(Math.abs(n)<e)return i?"0":"0.";if(i||Math.abs(n)>100&&Math.abs(n)<1e4)return n.toFixed(0);const r=n.toPrecision(2);return r.indexOf(".0")===r.length-2?r.slice(0,-1):r}function la(n){let{header:t="Uniforms",program:e,uniforms:i,undefinedOnly:r=!1}=n;C(e);const s=".*_.*",o=".*Matrix",a=e._uniformSetters,c={},l=Object.keys(a).sort();let u=0;for(const m of l)!m.match(s)&&!m.match(o)&&Er({table:c,header:t,uniforms:i,uniformName:m,undefinedOnly:r})&&u++;for(const m of l)m.match(o)&&Er({table:c,header:t,uniforms:i,uniformName:m,undefinedOnly:r})&&u++;for(const m of l)c[m]||Er({table:c,header:t,uniforms:i,uniformName:m,undefinedOnly:r})&&u++;let h=0;const g={};if(!r)for(const m in i){const b=i[m];c[m]||(h++,g[m]={Type:"NOT USED: ".concat(b),[t]:vn(b)})}return{table:c,count:u,unusedTable:g,unusedCount:h}}function Er(n){let{table:t,header:e,uniforms:i,uniformName:r,undefinedOnly:s}=n;const o=i[r],a=Cm(o);return!s||!a?(t[r]={[e]:a?vn(o):"N/A","Uniform Type":a?o:"NOT PROVIDED"},!0):!1}function Cm(n){return n!=null}function Om(n){let{vertexArray:t,header:e="Attributes"}=n;if(!t.configuration)return{};const i={};t.elements&&(i.ELEMENT_ARRAY_BUFFER=ua(t,t.elements,null,e));const r=t.values;for(const s in r){const o=t._getAttributeInfo(s);if(o){let a="".concat(s,": ").concat(o.name);const c=t.accessors[o.location];c&&(a="".concat(s,": ").concat(km(o.name,c))),i[a]=ua(t,r[s],c,e)}}return i}function ua(n,t,e,i){const{gl:r}=n;if(!t)return{[i]:"null","Format ":"N/A"};let s="NOT PROVIDED",o=1,a=0,c=0,l,u,h;if(e&&(s=e.type,o=e.size,s=String(s).replace("Array",""),l=s.indexOf("nt")!==-1),t instanceof W){const g=t,{data:m,changed:b}=g.getDebugData();u=b?"*":"",h=m,c=g.byteLength,a=c/m.BYTES_PER_ELEMENT/o;let y;if(e){const E=e.divisor>0;y="".concat(E?"I ":"P "," ").concat(a," (x").concat(o,"=").concat(c," bytes ").concat(ae(r,s),")")}else l=!0,y="".concat(c," bytes");return{[i]:"".concat(u).concat(vn(h,{size:o,isInteger:l})),"Format ":y}}return h=t,o=t.length,s=String(t.constructor.name).replace("Array",""),l=s.indexOf("nt")!==-1,{[i]:"".concat(vn(h,{size:o,isInteger:l})," (constant)"),"Format ":"".concat(o,"x").concat(s," (constant)")}}function km(n,t){const{type:e,size:i}=t,r=il(e,i);return r?"".concat(n," (").concat(r.name,")"):n}function Nm(n){const t={},e="Accessors for ".concat(n.id);for(const i of n.attributeInfos)if(i){const r=ha(i);t["in ".concat(r)]={[e]:JSON.stringify(i.accessor)}}for(const i of n.varyingInfos)if(i){const r=ha(i);t["out ".concat(r)]={[e]:JSON.stringify(i.accessor)}}return t}function ha(n){const{type:t,size:e}=n.accessor,i=il(t,e);return i?"".concat(i.name," ").concat(n.name):n.name}const fa=Kt()&&typeof document<"u";let Dm=0;class Fm{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:e=E=>Wc(E),onAddHTML:i=null,onInitialize:r=()=>{},onRender:s=()=>{},onFinalize:o=()=>{},onError:a,gl:c=null,glOptions:l={},debug:u=!1,createFramebuffer:h=!1,autoResizeViewport:g=!0,autoResizeDrawingBuffer:m=!0,stats:b=_e.get("animation-loop-".concat(Dm++))}=t;let{useDevicePixels:y=!0}=t;"useDevicePixelRatio"in t&&(O.deprecated("useDevicePixelRatio","useDevicePixels")(),y=t.useDevicePixelRatio),this.props={onCreateContext:e,onAddHTML:i,onInitialize:r,onRender:s,onFinalize:o,onError:a,gl:c,glOptions:l,debug:u,createFramebuffer:h},this.gl=c,this.needsRedraw=null,this.timeline=null,this.stats=b,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:g,autoResizeDrawingBuffer:m,useDevicePixels:y}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(t){return C(typeof t=="string"),this.needsRedraw=this.needsRedraw||t,this}setProps(t){return"autoResizeViewport"in t&&(this.autoResizeViewport=t.autoResizeViewport),"autoResizeDrawingBuffer"in t&&(this.autoResizeDrawingBuffer=t.autoResizeDrawingBuffer),"useDevicePixels"in t&&(this.useDevicePixels=t.useDevicePixels),this}start(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const e=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(t),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=bi.isSupported(this.gl,["timers"])?new bi(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(i=>{this._running&&(this._addCallbackData(i||{}),i!==!1&&this._startLoop())});return this.props.onError&&e.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(t){return this.timeline=t,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(t=>{this._resolveNextFrame=t})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.getElementById(t);return i?Number(i.value):e}setViewParameters(){return O.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const t=()=>{!this._running||(this.redraw(),this._animationFrameId=this._requestAnimationFrame(t))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(t)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=fa?new Promise((t,e)=>{if(fa&&document.readyState==="complete"){t(document);return}window.addEventListener("load",()=>{t(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(t){this.display&&(this.display.delete(),this.display.animationLoop=null),t&&(t.animationLoop=this),this.display=t}_cancelAnimationFrame(t){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(t):Gg(t)}_requestAnimationFrame(t){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(t):zg(t)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:t,height:e,aspect:i}=this._getSizeAndAspect();(t!==this.animationProps.width||e!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=t,this.animationProps.height=e,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(t){typeof t=="object"&&t!==null&&(this.animationProps=Object.assign({},this.animationProps,t))}_createWebGLContext(t){if(this.offScreen=t.canvas&&typeof OffscreenCanvas<"u"&&t.canvas instanceof OffscreenCanvas,t=Object.assign({},t,this.props.glOptions),this.gl=this.props.gl?As(this.props.gl,t):this.onCreateContext(t),!Di(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");Lg(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const t=document.createElement("div");document.body.appendChild(t),t.style.position="relative";const e=document.createElement("div");e.style.position="absolute",e.style.left="10px",e.style.bottom="10px",e.style.width="300px",e.style.background="white",t.appendChild(this.gl.canvas),t.appendChild(e);const i=this.props.onAddHTML(e);i&&(e.innerHTML=i)}}_getSizeAndAspect(){const t=this.gl.drawingBufferWidth,e=this.gl.drawingBufferHeight;let i=1;const{canvas:r}=this.gl;return r&&r.clientHeight?i=r.clientWidth/r.clientHeight:t>0&&e>0&&(i=t/e),{width:t,height:e,aspect:i}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&kg(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new Q(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:t}=this.gl;t&&(t.addEventListener("mousemove",this._onMousemove),t.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(t){this.animationProps._mousePosition=[t.offsetX,t.offsetY]}_onMouseleave(t){this.animationProps._mousePosition=null}}const Rn="vs",Ms="fs";function vt(n,t){if(!n)throw new Error(t||"shadertools: assertion failed.")}const vr={number:{validate(n,t){return Number.isFinite(n)&&(!("max"in t)||n<=t.max)&&(!("min"in t)||n>=t.min)}},array:{validate(n,t){return Array.isArray(n)||ArrayBuffer.isView(n)}}};function Um(n){const t={};for(const e in n){const i=n[e],r=Bm(i);t[e]=r}return t}function Bm(n){let t=da(n);return t==="object"?n?"type"in n?Object.assign({},n,vr[n.type]):"value"in n?(t=da(n.value),Object.assign({type:t},n,vr[t])):{type:"object",value:n}:{type:"object",value:null}:Object.assign({type:t,value:n},vr[t])}function da(n){return Array.isArray(n)||ArrayBuffer.isView(n)?"array":typeof n}const Vm="vs",jm="fs";class ga{constructor(t){let{name:e,vs:i,fs:r,dependencies:s=[],uniforms:o,getUniforms:a,deprecations:c=[],defines:l={},inject:u={},vertexShader:h,fragmentShader:g}=t;vt(typeof e=="string"),this.name=e,this.vs=i||h,this.fs=r||g,this.getModuleUniforms=a,this.dependencies=s,this.deprecations=this._parseDeprecationDefinitions(c),this.defines=l,this.injections=zm(u),o&&(this.uniforms=Um(o))}getModuleSource(t){let e;switch(t){case Vm:e=this.vs||"";break;case jm:e=this.fs||"";break;default:vt(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(e,"// END MODULE_").concat(this.name,`

`)}getUniforms(t,e){return this.getModuleUniforms?this.getModuleUniforms(t,e):this.uniforms?this._defaultGetUniforms(t):{}}getDefines(){return this.defines}checkDeprecations(t,e){this.deprecations.forEach(i=>{i.regex.test(t)&&(i.deprecated?e.deprecated(i.old,i.new)():e.removed(i.old,i.new)())})}_parseDeprecationDefinitions(t){return t.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp("\\b".concat(e.old,"\\("));break;default:e.regex=new RegExp("".concat(e.type," ").concat(e.old,";"))}}),t}_defaultGetUniforms(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e={},i=this.uniforms;for(const r in i){const s=i[r];r in t&&!s.private?(s.validate&&vt(s.validate(t[r],s),"".concat(this.name,": invalid ").concat(r)),e[r]=t[r]):e[r]=s.value}return e}}function zm(n){const t={vs:{},fs:{}};for(const e in n){let i=n[e];const r=e.slice(0,2);typeof i=="string"&&(i={order:0,injection:i}),t[r][e]=i}return t}function Gm(n){return Hm(al(n))}function Hm(n){const t={},e={};return ol({modules:n,level:0,moduleMap:t,moduleDepth:e}),Object.keys(e).sort((i,r)=>e[r]-e[i]).map(i=>t[i])}function ol(n){let{modules:t,level:e,moduleMap:i,moduleDepth:r}=n;if(e>=5)throw new Error("Possible loop in shader dependency graph");for(const s of t)i[s.name]=s,(r[s.name]===void 0||r[s.name]<e)&&(r[s.name]=e);for(const s of t)s.dependencies&&ol({modules:s.dependencies,level:e+1,moduleMap:i,moduleDepth:r})}function al(n,t){return n.map(e=>(e instanceof ga||(vt(typeof e!="string","Shader module use by name is deprecated. Import shader module '".concat(e,"' and use it directly.")),vt(e.name,"shader module has no name"),e=new ga(e),e.dependencies=al(e.dependencies)),e))}function Wm(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=typeof window<"u"?window.navigator||{}:{},e=n.userAgent||t.userAgent||"",i=e.indexOf("MSIE ")!==-1,r=e.indexOf("Trident/")!==-1;return i||r}const Xm=7936,Ym=7937,qm=7938,Zm=35724,Ls={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},me={};Object.keys(Ls).forEach(n=>{me[n]=n});function $m(n){return typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext?!0:Boolean(n&&n._version===2)}function Km(n){const t=n.getExtension("WEBGL_debug_renderer_info"),e=n.getParameter(t&&t.UNMASKED_VENDOR_WEBGL||Xm),i=n.getParameter(t&&t.UNMASKED_RENDERER_WEBGL||Ym);return{gpuVendor:Qm(e,i),vendor:e,renderer:i,version:n.getParameter(qm),shadingLanguageVersion:n.getParameter(Zm)}}function Qm(n,t){return n.match(/NVIDIA/i)||t.match(/NVIDIA/i)?"NVIDIA":n.match(/INTEL/i)||t.match(/INTEL/i)?"INTEL":n.match(/AMD/i)||t.match(/AMD/i)||n.match(/ATI/i)||t.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const Tr={};function pa(n,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i=Ls[t];if(vt(i,t),!Wm(e))return!0;if(t in Tr)return Tr[t];const r=i[0],s=e.behavior||"enable",o="#extension GL_".concat(r," : ").concat(s,`
void main(void) {}`),a=n.createShader(35633);n.shaderSource(a,o),n.compileShader(a);const c=n.getShaderParameter(a,35713);return n.deleteShader(a),Tr[t]=c,c}function Jm(n,t){const e=Ls[t];vt(e,t);const i=$m(n)&&e[1]||e[0],r=typeof i=="string"?Boolean(n.getExtension(i)):i;return vt(r===!1||r===!0),r}function Kn(n,t){return t=Array.isArray(t)?t:[t],t.every(e=>Jm(n,e))}function t0(n){switch(Km(n).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function e0(n,t,e){let i=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return Kn(n,me.GLSL_FRAG_DEPTH)&&(i+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),Kn(n,me.GLSL_DERIVATIVES)&&pa(n,me.GLSL_DERIVATIVES)&&(i+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),Kn(n,me.GLSL_FRAG_DATA)&&pa(n,me.GLSL_FRAG_DATA,{behavior:"require"})&&(i+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),Kn(n,me.GLSL_TEXTURE_LOD)&&(i+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),i}const n0=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,i0=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,r0={[Rn]:n0,[Ms]:i0},li="__LUMA_INJECT_DECLARATIONS__",ma=/void\s+main\s*\([^)]*\)\s*\{\n?/,_a=/}\n?[^{}]*$/,wr=[];function ba(n,t,e){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const r=t===Rn;for(const s in e){const o=e[s];o.sort((c,l)=>c.order-l.order),wr.length=o.length;for(let c=0,l=o.length;c<l;++c)wr[c]=o[c].injection;const a="".concat(wr.join(`
`),`
`);switch(s){case"vs:#decl":r&&(n=n.replace(li,a));break;case"vs:#main-start":r&&(n=n.replace(ma,c=>c+a));break;case"vs:#main-end":r&&(n=n.replace(_a,c=>a+c));break;case"fs:#decl":r||(n=n.replace(li,a));break;case"fs:#main-start":r||(n=n.replace(ma,c=>c+a));break;case"fs:#main-end":r||(n=n.replace(_a,c=>a+c));break;default:n=n.replace(s,c=>c+a)}}return n=n.replace(li,""),i&&(n=n.replace(/\}\s*$/,s=>s+r0[t])),n}function $r(n){const t={};return vt(Array.isArray(n)&&n.length>1),n.forEach(e=>{for(const i in e)t[i]=t[i]?"".concat(t[i],`
`).concat(e[i]):e[i]}),t}function ze(n){return new RegExp("\\b".concat(n,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const cl=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],s0=[...cl,[ze("attribute"),"in $1"],[ze("varying"),"out $1"]],o0=[...cl,[ze("varying"),"in $1"]],ll=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],a0=[...ll,[ze("in"),"attribute $1"],[ze("out"),"varying $1"]],c0=[...ll,[ze("in"),"varying $1"]],Kr="gl_FragColor",Qr=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,l0=/void\s+main\s*\([^)]*\)\s*\{\n?/;function u0(n,t,e){switch(t){case 300:return e?yi(n,s0):h0(n);case 100:return e?yi(n,a0):f0(n);default:throw new Error("unknown GLSL version ".concat(t))}}function yi(n,t){for(const[e,i]of t)n=n.replace(e,i);return n}function h0(n){n=yi(n,o0);const t=n.match(Qr);if(t){const e=t[1];n=n.replace(new RegExp("\\b".concat(Kr,"\\b"),"g"),e)}else{const e="fragmentColor";n=n.replace(l0,i=>"out vec4 ".concat(e,`;
`).concat(i)).replace(new RegExp("\\b".concat(Kr,"\\b"),"g"),e)}return n}function f0(n){n=yi(n,c0);const t=n.match(Qr);if(t){const e=t[1];n=n.replace(Qr,"").replace(new RegExp("\\b".concat(e,"\\b"),"g"),Kr)}return n}const d0=`

`.concat(li,`

`),ul={[Rn]:"vertex",[Ms]:"fragment"},g0=`precision highp float;

`;function p0(n,t){const{vs:e,fs:i}=t,r=Gm(t.modules||[]);return{gl:n,vs:ya(n,Object.assign({},t,{source:e,type:Rn,modules:r})),fs:ya(n,Object.assign({},t,{source:i,type:Ms,modules:r})),getUniforms:m0(r)}}function ya(n,t){let{id:e,source:i,type:r,modules:s,defines:o={},hookFunctions:a=[],inject:c={},transpileToGLSL100:l=!1,prologue:u=!0,log:h}=t;vt(typeof i=="string","shader source must be a string");const g=r===Rn,m=i.split(`
`);let b=100,y="",E=i;m[0].indexOf("#version ")===0?(b=300,y=m[0],E=m.slice(1).join(`
`)):y="#version ".concat(b);const T={};s.forEach(N=>{Object.assign(T,N.getDefines())}),Object.assign(T,o);let A=u?"".concat(y,`
`).concat(b0({id:e,source:i,type:r}),`
`).concat(_0({type:r}),`
`).concat(t0(n),`
`).concat(e0(n),`
`).concat(y0(T),`
`).concat(g?"":g0,`
`):"".concat(y,`
`);const S=v0(a),x={},M={},R={};for(const N in c){const B=typeof c[N]=="string"?{injection:c[N],order:0}:c[N],k=N.match(/^(v|f)s:(#)?([\w-]+)$/);if(k){const D=k[2],F=k[3];D?F==="decl"?M[N]=[B]:R[N]=[B]:x[N]=[B]}else R[N]=[B]}for(const N of s){h&&N.checkDeprecations(E,h),A+=N.getModuleSource(r,b);const k=N.injections[r];for(const D in k){const F=D.match(/^(v|f)s:#([\w-]+)$/);if(F){const et=F[2]==="decl"?M:R;et[D]=et[D]||[],et[D].push(k[D])}else x[D]=x[D]||[],x[D].push(k[D])}}return A+=d0,A=ba(A,r,M),A+=E0(S[r],x),A+=E,A=ba(A,r,R),A=u0(A,l?100:b,g),A}function m0(n){return function(e){const i={};for(const r of n){const s=r.getUniforms(e,i);Object.assign(i,s)}return i}}function _0(n){let{type:t}=n;return`
#define SHADER_TYPE_`.concat(ul[t].toUpperCase(),`
`)}function b0(n){let{id:t,source:e,type:i}=n;return t&&typeof t=="string"&&e.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(t,"_").concat(ul[i],`

`):""}function y0(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=0,e="";for(const i in n){t===0&&(e+=`
// APPLICATION DEFINES
`),t++;const r=n[i];(r||Number.isFinite(r))&&(e+="#define ".concat(i.toUpperCase()," ").concat(n[i],`
`))}return t===0&&(e+=`
`),e}function E0(n,t){let e="";for(const i in n){const r=n[i];if(e+="void ".concat(r.signature,` {
`),r.header&&(e+="  ".concat(r.header)),t[i]){const s=t[i];s.sort((o,a)=>o.order-a.order);for(const o of s)e+="  ".concat(o.injection,`
`)}r.footer&&(e+="  ".concat(r.footer)),e+=`}
`}return e}function v0(n){const t={vs:{},fs:{}};return n.forEach(e=>{let i;typeof e!="string"?(i=e,e=i.hook):i={},e=e.trim();const[r,s]=e.split(":"),o=e.replace(/\(.+/,"");t[r][o]=Object.assign(i,{signature:s})}),t}const T0="void main() {gl_FragColor = vec4(0);}",hl=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,w0=`#version 300 es
`.concat(hl);function fl(n,t){t=Array.isArray(t)?t:[t];const e=n.replace(/^\s+/,"").split(/\s+/),[i,r,s]=e;if(!t.includes(i)||!r||!s)return null;const o=s.split(";")[0];return{qualifier:i,type:r,name:o}}function dl(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:t=100,input:e,inputType:i,output:r}=n;if(!e)return t===300?w0:t>300?"#version ".concat(t,`
`).concat(hl):T0;const s=x0(e,i);return t>=300?"#version ".concat(t," ").concat(t===300?"es":"",`
in `).concat(i," ").concat(e,`;
out vec4 `).concat(r,`;
void main() {
  `).concat(r," = ").concat(s,`;
}`):"varying ".concat(i," ").concat(e,`;
void main() {
  gl_FragColor = `).concat(s,`;
}`)}function A0(n){switch(n){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return vt(!1),null}}function S0(n){switch(n){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return vt(!1),null}}function x0(n,t){switch(t){case"float":return"vec4(".concat(n,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(n,", 0.0, 1.0)");case"vec3":return"vec4(".concat(n,", 1.0)");case"vec4":return n;default:return vt(!1),null}}const P0=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,M0={name:"fp32",vs:P0,fs:null};function Ea(n,t){if(!n)throw new Error("math.gl assertion ".concat(t))}const L0=1/Math.PI*180,R0=1/180*Math.PI,pt={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function gl(n,{precision:t=pt.precision}={}){return n=I0(n),"".concat(parseFloat(n.toPrecision(t)))}function Ge(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}function Qn(n,t){return Rs(n,e=>e*R0,t)}function Pe(n,t){return Rs(n,e=>e*L0,t)}function $(n,t,e){return Rs(n,i=>Math.max(t,Math.min(e,i)))}function Ei(n,t,e){return Ge(n)?n.map((i,r)=>Ei(i,t[r],e)):e*t+(1-e)*n}function Xt(n,t,e){const i=pt.EPSILON;e&&(pt.EPSILON=e);try{if(n===t)return!0;if(Ge(n)&&Ge(t)){if(n.length!==t.length)return!1;for(let r=0;r<n.length;++r)if(!Xt(n[r],t[r]))return!1;return!0}return n&&n.equals?n.equals(t):t&&t.equals?t.equals(n):typeof n=="number"&&typeof t=="number"?Math.abs(n-t)<=pt.EPSILON*Math.max(1,Math.abs(n),Math.abs(t)):!1}finally{pt.EPSILON=i}}function I0(n){return Math.round(n/pt.EPSILON)*pt.EPSILON}function C0(n){return n.clone?n.clone():new Array(n.length)}function Rs(n,t,e){if(Ge(n)){const i=n;e=e||C0(i);for(let r=0;r<e.length&&r<i.length;++r)e[r]=t(n[r],r,e);return e}return t(n)}function O0(n){function t(){var e=Reflect.construct(n,Array.from(arguments));return Object.setPrototypeOf(e,Object.getPrototypeOf(this)),e}return t.prototype=Object.create(n.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,n):t.__proto__=n,t}class pl extends O0(Array){clone(){return new this.constructor().copy(this)}fromArray(t,e=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=t[i+e];return this.check()}toArray(t=[],e=0){for(let i=0;i<this.ELEMENTS;++i)t[e+i]=this[i];return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:Ge(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(pt)}formatString(t){let e="";for(let i=0;i<this.ELEMENTS;++i)e+=(i>0?", ":"")+gl(this[i],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(e,"]")}equals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(!Xt(this[e],t[e]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,e,i){if(i===void 0)return this.lerp(this,t,e);for(let r=0;r<this.ELEMENTS;++r){const s=t[r];this[r]=s+i*(e[r]-s)}return this.check()}min(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}max(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}clamp(t,e){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],t[i]),e[i]);return this.check()}add(...t){for(const e of t)for(let i=0;i<this.ELEMENTS;++i)this[i]+=e[i];return this.check()}subtract(...t){for(const e of t)for(let i=0;i<this.ELEMENTS;++i)this[i]-=e[i];return this.check()}scale(t){if(typeof t=="number")for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;else for(let e=0;e<this.ELEMENTS&&e<t.length;++e)this[e]*=t[e];return this.check()}multiplyByScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}check(){if(pt.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let t=this.length===this.ELEMENTS;for(let e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}addScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,e){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],t),e);return this.check()}get elements(){return this}}function k0(n,t){if(n.length!==t)return!1;for(let e=0;e<n.length;++e)if(!Number.isFinite(n[e]))return!1;return!0}function yt(n){if(!Number.isFinite(n))throw new Error("Invalid number ".concat(n));return n}function Ar(n,t,e=""){if(pt.debug&&!k0(n,t))throw new Error("math.gl: ".concat(e," some fields set to invalid numbers'"));return n}class N0 extends pl{get x(){return this[0]}set x(t){this[0]=yt(t)}get y(){return this[1]}set y(t){this[1]=yt(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let e=0;for(let i=0;i<this.ELEMENTS;++i){const r=this[i]-t[i];e+=r*r}return yt(e)}dot(t){let e=0;for(let i=0;i<this.ELEMENTS;++i)e+=this[i]*t[i];return yt(e)}normalize(){const t=this.magnitude();if(t!==0)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}multiply(...t){for(const e of t)for(let i=0;i<this.ELEMENTS;++i)this[i]*=e[i];return this.check()}divide(...t){for(const e of t)for(let i=0;i<this.ELEMENTS;++i)this[i]/=e[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return Ea(t>=0&&t<this.ELEMENTS,"index is out of range"),yt(this[t])}setComponent(t,e){return Ea(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}addVectors(t,e){return this.copy(t).add(e)}subVectors(t,e){return this.copy(t).subtract(e)}multiplyVectors(t,e){return this.copy(t).multiply(e)}addScaledVector(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}}var ui=1e-6,He=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});function D0(){var n=new He(2);return He!=Float32Array&&(n[0]=0,n[1]=0),n}function vi(n,t,e){return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n}function ml(n,t){return n[0]=-t[0],n[1]=-t[1],n}function _l(n,t,e,i){var r=t[0],s=t[1];return n[0]=r+i*(e[0]-r),n[1]=s+i*(e[1]-s),n}function F0(n,t,e){var i=t[0],r=t[1];return n[0]=e[0]*i+e[4]*r+e[12],n[1]=e[1]*i+e[5]*r+e[13],n}(function(){var n=D0();return function(t,e,i,r,s,o){var a,c;for(e||(e=2),i||(i=0),r?c=Math.min(r*e+i,t.length):c=t.length,a=i;a<c;a+=e)n[0]=t[a],n[1]=t[a+1],s(n,n,o),t[a]=n[0],t[a+1]=n[1];return t}})();function U0(n,t,e){const i=t[0],r=t[1],s=e[3]*i+e[7]*r||1;return n[0]=(e[0]*i+e[4]*r)/s,n[1]=(e[1]*i+e[5]*r)/s,n}function bl(n,t,e){const i=t[0],r=t[1],s=t[2],o=e[3]*i+e[7]*r+e[11]*s||1;return n[0]=(e[0]*i+e[4]*r+e[8]*s)/o,n[1]=(e[1]*i+e[5]*r+e[9]*s)/o,n[2]=(e[2]*i+e[6]*r+e[10]*s)/o,n}function B0(n,t,e){const i=t[0],r=t[1];return n[0]=e[0]*i+e[2]*r,n[1]=e[1]*i+e[3]*r,n[2]=t[2],n}function V0(){var n=new He(3);return He!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function yl(n){var t=n[0],e=n[1],i=n[2];return Math.hypot(t,e,i)}function j0(n,t,e){return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n}function z0(n){var t=n[0],e=n[1],i=n[2];return t*t+e*e+i*i}function G0(n,t){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n}function H0(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function W0(n,t,e){var i=t[0],r=t[1],s=t[2],o=e[0],a=e[1],c=e[2];return n[0]=r*c-s*a,n[1]=s*o-i*c,n[2]=i*a-r*o,n}function X0(n,t,e,i){var r=t[0],s=t[1],o=t[2];return n[0]=r+i*(e[0]-r),n[1]=s+i*(e[1]-s),n[2]=o+i*(e[2]-o),n}function El(n,t,e){var i=t[0],r=t[1],s=t[2],o=e[3]*i+e[7]*r+e[11]*s+e[15];return o=o||1,n[0]=(e[0]*i+e[4]*r+e[8]*s+e[12])/o,n[1]=(e[1]*i+e[5]*r+e[9]*s+e[13])/o,n[2]=(e[2]*i+e[6]*r+e[10]*s+e[14])/o,n}function Y0(n,t,e){var i=t[0],r=t[1],s=t[2];return n[0]=i*e[0]+r*e[3]+s*e[6],n[1]=i*e[1]+r*e[4]+s*e[7],n[2]=i*e[2]+r*e[5]+s*e[8],n}function q0(n,t,e){var i=e[0],r=e[1],s=e[2],o=e[3],a=t[0],c=t[1],l=t[2],u=r*l-s*c,h=s*a-i*l,g=i*c-r*a,m=r*g-s*h,b=s*u-i*g,y=i*h-r*u,E=o*2;return u*=E,h*=E,g*=E,m*=2,b*=2,y*=2,n[0]=a+u+m,n[1]=c+h+b,n[2]=l+g+y,n}function Z0(n,t,e,i){var r=[],s=[];return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],s[0]=r[0],s[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),s[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),n[0]=s[0]+e[0],n[1]=s[1]+e[1],n[2]=s[2]+e[2],n}function $0(n,t,e,i){var r=[],s=[];return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],s[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),s[1]=r[1],s[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),n[0]=s[0]+e[0],n[1]=s[1]+e[1],n[2]=s[2]+e[2],n}function K0(n,t,e,i){var r=[],s=[];return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],s[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),s[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),s[2]=r[2],n[0]=s[0]+e[0],n[1]=s[1]+e[1],n[2]=s[2]+e[2],n}function Q0(n,t){var e=n[0],i=n[1],r=n[2],s=t[0],o=t[1],a=t[2],c=Math.sqrt(e*e+i*i+r*r),l=Math.sqrt(s*s+o*o+a*a),u=c*l,h=u&&H0(n,t)/u;return Math.acos(Math.min(Math.max(h,-1),1))}var vl=j0,J0=yl,Sr=z0;(function(){var n=V0();return function(t,e,i,r,s,o){var a,c;for(e||(e=3),i||(i=0),r?c=Math.min(r*e+i,t.length):c=t.length,a=i;a<c;a+=e)n[0]=t[a],n[1]=t[a+1],n[2]=t[a+2],s(n,n,o),t[a]=n[0],t[a+1]=n[1],t[a+2]=n[2];return t}})();const xr=[0,0,0];let Jn;class Pt extends N0{static get ZERO(){return Jn||(Jn=new Pt(0,0,0),Object.freeze(Jn)),Jn}constructor(t=0,e=0,i=0){super(-0,-0,-0),arguments.length===1&&Ge(t)?this.copy(t):(pt.debug&&(yt(t),yt(e),yt(i)),this[0]=t,this[1]=e,this[2]=i)}set(t,e,i){return this[0]=t,this[1]=e,this[2]=i,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return pt.debug&&(yt(t.x),yt(t.y),yt(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=yt(t)}angle(t){return Q0(this,t)}cross(t){return W0(this,this,t),this.check()}rotateX({radians:t,origin:e=xr}){return Z0(this,this,e,t),this.check()}rotateY({radians:t,origin:e=xr}){return $0(this,this,e,t),this.check()}rotateZ({radians:t,origin:e=xr}){return K0(this,this,e,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return El(this,this,t),this.check()}transformAsVector(t){return bl(this,this,t),this.check()}transformByMatrix3(t){return Y0(this,this,t),this.check()}transformByMatrix2(t){return B0(this,this,t),this.check()}transformByQuaternion(t){return q0(this,this,t),this.check()}}class t_ extends pl{toString(){let t="[";if(pt.printRowMajor){t+="row-major:";for(let e=0;e<this.RANK;++e)for(let i=0;i<this.RANK;++i)t+=" ".concat(this[i*this.RANK+e])}else{t+="column-major:";for(let e=0;e<this.ELEMENTS;++e)t+=" ".concat(this[e])}return t+="]",t}getElementIndex(t,e){return e*this.RANK+t}getElement(t,e){return this[e*this.RANK+t]}setElement(t,e,i){return this[e*this.RANK+t]=yt(i),this}getColumn(t,e=new Array(this.RANK).fill(-0)){const i=t*this.RANK;for(let r=0;r<this.RANK;++r)e[r]=this[i+r];return e}setColumn(t,e){const i=t*this.RANK;for(let r=0;r<this.RANK;++r)this[i+r]=e[r];return this}}function e_(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function n_(n,t){if(n===t){var e=t[1],i=t[2],r=t[3],s=t[6],o=t[7],a=t[11];n[1]=t[4],n[2]=t[8],n[3]=t[12],n[4]=e,n[6]=t[9],n[7]=t[13],n[8]=i,n[9]=s,n[11]=t[14],n[12]=r,n[13]=o,n[14]=a}else n[0]=t[0],n[1]=t[4],n[2]=t[8],n[3]=t[12],n[4]=t[1],n[5]=t[5],n[6]=t[9],n[7]=t[13],n[8]=t[2],n[9]=t[6],n[10]=t[10],n[11]=t[14],n[12]=t[3],n[13]=t[7],n[14]=t[11],n[15]=t[15];return n}function Jr(n,t){var e=t[0],i=t[1],r=t[2],s=t[3],o=t[4],a=t[5],c=t[6],l=t[7],u=t[8],h=t[9],g=t[10],m=t[11],b=t[12],y=t[13],E=t[14],T=t[15],A=e*a-i*o,S=e*c-r*o,x=e*l-s*o,M=i*c-r*a,R=i*l-s*a,N=r*l-s*c,B=u*y-h*b,k=u*E-g*b,D=u*T-m*b,F=h*E-g*y,J=h*T-m*y,et=g*T-m*E,z=A*et-S*J+x*F+M*D-R*k+N*B;return z?(z=1/z,n[0]=(a*et-c*J+l*F)*z,n[1]=(r*J-i*et-s*F)*z,n[2]=(y*N-E*R+T*M)*z,n[3]=(g*R-h*N-m*M)*z,n[4]=(c*D-o*et-l*k)*z,n[5]=(e*et-r*D+s*k)*z,n[6]=(E*x-b*N-T*S)*z,n[7]=(u*N-g*x+m*S)*z,n[8]=(o*J-a*D+l*B)*z,n[9]=(i*D-e*J-s*B)*z,n[10]=(b*R-y*x+T*A)*z,n[11]=(h*x-u*R-m*A)*z,n[12]=(a*k-o*F-c*B)*z,n[13]=(e*F-i*k+r*B)*z,n[14]=(y*S-b*M-E*A)*z,n[15]=(u*M-h*S+g*A)*z,n):null}function i_(n){var t=n[0],e=n[1],i=n[2],r=n[3],s=n[4],o=n[5],a=n[6],c=n[7],l=n[8],u=n[9],h=n[10],g=n[11],m=n[12],b=n[13],y=n[14],E=n[15],T=t*o-e*s,A=t*a-i*s,S=t*c-r*s,x=e*a-i*o,M=e*c-r*o,R=i*c-r*a,N=l*b-u*m,B=l*y-h*m,k=l*E-g*m,D=u*y-h*b,F=u*E-g*b,J=h*E-g*y;return T*J-A*F+S*D+x*k-M*B+R*N}function be(n,t,e){var i=t[0],r=t[1],s=t[2],o=t[3],a=t[4],c=t[5],l=t[6],u=t[7],h=t[8],g=t[9],m=t[10],b=t[11],y=t[12],E=t[13],T=t[14],A=t[15],S=e[0],x=e[1],M=e[2],R=e[3];return n[0]=S*i+x*a+M*h+R*y,n[1]=S*r+x*c+M*g+R*E,n[2]=S*s+x*l+M*m+R*T,n[3]=S*o+x*u+M*b+R*A,S=e[4],x=e[5],M=e[6],R=e[7],n[4]=S*i+x*a+M*h+R*y,n[5]=S*r+x*c+M*g+R*E,n[6]=S*s+x*l+M*m+R*T,n[7]=S*o+x*u+M*b+R*A,S=e[8],x=e[9],M=e[10],R=e[11],n[8]=S*i+x*a+M*h+R*y,n[9]=S*r+x*c+M*g+R*E,n[10]=S*s+x*l+M*m+R*T,n[11]=S*o+x*u+M*b+R*A,S=e[12],x=e[13],M=e[14],R=e[15],n[12]=S*i+x*a+M*h+R*y,n[13]=S*r+x*c+M*g+R*E,n[14]=S*s+x*l+M*m+R*T,n[15]=S*o+x*u+M*b+R*A,n}function Ti(n,t,e){var i=e[0],r=e[1],s=e[2],o,a,c,l,u,h,g,m,b,y,E,T;return t===n?(n[12]=t[0]*i+t[4]*r+t[8]*s+t[12],n[13]=t[1]*i+t[5]*r+t[9]*s+t[13],n[14]=t[2]*i+t[6]*r+t[10]*s+t[14],n[15]=t[3]*i+t[7]*r+t[11]*s+t[15]):(o=t[0],a=t[1],c=t[2],l=t[3],u=t[4],h=t[5],g=t[6],m=t[7],b=t[8],y=t[9],E=t[10],T=t[11],n[0]=o,n[1]=a,n[2]=c,n[3]=l,n[4]=u,n[5]=h,n[6]=g,n[7]=m,n[8]=b,n[9]=y,n[10]=E,n[11]=T,n[12]=o*i+u*r+b*s+t[12],n[13]=a*i+h*r+y*s+t[13],n[14]=c*i+g*r+E*s+t[14],n[15]=l*i+m*r+T*s+t[15]),n}function Is(n,t,e){var i=e[0],r=e[1],s=e[2];return n[0]=t[0]*i,n[1]=t[1]*i,n[2]=t[2]*i,n[3]=t[3]*i,n[4]=t[4]*r,n[5]=t[5]*r,n[6]=t[6]*r,n[7]=t[7]*r,n[8]=t[8]*s,n[9]=t[9]*s,n[10]=t[10]*s,n[11]=t[11]*s,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n}function r_(n,t,e,i){var r=i[0],s=i[1],o=i[2],a=Math.hypot(r,s,o),c,l,u,h,g,m,b,y,E,T,A,S,x,M,R,N,B,k,D,F,J,et,z,le;return a<ui?null:(a=1/a,r*=a,s*=a,o*=a,c=Math.sin(e),l=Math.cos(e),u=1-l,h=t[0],g=t[1],m=t[2],b=t[3],y=t[4],E=t[5],T=t[6],A=t[7],S=t[8],x=t[9],M=t[10],R=t[11],N=r*r*u+l,B=s*r*u+o*c,k=o*r*u-s*c,D=r*s*u-o*c,F=s*s*u+l,J=o*s*u+r*c,et=r*o*u+s*c,z=s*o*u-r*c,le=o*o*u+l,n[0]=h*N+y*B+S*k,n[1]=g*N+E*B+x*k,n[2]=m*N+T*B+M*k,n[3]=b*N+A*B+R*k,n[4]=h*D+y*F+S*J,n[5]=g*D+E*F+x*J,n[6]=m*D+T*F+M*J,n[7]=b*D+A*F+R*J,n[8]=h*et+y*z+S*le,n[9]=g*et+E*z+x*le,n[10]=m*et+T*z+M*le,n[11]=b*et+A*z+R*le,t!==n&&(n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n)}function Tl(n,t,e){var i=Math.sin(e),r=Math.cos(e),s=t[4],o=t[5],a=t[6],c=t[7],l=t[8],u=t[9],h=t[10],g=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=s*r+l*i,n[5]=o*r+u*i,n[6]=a*r+h*i,n[7]=c*r+g*i,n[8]=l*r-s*i,n[9]=u*r-o*i,n[10]=h*r-a*i,n[11]=g*r-c*i,n}function s_(n,t,e){var i=Math.sin(e),r=Math.cos(e),s=t[0],o=t[1],a=t[2],c=t[3],l=t[8],u=t[9],h=t[10],g=t[11];return t!==n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=s*r-l*i,n[1]=o*r-u*i,n[2]=a*r-h*i,n[3]=c*r-g*i,n[8]=s*i+l*r,n[9]=o*i+u*r,n[10]=a*i+h*r,n[11]=c*i+g*r,n}function wl(n,t,e){var i=Math.sin(e),r=Math.cos(e),s=t[0],o=t[1],a=t[2],c=t[3],l=t[4],u=t[5],h=t[6],g=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=s*r+l*i,n[1]=o*r+u*i,n[2]=a*r+h*i,n[3]=c*r+g*i,n[4]=l*r-s*i,n[5]=u*r-o*i,n[6]=h*r-a*i,n[7]=g*r-c*i,n}function o_(n,t){var e=t[0],i=t[1],r=t[2],s=t[3],o=e+e,a=i+i,c=r+r,l=e*o,u=i*o,h=i*a,g=r*o,m=r*a,b=r*c,y=s*o,E=s*a,T=s*c;return n[0]=1-h-b,n[1]=u+T,n[2]=g-E,n[3]=0,n[4]=u-T,n[5]=1-l-b,n[6]=m+y,n[7]=0,n[8]=g+E,n[9]=m-y,n[10]=1-l-h,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function a_(n,t,e,i,r,s,o){var a=1/(e-t),c=1/(r-i),l=1/(s-o);return n[0]=s*2*a,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=s*2*c,n[6]=0,n[7]=0,n[8]=(e+t)*a,n[9]=(r+i)*c,n[10]=(o+s)*l,n[11]=-1,n[12]=0,n[13]=0,n[14]=o*s*2*l,n[15]=0,n}function c_(n,t,e,i,r){var s=1/Math.tan(t/2),o;return n[0]=s/e,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=s,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,r!=null&&r!==1/0?(o=1/(i-r),n[10]=(r+i)*o,n[14]=2*r*i*o):(n[10]=-1,n[14]=-2*i),n}var l_=c_;function u_(n,t,e,i,r,s,o){var a=1/(t-e),c=1/(i-r),l=1/(s-o);return n[0]=-2*a,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*c,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*l,n[11]=0,n[12]=(t+e)*a,n[13]=(r+i)*c,n[14]=(o+s)*l,n[15]=1,n}var h_=u_;function f_(n,t,e,i){var r,s,o,a,c,l,u,h,g,m,b=t[0],y=t[1],E=t[2],T=i[0],A=i[1],S=i[2],x=e[0],M=e[1],R=e[2];return Math.abs(b-x)<ui&&Math.abs(y-M)<ui&&Math.abs(E-R)<ui?e_(n):(u=b-x,h=y-M,g=E-R,m=1/Math.hypot(u,h,g),u*=m,h*=m,g*=m,r=A*g-S*h,s=S*u-T*g,o=T*h-A*u,m=Math.hypot(r,s,o),m?(m=1/m,r*=m,s*=m,o*=m):(r=0,s=0,o=0),a=h*o-g*s,c=g*r-u*o,l=u*s-h*r,m=Math.hypot(a,c,l),m?(m=1/m,a*=m,c*=m,l*=m):(a=0,c=0,l=0),n[0]=r,n[1]=a,n[2]=u,n[3]=0,n[4]=s,n[5]=c,n[6]=h,n[7]=0,n[8]=o,n[9]=l,n[10]=g,n[11]=0,n[12]=-(r*b+s*y+o*E),n[13]=-(a*b+c*y+l*E),n[14]=-(u*b+h*y+g*E),n[15]=1,n)}function d_(){var n=new He(4);return He!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function Al(n,t,e){return n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,n[3]=t[3]*e,n}function qe(n,t,e){var i=t[0],r=t[1],s=t[2],o=t[3];return n[0]=e[0]*i+e[4]*r+e[8]*s+e[12]*o,n[1]=e[1]*i+e[5]*r+e[9]*s+e[13]*o,n[2]=e[2]*i+e[6]*r+e[10]*s+e[14]*o,n[3]=e[3]*i+e[7]*r+e[11]*s+e[15]*o,n}(function(){var n=d_();return function(t,e,i,r,s,o){var a,c;for(e||(e=4),i||(i=0),r?c=Math.min(r*e+i,t.length):c=t.length,a=i;a<c;a+=e)n[0]=t[a],n[1]=t[a+1],n[2]=t[a+2],n[3]=t[a+3],s(n,n,o),t[a]=n[0],t[a+1]=n[1],t[a+2]=n[2],t[a+3]=n[3];return t}})();var ts;(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL0ROW3=3]="COL0ROW3",n[n.COL1ROW0=4]="COL1ROW0",n[n.COL1ROW1=5]="COL1ROW1",n[n.COL1ROW2=6]="COL1ROW2",n[n.COL1ROW3=7]="COL1ROW3",n[n.COL2ROW0=8]="COL2ROW0",n[n.COL2ROW1=9]="COL2ROW1",n[n.COL2ROW2=10]="COL2ROW2",n[n.COL2ROW3=11]="COL2ROW3",n[n.COL3ROW0=12]="COL3ROW0",n[n.COL3ROW1=13]="COL3ROW1",n[n.COL3ROW2=14]="COL3ROW2",n[n.COL3ROW3=15]="COL3ROW3"})(ts||(ts={}));const g_=45*Math.PI/180,p_=1,Pr=.1,Mr=500,m_=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class ct extends t_{static get IDENTITY(){return b_()}static get ZERO(){return __()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return ts}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,e,i,r,s,o,a,c,l,u,h,g,m,b,y,E){return this[0]=t,this[1]=e,this[2]=i,this[3]=r,this[4]=s,this[5]=o,this[6]=a,this[7]=c,this[8]=l,this[9]=u,this[10]=h,this[11]=g,this[12]=m,this[13]=b,this[14]=y,this[15]=E,this.check()}setRowMajor(t,e,i,r,s,o,a,c,l,u,h,g,m,b,y,E){return this[0]=t,this[1]=s,this[2]=l,this[3]=m,this[4]=e,this[5]=o,this[6]=u,this[7]=b,this[8]=i,this[9]=a,this[10]=h,this[11]=y,this[12]=r,this[13]=c,this[14]=g,this[15]=E,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(m_)}fromObject(t){return this.check()}fromQuaternion(t){return o_(this,t),this.check()}frustum(t){const{left:e,right:i,bottom:r,top:s,near:o=Pr,far:a=Mr}=t;return a===1/0?y_(this,e,i,r,s,o):a_(this,e,i,r,s,o,a),this.check()}lookAt(t){const{eye:e,center:i=[0,0,0],up:r=[0,1,0]}=t;return f_(this,e,i,r),this.check()}ortho(t){const{left:e,right:i,bottom:r,top:s,near:o=Pr,far:a=Mr}=t;return h_(this,e,i,r,s,o,a),this.check()}orthographic(t){const{fovy:e=g_,aspect:i=p_,focalDistance:r=1,near:s=Pr,far:o=Mr}=t;va(e);const a=e/2,c=r*Math.tan(a),l=c*i;return this.ortho({left:-l,right:l,bottom:-c,top:c,near:s,far:o})}perspective(t){const{fovy:e=45*Math.PI/180,aspect:i=1,near:r=.1,far:s=500}=t;return va(e),l_(this,e,i,r,s),this.check()}determinant(){return i_(this)}getScale(t=[-0,-0,-0]){return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(t=[-0,-0,-0]){return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const i=this.getScale(e),r=1/i[0],s=1/i[1],o=1/i[2];return t[0]=this[0]*r,t[1]=this[1]*s,t[2]=this[2]*o,t[3]=0,t[4]=this[4]*r,t[5]=this[5]*s,t[6]=this[6]*o,t[7]=0,t[8]=this[8]*r,t[9]=this[9]*s,t[10]=this[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const i=this.getScale(e),r=1/i[0],s=1/i[1],o=1/i[2];return t[0]=this[0]*r,t[1]=this[1]*s,t[2]=this[2]*o,t[3]=this[4]*r,t[4]=this[5]*s,t[5]=this[6]*o,t[6]=this[8]*r,t[7]=this[9]*s,t[8]=this[10]*o,t}transpose(){return n_(this,this),this.check()}invert(){return Jr(this,this),this.check()}multiplyLeft(t){return be(this,t,this),this.check()}multiplyRight(t){return be(this,this,t),this.check()}rotateX(t){return Tl(this,this,t),this.check()}rotateY(t){return s_(this,this,t),this.check()}rotateZ(t){return wl(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,e){return r_(this,this,t,e),this.check()}scale(t){return Is(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return Ti(this,this,t),this.check()}transform(t,e){return t.length===4?(e=qe(e||[-0,-0,-0,-0],t,this),Ar(e,4),e):this.transformAsPoint(t,e)}transformAsPoint(t,e){const{length:i}=t;let r;switch(i){case 2:r=F0(e||[-0,-0],t,this);break;case 3:r=El(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Ar(r,t.length),r}transformAsVector(t,e){let i;switch(t.length){case 2:i=U0(e||[-0,-0],t,this);break;case 3:i=bl(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Ar(i,t.length),i}transformPoint(t,e){return this.transformAsPoint(t,e)}transformVector(t,e){return this.transformAsPoint(t,e)}transformDirection(t,e){return this.transformAsVector(t,e)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,e,i){return this.identity().translate([t,e,i])}}let ti,ei;function __(){return ti||(ti=new ct([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(ti)),ti}function b_(){return ei||(ei=new ct,Object.freeze(ei)),ei}function va(n){if(n>Math.PI*2)throw Error("expected radians")}function y_(n,t,e,i,r,s){const o=2*s/(e-t),a=2*s/(r-i),c=(e+t)/(e-t),l=(r+i)/(r-i),u=-1,h=-1,g=-2*s;return n[0]=o,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=a,n[6]=0,n[7]=0,n[8]=c,n[9]=l,n[10]=u,n[11]=h,n[12]=0,n[13]=0,n[14]=g,n[15]=0,n}const Ta=1e-6,E_=6371e3;class Bi{constructor({phi:t=0,theta:e=0,radius:i=1,bearing:r,pitch:s,altitude:o,radiusScale:a=E_}={}){f(this,"phi",void 0),f(this,"theta",void 0),f(this,"radius",void 0),f(this,"radiusScale",void 0),this.phi=t,this.theta=e,this.radius=i||o||1,this.radiusScale=a||1,r!==void 0&&(this.bearing=r),s!==void 0&&(this.pitch=s),this.check()}toString(){return this.formatString(pt)}formatString({printTypes:t=!1}){const e=gl;return"".concat(t?"Spherical":"","[rho:").concat(e(this.radius),",theta:").concat(e(this.theta),",phi:").concat(e(this.phi),"]")}equals(t){return Xt(this.radius,t.radius)&&Xt(this.theta,t.theta)&&Xt(this.phi,t.phi)}exactEquals(t){return this.radius===t.radius&&this.theta===t.theta&&this.phi===t.phi}get bearing(){return 180-Pe(this.phi)}set bearing(t){this.phi=Math.PI-Qn(t)}get pitch(){return Pe(this.theta)}set pitch(t){this.theta=Qn(t)}get longitude(){return Pe(this.phi)}get latitude(){return Pe(this.theta)}get lng(){return Pe(this.phi)}get lat(){return Pe(this.theta)}get z(){return(this.radius-1)*this.radiusScale}set(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this.check()}clone(){return new Bi().copy(this)}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this.check()}fromLngLatZ([t,e,i]){return this.radius=1+i/this.radiusScale,this.phi=Qn(e),this.theta=Qn(t),this.check()}fromVector3(t){return this.radius=yl(t),this.radius>0&&(this.theta=Math.atan2(t[0],t[1]),this.phi=Math.acos($(t[2]/this.radius,-1,1))),this.check()}toVector3(){return new Pt(0,0,this.radius).rotateX({radians:this.theta}).rotateZ({radians:this.phi})}makeSafe(){return this.phi=Math.max(Ta,Math.min(Math.PI-Ta,this.phi)),this}check(){if(!Number.isFinite(this.phi)||!Number.isFinite(this.theta)||!(this.radius>0))throw new Error("SphericalCoordinates: some fields set to invalid numbers");return this}}const v_=new Uint8Array([0,255,255,255]),T_={pickingSelectedColor:null,pickingHighlightColor:v_,pickingActive:!1,pickingAttribute:!1};function w_(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:T_;const t={};if(n.pickingSelectedColor!==void 0)if(!n.pickingSelectedColor)t.picking_uSelectedColorValid=0;else{const e=n.pickingSelectedColor.slice(0,3);t.picking_uSelectedColorValid=1,t.picking_uSelectedColor=e}if(n.pickingHighlightColor){const e=Array.from(n.pickingHighlightColor,i=>i/255);Number.isFinite(e[3])||(e[3]=1),t.picking_uHighlightColor=e}return n.pickingActive!==void 0&&(t.picking_uActive=Boolean(n.pickingActive),t.picking_uAttribute=Boolean(n.pickingAttribute)),t}const A_=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,S_=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,x_={name:"picking",vs:A_,fs:S_,getUniforms:w_},P_=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,M_={name:"transform",vs:P_,fs:null};class In{static getDefaultProgramManager(t){return t.luma=t.luma||{},t.luma.defaultProgramManager=t.luma.defaultProgramManager||new In(t),t.luma.defaultProgramManager}constructor(t){this.gl=t,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(t){this._defaultModules.find(e=>e.name===t.name)||this._defaultModules.push(t),this.stateHash++}removeDefaultModule(t){const e=typeof t=="string"?t:t.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==e),this.stateHash++}addShaderHook(t,e){e&&(t=Object.assign(e,{hook:t})),this._hookFunctions.push(t),this.stateHash++}get(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:e="",fs:i="",defines:r={},inject:s={},varyings:o=[],bufferMode:a=35981,transpileToGLSL100:c=!1}=t,l=this._getModuleList(t.modules),u=this._getHash(e),h=this._getHash(i),g=l.map(S=>this._getHash(S.name)).sort(),m=o.map(S=>this._getHash(S)),b=Object.keys(r).sort(),y=Object.keys(s).sort(),E=[],T=[];for(const S of b)E.push(this._getHash(S)),E.push(this._getHash(r[S]));for(const S of y)T.push(this._getHash(S)),T.push(this._getHash(s[S]));const A="".concat(u,"/").concat(h,"D").concat(E.join("/"),"M").concat(g.join("/"),"I").concat(T.join("/"),"V").concat(m.join("/"),"H").concat(this.stateHash,"B").concat(a).concat(c?"T":"");if(!this._programCache[A]){const S=p0(this.gl,{vs:e,fs:i,modules:l,inject:s,defines:r,hookFunctions:this._hookFunctions,transpileToGLSL100:c});this._programCache[A]=new rl(this.gl,{hash:A,vs:S.vs,fs:S.fs,varyings:o,bufferMode:a}),this._getUniforms[A]=S.getUniforms||(x=>{}),this._useCounts[A]=0}return this._useCounts[A]++,this._programCache[A]}getUniforms(t){return this._getUniforms[t.hash]||null}release(t){const e=t.hash;this._useCounts[e]--,this._useCounts[e]===0&&(this._programCache[e].delete(),delete this._programCache[e],delete this._getUniforms[e],delete this._useCounts[e])}_getHash(t){return this._hashes[t]===void 0&&(this._hashes[t]=this._hashCounter++),this._hashes[t]}_getModuleList(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const e=new Array(this._defaultModules.length+t.length),i={};let r=0;for(let s=0,o=this._defaultModules.length;s<o;++s){const a=this._defaultModules[s],c=a.name;e[r++]=a,i[c]=!0}for(let s=0,o=t.length;s<o;++s){const a=t[s],c=a.name;i[c]||(e[r++]=a,i[c]=!0)}return e.length=r,e}}const L_={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function R_(n,t,e){const i={};let r=t.indices;for(const s in t.attributes){const o=t.attributes[s],a=I_(s,e);if(s==="indices")r=o;else if(o.constant)i[a]=o.value;else{const c=o.value,l={...o};delete l.value,i[a]=[new W(n,c),l],C_(s,l)}}if(r){const s=r.value||r;C(s instanceof Uint16Array||s instanceof Uint32Array,'attribute array for "indices" must be of integer type');const o={size:1,isIndexed:r.isIndexed===void 0?!0:r.isIndexed};i.indices=[new W(n,{data:s,target:34963}),o]}return i}function I_(n,t){const{attributeMap:e=L_}=t||{};return e&&e[n]||n}function C_(n,t){let e;switch(n){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":e="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":e="vectors";break}switch(e){case"vectors":t.size=t.size||3;break;case"uvs":t.size=t.size||2;break}C(Number.isFinite(t.size),"attribute ".concat(n," needs size"))}const Me=2,O_=1e4,k_="Model needs drawMode and vertexCount",wa=()=>{},N_={};class D_{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:i=ye("model")}=e;C(Di(t)),this.id=i,this.gl=t,this.id=e.id||ye("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(e)}initialize(t){this.props={},this.programManager=t.programManager||In.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:e=null,vs:i,fs:r,modules:s,defines:o,inject:a,varyings:c,bufferMode:l,transpileToGLSL100:u}=t;this.programProps={program:e,vs:i,fs:r,modules:s,defines:o,inject:a,varyings:c,bufferMode:l,transpileToGLSL100:u},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(t.moduleSettings))),this.drawMode=t.drawMode!==void 0?t.drawMode:4,this.vertexCount=t.vertexCount||0,this.geometryBuffers={},this.isInstanced=t.isInstanced||t.instanced||t.instanceCount>0,this._setModelProps(t),this.geometry={},C(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),k_)}setProps(t){this._setModelProps(t)}delete(){for(const t in this._attributes)this._attributes[t]!==this.attributes[t]&&this._attributes[t].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(t){const{program:e,vs:i,fs:r,modules:s,defines:o,inject:a,varyings:c,bufferMode:l,transpileToGLSL100:u}=t;this.programProps={program:e,vs:i,fs:r,modules:s,defines:o,inject:a,varyings:c,bufferMode:l,transpileToGLSL100:u},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(t){return this.drawMode=t,this}setVertexCount(t){return C(Number.isFinite(t)),this.vertexCount=t,this}setInstanceCount(t){return C(Number.isFinite(t)),this.instanceCount=t,this}setGeometry(t){return this.drawMode=t.drawMode,this.vertexCount=t.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=R_(this.gl,t),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Ve(t))return this;const e={};for(const i in t){const r=t[i];e[i]=r.getValue?r.getValue():r}return this.vertexArray.setAttributes(e),this}setUniforms(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,t),this}getModuleUniforms(t){this._checkProgram();const e=this.programManager.getUniforms(this.program);return e?e(t):{}}updateModuleSettings(t){const e=this.getModuleUniforms(t||{});return this.setUniforms(e)}clear(t){return xs(this.program.gl,t),this}draw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:e=null,framebuffer:i,uniforms:r={},attributes:s={},transformFeedback:o=this.transformFeedback,parameters:a={},vertexArray:c=this.vertexArray}=t;this.setAttributes(s),this.updateModuleSettings(e),this.setUniforms(r);let l;O.priority>=Me&&(l=this._logDrawCallStart(Me));const u=this.vertexArray.getDrawParams(),{isIndexed:h=u.isIndexed,indexType:g=u.indexType,indexOffset:m=u.indexOffset,vertexArrayInstanced:b=u.isInstanced}=this.props;b&&!this.isInstanced&&O.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:y,instanceCount:E}=this,{onBeforeRender:T=wa,onAfterRender:A=wa}=this.props;T(),this.program.setUniforms(this.uniforms);const S=this.program.draw(Object.assign(N_,t,{logPriority:l,uniforms:null,framebuffer:i,parameters:a,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:c,transformFeedback:o,isIndexed:h,indexType:g,isInstanced:y,instanceCount:E,offset:h?m:0}));return A(),O.priority>=Me&&this._logDrawCallEnd(l,c,i),S}transform(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:e=!0,feedbackBuffers:i,unbindModels:r=[]}=t;let{parameters:s}=t;i&&this._setFeedbackBuffers(i),e&&(s=Object.assign({},s,{[35977]:e})),r.forEach(o=>o.vertexArray.unbindBuffers());try{this.draw(Object.assign({},t,{parameters:s}))}finally{r.forEach(o=>o.vertexArray.bindBuffers())}return this}render(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return O.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(t).draw()}_setModelProps(t){Object.assign(this.props,t),"uniforms"in t&&this.setUniforms(t.uniforms),"pickable"in t&&(this.pickable=t.pickable),"instanceCount"in t&&(this.instanceCount=t.instanceCount),"geometry"in t&&this.setGeometry(t.geometry),"attributes"in t&&this.setAttributes(t.attributes),"_feedbackBuffers"in t&&this._setFeedbackBuffers(t._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:e}=this.programProps;if(e)this._managedProgram=!1;else{const{vs:i,fs:r,modules:s,inject:o,defines:a,varyings:c,bufferMode:l,transpileToGLSL100:u}=this.programProps;e=this.programManager.get({vs:i,fs:r,modules:s,inject:o,defines:a,varyings:c,bufferMode:l,transpileToGLSL100:u}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}C(e instanceof rl,"Model needs a program"),this._programDirty=!1,e!==this.program&&(this.program=e,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new Rm(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const t in this.geometryBuffers){const e=this.geometryBuffers[t][0]||this.geometryBuffers[t];e instanceof W&&e.delete()}}_setAnimationProps(t){this.animated&&C(t,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Ve(t))return this;const{gl:e}=this.program;return this.transformFeedback=this.transformFeedback||new sl(e,{program:this.program}),this.transformFeedback.setBuffers(t),this}_logDrawCallStart(t){const e=t>3?0:O_;if(!(Date.now()-this.lastLogTime<e))return this.lastLogTime=Date.now(),O.group(Me,">>> DRAWING MODEL ".concat(this.id),{collapsed:O.level<=2})(),t}_logDrawCallEnd(t,e,i,r){if(t===void 0)return;const s=Om({vertexArray:e,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:o,unusedTable:a,unusedCount:c}=la({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i)}),{table:l,count:u}=la({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i),undefinedOnly:!0});u>0&&O.log("MISSING UNIFORMS",Object.keys(l))(),c>0&&O.log("UNUSED UNIFORMS",Object.keys(a))();const h=Nm(this.vertexArray.configuration);O.table(t,s)(),O.table(t,o)(),O.table(t+1,h)(),r&&r.log({logLevel:Me,message:"Rendered to ".concat(r.id)}),O.groupEnd(Me)()}}class F_{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(e),Object.seal(this)}setupResources(t){for(const e of this.bindings)this._setupTransformFeedback(e,t)}updateModelProps(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:e}=this;return e.length>0&&(t=Object.assign({},t,{varyings:e})),t}getDrawOptions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=this.bindings[this.currentIndex],{sourceBuffers:i,transformFeedback:r}=e;return{attributes:Object.assign({},i,t.attributes),transformFeedback:r}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(t)}getBuffer(t){const{feedbackBuffers:e}=this.bindings[this.currentIndex],i=t?e[t]:null;return i?i instanceof W?i:i.buffer:null}getData(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:e}=t,i=this.getBuffer(e);return i?i.getData():null}delete(){for(const t in this.resources)this.resources[t].delete()}_initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(t),this.varyings=t.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&C(j(this.gl))}_getFeedbackBuffers(t){const{sourceBuffers:e={}}=t,i={};if(this.bindings[this.currentIndex]&&Object.assign(i,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const r in this.feedbackMap){const s=this.feedbackMap[r];r in e&&(i[s]=r)}Object.assign(i,t.feedbackBuffers);for(const r in i){const s=i[r];if(typeof s=="string"){const o=e[s],{byteLength:a,usage:c,accessor:l}=o;i[r]=this._createNewBuffer(r,{byteLength:a,usage:c,accessor:l})}}return i}_setupBuffers(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:e=null}=t;Object.assign(this.feedbackMap,t.feedbackMap);const i=this._getFeedbackBuffers(t);this._updateBindings({sourceBuffers:e,feedbackBuffers:i})}_setupTransformFeedback(t,e){let{model:i}=e;const{program:r}=i;t.transformFeedback=new sl(this.gl,{program:r,buffers:t.feedbackBuffers})}_updateBindings(t){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t),this.feedbackMap){const{sourceBuffers:e,feedbackBuffers:i}=this._swapBuffers(this.bindings[this.currentIndex]),r=this._getNextIndex();this.bindings[r]=this._updateBinding(this.bindings[r],{sourceBuffers:e,feedbackBuffers:i})}}_updateBinding(t,e){return t?(Object.assign(t.sourceBuffers,e.sourceBuffers),Object.assign(t.feedbackBuffers,e.feedbackBuffers),t.transformFeedback&&t.transformFeedback.setBuffers(t.feedbackBuffers),t):{sourceBuffers:Object.assign({},e.sourceBuffers),feedbackBuffers:Object.assign({},e.feedbackBuffers)}}_swapBuffers(t){if(!this.feedbackMap)return null;const e=Object.assign({},t.sourceBuffers),i=Object.assign({},t.feedbackBuffers);for(const r in this.feedbackMap){const s=this.feedbackMap[r];e[r]=t.feedbackBuffers[s],i[s]=t.sourceBuffers[r],C(i[s]instanceof W)}return{sourceBuffers:e,feedbackBuffers:i}}_createNewBuffer(t,e){const i=new W(this.gl,e);return this.resources[t]&&this.resources[t].delete(),this.resources[t]=i,i}_getNextIndex(){return(this.currentIndex+1)%2}}const U_="transform_uSampler_",wi="transform_uSize_",Aa="transform_position";function B_(n){let{vs:t,sourceTextureMap:e,targetTextureVarying:i,targetTexture:r}=n,o=Object.keys(e).length,a=null;const c={};let l=t,u={};if(o>0||i){const h=l.split(`
`),g=h.slice();if(h.forEach((m,b,y)=>{if(o>0){const E=H_(m,e);if(E){const{updatedLine:T,inject:A}=E;g[b]=T,u=$r([u,A]),Object.assign(c,E.samplerTextureMap),o--}}i&&!a&&(a=G_(m,i))}),i){C(r);const m="".concat(wi).concat(i),b="uniform vec2 ".concat(m,`;
`),y="     vec2 ".concat(Aa," = transform_getPos(").concat(m,`);
     gl_Position = vec4(`).concat(Aa,`, 0, 1.);
`);u=$r([u,{"vs:#decl":b,"vs:#main-start":y}])}l=g.join(`
`)}return{vs:l,targetTextureType:a,inject:u,samplerTextureMap:c}}function V_(n){let{sourceTextureMap:t,targetTextureVarying:e,targetTexture:i}=n;const r={};let s,o;e&&({width:s,height:o}=i,r["".concat(wi).concat(e)]=[s,o]);for(const a in t)({width:s,height:o}=t[a]),r["".concat(wi).concat(a)]=[s,o];return r}function j_(n){return fl(n,["attribute","in"])}function z_(n){const t="".concat(U_).concat(n),e="".concat(wi).concat(n),i="  uniform sampler2D ".concat(t,`;
  uniform vec2 `).concat(e,";");return{samplerName:t,sizeName:e,uniformDeclerations:i}}function G_(n,t){const e=fl(n,["varying","out"]);return e&&e.name===t?e.type:null}function H_(n,t){const e={},i=j_(n);if(!i)return null;const{type:r,name:s}=i;if(s&&t[s]){const o="// ".concat(n," => Replaced by Transform with a sampler"),{samplerName:a,sizeName:c,uniformDeclerations:l}=z_(s),u=A0(r),h="  ".concat(r," ").concat(s," = transform_getInput(").concat(a,", ").concat(c,").").concat(u,`;
`);return e[a]=s,{updatedLine:o,inject:{"vs:#decl":l,"vs:#main-start":h},samplerTextureMap:e}}return null}const W_={[10241]:9728,[10240]:9728,[10242]:33071,[10243]:33071},X_="transform_output";class Y_{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(e),Object.seal(this)}updateModelProps(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=this._processVertexShader(t);return Object.assign({},t,e)}getDrawOptions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:e,sourceTextures:i,framebuffer:r,targetTexture:s}=this.bindings[this.currentIndex],o=Object.assign({},e,t.attributes),a=Object.assign({},t.uniforms),c=Object.assign({},t.parameters);let l=t.discard;if(this.hasSourceTextures||this.hasTargetTexture){o.transform_elementID=this.elementIDBuffer;for(const h in this.samplerTextureMap){const g=this.samplerTextureMap[h];a[h]=i[g]}this._setSourceTextureParameters();const u=V_({sourceTextureMap:i,targetTextureVarying:this.targetTextureVarying,targetTexture:s});Object.assign(a,u)}return this.hasTargetTexture&&(l=!1,c.viewport=[0,0,r.width,r.height]),{attributes:o,framebuffer:r,uniforms:a,discard:l,parameters:c}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(t)}getTargetTexture(){const{targetTexture:t}=this.bindings[this.currentIndex];return t}getData(){let{packed:t=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:e}=this.bindings[this.currentIndex],i=Ui(e);if(!t)return i;const r=i.constructor,s=S0(this.targetTextureType),o=new r(i.length*s/4);let a=0;for(let c=0;c<i.length;c+=4)for(let l=0;l<s;l++)o[a++]=i[c+l];return o}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:e,_swapTexture:i}=t;this._swapTexture=i,this.targetTextureVarying=e,this.hasTargetTexture=e,this._setupTextures(t)}_createTargetTexture(t){const{sourceTextures:e,textureOrReference:i}=t;if(i instanceof Tt)return i;const r=e[i];return r?(this._targetRefTexName=i,this._createNewTexture(r)):null}_setupTextures(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:e,_sourceTextures:i={},_targetTexture:r}=t,s=this._createTargetTexture({sourceTextures:i,textureOrReference:r});this.hasSourceTextures=this.hasSourceTextures||i&&Object.keys(i).length>0,this._updateBindings({sourceBuffers:e,sourceTextures:i,targetTexture:s}),"elementCount"in t&&this._updateElementIDBuffer(t.elementCount)}_updateElementIDBuffer(t){if(typeof t!="number"||this.elementCount>=t)return;const e=new Float32Array(t);e.forEach((i,r,s)=>{s[r]=r}),this.elementIDBuffer?this.elementIDBuffer.setData({data:e}):this.elementIDBuffer=new W(this.gl,{data:e,accessor:{size:1}}),this.elementCount=t}_updateBindings(t){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t),this._swapTexture){const{sourceTextures:e,targetTexture:i}=this._swapTextures(this.bindings[this.currentIndex]),r=this._getNextIndex();this.bindings[r]=this._updateBinding(this.bindings[r],{sourceTextures:e,targetTexture:i})}}_updateBinding(t,e){const{sourceBuffers:i,sourceTextures:r,targetTexture:s}=e;if(t||(t={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(t.sourceTextures,r),Object.assign(t.sourceBuffers,i),s){t.targetTexture=s;const{width:o,height:a}=s,{framebuffer:c}=t;c?(c.update({attachments:{[36064]:s},resizeAttachments:!1}),c.resize({width:o,height:a})):t.framebuffer=new Q(this.gl,{id:"transform-framebuffer",width:o,height:a,attachments:{[36064]:s}})}return t}_setSourceTextureParameters(){const t=this.currentIndex,{sourceTextures:e}=this.bindings[t];for(const i in e)e[i].setParameters(W_)}_swapTextures(t){if(!this._swapTexture)return null;const e=Object.assign({},t.sourceTextures);e[this._swapTexture]=t.targetTexture;const i=t.sourceTextures[this._swapTexture];return{sourceTextures:e,targetTexture:i}}_createNewTexture(t){const e=yp(t,{parameters:{[10241]:9728,[10240]:9728,[10242]:33071,[10243]:33071},pixelStore:{[37440]:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=e,e}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:e,targetTexture:i}=this.bindings[this.currentIndex],{vs:r,uniforms:s,targetTextureType:o,inject:a,samplerTextureMap:c}=B_({vs:t.vs,sourceTextureMap:e,targetTextureVarying:this.targetTextureVarying,targetTexture:i}),l=$r([t.inject||{},a]);this.targetTextureType=o,this.samplerTextureMap=c;const u=t._fs||dl({version:nl(r),input:this.targetTextureVarying,inputType:o,output:X_}),h=this.hasSourceTextures||this.targetTextureVarying?[M_].concat(t.modules||[]):t.modules;return{vs:r,fs:u,modules:h,uniforms:s,inject:l}}}class Cs{static isSupported(t){return j(t)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(e),Object.seal(this)}delete(){const{model:t,bufferTransform:e,textureTransform:i}=this;t&&t.delete(),e&&e.delete(),i&&i.delete()}run(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:e=!0}=t,i=this._updateDrawOptions(t);e&&i.framebuffer&&i.framebuffer.clear({color:!0}),this.model.transform(i)}swap(){let t=!1;const e=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of e)t=t||i.swap();C(t,"Nothing to swap")}getBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(t)}getData(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of e){const r=i.getData(t);if(r)return r}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in t&&this.model.setVertexCount(t.elementCount);const e=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of e)i.update(t)}_initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:e}=this;this._buildResourceTransforms(e,t),t=this._updateModelProps(t),this.model=new D_(e,Object.assign({},t,{fs:t.fs||dl({version:nl(t.vs)}),id:t.id||"transform-model",drawMode:t.drawMode||0,vertexCount:t.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(t){let e=Object.assign({},t);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of i)e=r.updateModelProps(e);return e}_buildResourceTransforms(t,e){q_(e)&&(this.bufferTransform=new F_(t,e)),Z_(e)&&(this.textureTransform=new Y_(t,e)),C(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(t){let e=Object.assign({},t);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of i)e=Object.assign(e,r.getDrawOptions(e));return e}}function q_(n){return!!(!Ve(n.feedbackBuffers)||!Ve(n.feedbackMap)||n.varyings&&n.varyings.length>0)}function Z_(n){return!!(!Ve(n._sourceTextures)||n._targetTexture||n._targetTextureVarying)}let $_=1,K_=1;class Sl{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(t){const{delay:e=0,duration:i=Number.POSITIVE_INFINITY,rate:r=1,repeat:s=1}=t,o=$_++,a={time:0,delay:e,duration:i,rate:r,repeat:s};return this._setChannelTime(a,this.time),this.channels.set(o,a),o}removeChannel(t){this.channels.delete(t);for(const[e,i]of this.animations)i.channel===t&&this.detachAnimation(e)}isFinished(t){const e=this.channels.get(t);return e===void 0?!1:this.time>=e.delay+e.duration*e.repeat}getTime(t){if(t===void 0)return this.time;const e=this.channels.get(t);return e===void 0?-1:e.time}setTime(t){this.time=Math.max(0,t);const e=this.channels.values();for(const r of e)this._setChannelTime(r,this.time);const i=this.animations.values();for(const r of i){const{animation:s,channel:o}=r;s.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(t,e){const i=K_++;return this.animations.set(i,{animation:t,channel:e}),t.setTime(this.getTime(e)),i}detachAnimation(t){this.animations.delete(t)}update(t){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=t),this.setTime(this.time+(t-this.lastEngineTime)),this.lastEngineTime=t)}_setChannelTime(t,e){const i=e-t.delay,r=t.duration*t.repeat;i>=r?t.time=t.duration*t.rate:(t.time=Math.max(0,i)%t.duration,t.time*=t.rate)}}const xl="#define SMOOTH_EDGE_RADIUS 0.5",Q_=`
`.concat(xl,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),J_=`
`.concat(xl,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),tb={name:"geometry",vs:Q_,fs:J_},G={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(G,"IDENTITY",{get:()=>(H.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Lt={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Sa={common:0,meters:1,pixels:2},xa={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},Cn={DRAW:"draw",MASK:"mask"},eb=Object.keys(G).map(n=>"const int COORDINATE_SYSTEM_".concat(n," = ").concat(G[n],";")).join(""),nb=Object.keys(Lt).map(n=>"const int PROJECTION_MODE_".concat(n," = ").concat(Lt[n],";")).join(""),ib=Object.keys(Sa).map(n=>"const int UNIT_".concat(n.toUpperCase()," = ").concat(Sa[n],";")).join(""),rb="".concat(eb,`
`).concat(nb,`
`).concat(ib,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0; // meters
const float GLOBE_RADIUS = 256.0;

// returns an adjustment factor for uCommonUnitsPerMeter
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {

    // uCommonUnitsPerMeter in low-zoom Web Mercator is non-linear
    // Adjust by 1 / cos(latitude)
    // If geometry.position (vertex in common space) is populated, use it
    // Otherwise use geometry.worldPosition (anchor in world space)
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }

    // latitude from common y: 2.0 * (atan(exp(y / TILE_SIZE * 2.0 * PI - PI)) - PI / 4.0)
    // Taylor series of 1 / cos(latitude)
    // Max error < 0.003
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}

//
// Scaling offsets - scales meters to "world distance"
// Note the scalar version of project_size is for scaling the z component only
//
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}

// Get rotation matrix that aligns the z axis with the given up vector
// Find 3 unit vectors ux, uy, uz that are perpendicular to each other and uz == up
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  // Tangent on XY plane
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}

//
// Projecting normal - transform deltas from current coordinate system to
// normals in the worldspace
//
vec3 project_normal(vec3 vector) {
  // Apply model matrix
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

//
// Projecting positions - non-linear projection: lnglats => unit tile [0-1, 0-1]
//
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

//
// Projects positions (defined by project_uCoordinateSystem) to common space (defined by project_uProjectionMode)
//
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;

  // Work around for a Mac+NVIDIA bug https://github.com/visgl/deck.gl/issues/4145
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        // Too far from the projection center for offset mode to be accurate
        // Only use high parts
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    // Subtract high part of 64 bit value. Convert remainder to float32, preserving precision.
    position_world.xyz -= project_uCoordinateOrigin;
  }

  // Translation is already added to the high parts
  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}

//
// Projects from common space coordinates to clip space.
// Uses project_uViewProjectionMatrix
//
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}

// Returns a clip space offset that corresponds to a given number of screen pixels
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  // UNIT_PIXELS
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function sb(n,t){if(n===t)return!0;if(Array.isArray(n)){const e=n.length;if(!t||t.length!==e)return!1;for(let i=0;i<e;i++)if(n[i]!==t[i])return!1;return!0}return!1}function Vi(n){let t={},e;return i=>{for(const r in i)if(!sb(i[r],t[r])){e=n(i),t=i;break}return e}}const Pa=[0,0,0,0],ob=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Pl=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],ab=[0,0,0],Ml=[0,0,0],cb=Vi(hb);function Ll(n,t,e=Ml){e.length<3&&(e=[e[0],e[1],0]);let i=e,r,s=!0;switch(t===G.LNGLAT_OFFSETS||t===G.METER_OFFSETS?r=e:r=n.isGeospatial?[Math.fround(n.longitude),Math.fround(n.latitude),0]:null,n.projectionMode){case Lt.WEB_MERCATOR:(t===G.LNGLAT||t===G.CARTESIAN)&&(r=[0,0,0],s=!1);break;case Lt.WEB_MERCATOR_AUTO_OFFSET:t===G.LNGLAT?i=r:t===G.CARTESIAN&&(i=[Math.fround(n.center[0]),Math.fround(n.center[1]),0],r=n.unprojectPosition(i),i[0]-=e[0],i[1]-=e[1],i[2]-=e[2]);break;case Lt.IDENTITY:i=n.position.map(Math.fround),i[2]=i[2]||0;break;case Lt.GLOBE:s=!1,r=null;break;default:s=!1}return{geospatialOrigin:r,shaderCoordinateOrigin:i,offsetMode:s}}function lb(n,t,e){const{viewMatrixUncentered:i,projectionMatrix:r}=n;let{viewMatrix:s,viewProjectionMatrix:o}=n,a=Pa,c=Pa,l=n.cameraPosition;const{geospatialOrigin:u,shaderCoordinateOrigin:h,offsetMode:g}=Ll(n,t,e);return g&&(c=n.projectPosition(u||h),l=[l[0]-c[0],l[1]-c[1],l[2]-c[2]],c[3]=1,a=qe([],c,o),s=i||s,o=be([],r,s),o=be([],o,ob)),{viewMatrix:s,viewProjectionMatrix:o,projectionCenter:a,originCommon:c,cameraPosCommon:l,shaderCoordinateOrigin:h,geospatialOrigin:u}}function ub({viewport:n,devicePixelRatio:t=1,modelMatrix:e=null,coordinateSystem:i=G.DEFAULT,coordinateOrigin:r=Ml,autoWrapLongitude:s=!1}){i===G.DEFAULT&&(i=n.isGeospatial?G.LNGLAT:G.CARTESIAN);const o=cb({viewport:n,devicePixelRatio:t,coordinateSystem:i,coordinateOrigin:r});return o.project_uWrapLongitude=s,o.project_uModelMatrix=e||Pl,o}function hb({viewport:n,devicePixelRatio:t,coordinateSystem:e,coordinateOrigin:i}){const{projectionCenter:r,viewProjectionMatrix:s,originCommon:o,cameraPosCommon:a,shaderCoordinateOrigin:c,geospatialOrigin:l}=lb(n,e,i),u=n.getDistanceScales(),h=[n.width*t,n.height*t],g=qe([],[0,0,-n.focalDistance,1],n.projectionMatrix)[3]||1,m={project_uCoordinateSystem:e,project_uProjectionMode:n.projectionMode,project_uCoordinateOrigin:c,project_uCommonOrigin:o.slice(0,3),project_uCenter:r,project_uPseudoMeters:Boolean(n._pseudoMeters),project_uViewportSize:h,project_uDevicePixelRatio:t,project_uFocalDistance:g,project_uCommonUnitsPerMeter:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:ab,project_uScale:n.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:s,project_uModelMatrix:Pl,project_uCameraPosition:a};if(l){const b=n.getDistanceScales(l);switch(e){case G.METER_OFFSETS:m.project_uCommonUnitsPerWorldUnit=b.unitsPerMeter,m.project_uCommonUnitsPerWorldUnit2=b.unitsPerMeter2;break;case G.LNGLAT:case G.LNGLAT_OFFSETS:n._pseudoMeters||(m.project_uCommonUnitsPerMeter=b.unitsPerMeter),m.project_uCommonUnitsPerWorldUnit=b.unitsPerDegree,m.project_uCommonUnitsPerWorldUnit2=b.unitsPerDegree2;break;case G.CARTESIAN:m.project_uCommonUnitsPerWorldUnit=[1,1,b.unitsPerMeter[2]],m.project_uCommonUnitsPerWorldUnit2=[0,0,b.unitsPerMeter2[2]];break}}return m}const fb={};function db(n=fb){return"viewport"in n?ub(n):{}}const Rl={name:"project",dependencies:[M0,tb],vs:rb,getUniforms:db};function gb(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Ne(n,t){const e=qe([],t,n);return Al(e,e,1/e[3]),e}function Ma(n,t){const e=n%t;return e<0?t+e:e}function es(n,t,e){return n<t?t:n>e?e:n}function pb(n){return Math.log(n)*Math.LOG2E}const Os=Math.log2||pb;function Zt(n,t){if(!n)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}const Rt=Math.PI,Il=Rt/4,It=Rt/180,ns=180/Rt,Tn=512,is=4003e4,ni=85.051129,mb=1.5;function _b(n){return Os(n)}function Ai(n){const[t,e]=n;Zt(Number.isFinite(t)),Zt(Number.isFinite(e)&&e>=-90&&e<=90,"invalid latitude");const i=t*It,r=e*It,s=Tn*(i+Rt)/(2*Rt),o=Tn*(Rt+Math.log(Math.tan(Il+r*.5)))/(2*Rt);return[s,o]}function We(n){const[t,e]=n,i=t/Tn*(2*Rt)-Rt,r=2*(Math.atan(Math.exp(e/Tn*(2*Rt)-Rt))-Il);return[i*ns,r*ns]}function Cl(n){const{latitude:t}=n;Zt(Number.isFinite(t));const e=Math.cos(t*It);return _b(is*e)-9}function rs(n){const{latitude:t,longitude:e,highPrecision:i=!1}=n;Zt(Number.isFinite(t)&&Number.isFinite(e));const r=Tn,s=Math.cos(t*It),o=r/360,a=o/s,c=r/is/s,l={unitsPerMeter:[c,c,c],metersPerUnit:[1/c,1/c,1/c],unitsPerDegree:[o,a,c],degreesPerUnit:[1/o,1/a,1/c]};if(i){const u=It*Math.tan(t*It)/s,h=o*u/2,g=r/is*u,m=g/a*c;l.unitsPerDegree2=[0,h,g],l.unitsPerMeter2=[m,0,m]}return l}function Ol(n,t){const[e,i,r]=n,[s,o,a]=t,{unitsPerMeter:c,unitsPerMeter2:l}=rs({longitude:e,latitude:i,highPrecision:!0}),u=Ai(n);u[0]+=s*(c[0]+l[0]*o),u[1]+=o*(c[1]+l[1]*o);const h=We(u),g=(r||0)+(a||0);return Number.isFinite(r)||Number.isFinite(a)?[h[0],h[1],g]:h}function bb(n){const{height:t,pitch:e,bearing:i,altitude:r,scale:s,center:o}=n,a=gb();Ti(a,a,[0,0,-r]),Tl(a,a,-e*It),wl(a,a,i*It);const c=s/t;return Is(a,a,[c,c,c]),o&&Ti(a,a,G0([],o)),a}function yb(n){const{width:t,height:e,altitude:i,pitch:r=0,offset:s,center:o,scale:a,nearZMultiplier:c=1,farZMultiplier:l=1}=n;let{fovy:u=Si(mb)}=n;i!==void 0&&(u=Si(i));const h=u*It,g=r*It,m=ks(u);let b=m;o&&(b+=o[2]*a/Math.cos(g)/e);const y=h*(.5+(s?s[1]:0)/e),E=Math.sin(y)*b/Math.sin(es(Math.PI/2-g-y,.01,Math.PI-.01)),T=Math.sin(g)*E+b,A=b*10,S=Math.min(T*l,A);return{fov:h,aspect:t/e,focalDistance:m,near:c,far:S}}function Si(n){return 2*Math.atan(.5/n)*ns}function ks(n){return .5/Math.tan(.5*n*It)}function kl(n,t){const[e,i,r=0]=n;return Zt(Number.isFinite(e)&&Number.isFinite(i)&&Number.isFinite(r)),Ne(t,[e,i,r,1])}function On(n,t,e=0){const[i,r,s]=n;if(Zt(Number.isFinite(i)&&Number.isFinite(r),"invalid pixel coordinate"),Number.isFinite(s))return Ne(t,[i,r,s,1]);const o=Ne(t,[i,r,0,1]),a=Ne(t,[i,r,1,1]),c=o[2],l=a[2],u=c===l?0:((e||0)-c)/(l-c);return _l([],o,a,u)}function Nl(n){const{width:t,height:e,bounds:i,minExtent:r=0,maxZoom:s=24,offset:o=[0,0]}=n,[[a,c],[l,u]]=i,h=Eb(n.padding),g=Ai([a,es(u,-ni,ni)]),m=Ai([l,es(c,-ni,ni)]),b=[Math.max(Math.abs(m[0]-g[0]),r),Math.max(Math.abs(m[1]-g[1]),r)],y=[t-h.left-h.right-Math.abs(o[0])*2,e-h.top-h.bottom-Math.abs(o[1])*2];Zt(y[0]>0&&y[1]>0);const E=y[0]/b[0],T=y[1]/b[1],A=(h.right-h.left)/2/E,S=(h.top-h.bottom)/2/T,x=[(m[0]+g[0])/2+A,(m[1]+g[1])/2+S],M=We(x),R=Math.min(s,Os(Math.abs(Math.min(E,T))));return Zt(Number.isFinite(R)),{longitude:M[0],latitude:M[1],zoom:R}}function Eb(n=0){return typeof n=="number"?{top:n,bottom:n,left:n,right:n}:(Zt(Number.isFinite(n.top)&&Number.isFinite(n.bottom)&&Number.isFinite(n.left)&&Number.isFinite(n.right)),n)}const La=Math.PI/180;function vb(n,t=0){const{width:e,height:i,unproject:r}=n,s={targetZ:t},o=r([0,i],s),a=r([e,i],s);let c,l;const u=n.fovy?.5*n.fovy*La:Math.atan(.5/n.altitude),h=(90-n.pitch)*La;return u>h-.01?(c=Ra(n,0,t),l=Ra(n,e,t)):(c=r([0,0],s),l=r([e,0],s)),[o,a,l,c]}function Ra(n,t,e){const{pixelUnprojectionMatrix:i}=n,r=Ne(i,[t,0,1,1]),s=Ne(i,[t,n.height,1,1]),a=(e*n.distanceScales.unitsPerMeter[2]-r[2])/(s[2]-r[2]),c=_l([],r,s,a),l=We(c);return l.push(e),l}const Ia=512;function Tb(n){const{width:t,height:e,pitch:i=0}=n;let{longitude:r,latitude:s,zoom:o,bearing:a=0}=n;(r<-180||r>180)&&(r=Ma(r+180,360)-180),(a<-180||a>180)&&(a=Ma(a+180,360)-180);const c=Os(e/Ia);if(o<=c)o=c,s=0;else{const l=e/2/Math.pow(2,o),u=We([0,l])[1];if(s<u)s=u;else{const h=We([0,Ia-l])[1];s>h&&(s=h)}}return{width:t,height:e,longitude:r,latitude:s,zoom:o,pitch:i,bearing:a}}const wb=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,Ab=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,Sb=Vi(Rb),xb=Vi(Ib),Pb=[0,0,0,1],Mb=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function Lb(n,t){const[e,i,r]=n,s=On([e,i,r],t);return Number.isFinite(r)?s:[s[0],s[1],0]}function Rb({viewport:n,center:t}){return new ct(n.viewProjectionMatrix).invert().transform(t)}function Ib({viewport:n,shadowMatrices:t}){const e=[],i=n.pixelUnprojectionMatrix,r=n.isGeospatial?void 0:1,s=[[0,0,r],[n.width,0,r],[0,n.height,r],[n.width,n.height,r],[0,0,-1],[n.width,0,-1],[0,n.height,-1],[n.width,n.height,-1]].map(o=>Lb(o,i));for(const o of t){const a=o.clone().translate(new Pt(n.center).negate()),c=s.map(u=>a.transform(u)),l=new ct().ortho({left:Math.min(...c.map(u=>u[0])),right:Math.max(...c.map(u=>u[0])),bottom:Math.min(...c.map(u=>u[1])),top:Math.max(...c.map(u=>u[1])),near:Math.min(...c.map(u=>-u[2])),far:Math.max(...c.map(u=>-u[2]))});e.push(l.multiplyRight(o))}return e}function Cb(n,t){const{shadowEnabled:e=!0}=n;if(!e||!n.shadowMatrices||!n.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const i={shadow_uDrawShadowMap:Boolean(n.drawToShadowMap),shadow_uUseShadowMap:n.shadowMaps?n.shadowMaps.length>0:!1,shadow_uColor:n.shadowColor||Pb,shadow_uLightId:n.shadowLightId||0,shadow_uLightCount:n.shadowMatrices.length},r=Sb({viewport:n.viewport,center:t.project_uCenter}),s=[],o=xb({shadowMatrices:n.shadowMatrices,viewport:n.viewport}).slice();for(let a=0;a<n.shadowMatrices.length;a++){const c=o[a],l=c.clone().translate(new Pt(n.viewport.center).negate());t.project_uCoordinateSystem===G.LNGLAT&&t.project_uProjectionMode===Lt.WEB_MERCATOR?(o[a]=l,s[a]=r):(o[a]=c.clone().multiplyRight(Mb),s[a]=l.transform(r))}for(let a=0;a<o.length;a++)i["shadow_uViewProjectionMatrices[".concat(a,"]")]=o[a],i["shadow_uProjectCenters[".concat(a,"]")]=s[a],n.shadowMaps&&n.shadowMaps.length>0?i["shadow_uShadowMap".concat(a)]=n.shadowMaps[a]:i["shadow_uShadowMap".concat(a)]=n.dummyShadowMap;return i}const Lr={name:"shadow",dependencies:[Rl],vs:wb,fs:Ab,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(n={},t={})=>"viewport"in n&&(n.drawToShadowMap||n.shadowMaps&&n.shadowMaps.length>0)?Cb(n,t):{}};({...x_});const Ob=[Rl],kb=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function Nb(n){const t=In.getDefaultProgramManager(n);for(const e of Ob)t.addDefaultModule(e);for(const e of kb)t.addShaderHook(e);return t}const Db=[255,255,255],Fb=1;let Ub=0;class Bb{constructor(t={}){f(this,"id",void 0),f(this,"color",void 0),f(this,"intensity",void 0),f(this,"type","ambient");const{color:e=Db}=t,{intensity:i=Fb}=t;this.id=t.id||"ambient-".concat(Ub++),this.color=e,this.intensity=i}}const Vb=[255,255,255],jb=1,zb=[0,0,-1];let Gb=0;class Ca{constructor(t={}){f(this,"id",void 0),f(this,"color",void 0),f(this,"intensity",void 0),f(this,"type","directional"),f(this,"direction",void 0),f(this,"shadow",void 0);const{color:e=Vb}=t,{intensity:i=jb}=t,{direction:r=zb}=t,{_shadow:s=!1}=t;this.id=t.id||"directional-".concat(Gb++),this.color=e,this.intensity=i,this.type="directional",this.direction=new Pt(r).normalize().toArray(),this.shadow=s}getProjectedLight(t){return this}}class Hb{constructor(t,e={id:"pass"}){f(this,"id",void 0),f(this,"gl",void 0),f(this,"props",void 0);const{id:i}=e;this.id=i,this.gl=t,this.props={...e}}setProps(t){Object.assign(this.props,t)}render(t){}cleanup(){}}class ji extends Hb{constructor(...t){super(...t),f(this,"_lastRenderIndex",-1)}render(t){const e=this.gl;return qt(e,{framebuffer:t.target}),this._drawLayers(t)}_drawLayers(t){const{target:e,moduleParameters:i,viewports:r,views:s,onViewportActive:o,clearStack:a=!0,clearCanvas:c=!0}=t;t.pass=t.pass||"unknown";const l=this.gl;c&&Xb(l),a&&(this._lastRenderIndex=-1);const u=[];for(const h of r){const g=s&&s[h.id];o(h);const m=this._getDrawLayerParams(h,t),b=h.subViewports||[h];for(const y of b){const E=this._drawLayersInViewport(l,{target:e,moduleParameters:i,viewport:y,view:g,pass:t.pass,layers:t.layers},m);u.push(E)}}return u}_getDrawLayerParams(t,{layers:e,pass:i,layerFilter:r,cullRect:s,effects:o,moduleParameters:a}){const c=[],l=Dl(this._lastRenderIndex+1),u={layer:e[0],viewport:t,isPicking:i.startsWith("picking"),renderPass:i,cullRect:s},h={};for(let g=0;g<e.length;g++){const m=e[g],b=this._shouldDrawLayer(m,u,r,h),y={shouldDrawLayer:b};b&&(y.layerRenderIndex=l(m,b),y.moduleParameters=this._getModuleParameters(m,o,i,a),y.layerParameters=this.getLayerParameters(m,g,t)),c[g]=y}return c}_drawLayersInViewport(t,{layers:e,moduleParameters:i,pass:r,target:s,viewport:o,view:a},c){const l=Wb(t,{moduleParameters:i,target:s,viewport:o});if(a&&a.props.clear){const h=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;xt(t,{scissorTest:!0,scissor:l},()=>xs(t,h))}const u={totalCount:e.length,visibleCount:0,compositeCount:0,pickableCount:0};qt(t,{viewport:l});for(let h=0;h<e.length;h++){const g=e[h],{shouldDrawLayer:m,layerRenderIndex:b,moduleParameters:y,layerParameters:E}=c[h];if(m&&g.props.pickable&&u.pickableCount++,g.isComposite)u.compositeCount++;else if(m){u.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,b),y.viewport=o;try{g._drawLayer({moduleParameters:y,uniforms:{layerIndex:b},parameters:E})}catch(T){g.raiseError(T,"drawing ".concat(g," to ").concat(r))}}}return u}shouldDrawLayer(t){return!0}getModuleParameters(t,e){return null}getLayerParameters(t,e,i){return t.props.parameters}_shouldDrawLayer(t,e,i,r){if(!(t.props.visible&&this.shouldDrawLayer(t)))return!1;e.layer=t;let o=t.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(e))return!1;e.layer=o,o=o.parent}if(i){const a=e.layer.id;if(a in r||(r[a]=i(e)),!r[a])return!1}return t.activateViewport(e.viewport),!0}_getModuleParameters(t,e,i,r){var s;const o=Object.assign(Object.create(((s=t.internalState)===null||s===void 0?void 0:s.propsInTransition)||t.props),{autoWrapLongitude:t.wrapLongitude,viewport:t.context.viewport,mousePosition:t.context.mousePosition,pickingActive:0,devicePixelRatio:Be(this.gl)});if(e)for(const c of e){var a;Object.assign(o,(a=c.getModuleParameters)===null||a===void 0?void 0:a.call(c,t))}return Object.assign(o,this.getModuleParameters(t,e),r)}}function Dl(n=0,t={}){const e={},i=(r,s)=>{const o=r.props._offset,a=r.id,c=r.parent&&r.parent.id;let l;if(c&&!(c in t)&&i(r.parent,!1),c in e){const u=e[c]=e[c]||Dl(t[c],t);l=u(r,s),e[a]=u}else Number.isFinite(o)?(l=o+(t[c]||0),e[a]=null):l=n;return s&&l>=n&&(n=l+1),t[a]=l,l};return i}function Wb(n,{moduleParameters:t,target:e,viewport:i}){const r=e&&e.id!=="default-framebuffer",s=t&&t.devicePixelRatio||Be(n),o=r?e.height:n.drawingBufferHeight,a=i;return[a.x*s,o-(a.y+a.height)*s,a.width*s,a.height*s]}function Xb(n){const t=n.drawingBufferWidth,e=n.drawingBufferHeight;qt(n,{viewport:[0,0,t,e]}),n.clear(16640)}class Yb extends ji{constructor(t,e){super(t,e),f(this,"shadowMap",void 0),f(this,"depthBuffer",void 0),f(this,"fbo",void 0),this.shadowMap=new Tt(t,{width:1,height:1,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.depthBuffer=new Ce(t,{format:33189,width:1,height:1}),this.fbo=new Q(t,{id:"shadowmap",width:1,height:1,attachments:{[36064]:this.shadowMap,[36096]:this.depthBuffer}})}render(t){const e=this.fbo;xt(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const i=t.viewports[0],r=Be(this.gl),s=i.width*r,o=i.height*r;(s!==e.width||o!==e.height)&&e.resize({width:s,height:o}),super.render({...t,target:e,pass:"shadow"})})}shouldDrawLayer(t){return t.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const qb={color:[255,255,255],intensity:1},Oa=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],Zb=[0,0,0,200/255];class Fl{constructor(t={}){f(this,"id","lighting-effect"),f(this,"props",null),f(this,"shadowColor",Zb),f(this,"shadow",void 0),f(this,"ambientLight",null),f(this,"directionalLights",[]),f(this,"pointLights",[]),f(this,"shadowPasses",[]),f(this,"shadowMaps",[]),f(this,"dummyShadowMap",null),f(this,"programManager",void 0),f(this,"shadowMatrices",void 0);for(const e in t){const i=t[e];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(e=>e.shadow)}preRender(t,{layers:e,layerFilter:i,viewports:r,onViewportActive:s,views:o}){if(!!this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(t),this.programManager||(this.programManager=In.getDefaultProgramManager(t),Lr&&this.programManager.addDefaultModule(Lr)),this.dummyShadowMap||(this.dummyShadowMap=new Tt(t,{width:1,height:1}));for(let a=0;a<this.shadowPasses.length;a++)this.shadowPasses[a].render({layers:e,layerFilter:i,viewports:r,onViewportActive:s,views:o,moduleParameters:{shadowLightId:a,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(t){const e=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return e.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(i=>i.getProjectedLight({layer:t})),pointLights:this.pointLights.map(i=>i.getProjectedLight({layer:t}))},e}cleanup(){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(Lr),this.programManager=null)}_calculateMatrices(){const t=[];for(const e of this.directionalLights){const i=new ct().lookAt({eye:new Pt(e.direction).negate()});t.push(i)}return t}_createShadowPasses(t){for(let e=0;e<this.directionalLights.length;e++){const i=new Yb(t);this.shadowPasses[e]=i,this.shadowMaps[e]=i.shadowMap}}_applyDefaultLights(){const{ambientLight:t,pointLights:e,directionalLights:i}=this;!t&&e.length===0&&i.length===0&&(this.ambientLight=new Bb(qb),this.directionalLights.push(new Ca(Oa[0]),new Ca(Oa[1])))}}class $b{constructor(t={}){f(this,"_pool",[]),f(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(t)}setOptions(t){Object.assign(this.opts,t)}allocate(t,e,{size:i=1,type:r,padding:s=0,copy:o=!1,initialize:a=!1,maxCount:c}){const l=r||t&&t.constructor||Float32Array,u=e*i+s;if(ArrayBuffer.isView(t)){if(u<=t.length)return t;if(u*t.BYTES_PER_ELEMENT<=t.buffer.byteLength)return new l(t.buffer,0,u)}let h=1/0;c&&(h=c*i+s);const g=this._allocate(l,u,a,h);return t&&o?g.set(t):a||g.fill(0,0,4),this._release(t),g}release(t){this._release(t)}_allocate(t,e,i,r){let s=Math.max(Math.ceil(e*this.opts.overAlloc),1);s>r&&(s=r);const o=this._pool,a=t.BYTES_PER_ELEMENT*s,c=o.findIndex(l=>l.byteLength>=a);if(c>=0){const l=new t(o.splice(c,1)[0],0,s);return i&&l.fill(0),l}return new t(s)}_release(t){if(!ArrayBuffer.isView(t))return;const e=this._pool,{buffer:i}=t,{byteLength:r}=i,s=e.findIndex(o=>o.byteLength>=r);s<0?e.push(i):(s>0||e.length<this.opts.poolSize)&&e.splice(s,0,i),e.length>this.opts.poolSize&&e.shift()}}const wn=new $b;function gn(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function xi(n,t){const e=n%t;return e<0?t+e:e}function Kb(n){return[n[12],n[13],n[14]]}function Qb(n){return{left:Le(n[3]+n[0],n[7]+n[4],n[11]+n[8],n[15]+n[12]),right:Le(n[3]-n[0],n[7]-n[4],n[11]-n[8],n[15]-n[12]),bottom:Le(n[3]+n[1],n[7]+n[5],n[11]+n[9],n[15]+n[13]),top:Le(n[3]-n[1],n[7]-n[5],n[11]-n[9],n[15]-n[13]),near:Le(n[3]+n[2],n[7]+n[6],n[11]+n[10],n[15]+n[14]),far:Le(n[3]-n[2],n[7]-n[6],n[11]-n[10],n[15]-n[14])}}const ka=new Pt;function Le(n,t,e,i){ka.set(n,t,e);const r=ka.len();return{distance:i/r,normal:new Pt(-n/r,-t/r,-e/r)}}function Jb(n){return n-Math.fround(n)}let un;function Rr(n,t){const{size:e=1,startIndex:i=0}=t,r=t.endIndex!==void 0?t.endIndex:n.length,s=(r-i)/e;un=wn.allocate(un,s,{type:Float32Array,size:e*2});let o=i,a=0;for(;o<r;){for(let c=0;c<e;c++){const l=n[o++];un[a+c]=l,un[a+c+e]=Jb(l)}a+=e*2}return un.subarray(0,s*e*2)}const ty=Math.PI/180,ey=gn(),Na=[0,0,0],ny={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function iy({width:n,height:t,orthographic:e,fovyRadians:i,focalDistance:r,padding:s,near:o,far:a}){const c=n/t,l=e?new ct().orthographic({fovy:i,aspect:c,focalDistance:r,near:o,far:a}):new ct().perspective({fovy:i,aspect:c,near:o,far:a});if(s){const{left:u=0,right:h=0,top:g=0,bottom:m=0}=s,b=$((u+n-h)/2,0,n)-n/2,y=$((g+t-m)/2,0,t)-t/2;l[8]-=b*2/n,l[9]+=y*2/t}return l}class Vt{constructor(t={}){f(this,"id",void 0),f(this,"x",void 0),f(this,"y",void 0),f(this,"width",void 0),f(this,"height",void 0),f(this,"isGeospatial",void 0),f(this,"zoom",void 0),f(this,"focalDistance",void 0),f(this,"position",void 0),f(this,"modelMatrix",void 0),f(this,"distanceScales",void 0),f(this,"scale",void 0),f(this,"center",void 0),f(this,"cameraPosition",void 0),f(this,"projectionMatrix",void 0),f(this,"viewMatrix",void 0),f(this,"viewMatrixUncentered",void 0),f(this,"viewMatrixInverse",void 0),f(this,"viewProjectionMatrix",void 0),f(this,"pixelProjectionMatrix",void 0),f(this,"pixelUnprojectionMatrix",void 0),f(this,"resolution",void 0),f(this,"_frustumPlanes",{}),this.id=t.id||this.constructor.displayName||"viewport",this.x=t.x||0,this.y=t.y||0,this.width=t.width||1,this.height=t.height||1,this.zoom=t.zoom||0,this.distanceScales=t.distanceScales||ny,this.focalDistance=t.focalDistance||1,this.position=t.position||Na,this.modelMatrix=t.modelMatrix||null;const{longitude:e,latitude:i}=t;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(e),this._initProps(t),this._initMatrices(t),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Lt.WEB_MERCATOR:Lt.WEB_MERCATOR_AUTO_OFFSET:Lt.IDENTITY}equals(t){return t instanceof Vt?this===t?!0:t.width===this.width&&t.height===this.height&&t.scale===this.scale&&Xt(t.projectionMatrix,this.projectionMatrix)&&Xt(t.viewMatrix,this.viewMatrix):!1}project(t,{topLeft:e=!0}={}){const i=this.projectPosition(t),r=kl(i,this.pixelProjectionMatrix),[s,o]=r,a=e?o:this.height-o;return t.length===2?[s,a]:[s,a,r[2]]}unproject(t,{topLeft:e=!0,targetZ:i}={}){const[r,s,o]=t,a=e?s:this.height-s,c=i&&i*this.distanceScales.unitsPerMeter[2],l=On([r,a,o],this.pixelUnprojectionMatrix,c),[u,h,g]=this.unprojectPosition(l);return Number.isFinite(o)?[u,h,g]:Number.isFinite(i)?[u,h,i]:[u,h]}projectPosition(t){const[e,i]=this.projectFlat(t),r=(t[2]||0)*this.distanceScales.unitsPerMeter[2];return[e,i,r]}unprojectPosition(t){const[e,i]=this.unprojectFlat(t),r=(t[2]||0)*this.distanceScales.metersPerUnit[2];return[e,i,r]}projectFlat(t){if(this.isGeospatial){const e=Ai(t);return e[1]=$(e[1],-318,830),e}return t}unprojectFlat(t){return this.isGeospatial?We(t):t}getBounds(t={}){const e={targetZ:t.z||0},i=this.unproject([0,0],e),r=this.unproject([this.width,0],e),s=this.unproject([0,this.height],e),o=this.unproject([this.width,this.height],e);return[Math.min(i[0],r[0],s[0],o[0]),Math.min(i[1],r[1],s[1],o[1]),Math.max(i[0],r[0],s[0],o[0]),Math.max(i[1],r[1],s[1],o[1])]}getDistanceScales(t){return t?rs({longitude:t[0],latitude:t[1],highPrecision:!0}):this.distanceScales}containsPixel({x:t,y:e,width:i=1,height:r=1}){return t<this.x+this.width&&this.x<t+i&&e<this.y+this.height&&this.y<e+r}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,Qb(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(t,e){return null}_initProps(t){const e=t.longitude,i=t.latitude;this.isGeospatial&&(Number.isFinite(t.zoom)||(this.zoom=Cl({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=t.distanceScales||rs({latitude:i,longitude:e}));const r=Math.pow(2,this.zoom);this.scale=r;const{position:s,modelMatrix:o}=t;let a=Na;if(s&&(a=o?new ct(o).transformAsVector(s,[]):s),this.isGeospatial){const c=this.projectPosition([e,i,0]);this.center=new Pt(a).scale(this.distanceScales.unitsPerMeter).add(c)}else this.center=this.projectPosition(a)}_initMatrices(t){const{viewMatrix:e=ey,projectionMatrix:i=null,orthographic:r=!1,fovyRadians:s,fovy:o=75,near:a=.1,far:c=1e3,padding:l=null,focalDistance:u=1}=t;this.viewMatrixUncentered=e,this.viewMatrix=new ct().multiplyRight(e).translate(new Pt(this.center).negate()),this.projectionMatrix=i||iy({width:this.width,height:this.height,orthographic:r,fovyRadians:s||o*ty,focalDistance:u,padding:l,near:a,far:c});const h=gn();be(h,h,this.projectionMatrix),be(h,h,this.viewMatrix),this.viewProjectionMatrix=h,this.viewMatrixInverse=Jr([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=Kb(this.viewMatrixInverse);const g=gn(),m=gn();Is(g,g,[this.width/2,-this.height/2,1]),Ti(g,g,[1,-1,0]),be(m,g,this.viewProjectionMatrix),this.pixelProjectionMatrix=m,this.pixelUnprojectionMatrix=Jr(gn(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||H.warn("Pixel project matrix not invertible")()}}f(Vt,"displayName","Viewport");const ry=512,sy=4003e4,oy=Math.PI/180;function Da(n){const t=Math.cos(n*oy);return ry/sy/t}class $t extends Vt{constructor(t={}){const{latitude:e=0,longitude:i=0,zoom:r=0,pitch:s=0,bearing:o=0,nearZMultiplier:a=.1,farZMultiplier:c=1.01,orthographic:l=!1,projectionMatrix:u,repeat:h=!1,worldOffset:g=0,legacyMeterSizes:m=!1}=t;let{width:b,height:y,altitude:E=1.5}=t;const T=Math.pow(2,r);b=b||1,y=y||1;let A,S=null;u?(E=u[5]/2,A=Si(E)):(t.fovy?(A=t.fovy,E=ks(A)):A=Si(E),S=yb({width:b,height:y,pitch:s,fovy:A,nearZMultiplier:a,farZMultiplier:c}));let x=bb({height:y,pitch:s,bearing:o,scale:T,altitude:E});g&&(x=new ct().translate([512*g,0,0]).multiplyLeft(x)),super({...t,width:b,height:y,viewMatrix:x,longitude:i,latitude:e,zoom:r,...S,fovy:A,focalDistance:E}),f(this,"longitude",void 0),f(this,"latitude",void 0),f(this,"pitch",void 0),f(this,"bearing",void 0),f(this,"altitude",void 0),f(this,"fovy",void 0),f(this,"orthographic",void 0),f(this,"_subViewports",void 0),f(this,"_pseudoMeters",void 0),this.latitude=e,this.longitude=i,this.zoom=r,this.pitch=s,this.bearing=o,this.altitude=E,this.fovy=A,this.orthographic=l,this._subViewports=h?[]:null,this._pseudoMeters=m,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const t=this.getBounds(),e=Math.floor((t[0]+180)/360),i=Math.ceil((t[2]-180)/360);for(let r=e;r<=i;r++){const s=r?new $t({...this,worldOffset:r}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(t){if(this._pseudoMeters)return super.projectPosition(t);const[e,i]=this.projectFlat(t),r=(t[2]||0)*Da(t[1]);return[e,i,r]}unprojectPosition(t){if(this._pseudoMeters)return super.unprojectPosition(t);const[e,i]=this.unprojectFlat(t),r=(t[2]||0)/Da(i);return[e,i,r]}addMetersToLngLat(t,e){return Ol(t,e)}panByPosition(t,e){const i=On(e,this.pixelUnprojectionMatrix),r=this.projectFlat(t),s=vi([],r,ml([],i)),o=vi([],this.center,s),[a,c]=this.unprojectFlat(o);return{longitude:a,latitude:c}}getBounds(t={}){const e=vb(this,t.z||0);return[Math.min(e[0][0],e[1][0],e[2][0],e[3][0]),Math.min(e[0][1],e[1][1],e[2][1],e[3][1]),Math.max(e[0][0],e[1][0],e[2][0],e[3][0]),Math.max(e[0][1],e[1][1],e[2][1],e[3][1])]}fitBounds(t,e={}){const{width:i,height:r}=this,{longitude:s,latitude:o,zoom:a}=Nl({width:i,height:r,bounds:t,...e});return new $t({width:i,height:r,longitude:s,latitude:o,zoom:a})}}f($t,"displayName","WebMercatorViewport");function Ir(n,t,e=!1){const i=t.projectPosition(n);if(e&&t instanceof $t){const[r,s,o=0]=n,a=t.getDistanceScales([r,s]);i[2]=o*a.unitsPerMeter[2]}return i}function ay(n){const{viewport:t,modelMatrix:e,coordinateOrigin:i}=n;let{coordinateSystem:r,fromCoordinateSystem:s,fromCoordinateOrigin:o}=n;return r===G.DEFAULT&&(r=t.isGeospatial?G.LNGLAT:G.CARTESIAN),s===void 0&&(s=r),o===void 0&&(o=i),{viewport:t,coordinateSystem:r,coordinateOrigin:i,modelMatrix:e,fromCoordinateSystem:s,fromCoordinateOrigin:o}}function Ul(n,{viewport:t,modelMatrix:e,coordinateSystem:i,coordinateOrigin:r,offsetMode:s}){let[o,a,c=0]=n;switch(e&&([o,a,c]=qe([],[o,a,c,1],e)),i){case G.LNGLAT:return Ir([o,a,c],t,s);case G.LNGLAT_OFFSETS:return Ir([o+r[0],a+r[1],c+(r[2]||0)],t,s);case G.METER_OFFSETS:return Ir(Ol(r,[o,a,c]),t,s);case G.CARTESIAN:default:return t.isGeospatial?[o+r[0],a+r[1],c+r[2]]:t.projectPosition([o,a,c])}}function cy(n,t){const{viewport:e,coordinateSystem:i,coordinateOrigin:r,modelMatrix:s,fromCoordinateSystem:o,fromCoordinateOrigin:a}=ay(t),{geospatialOrigin:c,shaderCoordinateOrigin:l,offsetMode:u}=Ll(e,i,r),h=Ul(n,{viewport:e,modelMatrix:s,coordinateSystem:o,coordinateOrigin:a,offsetMode:u});if(u){const g=e.projectPosition(c||l);vl(h,h,g)}return h}const Ie={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Pi=Symbol.for("component"),De=Symbol.for("asyncPropDefaults"),Ee=Symbol.for("asyncPropOriginal"),oe=Symbol.for("asyncPropResolved");function Ns(n,t=()=>!0){return Array.isArray(n)?Bl(n,t,[]):t(n)?[n]:[]}function Bl(n,t,e){let i=-1;for(;++i<n.length;){const r=n[i];Array.isArray(r)?Bl(r,t,e):t(r)&&e.push(r)}return e}function ly({target:n,source:t,start:e=0,count:i=1}){const r=t.length,s=i*r;let o=0;for(let a=e;o<r;o++)n[a++]=t[o];for(;o<s;)o<s-o?(n.copyWithin(e+o,e,e+o),o*=2):(n.copyWithin(e+o,e,e+s-o),o=s);return n}class uy{constructor(t,e,i){f(this,"id",void 0),f(this,"context",void 0),f(this,"isLoaded",void 0),f(this,"persistent",void 0),f(this,"_loadCount",0),f(this,"_subscribers",new Set),f(this,"_data",void 0),f(this,"_loader",void 0),f(this,"_error",void 0),f(this,"_content",void 0),this.id=t,this.context=i,this.setData(e)}subscribe(t){this._subscribers.add(t)}unsubscribe(t){this._subscribers.delete(t)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(t,e){if(t===this._data&&!e)return;this._data=t;const i=++this._loadCount;let r=t;typeof t=="string"&&(r=jr(t)),r instanceof Promise?(this.isLoaded=!1,this._loader=r.then(s=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===i&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=t);for(const s of this._subscribers)s.onChange(this.getData())}}class hy{constructor({gl:t,protocol:e}){f(this,"protocol",void 0),f(this,"_context",void 0),f(this,"_resources",void 0),f(this,"_consumers",void 0),f(this,"_pruneRequest",void 0),this.protocol=e||"resource://",this._context={gl:t,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(t){return t.startsWith(this.protocol)?!0:t in this._resources}add({resourceId:t,data:e,forceUpdate:i=!1,persistent:r=!0}){let s=this._resources[t];s?s.setData(e,i):(s=new uy(t,e,this._context),this._resources[t]=s),s.persistent=r}remove(t){const e=this._resources[t];e&&(e.delete(),delete this._resources[t])}unsubscribe({consumerId:t}){const e=this._consumers[t];if(e){for(const i in e){const r=e[i],s=this._resources[r.resourceId];s&&s.unsubscribe(r)}delete this._consumers[t],this.prune()}}subscribe({resourceId:t,onChange:e,consumerId:i,requestId:r="default"}){const{_resources:s,protocol:o}=this;t.startsWith(o)&&(t=t.replace(o,""),s[t]||this.add({resourceId:t,data:null,persistent:!1}));const a=s[t];if(this._track(i,r,a,e),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const t in this._resources)this._resources[t].delete()}_track(t,e,i,r){const s=this._consumers,o=s[t]=s[t]||{},a=o[e]||{},c=a.resourceId&&this._resources[a.resourceId];c&&(c.unsubscribe(a),this.prune()),i&&(o[e]=a,a.onChange=r,a.resourceId=i.id,i.subscribe(a))}_prune(){this._pruneRequest=null;for(const t of Object.keys(this._resources)){const e=this._resources[t];!e.persistent&&!e.inUse()&&(e.delete(),delete this._resources[t])}}}const fy="layerManager.setLayers",dy="layerManager.activateViewport";class gy{constructor(t,{deck:e,stats:i,viewport:r,timeline:s}={}){f(this,"layers",void 0),f(this,"context",void 0),f(this,"resourceManager",void 0),f(this,"_lastRenderedLayers",[]),f(this,"_needsRedraw",!1),f(this,"_needsUpdate",!1),f(this,"_nextLayers",null),f(this,"_debug",!1),f(this,"activateViewport",o=>{at(dy,this,o),o&&(this.context.viewport=o)}),this.layers=[],this.resourceManager=new hy({gl:t,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:t,deck:e,programManager:t&&Nb(t),stats:i||new _s({id:"deck.gl"}),viewport:r||new Vt({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:s||new Sl,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const t of this.layers)this._finalizeLayer(t)}needsRedraw(t={clearRedrawFlags:!1}){let e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const r=i.getNeedsRedraw(t);e=e||r}return e}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(t){this._needsRedraw=this._needsRedraw||t}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t}getLayers({layerIds:t}={}){return t?this.layers.filter(e=>t.find(i=>e.id.indexOf(i)===0)):this.layers}setProps(t){"debug"in t&&(this._debug=t.debug),"userData"in t&&(this.context.userData=t.userData),"layers"in t&&(this._nextLayers=t.layers),"onError"in t&&(this.context.onError=t.onError)}setLayers(t,e){at(fy,this,e,t),this._lastRenderedLayers=t;const i=Ns(t,Boolean);for(const r of i)r.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const t=this.needsUpdate();t&&(this.setNeedsRedraw("updating layers: ".concat(t)),this.setLayers(this._nextLayers||this._lastRenderedLayers,t)),this._nextLayers=null}_handleError(t,e,i){i.raiseError(e,"".concat(t," of ").concat(i))}_updateLayers(t,e){const i={};for(const o of t)i[o.id]?H.warn("Multiple old layers with same id ".concat(o.id))():i[o.id]=o;const r=[];this._updateSublayersRecursively(e,i,r),this._finalizeOldLayers(i);let s=!1;for(const o of r)if(o.hasUniformTransition()){s="Uniform transition in ".concat(o);break}this._needsUpdate=s,this.layers=r}_updateSublayersRecursively(t,e,i){for(const r of t){r.context=this.context;const s=e[r.id];s===null&&H.warn("Multiple new layers with same id ".concat(r.id))(),e[r.id]=null;let o=null;try{this._debug&&s!==r&&r.validateProps(),s?(this._transferLayerState(s,r),this._updateLayer(r)):this._initializeLayer(r),i.push(r),o=r.isComposite?r.getSubLayers():null}catch(a){this._handleError("matching",a,r)}o&&this._updateSublayersRecursively(o,e,i)}}_finalizeOldLayers(t){for(const e in t){const i=t[e];i&&this._finalizeLayer(i)}}_initializeLayer(t){try{t._initialize(),t.lifecycle=Ie.INITIALIZED}catch(e){this._handleError("initialization",e,t)}}_transferLayerState(t,e){e._transferState(t),e.lifecycle=Ie.MATCHED,e!==t&&(t.lifecycle=Ie.AWAITING_GC)}_updateLayer(t){try{t._update()}catch(e){this._handleError("update",e,t)}}_finalizeLayer(t){this._needsRedraw=this._needsRedraw||"finalized ".concat(t),t.lifecycle=Ie.AWAITING_FINALIZATION;try{t._finalize(),t.lifecycle=Ie.FINALIZED}catch(e){this._handleError("finalization",e,t)}}}function Te(n,t){if(n===t)return!0;if(!n||!t)return!1;for(const e in n){const i=n[e],r=t[e];if(!(i===r||Array.isArray(i)&&Array.isArray(r)&&Te(i,r)))return!1}return!0}class py{constructor(t){f(this,"width",void 0),f(this,"height",void 0),f(this,"views",void 0),f(this,"viewState",void 0),f(this,"controllers",void 0),f(this,"timeline",void 0),f(this,"_viewports",void 0),f(this,"_viewportMap",void 0),f(this,"_isUpdating",void 0),f(this,"_needsRedraw",void 0),f(this,"_needsUpdate",void 0),f(this,"_eventManager",void 0),f(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=t.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=t.eventManager,this._eventCallbacks={onViewStateChange:t.onViewStateChange,onInteractionStateChange:t.onInteractionStateChange},Object.seal(this),this.setProps(t)}finalize(){for(const t in this.controllers){const e=this.controllers[t];e&&e.finalize()}this.controllers={}}needsRedraw(t={clearRedrawFlags:!1}){const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t,this._needsRedraw=this._needsRedraw||t}updateViewStates(){for(const t in this.controllers){const e=this.controllers[t];e&&e.updateTransition()}}getViewports(t){return t?this._viewports.filter(e=>e.containsPixel(t)):this._viewports}getViews(){const t={};return this.views.forEach(e=>{t[e.id]=e}),t}getView(t){return this.views.find(e=>e.id===t)}getViewState(t){const e=typeof t=="string"?this.getView(t):t,i=e&&this.viewState[e.getViewStateId()]||this.viewState;return e?e.filterViewState(i):i}getViewport(t){return this._viewportMap[t]}unproject(t,e){const i=this.getViewports(),r={x:t[0],y:t[1]};for(let s=i.length-1;s>=0;--s){const o=i[s];if(o.containsPixel(r)){const a=t.slice();return a[0]-=o.x,a[1]-=o.y,o.unproject(a,e)}}return null}setProps(t){t.views&&this._setViews(t.views),t.viewState&&this._setViewState(t.viewState),("width"in t||"height"in t)&&this._setSize(t.width,t.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(t,e){(t!==this.width||e!==this.height)&&(this.width=t,this.height=e,this.setNeedsUpdate("Size changed"))}_setViews(t){t=Ns(t,Boolean),this._diffViews(t,this.views)&&this.setNeedsUpdate("views changed"),this.views=t}_setViewState(t){t?(!Te(t,this.viewState)&&this.setNeedsUpdate("viewState changed"),this.viewState=t):H.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(t,e){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...e,viewId:t})}_createController(t,e){const i=e.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,e.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>{var o;return(o=this.getView(t.id))===null||o===void 0?void 0:o.makeViewport({viewState:s,width:this.width,height:this.height})}})}_updateController(t,e,i,r){const s=t.controller;if(s){const o={...e,...s,id:t.id,x:i.x,y:i.y,width:i.width,height:i.height};return r||(r=this._createController(t,o)),r&&r.setProps(o),r}return null}_rebuildViewports(){const{views:t}=this,e=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let r=t.length;r--;){const s=t[r],o=this.getViewState(s),a=s.makeViewport({viewState:o,width:this.width,height:this.height});let c=e[s.id];const l=Boolean(s.controller);l&&!c&&(i=!0),(i||!l)&&c&&(c.finalize(),c=null),this.controllers[s.id]=this._updateController(s,o,a,c),this._viewports.unshift(a)}for(const r in e){const s=e[r];s&&!this.controllers[r]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(t=>{t.id&&(this._viewportMap[t.id]=this._viewportMap[t.id]||t)})}_diffViews(t,e){return t.length!==e.length?!0:t.some((i,r)=>!t[r].equals(e[r]))}}const my=/([0-9]+\.?[0-9]*)(%|px)/;function ne(n){switch(typeof n){case"number":return{position:n,relative:!1};case"string":const t=my.exec(n);if(t&&t.length>=3){const e=t[2]==="%",i=parseFloat(t[1]);return{position:e?i/100:i,relative:e}}default:throw new Error("Could not parse position string ".concat(n))}}function ie(n,t){return n.relative?Math.round(n.position*t):n.position}function st(n,t){if(!n)throw new Error(t||"deck.gl: assertion failed.")}class Bt{constructor(t){f(this,"id",void 0),f(this,"viewportInstance",void 0),f(this,"_x",void 0),f(this,"_y",void 0),f(this,"_width",void 0),f(this,"_height",void 0),f(this,"_padding",void 0),f(this,"props",void 0);const{id:e,x:i=0,y:r=0,width:s="100%",height:o="100%",padding:a=null,viewportInstance:c}=t||{};st(!c||c instanceof Vt),this.viewportInstance=c,this.id=e||this.constructor.displayName||"view",this.props={...t,id:this.id},this._x=ne(i),this._y=ne(r),this._width=ne(s),this._height=ne(o),this._padding=a&&{left:ne(a.left||0),right:ne(a.right||0),top:ne(a.top||0),bottom:ne(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(t){return this===t?!0:this.viewportInstance?t.viewportInstance?this.viewportInstance.equals(t.viewportInstance):!1:this.ViewportType===t.ViewportType&&Te(this.props,t.props)}makeViewport({width:t,height:e,viewState:i}){if(this.viewportInstance)return this.viewportInstance;i=this.filterViewState(i);const r=this.getDimensions({width:t,height:e});return new this.ViewportType({...i,...this.props,...r})}getViewStateId(){const{viewState:t}=this.props;return typeof t=="string"?t:(t==null?void 0:t.id)||this.id}filterViewState(t){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const e={...t};for(const i in this.props.viewState)i!=="id"&&(e[i]=this.props.viewState[i]);return e}return t}getDimensions({width:t,height:e}){const i={x:ie(this._x,t),y:ie(this._y,e),width:ie(this._width,t),height:ie(this._height,e)};return this._padding&&(i.padding={left:ie(this._padding.left,t),top:ie(this._padding.top,e),right:ie(this._padding.right,t),bottom:ie(this._padding.bottom,e)}),i}get controller(){const t=this.props.controller;return t?t===!0?{type:this.ControllerType}:typeof t=="function"?{type:t}:{type:this.ControllerType,...t}:null}}class kn{constructor(t){f(this,"_inProgress",void 0),f(this,"_handle",void 0),f(this,"_timeline",void 0),f(this,"time",void 0),f(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=t,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(t){var e,i;this.cancel(),this.settings=t,this._inProgress=!0,(e=(i=this.settings).onStart)===null||e===void 0||e.call(i,this)}end(){if(this._inProgress){var t,e;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(t=(e=this.settings).onEnd)===null||t===void 0||t.call(e,this)}}cancel(){if(this._inProgress){var t,e;(t=(e=this.settings).onInterrupt)===null||t===void 0||t.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var t,e;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:i,settings:r}=this;this._handle=i.addChannel({delay:i.getTime(),duration:r.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(t=(e=this.settings).onUpdate)===null||t===void 0||t.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const Fa=()=>{},ss={BREAK:1,SNAP_TO_END:2,IGNORE:3},_y=n=>n,by=ss.BREAK;class yy{constructor(t){f(this,"getControllerState",void 0),f(this,"props",void 0),f(this,"propsInTransition",void 0),f(this,"transition",void 0),f(this,"onViewStateChange",void 0),f(this,"onStateChange",void 0),f(this,"_onTransitionUpdate",e=>{const{time:i,settings:{interpolator:r,startProps:s,endProps:o,duration:a,easing:c}}=e,l=c(i/a),u=r.interpolateProps(s,o,l);this.propsInTransition=this.getControllerState({...this.props,...u}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=t.getControllerState,this.propsInTransition=null,this.transition=new kn(t.timeline),this.onViewStateChange=t.onViewStateChange||Fa,this.onStateChange=t.onStateChange||Fa}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(t){let e=!1;const i=this.props;if(this.props=t,!i||this._shouldIgnoreViewportChange(i,t))return!1;if(this._isTransitionEnabled(t)){let r=i;if(this.transition.inProgress){const{interruption:s,endProps:o}=this.transition.settings;r={...i,...s===ss.SNAP_TO_END?o:this.propsInTransition||i}}this._triggerTransition(r,t),e=!0}else this.transition.cancel();return e}updateTransition(){this.transition.update()}_isTransitionEnabled(t){const{transitionDuration:e,transitionInterpolator:i}=t;return(e>0||e==="auto")&&Boolean(i)}_isUpdateDueToCurrentTransition(t){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(t,this.propsInTransition):!1}_shouldIgnoreViewportChange(t,e){return this.transition.inProgress?this.transition.settings.interruption===ss.IGNORE||this._isUpdateDueToCurrentTransition(e):this._isTransitionEnabled(e)?e.transitionInterpolator.arePropsEqual(t,e):!0}_triggerTransition(t,e){const i=this.getControllerState(t),r=this.getControllerState(e).shortestPathFrom(i),s=e.transitionInterpolator,o=s.getDuration?s.getDuration(t,e):e.transitionDuration;if(o===0)return;const a=s.initializeProps(t,r);this.propsInTransition={};const c={duration:o,easing:e.transitionEasing||_y,interpolator:s,interruption:e.transitionInterruption||by,startProps:a.start,endProps:a.end,onStart:e.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(e.onTransitionInterrupt),onEnd:this._onTransitionEnd(e.onTransitionEnd)};this.transition.start(c),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(t){return e=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),t==null||t(e)}}}class Ey{constructor(t){f(this,"_propsToCompare",void 0),f(this,"_propsToExtract",void 0),f(this,"_requiredProps",void 0);const{compare:e,extract:i,required:r}=t;this._propsToCompare=e,this._propsToExtract=i||e,this._requiredProps=r}arePropsEqual(t,e){for(const i of this._propsToCompare)if(!(i in t)||!(i in e)||!Xt(t[i],e[i]))return!1;return!0}initializeProps(t,e){const i={},r={};for(const s of this._propsToExtract)(s in t||s in e)&&(i[s]=t[s],r[s]=e[s]);return this._checkRequiredProps(i),this._checkRequiredProps(r),{start:i,end:r}}getDuration(t,e){return e.transitionDuration}_checkRequiredProps(t){!this._requiredProps||this._requiredProps.forEach(e=>{const i=t[e];st(Number.isFinite(i)||Array.isArray(i),"".concat(e," is required for transition"))})}}const vy=["longitude","latitude","zoom","bearing","pitch"],Ty=["longitude","latitude","zoom"];class Ze extends Ey{constructor(t={}){const e=Array.isArray(t)?t:t.transitionProps,i=Array.isArray(t)?{}:t;i.transitionProps=Array.isArray(e)?{compare:e,required:e}:e||{compare:vy,required:Ty},super(i.transitionProps),f(this,"opts",void 0),this.opts=i}initializeProps(t,e){const i=super.initializeProps(t,e),{makeViewport:r,around:s}=this.opts;if(r&&s){const o=r(t),a=r(e),c=o.unproject(s);i.start.around=s,Object.assign(i.end,{around:a.project(c),aroundPosition:c,width:e.width,height:e.height})}return i}interpolateProps(t,e,i){const r={};for(const s of this._propsToExtract)r[s]=Ei(t[s]||0,e[s]||0,i);if(e.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...e,...r});Object.assign(r,s.panByPosition(e.aroundPosition,Ei(t.around,e.around,i)))}return r}}const re={transitionDuration:0},wy=300,ii=n=>1-(1-n)*(1-n),Re={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},ge={};class Nn{constructor(t){f(this,"props",void 0),f(this,"state",{}),f(this,"transitionManager",void 0),f(this,"eventManager",void 0),f(this,"onViewStateChange",void 0),f(this,"onStateChange",void 0),f(this,"makeViewport",void 0),f(this,"_controllerState",void 0),f(this,"_events",{}),f(this,"_interactionState",{isDragging:!1}),f(this,"_customEvents",[]),f(this,"_eventStartBlocked",null),f(this,"_panMove",!1),f(this,"invertPan",!1),f(this,"dragMode","rotate"),f(this,"inertia",0),f(this,"scrollZoom",!0),f(this,"dragPan",!0),f(this,"dragRotate",!0),f(this,"doubleClickZoom",!0),f(this,"touchZoom",!0),f(this,"touchRotate",!1),f(this,"keyboard",!0),this.transitionManager=new yy({...t,getControllerState:e=>new this.ControllerState(e),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=t.eventManager,this.onViewStateChange=t.onViewStateChange||(()=>{}),this.onStateChange=t.onStateChange||(()=>{}),this.makeViewport=t.makeViewport}set events(t){this.toggleEvents(this._customEvents,!1),this.toggleEvents(t,!0),this._customEvents=t,this.props&&this.setProps(this.props)}finalize(){for(const e in this._events)if(this._events[e]){var t;(t=this.eventManager)===null||t===void 0||t.off(e,this.handleEvent)}this.transitionManager.finalize()}handleEvent(t){this._controllerState=void 0;const e=this._eventStartBlocked;switch(t.type){case"panstart":return e?!1:this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return e?!1:this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"tripanstart":return e?!1:this._onTriplePanStart(t);case"tripanmove":return this._onTriplePan(t);case"tripanend":return this._onTriplePanEnd(t);case"doubletap":return this._onDoubleTap(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(t){const{x:e,y:i}=this.props,{offsetCenter:r}=t;return[r.x-e,r.y-i]}isPointInBounds(t,e){const{width:i,height:r}=this.props;if(e&&e.handled)return!1;const s=t[0]>=0&&t[0]<=i&&t[1]>=0&&t[1]<=r;return s&&e&&e.stopPropagation(),s}isFunctionKeyPressed(t){const{srcEvent:e}=t;return Boolean(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(t){const e=setTimeout(()=>{this._eventStartBlocked===e&&(this._eventStartBlocked=null)},t);this._eventStartBlocked=e}setProps(t){t.dragMode&&(this.dragMode=t.dragMode),this.props=t,"transitionInterpolator"in t||(t.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(t);const{inertia:e}=t;this.inertia=Number.isFinite(e)?e:e===!0?wy:0;const{scrollZoom:i=!0,dragPan:r=!0,dragRotate:s=!0,doubleClickZoom:o=!0,touchZoom:a=!0,touchRotate:c=!1,keyboard:l=!0}=t,u=Boolean(this.onViewStateChange);this.toggleEvents(Re.WHEEL,u&&i),this.toggleEvents(Re.PAN,u&&(r||s)),this.toggleEvents(Re.PINCH,u&&(a||c)),this.toggleEvents(Re.TRIPLE_PAN,u&&c),this.toggleEvents(Re.DOUBLE_TAP,u&&o),this.toggleEvents(Re.KEYBOARD,u&&l),this.scrollZoom=i,this.dragPan=r,this.dragRotate=s,this.doubleClickZoom=o,this.touchZoom=a,this.touchRotate=c,this.keyboard=l}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(t,e){this.eventManager&&t.forEach(i=>{this._events[i]!==e&&(this._events[i]=e,e?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(t,e=null,i={}){const r={...t.getViewportProps(),...e},s=this.controllerState!==t;if(this.state=t.getState(),this._setInteractionState(i),s){const o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:r,interactionState:this._interactionState,oldViewState:o})}}_onTransition(t){this.onViewStateChange({...t,interactionState:this._interactionState})}_setInteractionState(t){Object.assign(this._interactionState,t),this.onStateChange(this._interactionState)}_onPanStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;let i=this.isFunctionKeyPressed(t)||t.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);const r=this.controllerState[i?"panStart":"rotateStart"]({pos:e});return this._panMove=i,this.updateViewport(r,re,{isDragging:!0}),!0}_onPan(t){return this.isDragging()?this._panMove?this._onPanMove(t):this._onPanRotate(t):!1}_onPanEnd(t){return this.isDragging()?this._panMove?this._onPanMoveEnd(t):this._onPanRotateEnd(t):!1}_onPanMove(t){if(!this.dragPan)return!1;const e=this.getCenter(t),i=this.controllerState.pan({pos:e});return this.updateViewport(i,re,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(t){const{inertia:e}=this;if(this.dragPan&&e&&t.velocity){const i=this.getCenter(t),r=[i[0]+t.velocityX*e/2,i[1]+t.velocityY*e/2],s=this.controllerState.pan({pos:r}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:ii},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(t){if(!this.dragRotate)return!1;const e=this.getCenter(t),i=this.controllerState.rotate({pos:e});return this.updateViewport(i,re,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(t){const{inertia:e}=this;if(this.dragRotate&&e&&t.velocity){const i=this.getCenter(t),r=[i[0]+t.velocityX*e/2,i[1]+t.velocityY*e/2],s=this.controllerState.rotate({pos:r}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:ii},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(t){if(!this.scrollZoom)return!1;t.srcEvent.preventDefault();const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const{speed:i=.01,smooth:r=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=t;let o=2/(1+Math.exp(-Math.abs(s*i)));s<0&&o!==0&&(o=1/o);const a=this.controllerState.zoom({pos:e,scale:o});return this.updateViewport(a,{...this._getTransitionProps({around:e}),transitionDuration:r?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const i=this.controllerState.rotateStart({pos:e});return this.updateViewport(i,re,{isDragging:!0}),!0}_onTriplePan(t){if(!this.touchRotate||!this.isDragging())return!1;const e=this.getCenter(t);e[0]-=t.deltaX;const i=this.controllerState.rotate({pos:e});return this.updateViewport(i,re,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(t){if(!this.isDragging())return!1;const{inertia:e}=this;if(this.touchRotate&&e&&t.velocityY){const i=this.getCenter(t),r=[i[0],i[1]+=t.velocityY*e/2],s=this.controllerState.rotate({pos:r});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:ii},{isDragging:!1,isRotating:!0}),this.blockEvents(e)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const i=this.controllerState.zoomStart({pos:e}).rotateStart({pos:e});return ge._startPinchRotation=t.rotation,ge._lastPinchEvent=t,this.updateViewport(i,re,{isDragging:!0}),!0}_onPinch(t){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let e=this.controllerState;if(this.touchZoom){const{scale:i}=t,r=this.getCenter(t);e=e.zoom({pos:r,scale:i})}if(this.touchRotate){const{rotation:i}=t;e=e.rotate({deltaAngleX:ge._startPinchRotation-i})}return this.updateViewport(e,re,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),ge._lastPinchEvent=t,!0}_onPinchEnd(t){if(!this.isDragging())return!1;const{inertia:e}=this,{_lastPinchEvent:i}=ge;if(this.touchZoom&&e&&i&&t.scale!==i.scale){const r=this.getCenter(t);let s=this.controllerState.rotateEnd();const o=Math.log2(t.scale),a=(o-Math.log2(i.scale))/(t.deltaTime-i.deltaTime),c=Math.pow(2,o+a*e/2);s=s.zoom({pos:r,scale:c}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:r}),transitionDuration:e,transitionEasing:ii},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(e)}else{const r=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return ge._startPinchRotation=null,ge._lastPinchEvent=null,!0}_onDoubleTap(t){if(!this.doubleClickZoom)return!1;const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const i=this.isFunctionKeyPressed(t),r=this.controllerState.zoom({pos:e,scale:i?.5:2});return this.updateViewport(r,this._getTransitionProps({around:e}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(t){if(!this.keyboard)return!1;const e=this.isFunctionKeyPressed(t),{zoomSpeed:i,moveSpeed:r,rotateSpeedX:s,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this;let c;const l={};switch(t.srcEvent.code){case"Minus":c=e?a.zoomOut(i).zoomOut(i):a.zoomOut(i),l.isZooming=!0;break;case"Equal":c=e?a.zoomIn(i).zoomIn(i):a.zoomIn(i),l.isZooming=!0;break;case"ArrowLeft":e?(c=a.rotateLeft(s),l.isRotating=!0):(c=a.moveLeft(r),l.isPanning=!0);break;case"ArrowRight":e?(c=a.rotateRight(s),l.isRotating=!0):(c=a.moveRight(r),l.isPanning=!0);break;case"ArrowUp":e?(c=a.rotateUp(o),l.isRotating=!0):(c=a.moveUp(r),l.isPanning=!0);break;case"ArrowDown":e?(c=a.rotateDown(o),l.isRotating=!0):(c=a.moveDown(r),l.isPanning=!0);break;default:return!1}return this.updateViewport(c,this._getTransitionProps(),l),!0}_getTransitionProps(t){const{transition:e}=this;return!e||!e.transitionInterpolator?re:t?{...e,transitionInterpolator:new Ze({...t,...e.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:e}}class Ds{constructor(t,e){f(this,"_viewportProps",void 0),f(this,"_state",void 0),this._viewportProps=this.applyConstraints(t),this._state=e}getViewportProps(){return this._viewportProps}getState(){return this._state}}const Ua=5,Ay=1.2;class Vl extends Ds{constructor(t){const{width:e,height:i,latitude:r,longitude:s,zoom:o,bearing:a=0,pitch:c=0,altitude:l=1.5,position:u=[0,0,0],maxZoom:h=20,minZoom:g=0,maxPitch:m=60,minPitch:b=0,startPanLngLat:y,startZoomLngLat:E,startRotatePos:T,startBearing:A,startPitch:S,startZoom:x,normalize:M=!0}=t;st(Number.isFinite(s)),st(Number.isFinite(r)),st(Number.isFinite(o)),super({width:e,height:i,latitude:r,longitude:s,zoom:o,bearing:a,pitch:c,altitude:l,maxZoom:h,minZoom:g,maxPitch:m,minPitch:b,normalize:M,position:u},{startPanLngLat:y,startZoomLngLat:E,startRotatePos:T,startBearing:A,startPitch:S,startZoom:x}),f(this,"makeViewport",void 0),this.makeViewport=t.makeViewport}panStart({pos:t}){return this._getUpdatedState({startPanLngLat:this._unproject(t)})}pan({pos:t,startPos:e}){const i=this.getState().startPanLngLat||this._unproject(e);if(!i)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(i,t);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:t}){return this._getUpdatedState({startRotatePos:t,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:t,deltaAngleX:e=0,deltaAngleY:i=0}){const{startRotatePos:r,startBearing:s,startPitch:o}=this.getState();if(!r||s===void 0||o===void 0)return this;let a;return t?a=this._getNewRotation(t,r,o,s):a={bearing:s+e,pitch:o+i},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:t}){return this._getUpdatedState({startZoomLngLat:this._unproject(t),startZoom:this.getViewportProps().zoom})}zoom({pos:t,startPos:e,scale:i}){let{startZoom:r,startZoomLngLat:s}=this.getState();if(s||(r=this.getViewportProps().zoom,s=this._unproject(e)||this._unproject(t)),!s)return this;const{maxZoom:o,minZoom:a}=this.getViewportProps();let c=r+Math.log2(i);c=$(c,a,o);const l=this.makeViewport({...this.getViewportProps(),zoom:c});return this._getUpdatedState({zoom:c,...l.panByPosition(s,t)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(t=2){return this._zoomFromCenter(t)}zoomOut(t=2){return this._zoomFromCenter(1/t)}moveLeft(t=100){return this._panFromCenter([t,0])}moveRight(t=100){return this._panFromCenter([-t,0])}moveUp(t=100){return this._panFromCenter([0,t])}moveDown(t=100){return this._panFromCenter([0,-t])}rotateLeft(t=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-t})}rotateRight(t=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+t})}rotateUp(t=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+t})}rotateDown(t=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-t})}shortestPathFrom(t){const e=t.getViewportProps(),i={...this.getViewportProps()},{bearing:r,longitude:s}=i;return Math.abs(r-e.bearing)>180&&(i.bearing=r<0?r+360:r-360),Math.abs(s-e.longitude)>180&&(i.longitude=s<0?s+360:s-360),i}applyConstraints(t){const{maxZoom:e,minZoom:i,zoom:r}=t;t.zoom=$(r,i,e);const{maxPitch:s,minPitch:o,pitch:a}=t;t.pitch=$(a,o,s);const{normalize:c=!0}=t;return c&&Object.assign(t,Tb(t)),t}_zoomFromCenter(t){const{width:e,height:i}=this.getViewportProps();return this.zoom({pos:[e/2,i/2],scale:t})}_panFromCenter(t){const{width:e,height:i}=this.getViewportProps();return this.pan({startPos:[e/2,i/2],pos:[e/2+t[0],i/2+t[1]]})}_getUpdatedState(t){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...t})}_unproject(t){const e=this.makeViewport(this.getViewportProps());return t&&e.unproject(t)}_getNewRotation(t,e,i,r){const s=t[0]-e[0],o=t[1]-e[1],a=t[1],c=e[1],{width:l,height:u}=this.getViewportProps(),h=s/l;let g=0;o>0?Math.abs(u-c)>Ua&&(g=o/(c-u)*Ay):o<0&&c>Ua&&(g=1-a/c),g=$(g,-1,1);const{minPitch:m,maxPitch:b}=this.getViewportProps(),y=r+180*h;let E=i;return g>0?E=i+g*(b-i):g<0&&(E=i-g*(m-i)),{pitch:E,bearing:y}}}class Sy extends Nn{constructor(...t){super(...t),f(this,"ControllerState",Vl),f(this,"transition",{transitionDuration:300,transitionInterpolator:new Ze({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),f(this,"dragMode","pan")}setProps(t){t.position=t.position||[0,0,0];const e=this.props;super.setProps(t),(!e||e.height!==t.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...t,...this.state}))}}class jl extends Bt{get ViewportType(){return $t}get ControllerType(){return Sy}}f(jl,"displayName","MapView");class xy extends ji{constructor(t,e){super(t,e),f(this,"maskMap",void 0),f(this,"fbo",void 0);const{mapSize:i=2048}=e;this.maskMap=new Tt(t,{width:i,height:i,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.fbo=new Q(t,{id:"maskmap",width:i,height:i,attachments:{[36064]:this.maskMap}})}render(t){const e=this.gl,i=[!1,!1,!1,!1];return i[t.channel]=!0,xt(e,{clearColor:[255,255,255,255],blend:!0,blendFunc:[0,1],blendEquation:32778,colorMask:i,depthTest:!1},()=>super.render({...t,target:this.fbo,pass:"mask"}))}shouldDrawLayer(t){return t.props.operation===Cn.MASK}delete(){this.fbo.delete(),this.maskMap.delete()}}const Py=new ct().lookAt({eye:[0,0,1]});function My({width:n,height:t,near:e,far:i,padding:r}){let s=-n/2,o=n/2,a=-t/2,c=t/2;if(r){const{left:l=0,right:u=0,top:h=0,bottom:g=0}=r,m=$((l+n-u)/2,0,n)-n/2,b=$((h+t-g)/2,0,t)-t/2;s-=m,o-=m,a+=b,c+=b}return new ct().ortho({left:s,right:o,bottom:a,top:c,near:e,far:i})}class Ly extends Vt{constructor(t){const{width:e,height:i,near:r=.1,far:s=1e3,zoom:o=0,target:a=[0,0,0],padding:c=null,flipY:l=!0}=t,u=Array.isArray(o)?o[0]:o,h=Array.isArray(o)?o[1]:o,g=Math.min(u,h),m=Math.pow(2,g);let b;if(u!==h){const y=Math.pow(2,u),E=Math.pow(2,h);b={unitsPerMeter:[y/m,E/m,1],metersPerUnit:[m/y,m/E,1]}}super({...t,longitude:void 0,position:a,viewMatrix:Py.clone().scale([m,m*(l?-1:1),m]),projectionMatrix:My({width:e||1,height:i||1,padding:c,near:r,far:s}),zoom:g,distanceScales:b})}projectFlat([t,e]){const{unitsPerMeter:i}=this.distanceScales;return[t*i[0],e*i[1]]}unprojectFlat([t,e]){const{metersPerUnit:i}=this.distanceScales;return[t*i[0],e*i[1]]}panByPosition(t,e){const i=On(e,this.pixelUnprojectionMatrix),r=this.projectFlat(t),s=vi([],r,ml([],i)),o=vi([],this.center,s);return{target:this.unprojectFlat(o)}}}class zl extends Ds{constructor(t){const{width:e,height:i,rotationX:r=0,rotationOrbit:s=0,target:o=[0,0,0],zoom:a=0,minRotationX:c=-90,maxRotationX:l=90,minZoom:u=-1/0,maxZoom:h=1/0,startPanPosition:g,startRotatePos:m,startRotationX:b,startRotationOrbit:y,startZoomPosition:E,startZoom:T}=t;super({width:e,height:i,rotationX:r,rotationOrbit:s,target:o,zoom:a,minRotationX:c,maxRotationX:l,minZoom:u,maxZoom:h},{startPanPosition:g,startRotatePos:m,startRotationX:b,startRotationOrbit:y,startZoomPosition:E,startZoom:T}),f(this,"makeViewport",void 0),this.makeViewport=t.makeViewport}panStart({pos:t}){return this._getUpdatedState({startPanPosition:this._unproject(t)})}pan({pos:t,startPosition:e}){const i=this.getState().startPanPosition||e;if(!i)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(i,t);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanPosition:null})}rotateStart({pos:t}){return this._getUpdatedState({startRotatePos:t,startRotationX:this.getViewportProps().rotationX,startRotationOrbit:this.getViewportProps().rotationOrbit})}rotate({pos:t,deltaAngleX:e=0,deltaAngleY:i=0}){const{startRotatePos:r,startRotationX:s,startRotationOrbit:o}=this.getState(),{width:a,height:c}=this.getViewportProps();if(!r||s===void 0||o===void 0)return this;let l;if(t){let u=(t[0]-r[0])/a;const h=(t[1]-r[1])/c;(s<-90||s>90)&&(u*=-1),l={rotationX:s+h*180,rotationOrbit:o+u*180}}else l={rotationX:s+i,rotationOrbit:o+e};return this._getUpdatedState(l)}rotateEnd(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}shortestPathFrom(t){const e=t.getViewportProps(),i={...this.getViewportProps()},{rotationOrbit:r}=i;return Math.abs(r-e.rotationOrbit)>180&&(i.rotationOrbit=r<0?r+360:r-360),i}zoomStart({pos:t}){return this._getUpdatedState({startZoomPosition:this._unproject(t),startZoom:this.getViewportProps().zoom})}zoom({pos:t,startPos:e,scale:i}){let{startZoom:r,startZoomPosition:s}=this.getState();if(s||(r=this.getViewportProps().zoom,s=this._unproject(e)||this._unproject(t)),!s)return this;const o=this._calculateNewZoom({scale:i,startZoom:r}),a=this.makeViewport({...this.getViewportProps(),zoom:o});return this._getUpdatedState({zoom:o,...a.panByPosition(s,t)})}zoomEnd(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}zoomIn(t=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:t})})}zoomOut(t=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:1/t})})}moveLeft(t=50){return this._panFromCenter([-t,0])}moveRight(t=50){return this._panFromCenter([t,0])}moveUp(t=50){return this._panFromCenter([0,-t])}moveDown(t=50){return this._panFromCenter([0,t])}rotateLeft(t=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit-t})}rotateRight(t=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit+t})}rotateUp(t=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX-t})}rotateDown(t=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX+t})}_unproject(t){const e=this.makeViewport(this.getViewportProps());return t&&e.unproject(t)}_calculateNewZoom({scale:t,startZoom:e}){const{maxZoom:i,minZoom:r}=this.getViewportProps();e===void 0&&(e=this.getViewportProps().zoom);const s=e+Math.log2(t);return $(s,r,i)}_panFromCenter(t){const{width:e,height:i,target:r}=this.getViewportProps();return this.pan({startPosition:r,pos:[e/2+t[0],i/2+t[1]]})}_getUpdatedState(t){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...t})}applyConstraints(t){const{maxZoom:e,minZoom:i,zoom:r,maxRotationX:s,minRotationX:o,rotationOrbit:a}=t;return t.zoom=Array.isArray(r)?[$(r[0],i,e),$(r[1],i,e)]:$(r,i,e),t.rotationX=$(t.rotationX,o,s),(a<-180||a>180)&&(t.rotationOrbit=xi(a+180,360)-180),t}}class Ry extends Nn{constructor(...t){super(...t),f(this,"ControllerState",zl),f(this,"transition",{transitionDuration:300,transitionInterpolator:new Ze({transitionProps:{compare:["target","zoom","rotationX","rotationOrbit"],required:["target","zoom"]}})})}}class Iy extends zl{constructor(t){super(t),f(this,"zoomAxis",void 0),this.zoomAxis=t.zoomAxis||"all"}_calculateNewZoom({scale:t,startZoom:e}){const{maxZoom:i,minZoom:r}=this.getViewportProps();e===void 0&&(e=this.getViewportProps().zoom);let s=Math.log2(t);if(Array.isArray(e)){let[o,a]=e;switch(this.zoomAxis){case"X":o=$(o+s,r,i);break;case"Y":a=$(a+s,r,i);break;default:let c=Math.min(o+s,a+s);c<r&&(s+=r-c),c=Math.max(o+s,a+s),c>i&&(s+=i-c),o+=s,a+=s}return[o,a]}return $(e+s,r,i)}}class Cy extends Nn{constructor(...t){super(...t),f(this,"ControllerState",Iy),f(this,"transition",{transitionDuration:300,transitionInterpolator:new Ze(["target","zoom"])}),f(this,"dragMode","pan")}_onPanRotate(){return!1}}class Gl extends Bt{get ViewportType(){return Ly}get ControllerType(){return Cy}}f(Gl,"displayName","OrthographicView");function Oy({layers:n,viewport:t}){let e=null;for(const s of n){const o=s.getBounds();o&&(e?(e[0]=Math.min(e[0],o[0][0]),e[1]=Math.min(e[1],o[0][1]),e[2]=Math.max(e[2],o[1][0]),e[3]=Math.max(e[3],o[1][1])):e=[o[0][0],o[0][1],o[1][0],o[1][1]])}const i=t.getBounds();if(!e)return i;const r=Ny(i);return e[2]-e[0]<r[2]-r[0]||e[3]-e[1]<r[3]-r[1]||(e[0]=Math.max(e[0],r[0]),e[1]=Math.max(e[1],r[1]),e[2]=Math.min(e[2],r[2]),e[3]=Math.min(e[3],r[3])),e}function ky({bounds:n,viewport:t,width:e,height:i}){if(n[2]<=n[0]||n[3]<=n[1])return null;const r=1;if(e-=r*2,i-=r*2,t instanceof $t){const{longitude:a,latitude:c,zoom:l}=Nl({width:e,height:i,bounds:[[n[0],n[1]],[n[2],n[3]]],maxZoom:20});return new $t({longitude:a,latitude:c,zoom:l,x:r,y:r,width:e,height:i})}const s=[(n[0]+n[2])/2,(n[1]+n[3])/2,0],o=Math.min(20,e/(n[2]-n[0]),i/(n[3]-n[1]));return new Gl({x:r,y:r}).makeViewport({width:e,height:i,viewState:{target:s,zoom:Math.log2(o)}})}function Ny(n){const t={x:n[2]-n[0],y:n[3]-n[1]},e={x:n[0]+.5*t.x,y:n[1]+.5*t.y};return[e.x-t.x,e.y-t.y,e.x+t.x,e.y+t.y]}class Dy{constructor(){f(this,"id","mask-effect"),f(this,"props",null),f(this,"useInPicking",!0),f(this,"dummyMaskMap",void 0),f(this,"channels",[]),f(this,"masks",null),f(this,"maskPass",void 0),f(this,"maskMap",void 0),f(this,"lastViewport",void 0)}preRender(t,{layers:e,layerFilter:i,viewports:r,onViewportActive:s,views:o}){this.dummyMaskMap||(this.dummyMaskMap=new Tt(t,{width:1,height:1}));const a=e.filter(h=>h.props.visible&&h.props.operation===Cn.MASK);if(a.length===0){this.masks=null,this.channels.length=0;return}this.masks={},this.maskPass||(this.maskPass=new xy(t,{id:"default-mask"}),this.maskMap=this.maskPass.maskMap);const c=this._sortMaskChannels(a),l=r[0],u=!this.lastViewport||!this.lastViewport.equals(l);for(const h in c)this._renderChannel(c[h],{layerFilter:i,onViewportActive:s,views:o,viewport:l,viewportChanged:u})}_renderChannel(t,{layerFilter:e,onViewportActive:i,views:r,viewport:s,viewportChanged:o}){const a=this.channels[t.index];if(!a)return;const c=t===a||a.layers.length!==t.layers.length||t.layerBounds.some((l,u)=>l!==a.layerBounds[u]);if(t.bounds=a.bounds,t.maskBounds=a.maskBounds,this.channels[t.index]=t,(c||o)&&(this.lastViewport=s,t.bounds=Oy({layers:t.layers,viewport:s}),c||!Xt(t.bounds,a.bounds))){const{maskPass:l,maskMap:u}=this,h=ky({bounds:t.bounds,viewport:s,width:u.width,height:u.height});t.maskBounds=h?h.getBounds():[0,0,1,1],l.render({pass:"mask",channel:t.index,layers:t.layers,layerFilter:e,viewports:h?[h]:[],onViewportActive:i,views:r,moduleParameters:{devicePixelRatio:1}})}this.masks[t.id]={index:t.index,bounds:t.maskBounds,coordinateOrigin:t.coordinateOrigin,coordinateSystem:t.coordinateSystem}}_sortMaskChannels(t){const e={};let i=0;for(const r of t){const{id:s}=r.root;let o=e[s];if(!o){if(++i>4){H.warn("Too many mask layers. The max supported is 4")();continue}o={id:s,index:this.channels.findIndex(a=>(a==null?void 0:a.id)===s),layers:[],layerBounds:[],coordinateOrigin:r.root.props.coordinateOrigin,coordinateSystem:r.root.props.coordinateSystem},e[s]=o}o.layers.push(r),o.layerBounds.push(r.getBounds())}for(let r=0;r<4;r++){const s=this.channels[r];(!s||!(s.id in e))&&(this.channels[r]=null)}for(const r in e){const s=e[r];s.index<0&&(s.index=this.channels.findIndex(o=>!o),this.channels[s.index]=s)}return e}getModuleParameters(){return{maskMap:this.masks?this.maskMap:this.dummyMaskMap,maskChannels:this.masks}}cleanup(){this.dummyMaskMap&&(this.dummyMaskMap.delete(),this.dummyMaskMap=void 0),this.maskPass&&(this.maskPass.delete(),this.maskPass=void 0,this.maskMap=void 0),this.lastViewport=void 0,this.masks=null,this.channels.length=0}}const Fy=new Fl;class Uy{constructor(){f(this,"effects",void 0),f(this,"_internalEffects",void 0),f(this,"_needsRedraw",void 0),this.effects=[],this._internalEffects=[],this._needsRedraw="Initial render",this.setEffects()}setProps(t){"effects"in t&&(t.effects.length!==this.effects.length||!Te(t.effects,this.effects))&&(this.setEffects(t.effects),this._needsRedraw="effects changed")}needsRedraw(t={clearRedrawFlags:!1}){const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}getEffects(){return this._internalEffects}finalize(){this.cleanup()}setEffects(t=[]){this.cleanup(),this.effects=t,this._internalEffects=t.slice(),this._internalEffects.push(new Dy),t.some(e=>e instanceof Fl)||this._internalEffects.push(Fy)}cleanup(){for(const t of this.effects)t.cleanup();for(const t of this._internalEffects)t.cleanup();this.effects.length=0,this._internalEffects.length=0}}class By extends ji{shouldDrawLayer(t){return t.props.operation===Cn.DRAW}}const Ba={blendFunc:[1,0,32771,0],blendEquation:32774};class Hl extends ji{constructor(...t){super(...t),f(this,"pickZ",void 0),f(this,"_colors",null)}render(t){return t.pickingFBO?this._drawPickingBuffer(t):super.render(t)}_drawPickingBuffer({layers:t,layerFilter:e,views:i,viewports:r,onViewportActive:s,pickingFBO:o,deviceRect:{x:a,y:c,width:l,height:u},cullRect:h,effects:g,pass:m="picking",pickZ:b}){const y=this.gl;this.pickZ=b;const E=b?null:{byLayer:new Map,byAlpha:[]};this._colors=E;const T=xt(y,{scissorTest:!0,scissor:[a,c,l,u],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...Ba,blend:!b},()=>super.render({target:o,layers:t,layerFilter:e,views:i,viewports:r,onViewportActive:s,cullRect:h,effects:g==null?void 0:g.filter(S=>S.useInPicking),pass:m}));return this._colors=null,{decodePickingColor:E&&jy.bind(null,E),stats:T}}shouldDrawLayer(t){return t.props.pickable&&t.props.operation===Cn.DRAW}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(t,e,i){const r={...t.props.parameters};return this._colors?(Object.assign(r,Ba),r.blend=!0,r.blendColor=Vy(this._colors,t,i)):r.blend=!1,r}}function Vy(n,t,e){const{byLayer:i,byAlpha:r}=n;let s,o=i.get(t);return o?(o.viewports.push(e),s=o.a):(s=i.size+1,s<=255?(o={a:s,layer:t,viewports:[e]},i.set(t,o),r[s]=o):(H.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function jy(n,t){const e=n.byAlpha[t[3]];return e&&{pickedLayer:e.layer,pickedViewports:e.viewports,pickedObjectIndex:e.layer.decodePickingColor(t)}}const zy="deckRenderer.renderLayers";class Gy{constructor(t){this.gl=t,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new By(t),this.pickLayersPass=new Hl(t),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(t){"layerFilter"in t&&this.layerFilter!==t.layerFilter&&(this.layerFilter=t.layerFilter,this._needsRedraw="layerFilter changed"),"drawPickingColors"in t&&this.drawPickingColors!==t.drawPickingColors&&(this.drawPickingColors=t.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(t){const e=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass;t.layerFilter=t.layerFilter||this.layerFilter,t.effects=t.effects||[],t.target=t.target||Q.getDefaultFramebuffer(this.gl),this._preRender(t.effects,t);const i=this.lastPostProcessEffect?this.renderBuffers[0]:t.target,r=e.render({...t,target:i});this._postRender(t.effects,t),this.renderCount++,at(zy,this,r,t)}needsRedraw(t={clearRedrawFlags:!1}){const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}finalize(){const{renderBuffers:t}=this;for(const e of t)e.delete();t.length=0}_preRender(t,e){let i=null;for(const r of t)r.preRender(this.gl,e),r.postRender&&(i=r);i&&this._resizeRenderBuffers(),this.lastPostProcessEffect=i}_resizeRenderBuffers(){const{renderBuffers:t}=this;t.length===0&&t.push(new Q(this.gl),new Q(this.gl));for(const e of t)e.resize()}_postRender(t,e){const{renderBuffers:i}=this,r={inputBuffer:i[0],swapBuffer:i[1],target:null};for(const s of t)if(s.postRender){if(s===this.lastPostProcessEffect){r.target=e.target,s.postRender(this.gl,r);break}const o=s.postRender(this.gl,r);r.inputBuffer=o,r.swapBuffer=o===i[0]?i[1]:i[0]}}}const Hy={pickedColor:null,pickedObjectIndex:-1};function Wy({pickedColors:n,decodePickingColor:t,deviceX:e,deviceY:i,deviceRadius:r,deviceRect:s}){const{x:o,y:a,width:c,height:l}=s;let u=r*r,h=-1,g=0;for(let m=0;m<l;m++){const b=m+a-i,y=b*b;if(y>u)g+=4*c;else for(let E=0;E<c;E++){if(n[g+3]-1>=0){const A=E+o-e,S=A*A+y;S<=u&&(u=S,h=g)}g+=4}}if(h>=0){const m=n.slice(h,h+4),b=t(m);if(b){const y=Math.floor(h/4/c),E=h/4-y*c;return{...b,pickedColor:m,pickedX:o+E,pickedY:a+y}}H.error("Picked non-existent layer. Is picking buffer corrupt?")()}return Hy}function Xy({pickedColors:n,decodePickingColor:t}){const e=new Map;if(n){for(let i=0;i<n.length;i+=4)if(n[i+3]-1>=0){const s=n.slice(i,i+4),o=s.join(",");if(!e.has(o)){const a=t(s);a?e.set(o,{...a,color:s}):H.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(e.values())}function Wl({pickInfo:n,viewports:t,pixelRatio:e,x:i,y:r,z:s}){let o=t[0];t.length>1&&(o=qy((n==null?void 0:n.pickedViewports)||t,{x:i,y:r}));let a;if(o){const c=[i-o.x,r-o.y];s!==void 0&&(c[2]=s),a=o.unproject(c)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:i,y:r,pixel:[i,r],coordinate:a,devicePixel:n&&"pickedX"in n?[n.pickedX,n.pickedY]:void 0,pixelRatio:e}}function Yy(n){const{pickInfo:t,lastPickedInfo:e,mode:i,layers:r}=n,{pickedColor:s,pickedLayer:o,pickedObjectIndex:a}=t,c=o?[o]:[];if(i==="hover"){const h=e.index,g=e.layerId,m=o?o.props.id:null;if(m!==g||a!==h){if(m!==g){const b=r.find(y=>y.props.id===g);b&&c.unshift(b)}e.layerId=m,e.index=a,e.info=null}}const l=Wl(n),u=new Map;return u.set(null,l),c.forEach(h=>{let g={...l};h===o&&(g.color=s,g.index=a,g.picked=!0),g=Xl({layer:h,info:g,mode:i});const m=g.layer;h===o&&i==="hover"&&(e.info=g),u.set(m.id,g),i==="hover"&&m.updateAutoHighlight(g)}),u}function Xl({layer:n,info:t,mode:e}){for(;n&&t;){const i=t.layer||null;t.sourceLayer=i,t.layer=n,t=n.getPickingInfo({info:t,mode:e,sourceLayer:i}),n=n.parent}return t}function qy(n,t){for(let e=n.length-1;e>=0;e--){const i=n[e];if(i.containsPixel(t))return i}return n[0]}class Zy{constructor(t){f(this,"gl",void 0),f(this,"pickingFBO",void 0),f(this,"depthFBO",void 0),f(this,"pickLayersPass",void 0),f(this,"layerFilter",void 0),f(this,"lastPickedInfo",void 0),f(this,"_pickable",!0),this.gl=t,this.pickLayersPass=new Hl(t),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(t){"layerFilter"in t&&(this.layerFilter=t.layerFilter),"_pickable"in t&&(this._pickable=t._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(t){return this._pickClosestObject(t)}pickObjects(t){return this._pickVisibleObjects(t)}getLastPickedObject({x:t,y:e,layers:i,viewports:r},s=this.lastPickedInfo.info){const o=s&&s.layer&&s.layer.id,a=s&&s.viewport&&s.viewport.id,c=o?i.find(g=>g.id===o):null,l=a&&r.find(g=>g.id===a)||r[0],u=l&&l.unproject([t-l.x,e-l.y]);return{...s,...{x:t,y:e,viewport:l,coordinate:u,layer:c}}}_resizeBuffer(){var t,e;const{gl:i}=this;if(!this.pickingFBO&&(this.pickingFBO=new Q(i),Q.isSupported(i,{colorBufferFloat:!0}))){const r=new Q(i);r.attach({[36064]:new Tt(i,{format:j(i)?34836:6408,type:5126})}),this.depthFBO=r}(t=this.pickingFBO)===null||t===void 0||t.resize({width:i.canvas.width,height:i.canvas.height}),(e=this.depthFBO)===null||e===void 0||e.resize({width:i.canvas.width,height:i.canvas.height})}_getPickable(t){if(this._pickable===!1)return null;const e=t.filter(i=>i.isPickable()&&!i.isComposite);return e.length?e:null}_pickClosestObject({layers:t,views:e,viewports:i,x:r,y:s,radius:o=0,depth:a=1,mode:c="query",unproject3D:l,onViewportActive:u,effects:h}){const g=this._getPickable(t),m=Be(this.gl);if(!g)return{result:[],emptyInfo:Wl({viewports:i,x:r,y:s,pixelRatio:m})};this._resizeBuffer();const b=pr(this.gl,[r,s],!0),y=[b.x+Math.floor(b.width/2),b.y+Math.floor(b.height/2)],E=Math.round(o*m),{width:T,height:A}=this.pickingFBO,S=this._getPickingRect({deviceX:y[0],deviceY:y[1],deviceRadius:E,deviceWidth:T,deviceHeight:A}),x={x:r-o,y:s-o,width:o*2+1,height:o*2+1};let M;const R=[],N=new Set;for(let B=0;B<a;B++){let k;if(S){const F=this._drawAndSample({layers:g,views:e,viewports:i,onViewportActive:u,deviceRect:S,cullRect:x,effects:h,pass:"picking:".concat(c)});k=Wy({...F,deviceX:y[0],deviceY:y[1],deviceRadius:E,deviceRect:S})}else k={pickedColor:null,pickedObjectIndex:-1};let D;k.pickedLayer&&l&&this.depthFBO&&(D=this._drawAndSample({layers:[k.pickedLayer],views:e,viewports:i,onViewportActive:u,deviceRect:{x:k.pickedX,y:k.pickedY,width:1,height:1},cullRect:x,effects:h,pass:"picking:".concat(c,":z")},!0).pickedColors[0]),k.pickedLayer&&B+1<a&&(N.add(k.pickedLayer),k.pickedLayer.disablePickingIndex(k.pickedObjectIndex)),M=Yy({pickInfo:k,lastPickedInfo:this.lastPickedInfo,mode:c,layers:g,viewports:i,x:r,y:s,z:D,pixelRatio:m});for(const F of M.values())F.layer&&R.push(F);if(!k.pickedColor)break}for(const B of N)B.restorePickingColors();return{result:R,emptyInfo:M.get(null)}}_pickVisibleObjects({layers:t,views:e,viewports:i,x:r,y:s,width:o=1,height:a=1,mode:c="query",maxObjects:l=null,onViewportActive:u,effects:h}){const g=this._getPickable(t);if(!g)return[];this._resizeBuffer();const m=Be(this.gl),b=pr(this.gl,[r,s],!0),y=b.x,E=b.y+b.height,T=pr(this.gl,[r+o,s+a],!0),A=T.x+T.width,S=T.y,x={x:y,y:S,width:A-y,height:E-S},M=this._drawAndSample({layers:g,views:e,viewports:i,onViewportActive:u,deviceRect:x,cullRect:{x:r,y:s,width:o,height:a},effects:h,pass:"picking:".concat(c)}),R=Xy(M),N=new Map,B=Number.isFinite(l);for(let k=0;k<R.length&&!(B&&l&&N.size>=l);k++){const D=R[k];let F={color:D.pickedColor,layer:null,index:D.pickedObjectIndex,picked:!0,x:r,y:s,pixelRatio:m};F=Xl({layer:D.pickedLayer,info:F,mode:c}),N.has(F.object)||N.set(F.object,F)}return Array.from(N.values())}_drawAndSample({layers:t,views:e,viewports:i,onViewportActive:r,deviceRect:s,cullRect:o,effects:a,pass:c},l=!1){const u=l?this.depthFBO:this.pickingFBO,{decodePickingColor:h}=this.pickLayersPass.render({layers:t,layerFilter:this.layerFilter,views:e,viewports:i,onViewportActive:r,pickingFBO:u,deviceRect:s,cullRect:o,effects:a,pass:c,pickZ:l}),{x:g,y:m,width:b,height:y}=s,E=new(l?Float32Array:Uint8Array)(b*y*4);return Ui(u,{sourceX:g,sourceY:m,sourceWidth:b,sourceHeight:y,target:E}),{pickedColors:E,decodePickingColor:h}}_getPickingRect({deviceX:t,deviceY:e,deviceRadius:i,deviceWidth:r,deviceHeight:s}){const o=Math.max(0,t-i),a=Math.max(0,e-i),c=Math.min(r,t+i+1)-o,l=Math.min(s,e+i+1)-a;return c<=0||l<=0?null:{x:o,y:a,width:c,height:l}}}const $y={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class Ky{constructor(t){f(this,"el",null),f(this,"isVisible",!1);const e=t.parentElement;e&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,$y),e.appendChild(this.el))}setTooltip(t,e,i){const r=this.el;if(!!r){if(typeof t=="string")r.innerText=t;else if(t)t.text&&(r.innerText=t.text),t.html&&(r.innerHTML=t.html),t.className&&(r.className=t.className),Object.assign(r.style,t.style);else{this.isVisible=!1,r.style.display="none";return}this.isVisible=!0,r.style.display="block",r.style.transform="translate(".concat(e,"px, ").concat(i,"px)")}}remove(){this.el&&(this.el.remove(),this.el=null)}}var $e={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(n){(function(t,e,i,r){var s=["","webkit","Moz","MS","ms","o"],o=e.createElement("div"),a="function",c=Math.round,l=Math.abs,u=Date.now;function h(d,p,_){return setTimeout(S(d,_),p)}function g(d,p,_){return Array.isArray(d)?(m(d,_[p],_),!0):!1}function m(d,p,_){var v;if(!!d)if(d.forEach)d.forEach(p,_);else if(d.length!==r)for(v=0;v<d.length;)p.call(_,d[v],v,d),v++;else for(v in d)d.hasOwnProperty(v)&&p.call(_,d[v],v,d)}function b(d,p,_){var v="DEPRECATED METHOD: "+p+`
`+_+` AT 
`;return function(){var P=new Error("get-stack-trace"),I=P&&P.stack?P.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",V=t.console&&(t.console.warn||t.console.log);return V&&V.call(t.console,v,I),d.apply(this,arguments)}}var y;typeof Object.assign!="function"?y=function(p){if(p===r||p===null)throw new TypeError("Cannot convert undefined or null to object");for(var _=Object(p),v=1;v<arguments.length;v++){var P=arguments[v];if(P!==r&&P!==null)for(var I in P)P.hasOwnProperty(I)&&(_[I]=P[I])}return _}:y=Object.assign;var E=b(function(p,_,v){for(var P=Object.keys(_),I=0;I<P.length;)(!v||v&&p[P[I]]===r)&&(p[P[I]]=_[P[I]]),I++;return p},"extend","Use `assign`."),T=b(function(p,_){return E(p,_,!0)},"merge","Use `assign`.");function A(d,p,_){var v=p.prototype,P;P=d.prototype=Object.create(v),P.constructor=d,P._super=v,_&&y(P,_)}function S(d,p){return function(){return d.apply(p,arguments)}}function x(d,p){return typeof d==a?d.apply(p&&p[0]||r,p):d}function M(d,p){return d===r?p:d}function R(d,p,_){m(D(p),function(v){d.addEventListener(v,_,!1)})}function N(d,p,_){m(D(p),function(v){d.removeEventListener(v,_,!1)})}function B(d,p){for(;d;){if(d==p)return!0;d=d.parentNode}return!1}function k(d,p){return d.indexOf(p)>-1}function D(d){return d.trim().split(/\s+/g)}function F(d,p,_){if(d.indexOf&&!_)return d.indexOf(p);for(var v=0;v<d.length;){if(_&&d[v][_]==p||!_&&d[v]===p)return v;v++}return-1}function J(d){return Array.prototype.slice.call(d,0)}function et(d,p,_){for(var v=[],P=[],I=0;I<d.length;){var V=p?d[I][p]:d[I];F(P,V)<0&&v.push(d[I]),P[I]=V,I++}return _&&(p?v=v.sort(function(it,ut){return it[p]>ut[p]}):v=v.sort()),v}function z(d,p){for(var _,v,P=p[0].toUpperCase()+p.slice(1),I=0;I<s.length;){if(_=s[I],v=_?_+P:p,v in d)return v;I++}return r}var le=1;function gu(){return le++}function Hs(d){var p=d.ownerDocument||d;return p.defaultView||p.parentWindow||t}var pu=/mobile|tablet|ip(ad|hone|od)|android/i,Ws="ontouchstart"in t,mu=z(t,"PointerEvent")!==r,_u=Ws&&pu.test(navigator.userAgent),Ke="touch",bu="pen",Yi="mouse",yu="kinect",Eu=25,lt=1,ue=2,K=4,dt=8,Dn=1,Qe=2,Je=4,tn=8,en=16,Ct=Qe|Je,he=tn|en,Xs=Ct|he,Ys=["x","y"],Fn=["clientX","clientY"];function wt(d,p){var _=this;this.manager=d,this.callback=p,this.element=d.element,this.target=d.options.inputTarget,this.domHandler=function(v){x(d.options.enable,[d])&&_.handler(v)},this.init()}wt.prototype={handler:function(){},init:function(){this.evEl&&R(this.element,this.evEl,this.domHandler),this.evTarget&&R(this.target,this.evTarget,this.domHandler),this.evWin&&R(Hs(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&N(this.element,this.evEl,this.domHandler),this.evTarget&&N(this.target,this.evTarget,this.domHandler),this.evWin&&N(Hs(this.element),this.evWin,this.domHandler)}};function vu(d){var p,_=d.options.inputClass;return _?p=_:mu?p=Zi:_u?p=Vn:Ws?p=$i:p=Bn,new p(d,Tu)}function Tu(d,p,_){var v=_.pointers.length,P=_.changedPointers.length,I=p&lt&&v-P===0,V=p&(K|dt)&&v-P===0;_.isFirst=!!I,_.isFinal=!!V,I&&(d.session={}),_.eventType=p,wu(d,_),d.emit("hammer.input",_),d.recognize(_),d.session.prevInput=_}function wu(d,p){var _=d.session,v=p.pointers,P=v.length;_.firstInput||(_.firstInput=qs(p)),P>1&&!_.firstMultiple?_.firstMultiple=qs(p):P===1&&(_.firstMultiple=!1);var I=_.firstInput,V=_.firstMultiple,nt=V?V.center:I.center,it=p.center=Zs(v);p.timeStamp=u(),p.deltaTime=p.timeStamp-I.timeStamp,p.angle=qi(nt,it),p.distance=Un(nt,it),Au(_,p),p.offsetDirection=Ks(p.deltaX,p.deltaY);var ut=$s(p.deltaTime,p.deltaX,p.deltaY);p.overallVelocityX=ut.x,p.overallVelocityY=ut.y,p.overallVelocity=l(ut.x)>l(ut.y)?ut.x:ut.y,p.scale=V?Pu(V.pointers,v):1,p.rotation=V?xu(V.pointers,v):0,p.maxPointers=_.prevInput?p.pointers.length>_.prevInput.maxPointers?p.pointers.length:_.prevInput.maxPointers:p.pointers.length,Su(_,p);var kt=d.element;B(p.srcEvent.target,kt)&&(kt=p.srcEvent.target),p.target=kt}function Au(d,p){var _=p.center,v=d.offsetDelta||{},P=d.prevDelta||{},I=d.prevInput||{};(p.eventType===lt||I.eventType===K)&&(P=d.prevDelta={x:I.deltaX||0,y:I.deltaY||0},v=d.offsetDelta={x:_.x,y:_.y}),p.deltaX=P.x+(_.x-v.x),p.deltaY=P.y+(_.y-v.y)}function Su(d,p){var _=d.lastInterval||p,v=p.timeStamp-_.timeStamp,P,I,V,nt;if(p.eventType!=dt&&(v>Eu||_.velocity===r)){var it=p.deltaX-_.deltaX,ut=p.deltaY-_.deltaY,kt=$s(v,it,ut);I=kt.x,V=kt.y,P=l(kt.x)>l(kt.y)?kt.x:kt.y,nt=Ks(it,ut),d.lastInterval=p}else P=_.velocity,I=_.velocityX,V=_.velocityY,nt=_.direction;p.velocity=P,p.velocityX=I,p.velocityY=V,p.direction=nt}function qs(d){for(var p=[],_=0;_<d.pointers.length;)p[_]={clientX:c(d.pointers[_].clientX),clientY:c(d.pointers[_].clientY)},_++;return{timeStamp:u(),pointers:p,center:Zs(p),deltaX:d.deltaX,deltaY:d.deltaY}}function Zs(d){var p=d.length;if(p===1)return{x:c(d[0].clientX),y:c(d[0].clientY)};for(var _=0,v=0,P=0;P<p;)_+=d[P].clientX,v+=d[P].clientY,P++;return{x:c(_/p),y:c(v/p)}}function $s(d,p,_){return{x:p/d||0,y:_/d||0}}function Ks(d,p){return d===p?Dn:l(d)>=l(p)?d<0?Qe:Je:p<0?tn:en}function Un(d,p,_){_||(_=Ys);var v=p[_[0]]-d[_[0]],P=p[_[1]]-d[_[1]];return Math.sqrt(v*v+P*P)}function qi(d,p,_){_||(_=Ys);var v=p[_[0]]-d[_[0]],P=p[_[1]]-d[_[1]];return Math.atan2(P,v)*180/Math.PI}function xu(d,p){return qi(p[1],p[0],Fn)+qi(d[1],d[0],Fn)}function Pu(d,p){return Un(p[0],p[1],Fn)/Un(d[0],d[1],Fn)}var Mu={mousedown:lt,mousemove:ue,mouseup:K},Lu="mousedown",Ru="mousemove mouseup";function Bn(){this.evEl=Lu,this.evWin=Ru,this.pressed=!1,wt.apply(this,arguments)}A(Bn,wt,{handler:function(p){var _=Mu[p.type];_&lt&&p.button===0&&(this.pressed=!0),_&ue&&p.which!==1&&(_=K),this.pressed&&(_&K&&(this.pressed=!1),this.callback(this.manager,_,{pointers:[p],changedPointers:[p],pointerType:Yi,srcEvent:p}))}});var Iu={pointerdown:lt,pointermove:ue,pointerup:K,pointercancel:dt,pointerout:dt},Cu={2:Ke,3:bu,4:Yi,5:yu},Qs="pointerdown",Js="pointermove pointerup pointercancel";t.MSPointerEvent&&!t.PointerEvent&&(Qs="MSPointerDown",Js="MSPointerMove MSPointerUp MSPointerCancel");function Zi(){this.evEl=Qs,this.evWin=Js,wt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}A(Zi,wt,{handler:function(p){var _=this.store,v=!1,P=p.type.toLowerCase().replace("ms",""),I=Iu[P],V=Cu[p.pointerType]||p.pointerType,nt=V==Ke,it=F(_,p.pointerId,"pointerId");I&lt&&(p.button===0||nt)?it<0&&(_.push(p),it=_.length-1):I&(K|dt)&&(v=!0),!(it<0)&&(_[it]=p,this.callback(this.manager,I,{pointers:_,changedPointers:[p],pointerType:V,srcEvent:p}),v&&_.splice(it,1))}});var Ou={touchstart:lt,touchmove:ue,touchend:K,touchcancel:dt},ku="touchstart",Nu="touchstart touchmove touchend touchcancel";function to(){this.evTarget=ku,this.evWin=Nu,this.started=!1,wt.apply(this,arguments)}A(to,wt,{handler:function(p){var _=Ou[p.type];if(_===lt&&(this.started=!0),!!this.started){var v=Du.call(this,p,_);_&(K|dt)&&v[0].length-v[1].length===0&&(this.started=!1),this.callback(this.manager,_,{pointers:v[0],changedPointers:v[1],pointerType:Ke,srcEvent:p})}}});function Du(d,p){var _=J(d.touches),v=J(d.changedTouches);return p&(K|dt)&&(_=et(_.concat(v),"identifier",!0)),[_,v]}var Fu={touchstart:lt,touchmove:ue,touchend:K,touchcancel:dt},Uu="touchstart touchmove touchend touchcancel";function Vn(){this.evTarget=Uu,this.targetIds={},wt.apply(this,arguments)}A(Vn,wt,{handler:function(p){var _=Fu[p.type],v=Bu.call(this,p,_);!v||this.callback(this.manager,_,{pointers:v[0],changedPointers:v[1],pointerType:Ke,srcEvent:p})}});function Bu(d,p){var _=J(d.touches),v=this.targetIds;if(p&(lt|ue)&&_.length===1)return v[_[0].identifier]=!0,[_,_];var P,I,V=J(d.changedTouches),nt=[],it=this.target;if(I=_.filter(function(ut){return B(ut.target,it)}),p===lt)for(P=0;P<I.length;)v[I[P].identifier]=!0,P++;for(P=0;P<V.length;)v[V[P].identifier]&&nt.push(V[P]),p&(K|dt)&&delete v[V[P].identifier],P++;if(!!nt.length)return[et(I.concat(nt),"identifier",!0),nt]}var Vu=2500,eo=25;function $i(){wt.apply(this,arguments);var d=S(this.handler,this);this.touch=new Vn(this.manager,d),this.mouse=new Bn(this.manager,d),this.primaryTouch=null,this.lastTouches=[]}A($i,wt,{handler:function(p,_,v){var P=v.pointerType==Ke,I=v.pointerType==Yi;if(!(I&&v.sourceCapabilities&&v.sourceCapabilities.firesTouchEvents)){if(P)ju.call(this,_,v);else if(I&&zu.call(this,v))return;this.callback(p,_,v)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function ju(d,p){d&lt?(this.primaryTouch=p.changedPointers[0].identifier,no.call(this,p)):d&(K|dt)&&no.call(this,p)}function no(d){var p=d.changedPointers[0];if(p.identifier===this.primaryTouch){var _={x:p.clientX,y:p.clientY};this.lastTouches.push(_);var v=this.lastTouches,P=function(){var I=v.indexOf(_);I>-1&&v.splice(I,1)};setTimeout(P,Vu)}}function zu(d){for(var p=d.srcEvent.clientX,_=d.srcEvent.clientY,v=0;v<this.lastTouches.length;v++){var P=this.lastTouches[v],I=Math.abs(p-P.x),V=Math.abs(_-P.y);if(I<=eo&&V<=eo)return!0}return!1}var io=z(o.style,"touchAction"),ro=io!==r,so="compute",oo="auto",Ki="manipulation",fe="none",nn="pan-x",rn="pan-y",jn=Hu();function Qi(d,p){this.manager=d,this.set(p)}Qi.prototype={set:function(d){d==so&&(d=this.compute()),ro&&this.manager.element.style&&jn[d]&&(this.manager.element.style[io]=d),this.actions=d.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var d=[];return m(this.manager.recognizers,function(p){x(p.options.enable,[p])&&(d=d.concat(p.getTouchAction()))}),Gu(d.join(" "))},preventDefaults:function(d){var p=d.srcEvent,_=d.offsetDirection;if(this.manager.session.prevented){p.preventDefault();return}var v=this.actions,P=k(v,fe)&&!jn[fe],I=k(v,rn)&&!jn[rn],V=k(v,nn)&&!jn[nn];if(P){var nt=d.pointers.length===1,it=d.distance<2,ut=d.deltaTime<250;if(nt&&it&&ut)return}if(!(V&&I)&&(P||I&&_&Ct||V&&_&he))return this.preventSrc(p)},preventSrc:function(d){this.manager.session.prevented=!0,d.preventDefault()}};function Gu(d){if(k(d,fe))return fe;var p=k(d,nn),_=k(d,rn);return p&&_?fe:p||_?p?nn:rn:k(d,Ki)?Ki:oo}function Hu(){if(!ro)return!1;var d={},p=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(_){d[_]=p?t.CSS.supports("touch-action",_):!0}),d}var zn=1,At=2,we=4,Jt=8,jt=Jt,sn=16,Ot=32;function zt(d){this.options=y({},this.defaults,d||{}),this.id=gu(),this.manager=null,this.options.enable=M(this.options.enable,!0),this.state=zn,this.simultaneous={},this.requireFail=[]}zt.prototype={defaults:{},set:function(d){return y(this.options,d),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(d){if(g(d,"recognizeWith",this))return this;var p=this.simultaneous;return d=Gn(d,this),p[d.id]||(p[d.id]=d,d.recognizeWith(this)),this},dropRecognizeWith:function(d){return g(d,"dropRecognizeWith",this)?this:(d=Gn(d,this),delete this.simultaneous[d.id],this)},requireFailure:function(d){if(g(d,"requireFailure",this))return this;var p=this.requireFail;return d=Gn(d,this),F(p,d)===-1&&(p.push(d),d.requireFailure(this)),this},dropRequireFailure:function(d){if(g(d,"dropRequireFailure",this))return this;d=Gn(d,this);var p=F(this.requireFail,d);return p>-1&&this.requireFail.splice(p,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(d){return!!this.simultaneous[d.id]},emit:function(d){var p=this,_=this.state;function v(P){p.manager.emit(P,d)}_<Jt&&v(p.options.event+ao(_)),v(p.options.event),d.additionalEvent&&v(d.additionalEvent),_>=Jt&&v(p.options.event+ao(_))},tryEmit:function(d){if(this.canEmit())return this.emit(d);this.state=Ot},canEmit:function(){for(var d=0;d<this.requireFail.length;){if(!(this.requireFail[d].state&(Ot|zn)))return!1;d++}return!0},recognize:function(d){var p=y({},d);if(!x(this.options.enable,[this,p])){this.reset(),this.state=Ot;return}this.state&(jt|sn|Ot)&&(this.state=zn),this.state=this.process(p),this.state&(At|we|Jt|sn)&&this.tryEmit(p)},process:function(d){},getTouchAction:function(){},reset:function(){}};function ao(d){return d&sn?"cancel":d&Jt?"end":d&we?"move":d&At?"start":""}function co(d){return d==en?"down":d==tn?"up":d==Qe?"left":d==Je?"right":""}function Gn(d,p){var _=p.manager;return _?_.get(d):d}function Mt(){zt.apply(this,arguments)}A(Mt,zt,{defaults:{pointers:1},attrTest:function(d){var p=this.options.pointers;return p===0||d.pointers.length===p},process:function(d){var p=this.state,_=d.eventType,v=p&(At|we),P=this.attrTest(d);return v&&(_&dt||!P)?p|sn:v||P?_&K?p|Jt:p&At?p|we:At:Ot}});function Hn(){Mt.apply(this,arguments),this.pX=null,this.pY=null}A(Hn,Mt,{defaults:{event:"pan",threshold:10,pointers:1,direction:Xs},getTouchAction:function(){var d=this.options.direction,p=[];return d&Ct&&p.push(rn),d&he&&p.push(nn),p},directionTest:function(d){var p=this.options,_=!0,v=d.distance,P=d.direction,I=d.deltaX,V=d.deltaY;return P&p.direction||(p.direction&Ct?(P=I===0?Dn:I<0?Qe:Je,_=I!=this.pX,v=Math.abs(d.deltaX)):(P=V===0?Dn:V<0?tn:en,_=V!=this.pY,v=Math.abs(d.deltaY))),d.direction=P,_&&v>p.threshold&&P&p.direction},attrTest:function(d){return Mt.prototype.attrTest.call(this,d)&&(this.state&At||!(this.state&At)&&this.directionTest(d))},emit:function(d){this.pX=d.deltaX,this.pY=d.deltaY;var p=co(d.direction);p&&(d.additionalEvent=this.options.event+p),this._super.emit.call(this,d)}});function Ji(){Mt.apply(this,arguments)}A(Ji,Mt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[fe]},attrTest:function(d){return this._super.attrTest.call(this,d)&&(Math.abs(d.scale-1)>this.options.threshold||this.state&At)},emit:function(d){if(d.scale!==1){var p=d.scale<1?"in":"out";d.additionalEvent=this.options.event+p}this._super.emit.call(this,d)}});function tr(){zt.apply(this,arguments),this._timer=null,this._input=null}A(tr,zt,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[oo]},process:function(d){var p=this.options,_=d.pointers.length===p.pointers,v=d.distance<p.threshold,P=d.deltaTime>p.time;if(this._input=d,!v||!_||d.eventType&(K|dt)&&!P)this.reset();else if(d.eventType&lt)this.reset(),this._timer=h(function(){this.state=jt,this.tryEmit()},p.time,this);else if(d.eventType&K)return jt;return Ot},reset:function(){clearTimeout(this._timer)},emit:function(d){this.state===jt&&(d&&d.eventType&K?this.manager.emit(this.options.event+"up",d):(this._input.timeStamp=u(),this.manager.emit(this.options.event,this._input)))}});function er(){Mt.apply(this,arguments)}A(er,Mt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[fe]},attrTest:function(d){return this._super.attrTest.call(this,d)&&(Math.abs(d.rotation)>this.options.threshold||this.state&At)}});function nr(){Mt.apply(this,arguments)}A(nr,Mt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Ct|he,pointers:1},getTouchAction:function(){return Hn.prototype.getTouchAction.call(this)},attrTest:function(d){var p=this.options.direction,_;return p&(Ct|he)?_=d.overallVelocity:p&Ct?_=d.overallVelocityX:p&he&&(_=d.overallVelocityY),this._super.attrTest.call(this,d)&&p&d.offsetDirection&&d.distance>this.options.threshold&&d.maxPointers==this.options.pointers&&l(_)>this.options.velocity&&d.eventType&K},emit:function(d){var p=co(d.offsetDirection);p&&this.manager.emit(this.options.event+p,d),this.manager.emit(this.options.event,d)}});function Wn(){zt.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}A(Wn,zt,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Ki]},process:function(d){var p=this.options,_=d.pointers.length===p.pointers,v=d.distance<p.threshold,P=d.deltaTime<p.time;if(this.reset(),d.eventType&lt&&this.count===0)return this.failTimeout();if(v&&P&&_){if(d.eventType!=K)return this.failTimeout();var I=this.pTime?d.timeStamp-this.pTime<p.interval:!0,V=!this.pCenter||Un(this.pCenter,d.center)<p.posThreshold;this.pTime=d.timeStamp,this.pCenter=d.center,!V||!I?this.count=1:this.count+=1,this._input=d;var nt=this.count%p.taps;if(nt===0)return this.hasRequireFailures()?(this._timer=h(function(){this.state=jt,this.tryEmit()},p.interval,this),At):jt}return Ot},failTimeout:function(){return this._timer=h(function(){this.state=Ot},this.options.interval,this),Ot},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==jt&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Gt(d,p){return p=p||{},p.recognizers=M(p.recognizers,Gt.defaults.preset),new ir(d,p)}Gt.VERSION="2.0.7",Gt.defaults={domEvents:!1,touchAction:so,enable:!0,inputTarget:null,inputClass:null,preset:[[er,{enable:!1}],[Ji,{enable:!1},["rotate"]],[nr,{direction:Ct}],[Hn,{direction:Ct},["swipe"]],[Wn],[Wn,{event:"doubletap",taps:2},["tap"]],[tr]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Wu=1,lo=2;function ir(d,p){this.options=y({},Gt.defaults,p||{}),this.options.inputTarget=this.options.inputTarget||d,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=d,this.input=vu(this),this.touchAction=new Qi(this,this.options.touchAction),uo(this,!0),m(this.options.recognizers,function(_){var v=this.add(new _[0](_[1]));_[2]&&v.recognizeWith(_[2]),_[3]&&v.requireFailure(_[3])},this)}ir.prototype={set:function(d){return y(this.options,d),d.touchAction&&this.touchAction.update(),d.inputTarget&&(this.input.destroy(),this.input.target=d.inputTarget,this.input.init()),this},stop:function(d){this.session.stopped=d?lo:Wu},recognize:function(d){var p=this.session;if(!p.stopped){this.touchAction.preventDefaults(d);var _,v=this.recognizers,P=p.curRecognizer;(!P||P&&P.state&jt)&&(P=p.curRecognizer=null);for(var I=0;I<v.length;)_=v[I],p.stopped!==lo&&(!P||_==P||_.canRecognizeWith(P))?_.recognize(d):_.reset(),!P&&_.state&(At|we|Jt)&&(P=p.curRecognizer=_),I++}},get:function(d){if(d instanceof zt)return d;for(var p=this.recognizers,_=0;_<p.length;_++)if(p[_].options.event==d)return p[_];return null},add:function(d){if(g(d,"add",this))return this;var p=this.get(d.options.event);return p&&this.remove(p),this.recognizers.push(d),d.manager=this,this.touchAction.update(),d},remove:function(d){if(g(d,"remove",this))return this;if(d=this.get(d),d){var p=this.recognizers,_=F(p,d);_!==-1&&(p.splice(_,1),this.touchAction.update())}return this},on:function(d,p){if(d!==r&&p!==r){var _=this.handlers;return m(D(d),function(v){_[v]=_[v]||[],_[v].push(p)}),this}},off:function(d,p){if(d!==r){var _=this.handlers;return m(D(d),function(v){p?_[v]&&_[v].splice(F(_[v],p),1):delete _[v]}),this}},emit:function(d,p){this.options.domEvents&&Xu(d,p);var _=this.handlers[d]&&this.handlers[d].slice();if(!(!_||!_.length)){p.type=d,p.preventDefault=function(){p.srcEvent.preventDefault()};for(var v=0;v<_.length;)_[v](p),v++}},destroy:function(){this.element&&uo(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function uo(d,p){var _=d.element;if(!!_.style){var v;m(d.options.cssProps,function(P,I){v=z(_.style,I),p?(d.oldCssProps[v]=_.style[v],_.style[v]=P):_.style[v]=d.oldCssProps[v]||""}),p||(d.oldCssProps={})}}function Xu(d,p){var _=e.createEvent("Event");_.initEvent(d,!0,!0),_.gesture=p,p.target.dispatchEvent(_)}y(Gt,{INPUT_START:lt,INPUT_MOVE:ue,INPUT_END:K,INPUT_CANCEL:dt,STATE_POSSIBLE:zn,STATE_BEGAN:At,STATE_CHANGED:we,STATE_ENDED:Jt,STATE_RECOGNIZED:jt,STATE_CANCELLED:sn,STATE_FAILED:Ot,DIRECTION_NONE:Dn,DIRECTION_LEFT:Qe,DIRECTION_RIGHT:Je,DIRECTION_UP:tn,DIRECTION_DOWN:en,DIRECTION_HORIZONTAL:Ct,DIRECTION_VERTICAL:he,DIRECTION_ALL:Xs,Manager:ir,Input:wt,TouchAction:Qi,TouchInput:Vn,MouseInput:Bn,PointerEventInput:Zi,TouchMouseInput:$i,SingleTouchInput:to,Recognizer:zt,AttrRecognizer:Mt,Tap:Wn,Pan:Hn,Swipe:nr,Pinch:Ji,Rotate:er,Press:tr,on:R,off:N,each:m,merge:T,extend:E,assign:y,inherit:A,bindFn:S,prefixed:z});var Yu=typeof t<"u"?t:typeof self<"u"?self:{};Yu.Hammer=Gt,typeof r=="function"&&r.amd?r(function(){return Gt}):n.exports?n.exports=Gt:t[i]=Gt})(window,document,"Hammer")})($e);const Qy=$e.exports,Dt=Ph({__proto__:null,default:Qy},[$e.exports]),Yl=1,ql=2,os=4,Jy={mousedown:Yl,mousemove:ql,mouseup:os};function tE(n,t){for(let e=0;e<n.length;e++)if(t(n[e]))return!0;return!1}function eE(n){const t=n.prototype.handler;n.prototype.handler=function(i){const r=this.store;i.button>0&&i.type==="pointerdown"&&(tE(r,s=>s.pointerId===i.pointerId)||r.push(i)),t.call(this,i)}}function nE(n){n.prototype.handler=function(e){let i=Jy[e.type];i&Yl&&e.button>=0&&(this.pressed=!0),i&ql&&e.which===0&&(i=os),this.pressed&&(i&os&&(this.pressed=!1),this.callback(this.manager,i,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))}}eE($e.exports.PointerEventInput);nE($e.exports.MouseInput);const iE=$e.exports.Manager;class zi{constructor(t,e,i){this.element=t,this.callback=e,this.options={enable:!0,...i}}}const rE=Dt?[[Dt.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Dt.Rotate,{enable:!1}],[Dt.Pinch,{enable:!1}],[Dt.Swipe,{enable:!1}],[Dt.Pan,{threshold:0,enable:!1}],[Dt.Press,{enable:!1}],[Dt.Tap,{event:"doubletap",taps:2,enable:!1}],[Dt.Tap,{event:"anytap",enable:!1}],[Dt.Tap,{enable:!1}]]:null,Va={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},sE={doubletap:["tap"]},oE={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},Fs={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},aE={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},ja={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},cE=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Oe=typeof window<"u"?window:global;let as=!1;try{const n={get passive(){return as=!0,!0}};Oe.addEventListener("test",null,n),Oe.removeEventListener("test",null)}catch{as=!1}const lE=cE.indexOf("firefox")!==-1,{WHEEL_EVENTS:uE}=Fs,za="wheel",Ga=4.000244140625,hE=40,fE=.25;class dE extends zi{constructor(t,e,i){super(t,e,i),this.handleEvent=r=>{if(!this.options.enable)return;let s=r.deltaY;Oe.WheelEvent&&(lE&&r.deltaMode===Oe.WheelEvent.DOM_DELTA_PIXEL&&(s/=Oe.devicePixelRatio),r.deltaMode===Oe.WheelEvent.DOM_DELTA_LINE&&(s*=hE)),s!==0&&s%Ga===0&&(s=Math.floor(s/Ga)),r.shiftKey&&s&&(s=s*fE),this.callback({type:za,center:{x:r.clientX,y:r.clientY},delta:-s,srcEvent:r,pointerType:"mouse",target:r.target})},this.events=(this.options.events||[]).concat(uE),this.events.forEach(r=>t.addEventListener(r,this.handleEvent,as?{passive:!1}:!1))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){t===za&&(this.options.enable=e)}}const{MOUSE_EVENTS:gE}=Fs,Ha="pointermove",Wa="pointerover",Xa="pointerout",Ya="pointerenter",qa="pointerleave";class pE extends zi{constructor(t,e,i){super(t,e,i),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:r}=this.options;this.enableMoveEvent=r,this.enableLeaveEvent=r,this.enableEnterEvent=r,this.enableOutEvent=r,this.enableOverEvent=r,this.events=(this.options.events||[]).concat(gE),this.events.forEach(s=>t.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){t===Ha&&(this.enableMoveEvent=e),t===Wa&&(this.enableOverEvent=e),t===Xa&&(this.enableOutEvent=e),t===Ya&&(this.enableEnterEvent=e),t===qa&&(this.enableLeaveEvent=e)}handleOverEvent(t){this.enableOverEvent&&t.type==="mouseover"&&this._emit(Wa,t)}handleOutEvent(t){this.enableOutEvent&&t.type==="mouseout"&&this._emit(Xa,t)}handleEnterEvent(t){this.enableEnterEvent&&t.type==="mouseenter"&&this._emit(Ya,t)}handleLeaveEvent(t){this.enableLeaveEvent&&t.type==="mouseleave"&&this._emit(qa,t)}handleMoveEvent(t){if(this.enableMoveEvent)switch(t.type){case"mousedown":t.button>=0&&(this.pressed=!0);break;case"mousemove":t.which===0&&(this.pressed=!1),this.pressed||this._emit(Ha,t);break;case"mouseup":this.pressed=!1;break}}_emit(t,e){this.callback({type:t,center:{x:e.clientX,y:e.clientY},srcEvent:e,pointerType:"mouse",target:e.target})}}const{KEY_EVENTS:mE}=Fs,Za="keydown",$a="keyup";class _E extends zi{constructor(t,e,i){super(t,e,i),this.handleEvent=r=>{const s=r.target||r.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&r.type==="keydown"&&this.callback({type:Za,srcEvent:r,key:r.key,target:r.target}),this.enableUpEvent&&r.type==="keyup"&&this.callback({type:$a,srcEvent:r,key:r.key,target:r.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(mE),t.tabIndex=this.options.tabIndex||0,t.style.outline="none",this.events.forEach(r=>t.addEventListener(r,this.handleEvent))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){t===Za&&(this.enableDownEvent=e),t===$a&&(this.enableUpEvent=e)}}const Ka="contextmenu";class bE extends zi{constructor(t,e,i){super(t,e,i),this.handleEvent=r=>{!this.options.enable||this.callback({type:Ka,center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})},t.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(t,e){t===Ka&&(this.options.enable=e)}}const cs=1,Mi=2,ls=4,yE={pointerdown:cs,pointermove:Mi,pointerup:ls,mousedown:cs,mousemove:Mi,mouseup:ls},EE=1,vE=2,TE=3,wE=0,AE=1,SE=2,xE=1,PE=2,ME=4;function LE(n){const t=yE[n.srcEvent.type];if(!t)return null;const{buttons:e,button:i,which:r}=n.srcEvent;let s=!1,o=!1,a=!1;return t===ls||t===Mi&&!Number.isFinite(e)?(s=r===EE,o=r===vE,a=r===TE):t===Mi?(s=Boolean(e&xE),o=Boolean(e&ME),a=Boolean(e&PE)):t===cs&&(s=i===wE,o=i===AE,a=i===SE),{leftButton:s,middleButton:o,rightButton:a}}function RE(n,t){const e=n.center;if(!e)return null;const i=t.getBoundingClientRect(),r=i.width/t.offsetWidth||1,s=i.height/t.offsetHeight||1,o={x:(e.x-i.left-t.clientLeft)/r,y:(e.y-i.top-t.clientTop)/s};return{center:e,offsetCenter:o}}const Cr={srcElement:"root",priority:0};class IE{constructor(t){this.handleEvent=e=>{if(this.isEmpty())return;const i=this._normalizeEvent(e);let r=e.srcEvent.target;for(;r&&r!==i.rootElement;){if(this._emit(i,r),i.handled)return;r=r.parentNode}this._emit(i,"root")},this.eventManager=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(t,e,i,r=!1,s=!1){const{handlers:o,handlersByElement:a}=this;let c=Cr;typeof i=="string"||i&&i.addEventListener?c={...Cr,srcElement:i}:i&&(c={...Cr,...i});let l=a.get(c.srcElement);l||(l=[],a.set(c.srcElement,l));const u={type:t,handler:e,srcElement:c.srcElement,priority:c.priority};r&&(u.once=!0),s&&(u.passive=!0),o.push(u),this._active=this._active||!u.passive;let h=l.length-1;for(;h>=0&&!(l[h].priority>=u.priority);)h--;l.splice(h+1,0,u)}remove(t,e){const{handlers:i,handlersByElement:r}=this;for(let s=i.length-1;s>=0;s--){const o=i[s];if(o.type===t&&o.handler===e){i.splice(s,1);const a=r.get(o.srcElement);a.splice(a.indexOf(o),1),a.length===0&&r.delete(o.srcElement)}}this._active=i.some(s=>!s.passive)}_emit(t,e){const i=this.handlersByElement.get(e);if(i){let r=!1;const s=()=>{t.handled=!0},o=()=>{t.handled=!0,r=!0},a=[];for(let c=0;c<i.length;c++){const{type:l,handler:u,once:h}=i[c];if(u({...t,type:l,stopPropagation:s,stopImmediatePropagation:o}),h&&a.push(i[c]),r)break}for(let c=0;c<a.length;c++){const{type:l,handler:u}=a[c];this.remove(l,u)}}}_normalizeEvent(t){const e=this.eventManager.getElement();return{...t,...LE(t),...RE(t,e),preventDefault:()=>{t.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:e}}}const CE={events:null,recognizers:null,recognizerOptions:{},Manager:iE,touchAction:"none",tabIndex:0};class OE{constructor(t=null,e){this._onBasicInput=r=>{const{srcEvent:s}=r,o=oE[s.type];o&&this.manager.emit(o,r)},this._onOtherEvent=r=>{this.manager.emit(r.type,r)},this.options={...CE,...e},this.events=new Map,this.setElement(t);const{events:i}=this.options;i&&this.on(i)}getElement(){return this.element}setElement(t){if(this.element&&this.destroy(),this.element=t,!t)return;const{options:e}=this,i=e.Manager;this.manager=new i(t,{touchAction:e.touchAction,recognizers:e.recognizers||rE}).on("hammer.input",this._onBasicInput),e.recognizers||Object.keys(Va).forEach(r=>{const s=this.manager.get(r);s&&Va[r].forEach(o=>{s.recognizeWith(o)})});for(const r in e.recognizerOptions){const s=this.manager.get(r);if(s){const o=e.recognizerOptions[r];delete o.enable,s.set(o)}}this.wheelInput=new dE(t,this._onOtherEvent,{enable:!1}),this.moveInput=new pE(t,this._onOtherEvent,{enable:!1}),this.keyInput=new _E(t,this._onOtherEvent,{enable:!1,tabIndex:e.tabIndex}),this.contextmenuInput=new bE(t,this._onOtherEvent,{enable:!1});for(const[r,s]of this.events)s.isEmpty()||(this._toggleRecognizer(s.recognizerName,!0),this.manager.on(r,s.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(t,e,i){this._addEventHandler(t,e,i,!1)}once(t,e,i){this._addEventHandler(t,e,i,!0)}watch(t,e,i){this._addEventHandler(t,e,i,!1,!0)}off(t,e){this._removeEventHandler(t,e)}_toggleRecognizer(t,e){const{manager:i}=this;if(!i)return;const r=i.get(t);if(r&&r.options.enable!==e){r.set({enable:e});const s=sE[t];s&&!this.options.recognizers&&s.forEach(o=>{const a=i.get(o);e?(a.requireFailure(t),r.dropRequireFailure(o)):a.dropRequireFailure(t)})}this.wheelInput.enableEventType(t,e),this.moveInput.enableEventType(t,e),this.keyInput.enableEventType(t,e),this.contextmenuInput.enableEventType(t,e)}_addEventHandler(t,e,i,r,s){if(typeof t!="string"){i=e;for(const u in t)this._addEventHandler(u,t[u],i,r,s);return}const{manager:o,events:a}=this,c=ja[t]||t;let l=a.get(c);l||(l=new IE(this),a.set(c,l),l.recognizerName=aE[c]||c,o&&o.on(c,l.handleEvent)),l.add(t,e,i,r,s),l.isEmpty()||this._toggleRecognizer(l.recognizerName,!0)}_removeEventHandler(t,e){if(typeof t!="string"){for(const o in t)this._removeEventHandler(o,t[o]);return}const{events:i}=this,r=ja[t]||t,s=i.get(r);if(!!s&&(s.remove(t,e),s.isEmpty())){const{recognizerName:o}=s;let a=!1;for(const c of i.values())if(c.recognizerName===o&&!c.isEmpty()){a=!0;break}a||this._toggleRecognizer(o,!1)}}}function pe(){}const kE=({isDragging:n})=>n?"grabbing":"grab",Zl={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:pe,onResize:pe,onViewStateChange:pe,onInteractionStateChange:pe,onBeforeRender:pe,onAfterRender:pe,onLoad:pe,onError:n=>H.error(n.message)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:kE,getTooltip:null,debug:!1,drawPickingColors:!1};class Gi{constructor(t){f(this,"props",void 0),f(this,"width",0),f(this,"height",0),f(this,"userData",{}),f(this,"canvas",null),f(this,"viewManager",null),f(this,"layerManager",null),f(this,"effectManager",null),f(this,"deckRenderer",null),f(this,"deckPicker",null),f(this,"eventManager",null),f(this,"tooltip",null),f(this,"metrics",void 0),f(this,"animationLoop",void 0),f(this,"stats",void 0),f(this,"viewState",void 0),f(this,"cursorState",void 0),f(this,"_needsRedraw",void 0),f(this,"_pickRequest",void 0),f(this,"_lastPointerDownInfo",null),f(this,"_metricsCounter",void 0),f(this,"_onPointerMove",e=>{const{_pickRequest:i}=this;if(e.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(e.leftButton||e.rightButton)return;{const r=e.offsetCenter;if(!r)return;i.x=r.x,i.y=r.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=e}),f(this,"_onEvent",e=>{const i=xa[e.type],r=e.offsetCenter;if(!i||!r||!this.layerManager)return;const s=this.layerManager.getLayers(),o=this.deckPicker.getLastPickedObject({x:r.x,y:r.y,layers:s,viewports:this.getViewports(r)},this._lastPointerDownInfo),{layer:a}=o,c=a&&(a[i.handler]||a.props[i.handler]),l=this.props[i.handler];let u=!1;c&&(u=c.call(a,o,e)),!u&&l&&l(o,e)}),f(this,"_onPointerDown",e=>{const i=e.offsetCenter,r=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=r.result[0]||r.emptyInfo}),this.props={...Zl,...t},t=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},t.viewState&&t.initialViewState&&H.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),xc()==="IE"&&H.warn("IE 11 is not supported")(),this.viewState=t.initialViewState,t.gl||typeof document<"u"&&(this.canvas=this._createCanvas(t)),this.animationLoop=this._createAnimationLoop(t),this.stats=new _s({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(t),t._typedArrayManagerProps&&wn.setOptions(t._typedArrayManagerProps),this.animationLoop.start()}finalize(){var t,e,i,r,s,o,a;if(this.animationLoop.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(t=this.layerManager)===null||t===void 0||t.finalize(),this.layerManager=null,(e=this.viewManager)===null||e===void 0||e.finalize(),this.viewManager=null,(i=this.effectManager)===null||i===void 0||i.finalize(),this.effectManager=null,(r=this.deckRenderer)===null||r===void 0||r.finalize(),this.deckRenderer=null,(s=this.deckPicker)===null||s===void 0||s.finalize(),this.deckPicker=null,(o=this.eventManager)===null||o===void 0||o.destroy(),this.eventManager=null,(a=this.tooltip)===null||a===void 0||a.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var c;(c=this.canvas.parentElement)===null||c===void 0||c.removeChild(this.canvas),this.canvas=null}}setProps(t){this.stats.get("setProps Time").timeStart(),"onLayerHover"in t&&H.removed("onLayerHover","onHover")(),"onLayerClick"in t&&H.removed("onLayerClick","onClick")(),t.initialViewState&&!Te(this.props.initialViewState,t.initialViewState)&&(this.viewState=t.initialViewState),Object.assign(this.props,t),this._setCanvasSize(this.props);const e=Object.create(this.props);Object.assign(e,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(e),this.layerManager&&(this.viewManager.setProps(e),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(e),this.effectManager.setProps(e),this.deckRenderer.setProps(e),this.deckPicker.setProps(e)),this.stats.get("setProps Time").timeEnd()}needsRedraw(t={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(t),r=this.layerManager.needsRedraw(t),s=this.effectManager.needsRedraw(t),o=this.deckRenderer.needsRedraw(t);return e=e||i||r||s||o,e}redraw(t){if(!this.layerManager)return;let e=this.needsRedraw({clearRedrawFlags:!0});e=t||e,e&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(e):this._drawLayers(e))}get isInitialized(){return this.viewManager!==null}getViews(){return st(this.viewManager),this.viewManager.views}getViewports(t){return st(this.viewManager),this.viewManager.getViewports(t)}pickObject(t){const e=this._pick("pickObject","pickObject Time",t).result;return e.length?e[0]:null}pickMultipleObjects(t){return t.depth=t.depth||10,this._pick("pickObject","pickMultipleObjects Time",t).result}pickObjects(t){return this._pick("pickObjects","pickObjects Time",t)}_addResources(t,e=!1){for(const i in t)this.layerManager.resourceManager.add({resourceId:i,data:t[i],forceUpdate:e})}_removeResources(t){for(const e of t)this.layerManager.resourceManager.remove(e)}_pick(t,e,i){st(this.deckPicker);const{stats:r}=this;r.get("Pick Count").incrementCount(),r.get(e).timeStart();const s=this.deckPicker[t]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return r.get(e).timeEnd(),s}_createCanvas(t){let e=t.canvas;return typeof e=="string"&&(e=document.getElementById(e),st(e)),e||(e=document.createElement("canvas"),e.id=t.id||"deckgl-overlay",(t.parent||document.body).appendChild(e)),Object.assign(e.style,t.style),e}_setCanvasSize(t){if(!this.canvas)return;const{width:e,height:i}=t;if(e||e===0){const s=Number.isFinite(e)?"".concat(e,"px"):e;this.canvas.style.width=s}if(i||i===0){var r;const s=Number.isFinite(i)?"".concat(i,"px"):i;this.canvas.style.position=((r=t.style)===null||r===void 0?void 0:r.position)||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){const{canvas:t}=this;if(!t)return;const e=t.clientWidth||t.width,i=t.clientHeight||t.height;if(e!==this.width||i!==this.height){var r;this.width=e,this.height=i,(r=this.viewManager)===null||r===void 0||r.setProps({width:e,height:i}),this.props.onResize({width:e,height:i})}}_createAnimationLoop(t){const{width:e,height:i,gl:r,glOptions:s,debug:o,onError:a,onBeforeRender:c,onAfterRender:l,useDevicePixels:u}=t;return new Fm({width:e,height:i,useDevicePixels:u,autoResizeViewport:!1,gl:r,onCreateContext:h=>Wc({...s,...h,canvas:this.canvas,debug:o,onContextLost:()=>this._onContextLost()}),onInitialize:h=>this._setGLContext(h.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:c,onAfterRender:l,onError:a})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let t=this.props.views||[new jl({id:"default-view"})];return t=Array.isArray(t)?t:[t],t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:t}=this.props;this.animationLoop&&t&&t(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:t}=this;if(t.event){const{result:i,emptyInfo:r}=this._pick("pickObject","pickObject Time",t);this.cursorState.isHovering=i.length>0;let s=r,o=!1;for(const a of i){var e;s=a,o=((e=a.layer)===null||e===void 0?void 0:e.onHover(a,t.event))||o}if(!o&&this.props.onHover&&this.props.onHover(s,t.event),this.props.getTooltip&&this.tooltip){const a=this.props.getTooltip(s);this.tooltip.setTooltip(a,s.x,s.y)}t.event=null}}_updateCursor(){const t=this.props.parent||this.canvas;t&&(t.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(t){if(this.layerManager)return;this.canvas||(this.canvas=t.canvas,As(t,{enable:!0,copyState:!0})),this.tooltip=new Ky(this.canvas),qt(t,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(t);const e=new Sl;e.play(),this.animationLoop.attachTimeline(e),this.eventManager=new OE(this.props.parent||t.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const r in xa)this.eventManager.on(r,this._onEvent);this.viewManager=new py({timeline:e,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new gy(t,{deck:this,stats:this.stats,viewport:i,timeline:e}),this.effectManager=new Uy,this.deckRenderer=new Gy(t),this.deckPicker=new Zy(t),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(t,e){const{gl:i}=this.layerManager.context;qt(i,this.props.parameters),this.props.onBeforeRender({gl:i}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",redrawReason:t,effects:this.effectManager.getEffects(),...e}),this.props.onAfterRender({gl:i})}_onRenderFrame(t){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),H.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(t){const e=this.props.onViewStateChange(t)||t.viewState;this.viewState&&(this.viewState={...this.viewState,[t.viewId]:e},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(t){this.cursorState.isDragging=t.isDragging||!1,this.props.onInteractionStateChange(t)}_getFrameStats(){const{stats:t}=this;t.get("frameRate").timeEnd(),t.get("frameRate").timeStart();const e=this.animationLoop.stats;t.get("GPU Time").addTime(e.get("GPU Time").lastTiming),t.get("CPU Time").addTime(e.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:t,stats:e}=this;t.fps=e.get("frameRate").getHz(),t.setPropsTime=e.get("setProps Time").time,t.updateAttributesTime=e.get("Update Attributes").time,t.framesRedrawn=e.get("Redraw Count").count,t.pickTime=e.get("pickObject Time").time+e.get("pickMultipleObjects Time").time+e.get("pickObjects Time").time,t.pickCount=e.get("Pick Count").count,t.gpuTime=e.get("GPU Time").time,t.cpuTime=e.get("CPU Time").time,t.gpuTimePerFrame=e.get("GPU Time").getAverageTime(),t.cpuTimePerFrame=e.get("CPU Time").getAverageTime();const i=_e.get("Memory Usage");t.bufferMemory=i.get("Buffer Memory").count,t.textureMemory=i.get("Texture Memory").count,t.renderbufferMemory=i.get("Renderbuffer Memory").count,t.gpuMemory=i.get("GPU Memory").count}}f(Gi,"defaultProps",Zl);f(Gi,"VERSION",zd.VERSION);class Or{constructor(t,e){f(this,"opts",void 0),f(this,"source",void 0),this.opts=e,this.source=t}get value(){return this.source.value}getValue(){const t=this.source.getBuffer(),e=this.getAccessor();if(t)return[t,e];const{value:i}=this.source,{size:r}=e;let s=i;if(i&&i.length!==r){s=new Float32Array(r);const o=e.elementOffset||0;for(let a=0;a<r;++a)s[a]=i[o+a]}return s}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function NE(n){switch(n){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function hi(n){return n.stride||n.size*n.bytesPerElement}function $l(n,t){t.offset&&H.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const e=hi(n),i=t.vertexOffset!==void 0?t.vertexOffset:n.vertexOffset||0,r=t.elementOffset||0,s=i*e+r*n.bytesPerElement+(n.offset||0);return{...t,offset:s,stride:e}}function DE(n,t){const e=$l(n,t);return{high:e,low:{...e,offset:e.offset+n.size*4}}}class FE{constructor(t,e,i){f(this,"gl",void 0),f(this,"id",void 0),f(this,"size",void 0),f(this,"settings",void 0),f(this,"value",void 0),f(this,"doublePrecision",void 0),f(this,"_buffer",void 0),f(this,"state",void 0),this.gl=t,this.id=e.id||"",this.size=e.size||1;const r=e.logicalType||e.type,s=r===5130;let{defaultValue:o}=e;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let a;s?a=5126:!r&&e.isIndexed?a=t&&dp(t,q.ELEMENT_INDEX_UINT32)?5125:5123:a=r||5126;let c=NE(r||a||5126);this.doublePrecision=s,s&&e.fp64===!1&&(c=Float32Array),this.value=null,this.settings={...e,defaultType:c,defaultValue:o,logicalType:r,type:a,size:this.size,bytesPerElement:c.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:t,type:e}=this.settings;this._buffer=new W(this.gl,{id:this.id,target:t?34963:34962,accessor:{type:e}})}return this._buffer}get byteOffset(){const t=this.getAccessor();return t.vertexOffset?t.vertexOffset*hi(t):0}get numInstances(){return this.state.numInstances}set numInstances(t){this.state.numInstances=t}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),wn.release(this.state.allocatedValue)}getShaderAttributes(t,e){if(this.doublePrecision){const i={},r=this.value instanceof Float64Array,s=DE(this.getAccessor(),e||{});return i[t]=new Or(this,s.high),i["".concat(t,"64Low")]=r?new Or(this,s.low):new Float32Array(this.size),i}if(e){const i=$l(this.getAccessor(),e);return{[t]:new Or(this,i)}}return{[t]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let t=null;if(this.state.constant&&this.value){const e=Array.from(this.value);t=[e,e]}else{const{value:e,numInstances:i,size:r}=this,s=i*r;if(e&&s&&e.length>=s){const o=new Array(r).fill(1/0),a=new Array(r).fill(-1/0);for(let c=0;c<s;)for(let l=0;l<r;l++){const u=e[c++];u<o[l]&&(o[l]=u),u>a[l]&&(a[l]=u)}t=[o,a]}}return this.state.bounds=t,t}setData(t){const{state:e}=this;let i;ArrayBuffer.isView(t)?i={value:t}:t instanceof W?i={buffer:t}:i=t;const r={...this.settings,...i};if(e.bufferAccessor=r,e.bounds=null,i.constant){let s=i.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!e.constant||!this._areValuesEqual(s,this.value)))return!1;e.externalBuffer=null,e.constant=!0,this.value=s}else if(i.buffer){const s=i.buffer;e.externalBuffer=s,e.constant=!1,this.value=i.value||null;const o=i.value instanceof Float64Array;r.type=i.type||s.accessor.type,r.bytesPerElement=s.accessor.BYTES_PER_ELEMENT*(o?2:1),r.stride=hi(r)}else if(i.value){this._checkExternalBuffer(i);let s=i.value;e.externalBuffer=null,e.constant=!1,this.value=s,r.bytesPerElement=s.BYTES_PER_ELEMENT,r.stride=hi(r);const{buffer:o,byteOffset:a}=this;this.doublePrecision&&s instanceof Float64Array&&(s=Rr(s,r));const c=s.byteLength+a+r.stride*2;o.byteLength<c&&o.reallocate(c),o.setAccessor(null),o.subData({data:s,offset:a}),r.type=i.type||o.accessor.type}return!0}updateSubBuffer(t={}){this.state.bounds=null;const e=this.value,{startOffset:i=0,endOffset:r}=t;this.buffer.subData({data:this.doublePrecision&&e instanceof Float64Array?Rr(e,{size:this.size,startIndex:i,endIndex:r}):e.subarray(i,r),offset:i*e.BYTES_PER_ELEMENT+this.byteOffset})}allocate(t,e=!1){const{state:i}=this,r=i.allocatedValue,s=wn.allocate(r,t+1,{size:this.size,type:this.settings.defaultType,copy:e});this.value=s;const{buffer:o,byteOffset:a}=this;return o.byteLength<s.byteLength+a&&(o.reallocate(s.byteLength+a),e&&r&&o.subData({data:r instanceof Float64Array?Rr(r,this):r,offset:a})),i.allocatedValue=s,i.constant=!1,i.externalBuffer=null,i.bufferAccessor=this.settings,!0}_checkExternalBuffer(t){const{value:e}=t;if(!ArrayBuffer.isView(e))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const i=this.settings.defaultType;let r=!1;if(this.doublePrecision&&(r=e.BYTES_PER_ELEMENT<4),r)throw new Error("Attribute ".concat(this.id," does not support ").concat(e.constructor.name));!(e instanceof i)&&this.settings.normalized&&!("normalized"in t)&&H.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(t){switch(this.settings.type){case 5120:return new Float32Array(t).map(e=>(e+128)/255*2-1);case 5122:return new Float32Array(t).map(e=>(e+32768)/65535*2-1);case 5121:return new Float32Array(t).map(e=>e/255);case 5123:return new Float32Array(t).map(e=>e/65535);default:return t}}_normalizeValue(t,e,i){const{defaultValue:r,size:s}=this.settings;if(Number.isFinite(t))return e[i]=t,e;if(!t)return e[i]=r[0],e;switch(s){case 4:e[i+3]=Number.isFinite(t[3])?t[3]:r[3];case 3:e[i+2]=Number.isFinite(t[2])?t[2]:r[2];case 2:e[i+1]=Number.isFinite(t[1])?t[1]:r[1];case 1:e[i+0]=Number.isFinite(t[0])?t[0]:r[0];break;default:let o=s;for(;--o>=0;)e[i+o]=Number.isFinite(t[o])?t[o]:r[o]}return e}_areValuesEqual(t,e){if(!t||!e)return!1;const{size:i}=this;for(let r=0;r<i;r++)if(t[r]!==e[r])return!1;return!0}}const Qa=[],Ja=[];function UE(n,t=0,e=1/0){let i=Qa;const r={index:-1,data:n,target:[]};return n?typeof n[Symbol.iterator]=="function"?i=n:n.length>0&&(Ja.length=n.length,i=Ja):i=Qa,(t>0||Number.isFinite(e))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(t,e),r.index=t-1),{iterable:i,objectInfo:r}}function Kl(n){return n&&n[Symbol.asyncIterator]}function BE(n,t){const{size:e,stride:i,offset:r,startIndices:s,nested:o}=t,a=n.BYTES_PER_ELEMENT,c=i?i/a:e,l=r?r/a:0,u=Math.floor((n.length-l)/c);return(h,{index:g,target:m})=>{if(!s){const T=g*c+l;for(let A=0;A<e;A++)m[A]=n[T+A];return m}const b=s[g],y=s[g+1]||u;let E;if(o){E=new Array(y-b);for(let T=b;T<y;T++){const A=T*c+l;m=new Array(e);for(let S=0;S<e;S++)m[S]=n[A+S];E[T-b]=m}}else if(c===e)E=n.subarray(b*e+l,y*e+l);else{E=new n.constructor((y-b)*e);let T=0;for(let A=b;A<y;A++){const S=A*c+l;for(let x=0;x<e;x++)E[T++]=n[S+x]}}return E}}const VE=[],fi=[[0,1/0]];function jE(n,t){if(n===fi||(t[0]<0&&(t[0]=0),t[0]>=t[1]))return n;const e=[],i=n.length;let r=0;for(let s=0;s<i;s++){const o=n[s];o[1]<t[0]?(e.push(o),r=s+1):o[0]>t[1]?e.push(o):t=[Math.min(o[0],t[0]),Math.max(o[1],t[1])]}return e.splice(r,0,t),e}function kr(n){const{source:t,target:e,start:i=0,size:r,getData:s}=n,o=n.end||e.length,a=t.length,c=o-i;if(a>c){e.set(t.subarray(0,c),i);return}if(e.set(t,i),!s)return;let l=a;for(;l<c;){const u=s(l,t);for(let h=0;h<r;h++)e[i+l]=u[h]||0,l++}}function zE({source:n,target:t,size:e,getData:i,sourceStartIndices:r,targetStartIndices:s}){if(!Array.isArray(s))return kr({source:n,target:t,size:e,getData:i}),t;let o=0,a=0;const c=i&&((u,h)=>i(u+a,h)),l=Math.min(r.length,s.length);for(let u=1;u<l;u++){const h=r[u]*e,g=s[u]*e;kr({source:n.subarray(o,h),target:t,start:a,end:g,size:e,getData:c}),o=h,a=g}return a<t.length&&kr({source:[],target:t,start:a,size:e,getData:c}),t}const GE={interpolation:{duration:0,easing:n=>n},spring:{stiffness:.05,damping:.5}};function Ql(n,t){if(!n)return null;Number.isFinite(n)&&(n={type:"interpolation",duration:n});const e=n.type||"interpolation";return{...GE[e],...t,...n,type:e}}function Jl(n,t){const e=t.getBuffer();return e?[e,{divisor:0,size:t.size,normalized:t.settings.normalized}]:t.value}function tu(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(n,'"'))}}function eu(n){n.push(n.shift())}function Us(n,t){const{doublePrecision:e,settings:i,value:r,size:s}=n,o=e&&r instanceof Float64Array?2:1;return(i.noAlloc?r.length:t*s)*o}function nu({buffer:n,numInstances:t,attribute:e,fromLength:i,fromStartIndices:r,getData:s=o=>o}){const o=e.doublePrecision&&e.value instanceof Float64Array?2:1,a=e.size*o,c=e.byteOffset,l=e.startIndices,u=r&&l,h=Us(e,t),g=e.isConstant;if(!u&&i>=h)return;const m=g?e.value:e.getBuffer().getData({srcByteOffset:c});if(e.settings.normalized&&!g){const T=s;s=(A,S)=>e.normalizeConstant(T(A,S))}const b=g?(T,A)=>s(m,A):(T,A)=>s(m.subarray(T,T+a),A),y=n.getData({length:i}),E=new Float32Array(h);zE({source:y,target:E,sourceStartIndices:r,targetStartIndices:l,size:a,getData:b}),n.byteLength<E.byteLength+c&&n.reallocate(E.byteLength+c),n.subData({data:E,offset:c})}class Bs extends FE{constructor(t,e){super(t,e,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:fi}),f(this,"constant",!1),this.settings.update=e.update||(e.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(t){this.state.startIndices=t}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:t=!1}={}){const e=this.state.needsRedraw;return this.state.needsRedraw=e&&!t,e}getUpdateTriggers(){const{accessor:t}=this.settings;return[this.id].concat(typeof t!="function"&&t||[])}supportsTransition(){return Boolean(this.settings.transition)}getTransitionSetting(t){if(!t||!this.supportsTransition())return null;const{accessor:e}=this.settings,i=this.settings.transition,r=Array.isArray(e)?t[e.find(s=>t[s])]:t[e];return Ql(r,i)}setNeedsUpdate(t=this.id,e){if(this.state.needsUpdate=this.state.needsUpdate||t,this.setNeedsRedraw(t),e){const{startRow:i=0,endRow:r=1/0}=e;this.state.updateRanges=jE(this.state.updateRanges,[i,r])}else this.state.updateRanges=fi}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=VE}setNeedsRedraw(t=this.id){this.state.needsRedraw=this.state.needsRedraw||t}allocate(t){const{state:e,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(t,e.updateRanges!==fi),!0):!1}updateBuffer({numInstances:t,data:e,props:i,context:r}){if(!this.needsUpdate())return!1;const{state:{updateRanges:s},settings:{update:o,noAlloc:a}}=this;let c=!0;if(o){for(const[l,u]of s)o.call(r,this,{data:e,startRow:l,endRow:u,props:i,numInstances:t});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[l,u]of s){const h=Number.isFinite(l)?this.getVertexOffset(l):0,g=Number.isFinite(u)?this.getVertexOffset(u):a||!Number.isFinite(t)?this.value.length:t*this.size;super.updateSubBuffer({startOffset:h,endOffset:g})}this._checkAttributeArray()}else c=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),c}setConstantValue(t){return t===void 0||typeof t=="function"?!1:(this.setData({constant:!0,value:t})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(t){const{state:e}=this;return t?(this.clearNeedsUpdate(),e.lastExternalBuffer===t||(e.lastExternalBuffer=t,this.setNeedsRedraw(),this.setData(t)),!0):(e.lastExternalBuffer=null,!1)}setBinaryValue(t,e=null){const{state:i,settings:r}=this;if(!t)return i.binaryValue=null,i.binaryAccessor=null,!1;if(r.noAlloc)return!1;if(i.binaryValue===t)return this.clearNeedsUpdate(),!0;if(i.binaryValue=t,this.setNeedsRedraw(),r.transform||e!==this.startIndices){ArrayBuffer.isView(t)&&(t={value:t});const o=t;st(ArrayBuffer.isView(o.value),"invalid ".concat(r.accessor));const a=Boolean(o.size)&&o.size!==this.size;return i.binaryAccessor=BE(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:e,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(t),!0}getVertexOffset(t){const{startIndices:e}=this;return(e?e[t]:t)*this.size}getShaderAttributes(){const t=this.settings.shaderAttributes||{[this.id]:null},e={};for(const i in t)Object.assign(e,super.getShaderAttributes(i,t[i]));return e}_autoUpdater(t,{data:e,startRow:i,endRow:r,props:s,numInstances:o}){if(t.constant)return;const{settings:a,state:c,value:l,size:u,startIndices:h}=t,{accessor:g,transform:m}=a,b=c.binaryAccessor||(typeof g=="function"?g:s[g]);st(typeof b=="function",'accessor "'.concat(g,'" is not a function'));let y=t.getVertexOffset(i);const{iterable:E,objectInfo:T}=UE(e,i,r);for(const A of E){T.index++;let S=b(A,T);if(m&&(S=m.call(this,S)),h){const x=(T.index<h.length-1?h[T.index+1]:o)-h[T.index];if(S&&Array.isArray(S[0])){let M=y;for(const R of S)t._normalizeValue(R,l,M),M+=u}else S&&S.length>u?l.set(S,y):(t._normalizeValue(S,T.target,0),ly({target:l,source:T.target,start:y,count:x}));y+=x*u}else t._normalizeValue(S,l,y),y+=u}}_validateAttributeUpdaters(){const{settings:t}=this;if(!(t.noAlloc||typeof t.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:t}=this,e=Math.min(4,this.size);if(t&&t.length>=e){let i=!0;switch(e){case 4:i=i&&Number.isFinite(t[3]);case 3:i=i&&Number.isFinite(t[2]);case 2:i=i&&Number.isFinite(t[1]);case 1:i=i&&Number.isFinite(t[0]);break;default:i=!1}if(!i)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class HE{constructor({gl:t,attribute:e,timeline:i}){f(this,"gl",void 0),f(this,"type","interpolation"),f(this,"attributeInTransition",void 0),f(this,"settings",void 0),f(this,"attribute",void 0),f(this,"transition",void 0),f(this,"currentStartIndices",void 0),f(this,"currentLength",void 0),f(this,"transform",void 0),f(this,"buffers",void 0),this.gl=t,this.transition=new kn(i),this.attribute=e,this.attributeInTransition=new Bs(t,e.settings),this.currentStartIndices=e.startIndices,this.currentLength=0,this.transform=XE(t,e);const r={byteLength:0,usage:35050};this.buffers=[new W(t,r),new W(t,r)]}get inProgress(){return this.transition.inProgress}start(t,e){if(t.duration<=0){this.transition.cancel();return}this.settings=t;const{gl:i,buffers:r,attribute:s}=this;eu(r);const o={numInstances:e,attribute:s,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:t.enter};for(const a of r)nu({buffer:a,...o});this.currentStartIndices=s.startIndices,this.currentLength=Us(s,e),this.attributeInTransition.setData({buffer:r[1],value:s.value}),this.transition.start(t),this.transform.update({elementCount:Math.floor(this.currentLength/s.size),sourceBuffers:{aFrom:r[0],aTo:Jl(i,s)},feedbackBuffers:{vCurrent:r[1]}})}update(){const t=this.transition.update();if(t){const{duration:e,easing:i}=this.settings,{time:r}=this.transition;let s=r/e;i&&(s=i(s)),this.transform.run({uniforms:{time:s}})}return t}cancel(){this.transition.cancel(),this.transform.delete();for(const t of this.buffers)t.delete();this.buffers.length=0}}const WE=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function XE(n,t){const e=tu(t.size);return new Cs(n,{vs:WE,defines:{ATTRIBUTE_TYPE:e},varyings:["vCurrent"]})}class YE{constructor({gl:t,attribute:e,timeline:i}){f(this,"gl",void 0),f(this,"type","spring"),f(this,"attributeInTransition",void 0),f(this,"settings",void 0),f(this,"attribute",void 0),f(this,"transition",void 0),f(this,"currentStartIndices",void 0),f(this,"currentLength",void 0),f(this,"texture",void 0),f(this,"framebuffer",void 0),f(this,"transform",void 0),f(this,"buffers",void 0),this.gl=t,this.type="spring",this.transition=new kn(i),this.attribute=e,this.attributeInTransition=new Bs(t,{...e.settings,normalized:!1}),this.currentStartIndices=e.startIndices,this.currentLength=0,this.texture=ZE(t),this.framebuffer=$E(t,this.texture),this.transform=qE(t,e,this.framebuffer);const r={byteLength:0,usage:35050};this.buffers=[new W(t,r),new W(t,r),new W(t,r)]}get inProgress(){return this.transition.inProgress}start(t,e){const{gl:i,buffers:r,attribute:s}=this,o={numInstances:e,attribute:s,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:t.enter};for(const a of r)nu({buffer:a,...o});this.settings=t,this.currentStartIndices=s.startIndices,this.currentLength=Us(s,e),this.attributeInTransition.setData({buffer:r[1],value:s.value}),this.transition.start({...t,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/s.size),sourceBuffers:{aTo:Jl(i,s)}})}update(){const{buffers:t,transform:e,framebuffer:i,transition:r}=this;if(!r.update())return!1;const o=this.settings;return e.update({sourceBuffers:{aPrev:t[0],aCur:t[1]},feedbackBuffers:{vNext:t[2]}}),e.run({framebuffer:i,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:o.stiffness,damping:o.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),eu(t),this.attributeInTransition.setData({buffer:t[1],value:this.attribute.value}),Ui(i)[0]>0||r.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const t of this.buffers)t.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function qE(n,t,e){const i=tu(t.size);return new Cs(n,{framebuffer:e,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:i},varyings:["vNext"]})}function ZE(n){return new Tt(n,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function $E(n,t){return new Q(n,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{[36064]:t}})}const KE={interpolation:HE,spring:YE};class QE{constructor(t,{id:e,timeline:i}){f(this,"id",void 0),f(this,"isSupported",void 0),f(this,"gl",void 0),f(this,"timeline",void 0),f(this,"transitions",void 0),f(this,"needsRedraw",void 0),f(this,"numInstances",void 0),this.id=e,this.gl=t,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=Cs.isSupported(t)}finalize(){for(const t in this.transitions)this._removeTransition(t)}update({attributes:t,transitions:e,numInstances:i}){this.numInstances=i||1;for(const r in t){const s=t[r],o=s.getTransitionSetting(e);!o||this._updateAttribute(r,s,o)}for(const r in this.transitions){const s=t[r];(!s||!s.getTransitionSetting(e))&&this._removeTransition(r)}}hasAttribute(t){const e=this.transitions[t];return e&&e.inProgress}getAttributes(){const t={};for(const e in this.transitions){const i=this.transitions[e];i.inProgress&&(t[e]=i.attributeInTransition)}return t}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const e in this.transitions)this.transitions[e].update()&&(this.needsRedraw=!0);const t=this.needsRedraw;return this.needsRedraw=!1,t}_removeTransition(t){this.transitions[t].cancel(),delete this.transitions[t]}_updateAttribute(t,e,i){const r=this.transitions[t];let s=!r||r.type!==i.type;if(s){if(!this.isSupported){H.warn("WebGL2 not supported by this browser. Transition for ".concat(t," is disabled."))();return}r&&this._removeTransition(t);const o=KE[i.type];o?this.transitions[t]=new o({attribute:e,timeline:this.timeline,gl:this.gl}):(H.error("unsupported transition type '".concat(i.type,"'"))(),s=!1)}(s||e.needsRedraw())&&(this.needsRedraw=!0,this.transitions[t].start(i,this.numInstances))}}const tc="attributeManager.invalidate",JE="attributeManager.updateStart",tv="attributeManager.updateEnd",ev="attribute.updateStart",nv="attribute.allocate",iv="attribute.updateEnd";class rv{constructor(t,{id:e="attribute-manager",stats:i,timeline:r}={}){f(this,"id",void 0),f(this,"gl",void 0),f(this,"attributes",void 0),f(this,"updateTriggers",void 0),f(this,"needsRedraw",void 0),f(this,"userData",void 0),f(this,"stats",void 0),f(this,"attributeTransitionManager",void 0),this.id=e,this.gl=t,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new QE(t,{id:"".concat(e,"-transitions"),timeline:r}),Object.seal(this)}finalize(){for(const t in this.attributes)this.attributes[t].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(t={clearRedrawFlags:!1}){const e=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!t.clearRedrawFlags,e&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(t){this._add(t)}addInstanced(t){this._add(t,{instanced:1})}remove(t){for(const e of t)this.attributes[e]!==void 0&&(this.attributes[e].delete(),delete this.attributes[e])}invalidate(t,e){const i=this._invalidateTrigger(t,e);at(tc,this,t,i)}invalidateAll(t){for(const e in this.attributes)this.attributes[e].setNeedsUpdate(e,t);at(tc,this,"all")}update({data:t,numInstances:e,startIndices:i=null,transitions:r,props:s={},buffers:o={},context:a={}}){let c=!1;at(JE,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const l in this.attributes){const u=this.attributes[l],h=u.settings.accessor;u.startIndices=i,u.numInstances=e,s[l]&&H.removed("props.".concat(l),"data.attributes.".concat(l))(),u.setExternalBuffer(o[l])||u.setBinaryValue(typeof h=="string"?o[h]:void 0,t.startIndices)||typeof h=="string"&&!o[h]&&u.setConstantValue(s[h])||u.needsUpdate()&&(c=!0,this._updateAttribute({attribute:u,numInstances:e,data:t,props:s,context:a})),this.needsRedraw=this.needsRedraw||u.needsRedraw()}c&&at(tv,this,e),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:e,transitions:r})}updateTransition(){const{attributeTransitionManager:t}=this,e=t.run();return this.needsRedraw=this.needsRedraw||e,e}getAttributes(){return this.attributes}getChangedAttributes(t={clearChangedFlags:!1}){const{attributes:e,attributeTransitionManager:i}=this,r={...i.getAttributes()};for(const s in e){const o=e[s];o.needsRedraw(t)&&!i.hasAttribute(s)&&(r[s]=o)}return r}getShaderAttributes(t,e={}){t||(t=this.getAttributes());const i={};for(const r in t)e[r]||Object.assign(i,t[r].getShaderAttributes());return i}_add(t,e={}){for(const i in t){const r=t[i];this.attributes[i]=this._createAttribute(i,r,e)}this._mapUpdateTriggersToAttributes()}_createAttribute(t,e,i){const r={...e,id:t,size:e.isIndexed&&1||e.size||1,divisor:i.instanced?1:e.divisor||0};return new Bs(this.gl,r)}_mapUpdateTriggersToAttributes(){const t={};for(const e in this.attributes)this.attributes[e].getUpdateTriggers().forEach(r=>{t[r]||(t[r]=[]),t[r].push(e)});this.updateTriggers=t}_invalidateTrigger(t,e){const{attributes:i,updateTriggers:r}=this,s=r[t];return s&&s.forEach(o=>{const a=i[o];a&&a.setNeedsUpdate(a.id,e)}),s}_updateAttribute(t){const{attribute:e,numInstances:i}=t;if(at(ev,e),e.constant){e.setConstantValue(e.value);return}e.allocate(i)&&at(nv,e,i),e.updateBuffer(t)&&(this.needsRedraw=!0,at(iv,e,i))}}class sv extends kn{get value(){return this._value}_onUpdate(){const{time:t,settings:{fromValue:e,toValue:i,duration:r,easing:s}}=this,o=s(t/r);this._value=Ei(e,i,o)}}const ec=1e-5;function nc(n,t,e,i,r){const s=t-n,a=(e-t)*r,c=-s*i;return a+c+s+t}function ov(n,t,e,i,r){if(Array.isArray(e)){const s=[];for(let o=0;o<e.length;o++)s[o]=nc(n[o],t[o],e[o],i,r);return s}return nc(n,t,e,i,r)}function ic(n,t){if(Array.isArray(n)){let e=0;for(let i=0;i<n.length;i++){const r=n[i]-t[i];e+=r*r}return Math.sqrt(e)}return Math.abs(n-t)}class av extends kn{get value(){return this._currValue}_onUpdate(){const{fromValue:t,toValue:e,damping:i,stiffness:r}=this.settings,{_prevValue:s=t,_currValue:o=t}=this;let a=ov(s,o,e,i,r);const c=ic(a,e),l=ic(a,o);c<ec&&l<ec&&(a=e,this.end()),this._prevValue=o,this._currValue=a}}const cv={interpolation:sv,spring:av};class lv{constructor(t){this.transitions=new Map,this.timeline=t}get active(){return this.transitions.size>0}add(t,e,i,r){const{transitions:s}=this;if(s.has(t)){const c=s.get(t),{value:l=c.settings.fromValue}=c;e=l,this.remove(t)}if(r=Ql(r),!r)return;const o=cv[r.type];if(!o){H.error("unsupported transition type '".concat(r.type,"'"))();return}const a=new o(this.timeline);a.start({...r,fromValue:e,toValue:i}),s.set(t,a)}remove(t){const{transitions:e}=this;e.has(t)&&(e.get(t).cancel(),e.delete(t))}update(){const t={};for(const[e,i]of this.transitions)i.update(),t[e]=i.value,i.inProgress||this.remove(e);return t}clear(){for(const t of this.transitions.keys())this.remove(t)}}function uv(n){const t=Vs(n);for(const e in t){const i=t[e],{validate:r}=i;if(r&&!r(n[e],i))throw new Error("Invalid prop ".concat(e,": ").concat(n[e]))}}function hv(n,t){const e=iu({newProps:n,oldProps:t,propTypes:Vs(n),ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=dv(n,t);let r=!1;return i||(r=gv(n,t)),{dataChanged:i,propsChanged:e,updateTriggersChanged:r,extensionsChanged:pv(n,t),transitionsChanged:fv(n,t)}}function fv(n,t){if(!n.transitions)return!1;const e={},i=Vs(n);let r=!1;for(const s in n.transitions){const o=i[s],a=o&&o.type;(a==="number"||a==="color"||a==="array")&&us(n[s],t[s],o)&&(e[s]=!0,r=!0)}return r?e:!1}function iu({newProps:n,oldProps:t,ignoreProps:e={},propTypes:i={},triggerName:r="props"}){if(t===n)return!1;if(typeof n!="object"||n===null||typeof t!="object"||t===null)return"".concat(r," changed shallowly");for(const s of Object.keys(n))if(!(s in e)){if(!(s in t))return"".concat(r,".").concat(s," added");const o=us(n[s],t[s],i[s]);if(o)return"".concat(r,".").concat(s," ").concat(o)}for(const s of Object.keys(t))if(!(s in e)){if(!(s in n))return"".concat(r,".").concat(s," dropped");if(!Object.hasOwnProperty.call(n,s)){const o=us(n[s],t[s],i[s]);if(o)return"".concat(r,".").concat(s," ").concat(o)}}return!1}function us(n,t,e){let i=e&&e.equal;return i&&!i(n,t,e)||!i&&(i=n&&t&&n.equals,i&&!i.call(n,t))?"changed deeply":!i&&t!==n?"changed shallowly":null}function dv(n,t){if(t===null)return"oldProps is null, initial diff";let e=!1;const{dataComparator:i,_dataDiff:r}=n;return i?i(n.data,t.data)||(e="Data comparator detected a change"):n.data!==t.data&&(e="A new data container was supplied"),e&&r&&(e=r(n.data,t.data)||e),e}function gv(n,t){if(t===null)return{all:!0};if("all"in n.updateTriggers&&rc(n,t,"all"))return{all:!0};const e={};let i=!1;for(const r in n.updateTriggers)r!=="all"&&rc(n,t,r)&&(e[r]=!0,i=!0);return i?e:!1}function pv(n,t){if(t===null)return!0;const e=t.extensions,{extensions:i}=n;if(i===e)return!1;if(!e||!i||i.length!==e.length)return!0;for(let r=0;r<i.length;r++)if(!i[r].equals(e[r]))return!0;return!1}function rc(n,t,e){let i=n.updateTriggers[e];i=i==null?{}:i;let r=t.updateTriggers[e];return r=r==null?{}:r,iu({oldProps:r,newProps:i,triggerName:e})}function Vs(n){const t=n[Pi],e=t&&t.constructor;return e?e._propTypes:{}}const mv="count(): argument not an object",_v="count(): argument not a container";function bv(n){if(!Ev(n))throw new Error(mv);if(typeof n.count=="function")return n.count();if(Number.isFinite(n.size))return n.size;if(Number.isFinite(n.length))return n.length;if(yv(n))return Object.keys(n).length;throw new Error(_v)}function yv(n){return n!==null&&typeof n=="object"&&n.constructor===Object}function Ev(n){return n!==null&&typeof n=="object"}function vv(n,t){if(!t)return n;const e={...n,...t};if("defines"in t&&(e.defines={...n.defines,...t.defines}),"modules"in t&&(e.modules=(n.modules||[]).concat(t.modules),t.modules.some(i=>i.name==="project64"))){const i=e.modules.findIndex(r=>r.name==="project32");i>=0&&e.modules.splice(i,1)}if("inject"in t)if(!n.inject)e.inject=t.inject;else{const i={...n.inject};for(const r in t.inject)i[r]=(i[r]||"")+t.inject[r];e.inject=i}return e}const Tv={[10241]:9987,[10240]:9729,[10242]:33071,[10243]:33071},hs={};function wv(n,t){const e=n.context&&n.context.gl;if(!e||!t)return null;if(t instanceof Tt)return t;t.constructor&&t.constructor.name!=="Object"&&(t={data:t});let i=null;t.compressed&&(i={[10241]:t.data.length>1?9985:9729});const r=new Tt(e,{...t,parameters:{...Tv,...i,...n.props.textureParameters}});return hs[r.id]=!0,r}function Av(n){!n||!(n instanceof Tt)||hs[n.id]&&(n.delete(),delete hs[n.id])}const Sv={boolean:{validate(n,t){return!0},equal(n,t,e){return Boolean(n)===Boolean(t)}},number:{validate(n,t){return Number.isFinite(n)&&(!("max"in t)||n<=t.max)&&(!("min"in t)||n>=t.min)}},color:{validate(n,t){return t.optional&&!n||An(n)&&(n.length===3||n.length===4)},equal(n,t,e){return Nr(n,t)}},accessor:{validate(n,t){const e=Li(n);return e==="function"||e===Li(t.value)},equal(n,t,e){return typeof t=="function"?!0:Nr(n,t)}},array:{validate(n,t){return t.optional&&!n||An(n)},equal(n,t,e){return e.compare?Nr(n,t):n===t}},object:{equal(n,t,e){return e.compare?Te(n,t):n===t}},function:{validate(n,t){return t.optional&&!n||typeof n=="function"},equal(n,t,e){return!e.compare||n===t}},data:{transform:(n,t,e)=>{const{dataTransform:i}=e.props;return i&&n?i(n):n}},image:{transform:(n,t,e)=>wv(e,n),release:n=>{Av(n)}}};function Nr(n,t){if(n===t)return!0;if(!An(n)||!An(t))return!1;const e=n.length;if(e!==t.length)return!1;for(let i=0;i<e;i++)if(n[i]!==t[i])return!1;return!0}function xv(n){const t={},e={},i={};for(const[r,s]of Object.entries(n)){const o=s==null?void 0:s.deprecatedFor;if(o)i[r]=Array.isArray(o)?o:[o];else{const a=Pv(r,s);t[r]=a,e[r]=a.value}}return{propTypes:t,defaultProps:e,deprecatedProps:i}}function Pv(n,t){switch(Li(t)){case"object":return hn(n,t);case"array":return hn(n,{type:"array",value:t,compare:!1});case"boolean":return hn(n,{type:"boolean",value:t});case"number":return hn(n,{type:"number",value:t});case"function":return hn(n,{type:"function",value:t,compare:!0});default:return{name:n,type:"unknown",value:t}}}function hn(n,t){return"type"in t?{name:n,...Sv[t.type],...t}:"value"in t?{name:n,type:Li(t.value),...t}:{name:n,type:"object",value:t}}function An(n){return Array.isArray(n)||ArrayBuffer.isView(n)}function Li(n){return An(n)?"array":n===null?"null":typeof n}function Mv(n,t){const e=ru(n.constructor),i=Object.create(e);i[Pi]=n,i[Ee]={},i[oe]={};for(let r=0;r<t.length;++r){const s=t[r];for(const o in s)i[o]=s[o]}return Object.freeze(i),i}function ru(n){const t=Ri(n,"_mergedDefaultProps");return t||(Lv(n),n._mergedDefaultProps)}function Lv(n){if(!n.prototype)return;const e=Object.getPrototypeOf(n),i=ru(e),r=Ri(n,"defaultProps")||{},s=xv(r),o=Rv(s.defaultProps,i,n),a={...e._propTypes,...s.propTypes};Cv(o,a);const c={...e._deprecatedProps,...s.deprecatedProps};Iv(o,c),n._mergedDefaultProps=o,n._propTypes=a,n._deprecatedProps=c}function Rv(n,t,e){const i=Object.create(null);Object.assign(i,t,n);const r=kv(e);return delete n.id,Object.defineProperties(i,{id:{writable:!0,value:r}}),i}function Iv(n,t){for(const e in t)Object.defineProperty(n,e,{enumerable:!1,set(i){const r="".concat(this.id,": ").concat(e);for(const s of t[e])su(this,s)||(this[s]=i);H.deprecated(r,t[e].join("/"))()}})}function Cv(n,t){const e={},i={};for(const r in t){const s=t[r],{name:o,value:a}=s;s.async&&(e[o]=a,i[o]=Ov(o))}n[De]=e,n[Ee]={},Object.defineProperties(n,i)}function Ov(n){return{enumerable:!0,set(t){typeof t=="string"||t instanceof Promise||Kl(t)?this[Ee][n]=t:this[oe][n]=t},get(){if(this[oe]){if(n in this[oe])return this[oe][n]||this[De][n];if(n in this[Ee]){const t=this[Pi]&&this[Pi].internalState;if(t&&t.hasAsyncProp(n))return t.getAsyncProp(n)||this[De][n]}}return this[De][n]}}}function su(n,t){return Object.prototype.hasOwnProperty.call(n,t)}function Ri(n,t){return su(n,t)&&n[t]}function kv(n){const t=Ri(n,"layerName")||Ri(n,"componentName");return t||H.once(0,"".concat(n.name,".componentName not specified"))(),t||n.name}let Nv=0;class js{constructor(...t){f(this,"id",void 0),f(this,"props",void 0),f(this,"count",void 0),this.props=Mv(this,t),this.id=this.props.id,this.count=Nv++}clone(t){const{props:e}=this,i={};for(const r in e[De])r in e[oe]?i[r]=e[oe][r]:r in e[Ee]&&(i[r]=e[Ee][r]);return new this.constructor({...e,...i,...t})}}f(js,"componentName","Component");f(js,"defaultProps",{});const Dv=Object.freeze({});class Fv{constructor(t){f(this,"component",void 0),f(this,"onAsyncPropUpdated",void 0),f(this,"asyncProps",void 0),f(this,"oldProps",void 0),f(this,"oldAsyncProps",void 0),this.component=t,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const t in this.asyncProps){const e=this.asyncProps[t];e&&e.type&&e.type.release&&e.type.release(e.resolvedValue,e.type,this.component)}}getOldProps(){return this.oldAsyncProps||this.oldProps||Dv}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component.props}hasAsyncProp(t){return t in this.asyncProps}getAsyncProp(t){const e=this.asyncProps[t];return e&&e.resolvedValue}isAsyncPropLoading(t){if(t){const e=this.asyncProps[t];return Boolean(e&&e.pendingLoadCount>0&&e.pendingLoadCount!==e.resolvedLoadCount)}for(const e in this.asyncProps)if(this.isAsyncPropLoading(e))return!0;return!1}reloadAsyncProp(t,e){this._watchPromise(t,Promise.resolve(e))}setAsyncProps(t){const e=t[oe]||{},i=t[Ee]||t,r=t[De]||{};for(const s in e){const o=e[s];this._createAsyncPropData(s,r[s]),this._updateAsyncProp(s,o),e[s]=this.getAsyncProp(s)}for(const s in i){const o=i[s];this._createAsyncPropData(s,r[s]),this._updateAsyncProp(s,o)}}_fetch(t,e){return null}_onResolve(t,e){}_onError(t,e){}_updateAsyncProp(t,e){if(!!this._didAsyncInputValueChange(t,e)){if(typeof e=="string"&&(e=this._fetch(t,e)),e instanceof Promise){this._watchPromise(t,e);return}if(Kl(e)){this._resolveAsyncIterable(t,e);return}this._setPropValue(t,e)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const t in this.asyncProps)Object.defineProperty(this.oldAsyncProps,t,{enumerable:!0,value:this.oldProps[t]})}}_didAsyncInputValueChange(t,e){const i=this.asyncProps[t];return e===i.resolvedValue||e===i.lastValue?!1:(i.lastValue=e,!0)}_setPropValue(t,e){this._freezeAsyncOldProps();const i=this.asyncProps[t];i&&(e=this._postProcessValue(i,e),i.resolvedValue=e,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(t,e,i){const r=this.asyncProps[t];r&&i>=r.resolvedLoadCount&&e!==void 0&&(this._freezeAsyncOldProps(),r.resolvedValue=e,r.resolvedLoadCount=i,this.onAsyncPropUpdated(t,e))}_watchPromise(t,e){const i=this.asyncProps[t];if(i){i.pendingLoadCount++;const r=i.pendingLoadCount;e.then(s=>{s=this._postProcessValue(i,s),this._setAsyncPropValue(t,s,r),this._onResolve(t,s)}).catch(s=>{this._onError(t,s)})}}async _resolveAsyncIterable(t,e){if(t!=="data"){this._setPropValue(t,e);return}const i=this.asyncProps[t];if(!i)return;i.pendingLoadCount++;const r=i.pendingLoadCount;let s=[],o=0;for await(const a of e){const{dataTransform:c}=this.component.props;c?s=c(a,s):s=s.concat(a),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:o,endRow:s.length}]}),o=s.length,this._setAsyncPropValue(t,s,r)}this._onResolve(t,s)}_postProcessValue(t,e){const i=t.type;return i&&(i.release&&i.release(t.resolvedValue,i,this.component),i.transform)?i.transform(e,i,this.component):e}_createAsyncPropData(t,e){if(!this.asyncProps[t]){const r=this.component&&this.component.constructor._propTypes;this.asyncProps[t]={type:r&&r[t],lastValue:null,resolvedValue:e,pendingLoadCount:0,resolvedLoadCount:0}}}}class Uv extends Fv{constructor({attributeManager:t,layer:e}){super(e),f(this,"attributeManager",void 0),f(this,"needsRedraw",void 0),f(this,"needsUpdate",void 0),f(this,"subLayers",void 0),f(this,"usesPickingColorCache",void 0),f(this,"changeFlags",void 0),f(this,"viewport",void 0),f(this,"uniformTransitions",void 0),f(this,"propsInTransition",void 0),this.attributeManager=t,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}set layer(t){this.component=t}_fetch(t,e){const i=this.component.props.fetch;return i?i(e,{propName:t,layer:this.layer}):super._fetch(t,e)}_onResolve(t,e){const i=this.component.props.onDataLoad;t==="data"&&i&&i(e,{propName:t,layer:this.layer})}_onError(t,e){this.layer.raiseError(e,"loading ".concat(t," of ").concat(this.layer))}}const Bv="layer.changeFlag",Vv="layer.initialize",jv="layer.update",zv="layer.finalize",Gv="layer.matched",sc=2**24-1,Hv=Object.freeze([]),Wv=Vi(({oldViewport:n,viewport:t})=>n.equals(t));let Ft=new Uint8ClampedArray(0);const Xv={data:{type:"data",value:Hv,async:!0},dataComparator:{type:"function",value:null,compare:!1,optional:!0},_dataDiff:{type:"function",value:n=>n&&n.__diff,compare:!1,optional:!0},dataTransform:{type:"function",value:null,compare:!1,optional:!0},onDataLoad:{type:"function",value:null,compare:!1,optional:!0},onError:{type:"function",value:null,compare:!1,optional:!0},fetch:{type:"function",value:(n,{propName:t,layer:e,loaders:i,loadOptions:r,signal:s})=>{const{resourceManager:o}=e.context;if(r=r||e.getLoadOptions(),i=i||e.props.loaders,s){var a;r={...r,fetch:{...(a=r)===null||a===void 0?void 0:a.fetch,signal:s}}}let c=o.contains(n);return!c&&!r&&(o.add({resourceId:n,data:jr(n,i),persistent:!1}),c=!0),c?o.subscribe({resourceId:n,onChange:l=>{var u;return(u=e.internalState)===null||u===void 0?void 0:u.reloadAsyncProp(t,l)},consumerId:e.id,requestId:t}):jr(n,i,r)},compare:!1},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:Cn.DRAW,onHover:{type:"function",value:null,compare:!1,optional:!0},onClick:{type:"function",value:null,compare:!1,optional:!0},onDragStart:{type:"function",value:null,compare:!1,optional:!0},onDrag:{type:"function",value:null,compare:!1,optional:!0},onDragEnd:{type:"function",value:null,compare:!1,optional:!0},coordinateSystem:G.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,compare:!0},getPolygonOffset:{type:"function",value:({layerIndex:n})=>[0,-n*100],compare:!1},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Hi extends js{constructor(...t){super(...t),f(this,"internalState",null),f(this,"lifecycle",Ie.NO_STATE),f(this,"context",void 0),f(this,"state",void 0),f(this,"parent",null)}get root(){let t=this;for(;t.parent;)t=t.parent;return t}toString(){const t=this.constructor.layerName||this.constructor.name;return"".concat(t,"({id: '").concat(this.props.id,"'})")}project(t){st(this.internalState);const e=this.internalState.viewport||this.context.viewport,i=Ul(t,{viewport:e,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[r,s,o]=kl(i,e.pixelProjectionMatrix);return t.length===2?[r,s]:[r,s,o]}unproject(t){return st(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(t)}projectPosition(t,e){st(this.internalState);const i=this.internalState.viewport||this.context.viewport;return cy(t,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...e})}get isComposite(){return!1}setState(t){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,t),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(t){for(const e of this.getModels())e.updateModuleSettings(t)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:t}=this.props;return t===G.DEFAULT||t===G.LNGLAT||t===G.CARTESIAN}onHover(t,e){return this.props.onHover&&this.props.onHover(t,e)||!1}onClick(t,e){return this.props.onClick&&this.props.onClick(t,e)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(t,e=[]){return e[0]=t+1&255,e[1]=t+1>>8&255,e[2]=t+1>>8>>8&255,e}decodePickingColor(t){st(t instanceof Uint8Array);const[e,i,r]=t;return e+i*256+r*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:bv(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var t;const e=this.getAttributeManager();if(!e)return null;const{positions:i,instancePositions:r}=e.attributes;return(t=i||r)===null||t===void 0?void 0:t.getBounds()}getShaders(t){for(const e of this.props.extensions)t=vv(t,e.getShaders.call(this,e));return t}shouldUpdateState(t){return t.changeFlags.propsOrDataChanged}updateState(t){const e=this.getAttributeManager(),{dataChanged:i}=t.changeFlags;if(i&&e)if(Array.isArray(i))for(const c of i)e.invalidateAll(c);else e.invalidateAll();const{props:r,oldProps:s}=t,o=Number.isInteger(s.highlightedObjectIndex)||s.pickable,a=Number.isInteger(r.highlightedObjectIndex)||r.pickable;if(o!==a&&e){const{pickingColors:c,instancePickingColors:l}=e.attributes,u=c||l;u&&(a&&u.constant&&(u.constant=!1,e.invalidate(u.id)),!u.value&&!a&&(u.constant=!0,u.value=[0,0,0]))}}finalizeState(t){for(const i of this.getModels())i.delete();const e=this.getAttributeManager();e&&e.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(t){for(const e of this.getModels())e.draw(t)}getPickingInfo({info:t,mode:e,sourceLayer:i}){const{index:r}=t;return r>=0&&Array.isArray(this.props.data)&&(t.object=this.props.data[r]),t}raiseError(t,e){var i,r;if(e&&(t.message="".concat(e,": ").concat(t.message)),!((i=(r=this.props).onError)!==null&&i!==void 0&&i.call(r,t))){var s,o;(s=this.context)===null||s===void 0||(o=s.onError)===null||o===void 0||o.call(s,t,this)}}getNeedsRedraw(t={clearRedrawFlags:!1}){return this._getNeedsRedraw(t)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var t;return((t=this.internalState)===null||t===void 0?void 0:t.uniformTransitions.active)||!1}activateViewport(t){if(!this.internalState)return;const e=this.internalState.viewport;this.internalState.viewport=t,(!e||!Wv({oldViewport:e,viewport:t}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(t="all"){const e=this.getAttributeManager();!e||(t==="all"?e.invalidateAll():e.invalidate(t))}updateAttributes(t){for(const e of this.getModels())this._setModelAttributes(e,t)}_updateAttributes(){const t=this.getAttributeManager();if(!t)return;const e=this.props,i=this.getNumInstances(),r=this.getStartIndices();t.update({data:e.data,numInstances:i,startIndices:r,props:e,transitions:e.transitions,buffers:e.data.attributes,context:this});const s=t.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const t=this.getAttributeManager();t&&t.updateTransition()}_updateUniformTransition(){const{uniformTransitions:t}=this.internalState;if(t.active){const e=t.update(),i=Object.create(this.props);for(const r in e)Object.defineProperty(i,r,{value:e[r]});return i}return this.props}calculateInstancePickingColors(t,{numInstances:e}){if(t.constant)return;const i=Math.floor(Ft.length/3);if(this.internalState.usesPickingColorCache=!0,i<e){e>sc&&H.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Ft=wn.allocate(Ft,e,{size:3,copy:!0,maxCount:Math.max(e,sc)});const r=Math.floor(Ft.length/3),s=[];for(let o=i;o<r;o++)this.encodePickingColor(o,s),Ft[o*3+0]=s[0],Ft[o*3+1]=s[1],Ft[o*3+2]=s[2]}t.value=Ft.subarray(0,e*3)}_setModelAttributes(t,e){const i=this.getAttributeManager(),r=t.userData.excludeAttributes||{},s=i.getShaderAttributes(e,r);t.setAttributes(s)}disablePickingIndex(t){this._disablePickingIndex(t)}_disablePickingIndex(t){const{pickingColors:e,instancePickingColors:i}=this.getAttributeManager().attributes,r=e||i;if(!r)return;const s=r.getVertexOffset(t),o=r.getVertexOffset(t+1);r.buffer.subData({data:new Uint8Array(o-s),offset:s})}restorePickingColors(){const{pickingColors:t,instancePickingColors:e}=this.getAttributeManager().attributes,i=t||e;!i||(this.internalState.usesPickingColorCache&&i.value.buffer!==Ft.buffer&&(i.value=Ft.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){st(!this.internalState),st(Number.isFinite(this.props.coordinateSystem)),at(Vv,this);const t=this._getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new Uv({attributeManager:t,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(H.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),t)}),this.internalState.layer=this,this.internalState.uniformTransitions=new lv(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const e of this.props.extensions)e.initializeState.call(this,this.context,e);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(t){at(Gv,this,this===t);const{state:e,internalState:i}=t;this!==t&&(this.internalState=i,this.internalState.layer=this,this.state=e,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const t=this.needsUpdate();if(at(jv,this,t),!t)return;const e=this.props,i=this.context,r=this.internalState,s=i.viewport,o=this._updateUniformTransition();r.propsInTransition=o,i.viewport=r.viewport||s,this.props=o;try{const a=this._getUpdateParams(),c=this.getModels();if(i.gl)this.updateState(a);else try{this.updateState(a)}catch{}for(const u of this.props.extensions)u.updateState.call(this,a,u);const l=this.getModels()[0]!==c[0];this._postUpdate(a,l)}finally{i.viewport=s,this.props=e,this._clearChangeFlags(),r.needsUpdate=!1,r.resetOldProps()}}_finalize(){at(zv,this),this.finalizeState(this.context);for(const t of this.props.extensions)t.finalizeState.call(this,t)}_drawLayer({moduleParameters:t=null,uniforms:e={},parameters:i={}}){this._updateAttributeTransition();const r=this.props,s=this.context;this.props=this.internalState.propsInTransition||r;const o=this.props.opacity;e.opacity=Math.pow(o,1/2.2);try{t&&this.setModuleParameters(t);const{getPolygonOffset:a}=this.props,c=a&&a(e)||[0,0];qt(s.gl,{polygonOffset:c}),xt(s.gl,i,()=>{const l={moduleParameters:t,uniforms:e,parameters:i,context:s};for(const u of this.props.extensions)u.draw.call(this,l,u);this.draw(l)})}finally{this.props=r}}getChangeFlags(){var t;return(t=this.internalState)===null||t===void 0?void 0:t.changeFlags}setChangeFlags(t){if(!this.internalState)return;const{changeFlags:e}=this.internalState;for(const r in t)if(t[r]){let s=!1;switch(r){case"dataChanged":const o=t[r],a=e[r];o&&Array.isArray(a)&&(e.dataChanged=Array.isArray(o)?a.concat(o):o,s=!0);default:e[r]||(e[r]=t[r],s=!0)}s&&at(Bv,this,r,t)}const i=Boolean(e.dataChanged||e.updateTriggersChanged||e.propsChanged||e.extensionsChanged);e.propsOrDataChanged=i,e.somethingChanged=i||e.viewportChanged||e.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(t,e){const i=hv(t,e);if(i.updateTriggersChanged)for(const s in i.updateTriggersChanged)i.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(i.transitionsChanged)for(const s in i.transitionsChanged){var r;this.internalState.uniformTransitions.add(s,e[s],t[s],(r=t.transitions)===null||r===void 0?void 0:r[s])}return this.setChangeFlags(i)}validateProps(){uv(this.props)}updateAutoHighlight(t){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(t)}_updateAutoHighlight(t){const e={pickingSelectedColor:t.picked?t.color:null},{highlightColor:i}=this.props;t.picked&&typeof i=="function"&&(e.pickingHighlightColor=i(t)),this.setModuleParameters(e),this.setNeedsRedraw()}_getAttributeManager(){const t=this.context;return new rv(t.gl,{id:this.props.id,stats:t.stats,timeline:t.timeline})}_postUpdate(t,e){const{props:i,oldProps:r}=t;this.setNeedsRedraw(),this._updateAttributes();const{model:s}=this.state;s==null||s.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:a,highlightColor:c}=i;if(e||r.autoHighlight!==o||r.highlightedObjectIndex!==a||r.highlightColor!==c){const l={};o||(l.pickingSelectedColor=null),Array.isArray(c)&&(l.pickingHighlightColor=c),Number.isInteger(a)&&(l.pickingSelectedColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setModuleParameters(l)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(t){if(!this.internalState)return!1;let e=!1;e=e||this.internalState.needsRedraw&&this.id,this.internalState.needsRedraw=this.internalState.needsRedraw&&!t.clearRedrawFlags;const i=this.getAttributeManager(),r=i?i.getNeedsRedraw(t):!1;return e=e||r,e}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}f(Hi,"defaultProps",Xv);f(Hi,"layerName","Layer");const Yv="compositeLayer.renderLayers";class qv extends Hi{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(t=>t.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(t){}setState(t){super.setState(t),this.setNeedsUpdate()}getPickingInfo({info:t}){const{object:e}=t;return e&&e.__source&&e.__source.parent&&e.__source.parent.id===this.id&&(t.object=e.__source.object,t.index=e.__source.index),t}filterSubLayer(t){return!0}shouldRenderSubLayer(t,e){return e&&e.length}getSubLayerClass(t,e){const{_subLayerProps:i}=this.props;return i&&i[t]&&i[t].type||e}getSubLayerRow(t,e,i){return t.__source={parent:this,object:e,index:i},t}getSubLayerAccessor(t){if(typeof t=="function"){const e={index:-1,data:this.props.data,target:[]};return(i,r)=>i&&i.__source?(e.index=i.__source.index,t(i.__source.object,e)):t(i,r)}return t}getSubLayerProps(t={}){var e;const{opacity:i,pickable:r,visible:s,parameters:o,getPolygonOffset:a,highlightedObjectIndex:c,autoHighlight:l,highlightColor:u,coordinateSystem:h,coordinateOrigin:g,wrapLongitude:m,positionFormat:b,modelMatrix:y,extensions:E,fetch:T,operation:A,_subLayerProps:S}=this.props,x={id:"",updateTriggers:{},opacity:i,pickable:r,visible:s,parameters:o,getPolygonOffset:a,highlightedObjectIndex:c,autoHighlight:l,highlightColor:u,coordinateSystem:h,coordinateOrigin:g,wrapLongitude:m,positionFormat:b,modelMatrix:y,extensions:E,fetch:T,operation:A},M=S&&t.id&&S[t.id],R=M&&M.updateTriggers,N=t.id||"sublayer";if(M){const B=this.constructor._propTypes,k=t.type?t.type._propTypes:{};for(const D in M){const F=k[D]||B[D];F&&F.type==="accessor"&&(M[D]=this.getSubLayerAccessor(M[D]))}}Object.assign(x,t,M),x.id="".concat(this.props.id,"-").concat(N),x.updateTriggers={all:(e=this.props.updateTriggers)===null||e===void 0?void 0:e.all,...t.updateTriggers,...R};for(const B of E){const k=B.getSubLayerProps.call(this,B);k&&Object.assign(x,k,{updateTriggers:Object.assign(x.updateTriggers,k.updateTriggers)})}return x}_updateAutoHighlight(t){for(const e of this.getSubLayers())e.updateAutoHighlight(t)}_getAttributeManager(){return null}_postUpdate(t,e){let i=this.internalState.subLayers;const r=!i||this.needsUpdate();if(r){const s=this.renderLayers();i=Ns(s,Boolean),this.internalState.subLayers=i}at(Yv,this,r,i);for(const s of i)s.parent=this}}f(qv,"layerName","CompositeLayer");const ri=Math.PI/180,oc=180/Math.PI,di=6370972,ke=256;function Zv(){const n=ke/di,t=Math.PI/180*ke;return{unitsPerMeter:[n,n,n],unitsPerMeter2:[0,0,0],metersPerUnit:[1/n,1/n,1/n],unitsPerDegree:[t,t,n],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/t,1/t,1/n]}}class $v extends Vt{constructor(t={}){const{latitude:e=0,longitude:i=0,zoom:r=0,nearZMultiplier:s=.1,farZMultiplier:o=2,resolution:a=10}=t;let{height:c,altitude:l=1.5}=t;c=c||1,l=Math.max(.75,l);const u=new ct().lookAt({eye:[0,-l,0],up:[0,0,1]}),h=Math.pow(2,r);u.rotateX(e*ri),u.rotateZ(-i*ri),u.scale(h/c);const g=Math.atan(.5/l),m=ke*2*h/c;super({...t,height:c,viewMatrix:u,longitude:i,latitude:e,zoom:r,distanceScales:Zv(),fovyRadians:g*2,focalDistance:l,near:s,far:Math.min(2,1/m+1)*l*o}),f(this,"longitude",void 0),f(this,"latitude",void 0),f(this,"resolution",void 0),this.latitude=e,this.longitude=i,this.resolution=a}get projectionMode(){return Lt.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(t={}){const e={targetZ:t.z||0},i=this.unproject([0,this.height/2],e),r=this.unproject([this.width/2,0],e),s=this.unproject([this.width,this.height/2],e),o=this.unproject([this.width/2,this.height],e);return s[0]<this.longitude&&(s[0]+=360),i[0]>this.longitude&&(i[0]-=360),[Math.min(i[0],s[0],r[0],o[0]),Math.min(i[1],s[1],r[1],o[1]),Math.max(i[0],s[0],r[0],o[0]),Math.max(i[1],s[1],r[1],o[1])]}unproject(t,{topLeft:e=!0,targetZ:i}={}){const[r,s,o]=t,a=e?s:this.height-s,{pixelUnprojectionMatrix:c}=this;let l;if(Number.isFinite(o))l=Dr(c,[r,a,o,1]);else{const m=Dr(c,[r,a,-1,1]),b=Dr(c,[r,a,1,1]),y=((i||0)/di+1)*ke,E=Sr(vl([],m,b)),T=Sr(m),A=Sr(b),S=(4*T*A-(E-T-A)**2)/16,x=4*S/E,M=Math.sqrt(T-x),R=Math.sqrt(Math.max(0,y*y-x)),N=(M-R)/Math.sqrt(E);l=X0([],m,b,N)}const[u,h,g]=this.unprojectPosition(l);return Number.isFinite(o)?[u,h,g]:Number.isFinite(i)?[u,h,i]:[u,h]}projectPosition(t){const[e,i,r=0]=t,s=e*ri,o=i*ri,a=Math.cos(o),c=(r/di+1)*ke;return[Math.sin(s)*a*c,-Math.cos(s)*a*c,Math.sin(o)*c]}unprojectPosition(t){const[e,i,r]=t,s=J0(t),o=Math.asin(r/s),c=Math.atan2(e,-i)*oc,l=o*oc,u=(s/ke-1)*di;return[c,l,u]}projectFlat(t){return t}unprojectFlat(t){return t}panByPosition(t,e){const i=this.unproject(e);return{longitude:t[0]-i[0]+this.longitude,latitude:t[1]-i[1]+this.latitude}}}function Dr(n,t){const e=qe([],t,n);return Al(e,e,1/e[3]),e}const Fr=Math.PI/180;function Kv({height:n,focalDistance:t,orbitAxis:e,rotationX:i,rotationOrbit:r,zoom:s}){const o=e==="Z"?[0,0,1]:[0,1,0],a=e==="Z"?[0,-t,0]:[0,0,t],c=new ct().lookAt({eye:a,up:o});c.rotateX(i*Fr),e==="Z"?c.rotateZ(r*Fr):c.rotateY(r*Fr);const l=Math.pow(2,s)/n;return c.scale(l),c}class Qv extends Vt{constructor(t){const{height:e,projectionMatrix:i,fovy:r=50,orbitAxis:s="Z",target:o=[0,0,0],rotationX:a=0,rotationOrbit:c=0,zoom:l=0}=t,u=i?i[5]/2:ks(r);super({...t,longitude:void 0,viewMatrix:Kv({height:e||1,focalDistance:u,orbitAxis:s,rotationX:a,rotationOrbit:c,zoom:l}),fovy:r,focalDistance:u,position:o,zoom:l}),f(this,"projectedCenter",void 0),this.projectedCenter=this.project(this.center)}unproject(t,{topLeft:e=!0}={}){const[i,r,s=this.projectedCenter[2]]=t,o=e?r:this.height-r,[a,c,l]=On([i,o,s],this.pixelUnprojectionMatrix);return[a,c,l]}panByPosition(t,e){const i=this.project(t),r=[this.width/2+i[0]-e[0],this.height/2+i[1]-e[1],this.projectedCenter[2]];return{target:this.unproject(r)}}}class Jv extends Vt{constructor(t){const{longitude:e,latitude:i,modelMatrix:r,bearing:s=0,pitch:o=0,up:a=[0,0,1]}=t,l=new Bi({bearing:s,pitch:o===-90?1e-4:90+o}).toVector3().normalize(),u=r?new ct(r).transformAsVector(l):l,h=Number.isFinite(i)?Cl({latitude:i}):0,g=Math.pow(2,h),m=new ct().lookAt({eye:[0,0,0],center:u,up:a}).scale(g);super({...t,zoom:h,viewMatrix:m}),f(this,"longitude",void 0),f(this,"latitude",void 0),this.latitude=i,this.longitude=e}}const fn=20;class zs extends Ds{constructor(t){const{width:e,height:i,position:r=[0,0,0],bearing:s=0,pitch:o=0,longitude:a=null,latitude:c=null,maxPitch:l=90,minPitch:u=-90,startRotatePos:h,startBearing:g,startPitch:m,startZoomPosition:b}=t;super({width:e,height:i,position:r,bearing:s,pitch:o,longitude:a,latitude:c,maxPitch:l,minPitch:u},{startRotatePos:h,startBearing:g,startPitch:m,startZoomPosition:b})}panStart(){return this}pan(){return this}panEnd(){return this}rotateStart({pos:t}){return this._getUpdatedState({startRotatePos:t,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:t,deltaAngleX:e=0,deltaAngleY:i=0}){const{startRotatePos:r,startBearing:s,startPitch:o}=this.getState(),{width:a,height:c}=this.getViewportProps();if(!r||s===void 0||o===void 0)return this;let l;if(t){const u=(t[0]-r[0])/a,h=(t[1]-r[1])/c;l={bearing:s-u*180,pitch:o-h*90}}else l={bearing:s-e,pitch:o-i};return this._getUpdatedState(l)}rotateEnd(){return this._getUpdatedState({startRotatePos:null,startBearing:null,startPitch:null})}zoomStart(){return this._getUpdatedState({startZoomPosition:this.getViewportProps().position})}zoom({scale:t}){let{startZoomPosition:e}=this.getState();e||(e=this.getViewportProps().position);const i=this.getDirection();return this._move(i,Math.log2(t)*fn,e)}zoomEnd(){return this._getUpdatedState({startZoomPosition:null})}moveLeft(t=fn){const e=this.getDirection(!0);return this._move(e.rotateZ({radians:Math.PI/2}),t)}moveRight(t=fn){const e=this.getDirection(!0);return this._move(e.rotateZ({radians:-Math.PI/2}),t)}moveUp(t=fn){const e=this.getDirection(!0);return this._move(e,t)}moveDown(t=fn){const e=this.getDirection(!0);return this._move(e.negate(),t)}rotateLeft(t=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-t})}rotateRight(t=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+t})}rotateUp(t=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+t})}rotateDown(t=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-t})}zoomIn(t=2){return this.zoom({scale:t})}zoomOut(t=2){return this.zoom({scale:1/t})}shortestPathFrom(t){const e=t.getViewportProps(),i={...this.getViewportProps()},{bearing:r,longitude:s}=i;return Math.abs(r-e.bearing)>180&&(i.bearing=r<0?r+360:r-360),s!==null&&e.longitude!==null&&Math.abs(s-e.longitude)>180&&(i.longitude=s<0?s+360:s-360),i}_move(t,e,i=this.getViewportProps().position){const r=t.scale(e);return this._getUpdatedState({position:new Pt(i).add(r)})}getDirection(t=!1){return new Bi({bearing:this.getViewportProps().bearing,pitch:t?90:90+this.getViewportProps().pitch}).toVector3().normalize()}_getUpdatedState(t){return new zs({...this.getViewportProps(),...this.getState(),...t})}applyConstraints(t){const{pitch:e,maxPitch:i,minPitch:r,longitude:s,bearing:o}=t;return t.pitch=$(e,r,i),s!==null&&(s<-180||s>180)&&(t.longitude=xi(s+180,360)-180),(o<-180||o>180)&&(t.bearing=xi(o+180,360)-180),t}}class tT extends Nn{constructor(...t){super(...t),f(this,"ControllerState",zs),f(this,"transition",{transitionDuration:300,transitionInterpolator:new Ze(["position","pitch","bearing"])})}}class eT extends Bt{get ViewportType(){return Jv}get ControllerType(){return tT}}f(eT,"displayName","FirstPersonView");class nT extends Bt{constructor(t={}){super(t),this.props.orbitAxis=t.orbitAxis||"Z"}get ViewportType(){return Qv}get ControllerType(){return Ry}}f(nT,"displayName","OrbitView");class iT extends Vl{applyConstraints(t){const{maxZoom:e,minZoom:i,zoom:r}=t;t.zoom=$(r,i,e);const{longitude:s,latitude:o}=t;return(s<-180||s>180)&&(t.longitude=xi(s+180,360)-180),t.latitude=$(o,-89,89),t}}class rT extends Nn{constructor(...t){super(...t),f(this,"ControllerState",iT),f(this,"transition",{transitionDuration:300,transitionInterpolator:new Ze(["longitude","latitude","zoom"])}),f(this,"dragMode","pan")}setProps(t){super.setProps(t),this.dragRotate=!1,this.touchRotate=!1}}class sT extends Bt{get ViewportType(){return $v}get ControllerType(){return rT}}f(sT,"displayName","GlobeView");class oT{constructor(t){f(this,"opts",void 0),t&&(this.opts=t)}equals(t){return this===t?!0:this.constructor===t.constructor&&Te(this.opts,t.opts)}getShaders(t){return null}getSubLayerProps(t){const{defaultProps:e}=t.constructor,i={updateTriggers:{}};for(const r in e)if(r in this.props){const s=e[r],o=this.props[r];i[r]=o,s&&s.type==="accessor"&&(i.updateTriggers[r]=this.props.updateTriggers[r],typeof o=="function"&&(i[r]=this.getSubLayerAccessor(o)))}return i}initializeState(t,e){}updateState(t,e){}draw(t,e){}finalizeState(t,e){}}f(oT,"defaultProps",{});const ou=(n,t)=>{const{offsetWidth:e,offsetHeight:i}=t;return new $t({width:e,height:i}).fitBounds(n,{})};const aT=n=>{const t=L.exports.useRef(null),e=L.exports.useRef(null),i=ce(),[r,s]=Ue(ki),[o,a]=Ue(Dh),{search:c}=Sn(),l=Oi(),[u,h]=L.exports.useState();L.exports.useEffect(()=>{if(t.current&&!gi(r)){const T=ou(n.defaultBounds,t.current);s(T)}},[t.current]);const g=L.exports.useMemo(()=>{var T;return(c==null?void 0:c.status)==="OK"&&((T=c.result)==null?void 0:T.items.length)?{type:"FeatureCollection",features:c.result.items.map(A=>({...A,properties:{id:A.id,...A.properties}}))}:null},[c]),m=L.exports.useMemo(()=>rr.Children.map(n.children,T=>T.props.id)||[],[n.children]),b=L.exports.useCallback(T=>{var S;if(!e.current)return;const A=e.current.queryRenderedFeatures(T).filter(x=>m.find(M=>x.layer.id.startsWith(M)));if(A.length>0){const x=A[0];return{node:l.getNodeById((S=x.properties)==null?void 0:S.id),feature:x}}},[n.children,l,e.current,m]),y=L.exports.useCallback(T=>{var x,M;const{point:A}=T,S=b(A);if(S){const{node:R,feature:N}=S,B=u&&(R==null?void 0:R.id)===(u==null?void 0:u.node.id)?{...u,...A}:{node:R,feature:N,...A};(x=t.current)==null||x.classList.add("hover"),h(B)}else(M=t.current)==null||M.classList.remove("hover"),h(void 0)},[b,u]),E=T=>{const A=b(T.point);if(A){const S=JSON.parse(JSON.stringify(A));h(null),a(S)}else a(null)};return U("div",{ref:t,className:"p6o-map-container",children:[gi(r)&&w(hc,{clickTolerance:i.isTouchDevice?10:3,ref:e,initialViewState:r,mapStyle:n.mapStyle,onClick:E,onMouseMove:y,onMove:T=>s(T.viewState),children:rr.Children.map(n.children,T=>rr.cloneElement(T,{data:g}))}),n.tooltip&&u&&w(MT,{...u,tooltip:n.tooltip}),n.popup&&e.current&&o&&w(PT,{selected:o,viewState:r,map:e.current,popup:n.popup,onClose:()=>a(null)})]})},cT=typeof window<"u"?L.exports.useLayoutEffect:L.exports.useEffect;function Ii(n,t){for(;n;){if(n===t)return!0;n=Object.getPrototypeOf(n)}return!1}const lT={position:"absolute",zIndex:-1};function au(n,t){if(typeof n=="function")return n(t);if(Array.isArray(n))return n.map(e=>au(e,t));if(Wi(n)){if(uT(n))return t.style=lT,L.exports.cloneElement(n,t);if(hT(n))return L.exports.cloneElement(n,t)}return n}function Wi(n){return n&&typeof n=="object"&&"type"in n||!1}function uT(n){const t=n.type,e=t&&t.defaultProps;return e&&e.mapStyle}function hT(n){const t=n.type;return t&&t.deckGLViewProps}function fs(n){if(typeof n=="function")return L.exports.createElement(Bt,{},n);if(Array.isArray(n))return n.map(fs);if(Wi(n)){if(n.type===L.exports.Fragment)return fs(n.props.children);if(Ii(n.type,Bt))return n}return n}function fT({children:n,layers:t=[],views:e=null}){const i=[],r=[],s={};return L.exports.Children.forEach(fs(n),o=>{if(Wi(o)){const a=o.type;if(Ii(a,Hi)){const c=dT(a,o.props);r.push(c)}else i.push(o);if(Ii(a,Bt)&&a!==Bt&&o.props.id){const c=new a(o.props);s[c.id]=c}}else o&&i.push(o)}),Object.keys(s).length>0&&(Array.isArray(e)?e.forEach(o=>{s[o.id]=o}):e&&(s[e.id]=e),e=Object.values(s)),t=r.length>0?[...r,...t]:t,{layers:t,children:i,views:e}}function dT(n,t){const e={},i=n.defaultProps||{};for(const r in t)i[r]!==t[r]&&(e[r]=t[r]);return new n(e)}function gT({children:n,deck:t,ContextProvider:e}){const{viewManager:i}=t||{};if(!i||!i.views.length)return[];const r={},s=i.views[0].id;for(const o of n){let a=s,c=o;Wi(o)&&Ii(o.type,Bt)&&(a=o.props.id||s,c=o.props.children);const l=i.getViewport(a),u=i.getViewState(a);if(l){const{x:h,y:g,width:m,height:b}=l;c=au(c,{x:h,y:g,width:m,height:b,viewport:l,viewState:u}),r[a]||(r[a]={viewport:l,children:[]}),r[a].children.push(c)}}return Object.keys(r).map(o=>{const{viewport:a,children:c}=r[o],{x:l,y:u,width:h,height:g}=a,m={position:"absolute",left:l,top:u,width:h,height:g},b="view-".concat(o),y=L.exports.createElement("div",{key:b,id:b,style:m},...c);if(e){const E={viewport:a,container:t.canvas.offsetParent,eventManager:t.eventManager,onViewStateChange:T=>{T.viewId=o,t._onViewStateChange(T)}};return L.exports.createElement(e,{key:b,value:E},y)}return y})}const pT={mixBlendMode:null};function mT({width:n,height:t,style:e}){const i={position:"absolute",zIndex:0,left:0,top:0,width:n,height:t},r={left:0,top:0};if(e)for(const s in e)s in pT?r[s]=e[s]:i[s]=e[s];return{containerStyle:i,canvasStyle:r}}function _T(n){return{get deck(){return n.deck},pickObject:t=>n.deck.pickObject(t),pickMultipleObjects:t=>n.deck.pickMultipleObjects(t),pickObjects:t=>n.deck.pickObjects(t)}}function cu(n){n.redrawReason&&(n.deck._drawLayers(n.redrawReason),n.redrawReason=null)}function bT(n,t,e){const i=new t({...e,_customRender:r=>{n.redrawReason=r;const s=i.getViewports();n.lastRenderedViewports!==s?n.forceUpdate():cu(n)}});return i}const lu=L.exports.forwardRef((n,t)=>{const[e,i]=L.exports.useState(0),s=L.exports.useRef({control:null,version:e,forceUpdate:()=>i(M=>M+1)}).current,o=L.exports.useRef(null),a=L.exports.useRef(null),c=L.exports.useMemo(()=>fT(n),[n.layers,n.views,n.children]);let l=!0;const u=M=>{var R;return l&&n.viewState?(s.viewStateUpdateRequested=M,null):(s.viewStateUpdateRequested=null,(R=n.onViewStateChange)===null||R===void 0?void 0:R.call(n,M))},h=M=>{if(l)s.interactionStateUpdateRequested=M;else{var R;s.interactionStateUpdateRequested=null,(R=n.onInteractionStateChange)===null||R===void 0||R.call(n,M)}},g=L.exports.useMemo(()=>{const M={...n,style:null,width:"100%",height:"100%",parent:o.current,canvas:a.current,layers:c.layers,views:c.views,onViewStateChange:u,onInteractionStateChange:h};return delete M._customRender,s.deck&&s.deck.setProps(M),M},[n]);L.exports.useEffect(()=>{const M=n.Deck||Gi;return s.deck=bT(s,M,{...g,parent:o.current,canvas:a.current}),()=>{var R;return(R=s.deck)===null||R===void 0?void 0:R.finalize()}},[]),cT(()=>{cu(s);const{viewStateUpdateRequested:M,interactionStateUpdateRequested:R}=s;M&&u(M),R&&h(R)}),L.exports.useImperativeHandle(t,()=>_T(s),[]);const m=s.deck&&s.deck.isInitialized?s.deck.getViewports():void 0,{ContextProvider:b,width:y,height:E,id:T,style:A}=n,{containerStyle:S,canvasStyle:x}=L.exports.useMemo(()=>mT({width:y,height:E,style:A}),[y,E,A]);if(!s.viewStateUpdateRequested&&s.lastRenderedViewports===m||s.version!==e){s.lastRenderedViewports=m,s.version=e;const M=gT({children:c.children,deck:s.deck,ContextProvider:b}),R=L.exports.createElement("canvas",{key:"canvas",id:T||"deckgl-overlay",ref:a,style:x});s.control=L.exports.createElement("div",{id:"".concat(T||"deckgl","-wrapper"),ref:o,style:S},[R,M])}return l=!1,s.control});lu.defaultProps=Gi.defaultProps;const yT=n=>{const t=L.exports.useRef(null),{search:e}=Sn(),i=Oi(),r=L.exports.useMemo(()=>(e==null?void 0:e.result)&&e.status==="OK"&&e.result.items.length>0?e.result.items:null,[e]),s=L.exports.useMemo(()=>n.layers&&r?n.layers.reduce((a,c)=>{const l=c(r,i);return Array.isArray(l)?[...a,...l]:[...a,l]},[]):[],[r,n.layers]),o=L.exports.useCallback(a=>{const{offsetX:c,offsetY:l}=a.nativeEvent,u=t.current.pickObject({x:c,y:l,radius:3});u&&n.onClick&&n.onClick(u)},[n.onClick,t]);return w("div",{onClick:o,children:w(lu,{ref:t,initialViewState:n.initialViewState,controller:!0,onViewStateChange:n.onViewStateChange,layers:s,getTooltip:n.tooltip?a=>n.tooltip({...a,graph:i,search:e}):null,children:w(hc,{mapStyle:n.mapStyle})})})},ET=n=>{const t=L.exports.useRef(null),[e,i]=Ue(ki),[r,s]=L.exports.useState(gi(e)?e:null),[o,a]=L.exports.useState(),[c]=nh(o,200);return L.exports.useEffect(()=>{c&&i(c)},[c]),L.exports.useEffect(()=>{if(t.current&&!r){const l=ou(n.defaultBounds,t.current);s(l)}},[t.current]),L.exports.useEffect(()=>{t.current&&r&&gi(e)&&s(e)},[e]),w("div",{ref:t,className:"p6o-map-container",children:r&&w(yT,{...n,initialViewState:r,onViewStateChange:l=>a(l.viewState)})})},vT=[0,"rgba(49, 54, 149, 0)",.1,"#313695",.2,"#4575b4",.3,"#74add1",.4,"#abd9e9",.5,"#e0f3f8",.6,"#fee090",.7,"#fdae61",.8,"#f46d43",.9,"#d73027",1,"#a50026"],TT=n=>({type:"heatmap",paint:{"heatmap-weight":1,"heatmap-intensity":["interpolate",["linear"],["zoom"],0,.2,9,2.5],"heatmap-color":["interpolate",["linear"],["heatmap-density"],...n],"heatmap-radius":["interpolate",["linear"],["zoom"],0,1,12,28],"heatmap-opacity":["interpolate",["linear"],["zoom"],8,1,10,0]}}),wT=n=>({type:"circle",paint:{"circle-radius":["interpolate",["linear"],["number",["get","count"],0],0,5,4e3,20],"circle-color":["case",["==",["get","is_centroid"],!0],"#808080",n],"circle-stroke-color":["case",["==",["get","is_centroid"],!0],Ur("#808080").darken().hex(),Ur(n).darken().hex()],"circle-stroke-width":1,"circle-opacity":["interpolate",["linear"],["zoom"],7,0,10,["case",["==",["get","is_centroid"],!0],.5,1]],"circle-stroke-opacity":["interpolate",["linear"],["zoom"],7,0,10,["case",["==",["get","is_centroid"],!0],.5,1]]}}),AT=n=>({type:"circle",paint:{"circle-radius":n,"circle-color":"transparent","circle-stroke-width":0,"circle-opacity":.5,"circle-stroke-opacity":0}}),ST=n=>{const t=ce(),e=TT(vT),i=wT(n.color),r=t.isTouchDevice?AT(15):null;return U(ih,{type:"geojson",data:n.data,children:[r&&w(sr,{id:`${n.id}-clickbuffer`,...r}),w(sr,{id:`${n.id}-ht`,...e}),w(sr,{id:`${n.id}-pt`,...i})]})},xT={MapLibre:aT,MapLibreDeckGL:ET};const uu=(n,t,e,i=[15,0,0,15])=>{var c;const[r,s]=L.exports.useState(t+i[3]),[o,a]=L.exports.useState(e+i[0]);return L.exports.useEffect(()=>s(t),[t]),L.exports.useEffect(()=>a(e),[e]),L.exports.useEffect(()=>{var l,u;if(n.current){const h=(l=n.current.firstChild)==null?void 0:l.getBoundingClientRect(),g=(u=n.current.closest(".p6o-map-container"))==null?void 0:u.getBoundingClientRect();if(h&&g){const m=h.right+i[1]>g.right,b=h.bottom+i[2]>g.bottom;m&&s(g.right-h.width-i[1]-i[3]),b&&a(g.bottom-h.height-i[0]-i[2])}}},[(c=n.current)==null?void 0:c.getBoundingClientRect()]),{top:o,left:r}},PT=n=>{const t=ce(),e=L.exports.useRef(null),{selected:i,viewState:r,map:s,popup:o}=n,[a,c]=L.exports.useState({left:0,top:0}),{top:l,left:u}=t.size===gt.DESKTOP?uu(e,a.left,a.top):{top:0,left:0};L.exports.useEffect(()=>{var g;if(i&&t.size===gt.DESKTOP){const m=(g=rh(i.feature))==null?void 0:g.geometry.coordinates,{x:b,y}=s.project(m);c({left:b,top:y})}else i&&c({left:0,top:0})},[i,r,t.size]);const h=L.exports.useMemo(()=>i?o({...n,onClose:n.onClose}):null,[i]);return h&&U("div",{className:t.size===gt.DESKTOP?"p6o-map-popup-container":"p6o-map-popup-container-mobile",style:{zIndex:9,position:"absolute",top:l,left:u},children:[w("button",{className:"p6o-map-popup-close",onClick:n.onClose,children:w(gs,{})}),w("main",{ref:e,children:h})]})},MT=n=>{const t=L.exports.useRef(null),{x:e,y:i,node:r,feature:s,tooltip:o}=n,{left:a,top:c}=uu(t,e,i),l=L.exports.useMemo(()=>r?o({node:r,feature:s}):null,[r,s]);return l&&w("div",{ref:t,className:"p6o-map-tooltip-container",style:{left:a,top:c,zIndex:1},children:l})},Xi=()=>{const{current:n,...t}=sh();return Object.values(t)[0]},hu=()=>{const n=Xi(),[t,e]=Ue(ki);return{viewState:t,setViewState:e,getMapBounds:()=>{if(n)return n.getBounds().toArray()}}};const LT=()=>{const n=Xi(),{setViewState:t}=hu(),e=s=>{const{latitude:o,longitude:a}=s.coords;t({latitude:o,longitude:a,zoom:12}),n==null||n.easeTo({center:[a,o],zoom:12})},i=s=>console.warn("Error fetching location: "+s.message);return w("button",{className:"p6o-controls-btn p6o-my-location",tabIndex:40,"aria-label":"Go to my location",onClick:()=>navigator.geolocation.getCurrentPosition(e,i,{enableHighAccuracy:!0}),children:w(oh,{})})};const RT=n=>w("div",{className:"p6o-controls-container",children:n.children});const IT=()=>{const n=Xi(),[t,e]=Ue(ki),i=r=>()=>{n&&e({...t,zoom:t.zoom+r,transitionDuration:200}),n==null||n.easeTo({zoom:n.getZoom()+r})};return U("div",{className:"p6o-zoom-container",children:[w("button",{className:"p6o-controls-btn p6o-zoom p6o-zoom-in",tabIndex:31,"aria-label":"Zoom in",onClick:i(1),children:w(ah,{})}),w("button",{className:"p6o-controls-btn p6o-zoom p6o-zoom-out",tabIndex:32,"aria-label":"Zoom out",onClick:i(-1),children:w(ch,{})})]})},Ci={ARCHIVE:"#7eb0d5",BOOK:"#ede15b",EPHEMERA:"#ef9b20","GENIZA MANUSCRIPT":"#8a3800",KETUBBA:"#b2e061",MANUSCRIPT:"#bdcf32",MAP:"#edbf33",MOVIE:"#b33dc6",MUSIC:"#f46a9b",NEWSPAPER:"#bd7ebe",ORAL:"#87bc45",PHOTOGRAPH:"#ea5545",PICTURE:"#fd7f6f",SCORE:"#27aeef"};const CT=n=>/^[\u04c7-\u0591\u05D0-\u05EA\u05F0-\u05F4\u0600-\u06FF\u0750-\u077f]/.test(n),OT=n=>{const{record:t}=n,{title:e,thumbnailURI:i,type:r}=t;return U("div",{className:"kima-listpreview-card",onClick:n.onClick,children:[w("h5",{style:CT(e)?{direction:"rtl"}:null,children:e}),i&&w("div",{className:"kima-listpreview-image-wrapper",style:{backgroundImage:`url(${i})`,borderColor:Ci[r.label]}})]})},ac=[45,25],kT=(n,t,e)=>{var c;const i=ce(),[r,s]=L.exports.useState(t),[o,a]=L.exports.useState(e);return L.exports.useEffect(()=>s(t),[t]),L.exports.useEffect(()=>a(e),[e]),L.exports.useEffect(()=>{n.current&&i.size==="DESKTOP"&&setTimeout(()=>{var h,g;const l=(h=n.current)==null?void 0:h.getBoundingClientRect(),u=(g=n.current.closest(".p6o-map-container"))==null?void 0:g.getBoundingClientRect();if(l&&u){const m=l.right>u.right,b=l.bottom>u.bottom;m&&s(u.right-l.width-ac[0]),b&&a(u.bottom-l.bottom-ac[1])}},1)},[(c=n.current)==null?void 0:c.getBoundingClientRect()]),{top:o,left:r}};const NT=n=>{const{image:t}=n;return w(lh,{mainSrc:t,onCloseRequest:n.onClose})},DT=n=>{if(!!n.descriptions&&!!Array.isArray(n.descriptions))return n.descriptions[0].value},cc={ARCHIVE:w(uh,{}),BOOK:w(hh,{}),EPHEMERA:w(fh,{}),"GENIZA MANUSCRIPT":w(or,{}),KETUBBA:w(or,{}),MANUSCRIPT:w(or,{}),MAP:w(dh,{}),MOVIE:w(gh,{}),MUSIC:w(ho,{}),NEWSPAPER:w(fo,{}),"NEWSPAPER ARTICLE":w(fo,{}),ORAL:w(ph,{}),PHOTOGRAPH:w(mh,{}),PICTURE:w(_h,{}),SCORE:w(ho,{})};const lc=n=>/^[\u04c7-\u0591\u05D0-\u05EA\u05F0-\u05F4\u0600-\u06FF\u0750-\u077f]/.test(n),uc=n=>{const t=L.exports.useRef(),{record:e}=n,{id:i,presentationURI:r,thumbnailURI:s,title:o,type:a}=e,c=L.exports.useMemo(()=>DT(e),[e]),[l,u]=L.exports.useState(!1),[h,g]=L.exports.useState(!1),[m,b]=L.exports.useState(),y=(a==null?void 0:a.label)==="ORAL"||(a==null?void 0:a.label)==="MUSIC",[E,T]=L.exports.useState(!1),{top:A,left:S}=kT(t,10,-10);return L.exports.useEffect(()=>{if(y&&r&&fetch("https://kimanli.azurewebsites.net/api/cors-proxy",{method:"POST",body:r}).then(x=>x.text()).then(x=>{console.log("proxy response",x),window.setTimeout(()=>b(x),2e3)}),r||s){const x=document.createElement("img");x.onerror=()=>T(!0),x.src=r||s}},[r]),w("div",{className:"kima-selected-card-wrapper",children:U("div",{ref:t,className:"kima-selected-card",style:{top:A,left:S},onClick:n.onClick,children:[w("header",{children:(r||s)&&!E?y&&m?w("audio",{controls:!0,crossOrigin:"anonymous",children:w("source",{src:m})}):U(ps,{children:[w("div",{className:"kima-selected-preview-loading",children:w(fc,{})}),w("div",{className:"kima-selected-preview",style:{backgroundImage:`url("${r||s}")`}}),r&&w("button",{className:"kima-selected-fullscreen",onClick:()=>u(!0),children:w(dc,{})})]}):w("div",{className:"kima-selected-preview",children:cc[a.label]})}),U("main",{children:[U("div",{style:lc(o)?{direction:"rtl"}:null,children:[w("h1",{children:o}),U("h2",{className:"type",children:[cc[a.label],w("span",{className:"label",children:a.label})]})]}),c&&w("p",{style:lc(c)?{direction:"rtl"}:null,children:c})]}),U("footer",{children:[w("a",{href:i,target:"_blank",children:U("section",{className:"details",children:[w("span",{children:"Details"}),w("span",{children:w(bh,{})})]})}),U("section",{className:"close",style:{borderBottomColor:Ci[a.label]},children:[w("button",{className:"share",onClick:()=>g(!0),children:w(yh,{})}),w("button",{className:"close",onClick:n.onClose,children:"Close"})]})]}),r&&l&&w(NT,{image:r,onClose:()=>u(!1)}),h&&w(_c,{onClose:()=>g(!1),children:w("div",{className:"easter-egg",children:U("main",{children:[w("h1",{children:"Vote for us!"}),w("p",{children:"If the NLI Heritage Browser makes it to the winner's podium, we will build lots of additional great features - such as the ability to share items and maps on social media."})]})})})]})})},FT=n=>{var c;const t=Oi(),{node:e}=n.selected,[i,r]=L.exports.useState([]),[s,o]=L.exports.useState(),a=((c=e.descriptions)==null?void 0:c.length)>0?e.descriptions[0].value:null;return L.exports.useEffect(()=>{o(null),r([]);const l=h=>{const g=new Set(u.map(b=>b.id)),m=h.records.filter(b=>!g.has(b.id));m.length>0&&r([...u,...m.slice(0,500)])},u=t.getConnected(e.id,!0,l);r(u)},[e]),U("div",{className:"kima-popup-wrapper",children:[U("div",{className:"kima-popup-expanded",children:[i.length===1&&w(uc,{record:i[0],onClose:n.onClose}),s&&w(uc,{record:s,onClose:()=>o(null)})]}),i.length>1&&U("div",{className:"kima-popup-multilist",children:[U("header",{children:[U("h1",{children:[w("a",{href:e.id,target:"_blank",title:"This place in KIMA",children:e.properties.title}),e.externalURI&&w("a",{href:e.externalURI,target:"_blank",title:"This place in Wikidata",children:w(Eh,{title:"This place in Wikidata"})})]}),w("p",{className:"kima-description",children:a})]}),w("div",{className:"kima-popup-multilist-list",children:i.map(l=>w(OT,{record:l,onClick:()=>o(l)},l.id))})]})]})},fu={headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST"};class UT extends Error{constructor(t,e){super(t),this.status=e}}const Fe=n=>{if(n.status===200)return n.json();throw new UT("API Error",n.status)},Gs=n=>{const t={};return n.forEach(({name:e,values:i})=>t[e]=i),Object.keys(t.length>0)?t:null},BT=n=>(t=null,e=[],i)=>{if(t){const[[r,s],[o,a]]=t;return e.length>0?fetch(`${n}/BoxPlaces/${r}/${s}/${o}/${a}`,{signal:i,...fu,body:JSON.stringify(Gs(e))}).then(Fe):new Promise(c=>setTimeout(c,50)).then(()=>fetch(`${n}/BoxPlaces/${r}/${s}/${o}/${a}`,{signal:i})).then(Fe)}else return fetch(`${n}/Places`,{signal:i}).then(Fe)},VT=n=>(t=null,e=[],i)=>{if(t){const[[r,s],[o,a]]=t;return e.length>0?fetch(`${n}/BoxRecords/${r}/${s}/${o}/${a}`,{signal:i,...fu,body:JSON.stringify(Gs(e))}).then(Fe):fetch(`${n}/BoxRecords/${r}/${s}/${o}/${a}`,{signal:i}).then(Fe)}else return fetch(`${n}/Records`,{signal:i}).then(Fe)},jT=n=>{const{search:t,setSearchState:e}=Sn(),[i,r]=L.exports.useState(),s=BT(n.api),o=VT(n.api);return L.exports.useEffect(()=>{if(t.status===se.PENDING){n.onLoad(),i&&i.abort();const a=new AbortController;r(a),console.log("Running search");const{signal:c}=a;Promise.all([s(n.bounds,t.args.filters,c),o(n.bounds,t.args.filters,c)]).then(([l,u])=>{r(null),console.log("Places",l),console.log("Records",u);const h=l.features.reduce((m,b)=>m+(b.properties.total_records||1),0),g=l.features.map(m=>({...m,properties:{id:m.id,count:m.properties.total_records,...m.properties}}));e({args:{...t.args},status:se.OK,result:{total:h,items:g,aggregations:Object.entries(u.facetsInfo).reduce((m,[b,y])=>(m[b]={buckets:y.map(E=>({label:E.label,count:E.countFaceted}))},m),{})}}),n.onLoadDone(),n.onSearchResult({places:l,records:u})}).catch(l=>{console.log(l),l.status===500&&e({...t,status:se.PENDING})})}},[t]),L.exports.useEffect(()=>{n.bounds&&e({args:t.args,status:se.PENDING,result:t.result})},[n.bounds]),n.children},du=n=>n.substring(n.lastIndexOf("=")+1),zT=n=>{const{records:t}=n,e={};return t.forEach(i=>{const{places:r}=i;r.forEach(s=>{const o=du(s.id);e[o]?e[o].push(i):e[o]=[i]})}),e},GT=n=>{const[t,e]=L.exports.useState(),{search:i}=Sn(),{results:r}=n,s=r==null?void 0:r.places.features,o=r==null?void 0:r.records,a=L.exports.useMemo(()=>o?zT(o):null,[n.results]),c=l=>a?a[l]||[]:[];return L.exports.useEffect(()=>{e({getNodeById:h=>s==null?void 0:s.find(g=>g.id===h),getConnected:(h,g,m)=>{var y;const b=du(h);return g?((((y=i.args.filters)==null?void 0:y.length)>0?fetch("https://kimanli.azurewebsites.net/api/Records/"+b,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",body:JSON.stringify(Gs(i.args.filters))}):fetch("https://kimanli.azurewebsites.net/api/Records/"+b)).then(T=>T.json()).then(T=>m(T)),c(b)):new Promise(E=>E(c(b)))}})},[n.results]),w(mc.Provider,{value:t,children:n.children})},HT=n=>{const{longitude:t,latitude:e,zoom:i}=n;return!!(t&&e&&i)},WT=n=>{const{viewState:t,setViewState:e,getMapBounds:i}=hu(),[r]=vh(t,250),s=Xi(),o=L.exports.useMemo(()=>{if(HT(r))return i()},[s,r]),[a,c]=L.exports.useState();return w(jT,{api:n.api,bounds:o,onLoad:n.onLoad,onLoadDone:n.onLoadDone,onSearchResult:l=>c(l),children:w(GT,{api:n.api,bounds:o,results:a,children:n.children})})},XT=n=>{var c,l;const t=Oi(),e=ce(),[i,r]=L.exports.useState([]),{node:s}=n;L.exports.useEffect(()=>{t.getConnected(s.id,!1).then(r)},[]);const o=((c=s.descriptions)==null?void 0:c.length)>0?s.descriptions[0].value:null,a=s.properties.total_records;return e.size==="DESKTOP"?U("div",{dir:"rtl",className:"kima-tooltip",children:[U("main",{children:[w("h1",{children:s.properties.title}),w("p",{className:"kima-description",children:o})]}),a===1&&i.length>0&&U("div",{className:"kima-tooltip-footer kima-first-connected",children:[i[0].title," ",((l=i[0].type)==null?void 0:l.label)&&U("span",{children:["(",i[0].type.label,")"]})]}),a>1&&i.length>0&&U("div",{className:"kima-tooltip-footer kima-connected-count",dir:"ltr",children:[a.toLocaleString()," Objects"]})]}):null};const YT=n=>{const t=ce();return w("div",{className:t.size==="DESKTOP"?"kima-load-indicator p6o-controls-btn":"kima-load-indicator p6o-controls-btn mobile",children:w(fc,{})})};window.global||(window.global=window);const qT=new Th,ZT=()=>{const[n,t]=L.exports.useState(!0);return w(Ah,{client:qT,children:w(Lh,{children:U(WT,{api:"https://kimanli.azurewebsites.net/api",onLoad:()=>t(!0),onLoadDone:()=>t(!1),children:[w(xT.MapLibre,{mapStyle:"https://api.maptiler.com/maps/voyager/style.json?key=RFavxpVJ82EHyrN2kxsF",defaultBounds:[[32,27.1],[38.2,35.7]],tooltip:e=>w(XT,{...e}),popup:e=>w(FT,{...e}),children:w(ST,{id:"kima-layer-places",color:"#9d00d1"})}),U(RT,{children:[w(mo,{children:w(Nh,{items:[w(go,{colors:Ci,fullscreen:!0,displayFacets:["RecordTypes","RelationshipTypes"],facetLabels:["Record Types","Relationships"]})]})}),w(po,{children:w(go,{colors:Ci,responsive:!0,displayFacets:["RecordTypes","RelationshipTypes"],facetLabels:["Record Types","Relationships"]})}),w(IT,{}),w(LT,{}),U(kh,{className:"kima-welcome",children:[w("h1",{children:"Welcome to the Heritage Browser!"}),w("p",{children:"Discover the digitally available treasures of the National Library of Israel displayed on a map according to where they were created or locations they describe."}),U("ul",{children:[w("li",{children:"Move the map around by dragging it and use the buttons on the right or your mouse to zoom in and out."}),w("li",{children:"Click on a place to see the number of items related to it, as well as links to wikidata and the Kima Gazetteer. Another click will open a list of related items."}),U("li",{children:["After opening an item, use the ",w(dc,{})," icon to enlarge the image. Click Details to view the item's details at the library's website."]}),w(po,{children:w("li",{children:"Use the left bar to filter the types of items that interest you, or change the bar from Record Types to Relationship Types to filter items according to their relation to the place."})}),w(mo,{children:U("li",{children:["Click the ",w(Sh,{})," icon to filter the types of items that interest you, or change the bar from Record Types to Relationship Types to filter items according to their relation to the place."]})}),U("li",{children:["The ",w(xh,{})," button on the right of the screen will focus the map on your current location."]})]}),U("p",{children:["Created by ",w("a",{href:"mailto:sinai.rusinek@mail.huji.ac.il",children:"Sinai Rusinek"}),", ",w("a",{href:"mailto:gil.shalit@gmail.com",children:"Gil Shalit"})," and ",w("a",{href:"mailto:hello@rainersimon.io",children:"Rainer Simon"})," and was a finalist in the ",w("a",{href:"https://tarboot.org/",target:"_blank",children:"tarboot"}),"competition's general track."]})]}),n&&w(YT,{})]})]})})})};window.onload=function(){wh.createRoot(document.getElementById("app")).render(w(ZT,{}))};
